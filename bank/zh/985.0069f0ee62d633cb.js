"use strict";(self.webpackChunkbank=self.webpackChunkbank||[]).push([[985],{3985:(et,z,x)=>{x.r(z),x.d(z,{DemoModule:()=>wt});var R=x(6895),A=x(4793),L=x(1281),D=x(1135),I=x(727),q=x(9300),Z=x(7331),O=x(7445),B=x(4004),M=x(2516);function w([o,f,e]){const t=1<<e;return[o-Math.floor(o/t)*t,f-Math.floor(f/t)*t,e]}var u=x(4650);const T=Math.PI/180,_=180/Math.PI,X=new u.OlP("MAP_PROJECTION");function ot(o,f){for(var e=0,t=0;o.length>e;++e)t+=o[e]*f[e];return t}let G=(()=>{class o{constructor(e){this._projection=e,this._path=M.l49().projection(e)}get d3Projection(){return this._projection}get geoPath(){return this._path}fromLatLngToPoint(e){return this._projection(e)}fromPointToLatLng(e,t=!1){return this._projection.invert(e)}fromLatLngToRotate(e){const t=e[0]*T,n=e[1]*T;return[Math.cos(n)*Math.cos(t),Math.cos(n)*Math.sin(t),Math.sin(n)]}getCenter(){return[-this.wrapLong(this._projection.rotate()[0]),-this.wrapLat(this._projection.rotate()[1])]}getZoom(){return Math.round(Math.max(Math.log2(this.getRadius()*(2*Math.PI)/this.getTileSize()),0))}getRadius(){return this._projection.scale()}setRadius(e){this._projection.scale(e/(2*Math.PI))}getTileSize(){return 256}setDimension(e,t){this._projection.translate([e/2,t/2])}wrapLat(e,t=-90,n=90){const a=n-t,s=Math.pow(-1,Math.floor(e/a));return(e=Math.abs(e%a)*s)>=t&&e<=n||(e=(a-e*s)*s),e}wrapLong(e,t=-180,n=180){return e>=t&&e<n||(e=((e-t)%(n-=t)+n)%n+t),e}eulerAngles(e,t,n){const a=.5*n[0]*T,s=.5*n[1]*T,p=.5*n[2]*T,c=Math.sin(a),i=Math.cos(a),h=Math.sin(s),l=Math.cos(s),y=Math.sin(p),P=Math.cos(p),d=[i*l*P+c*h*y,c*l*P-i*h*y,i*h*P+c*l*y,i*l*y-c*h*P],r=this.fromLatLngToRotate(e),g=this.fromLatLngToRotate(t),m=function ct(o,f){return[o[1]*f[2]-o[2]*f[1],o[2]*f[0]-o[0]*f[2],o[0]*f[1]-o[1]*f[0]]}(r,g),S=Math.sqrt(ot(m,m));if(0===S)return n;const v=.5*Math.acos(Math.max(-1,Math.min(1,ot(r,g)))),b=m[2]*Math.sin(v)/S,j=-m[1]*Math.sin(v)/S,Y=m[0]*Math.sin(v)/S,F=Math.cos(v),C=v&&[F,b,j,Y],$=d[0],H=d[1],W=d[2],J=d[3],K=C[0],N=C[1],V=C[2],Q=C[3],E=[$*K-H*N-W*V-J*Q,H*K+$*N+W*Q-J*V,$*V-H*Q+W*K+J*N,$*Q+H*V-W*N+J*K];return[Math.atan2(2*(E[0]*E[1]+E[2]*E[3]),1-2*(E[1]*E[1]+E[2]*E[2]))*_,Math.asin(Math.max(-1,Math.min(1,2*(E[0]*E[2]-E[3]*E[1]))))*_,Math.atan2(2*(E[0]*E[3]+E[1]*E[2]),1-2*(E[2]*E[2]+E[3]*E[3]))*_]}}return o.\u0275fac=function(e){return new(e||o)(u.LFG(X))},o.\u0275prov=u.Yz7({token:o,factory:o.\u0275fac}),o})();const ht={provide:X,deps:[[new u.FiY,new u.tp0,X]],useFactory:function lt(o,f){return o}};var tt=x(1481);let nt=(()=>{class o{constructor(e){this.titleService=e,this.oldTitle=e.getTitle()}ngOnDestroy(){this.titleService.setTitle(this.oldTitle)}setTitle(e){this.titleService.setTitle(e)}}return o.\u0275fac=function(e){return new(e||o)(u.Y36(tt.Dx,8))},o.\u0275dir=u.lG2({type:o}),o})();const U=new u.OlP("MAP_SOURCE");let pt=(()=>{class o{constructor(e){this.locale=e}url(e,t,n){return`https://khms1.googleapis.com/kh?v=917&hl=${this.locale}&x=${e}&y=${t}&z=${n}`}}return o.\u0275fac=function(e){return new(e||o)(u.LFG(u.soG))},o.\u0275prov=u.Yz7({token:o,factory:o.\u0275fac}),o})();const st={provide:U,deps:[[new u.FiY,new u.tp0,U],u.soG],useFactory:function ut(o,f){return o||new pt(f)}};var mt=x(5589);let at=(()=>{class o{constructor(){}mapMatrixToSphere(e,t,n,a,s,p){const c=t[0]*T,i=n[0]*T,h=t[1]*T,l=n[1]*T,y=new Uint8ClampedArray(p*p*4);let P,d,r;a=[a[0]*T,a[1]*T,a[2]*T];for(let g=0;g<p;g++)for(let m=0;m<p;m++)P=this.mapPoint([g,m],c,i,h,l,a,s,p),d=4*(g+m*p),r=4*(P[0]+s+(P[1]+s)*p),y[r]=e[d],y[r+1]=e[d+1],y[r+2]=e[d+2],y[r+3]=e[d+3];return y}mapPoint(e,t,n,a,s,p,c,i){const h=this.mapCoordinate(0,i-1,n,t,e[0]),l=this.mapCoordinate(0,i-1,a,s,e[1]);let r,y=c*Math.sin(l)*Math.cos(h),P=c*Math.sin(l)*Math.sin(h),d=c*Math.cos(l);return r=this.rotate(p[0],P,d),P=r.r1,d=r.r2,r=this.rotate(p[1],y,d),y=r.r1,d=r.r2,[y,P,d]}mapCoordinate(e,t,n,a,s){return(s-e)/(t-e)*(a-n)+n}rotate(e,t,n){return{r1:t*Math.cos(e)-n*Math.sin(e),r2:t*Math.sin(e)+n*Math.cos(e)}}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=u.Yz7({token:o,factory:o.\u0275fac}),o})(),ft=(()=>{class o extends nt{constructor(e,t,n,a,s,p,c,i){super(e),this.elementRef=t,this.renderer=n,this.document=a,this.viewportRuler=s,this.mapSource=p,this.mapProjection=c,this.sphereSurface=i,this.hostClassList="d-flex flex-column flex-nowrap w-100 h-100",this.mapZoomEvent=new D.X(null),this.subscription=new I.w0,this.setTitle("Demo d3 Earth")}ngOnInit(){this.zoom=M.sPX().on("zoom",t=>{this.mapZoomEvent.next(t)}),this.drag=M.ohM().on("drag",t=>{const n=this.mapProjection.d3Projection.rotate();if(0!==t.dx&&0!==t.dy){const a=this.mapProjection.fromPointToLatLng([t.x,t.y]),s=this.mapProjection.fromPointToLatLng([t.x-t.dx,t.y-t.dy]);this.mapProjection.d3Projection.rotate(this.mapProjection.eulerAngles(s,a,n)),this.mapZoomEvent.next({sourceEvent:t.sourceEvent,target:null,type:t.type,transform:this.mapZoomEvent.value?.transform})}}),this.mapZoomEvent.next({sourceEvent:{},target:null,type:"",transform:M.CRH});const e=this.renderer.createElement("canvas");this.renderer.setStyle(e,"position","absolute"),this.renderer.setStyle(e,"top","0"),this.renderer.setStyle(e,"left","0"),this.renderer.setStyle(e,"width","100%"),this.renderer.setStyle(e,"height","100%"),this.renderer.appendChild((0,L.fI)(this.elementRef),e),this.surfaceContext=e.getContext("2d")}ngAfterViewInit(){const e=(0,L.fI)(this.elementRef),t=M.Ue8("svg"),n=t.append("g").attr("class","map-content"),s=(n.append("path").attr("class","view-edge").attr("fill-opacity",.3).attr("fill","green").attr("stroke-width",0),n.append("g").attr("class","map-sphere").attr("fill","transparent").attr("stroke-width",1).attr("stroke","#888888"));s.append("path").attr("class","map-graticule"),this.content=t,t.append("clipPath").attr("id","rect-clip").append("rect").attr("x",0).attr("y",0),e.appendChild(t.node()),this.setViewDimension(),t.call(this.zoom).call(this.zoom.transform,this.mapZoomEvent.value.transform),s.call(this.drag),s.on("click",c=>{console.log(this.mapProjection.fromPointToLatLng([c.offsetX,c.offsetY]))}),this.mapZoomEvent.pipe((0,q.h)(c=>null!==c),(0,Z.D)(c=>{const i=c.sourceEvent?.type;return(0,O.F)("mousemove"===i||"touchmove"===i?0:100)}),(0,B.U)(c=>{const i=this.mapProjection,h=this.getDimension(),l=this.zoom.scaleExtent();let y=Math.min(l[1],Math.max(l[0],Math.ceil(c.transform.k))),P=h.width>>1,d=h.height>>1;return i.d3Projection.translate([P,d]),i.setRadius(y),{...c,transform:new M.axH(y,P,d)}})).subscribe(c=>{console.log(c),this.render(c.transform)}),this.subscription.add(this.viewportRuler.change(100).subscribe(()=>{console.log("viewportRuler => change"),this.setViewDimension()}))}ngOnDestroy(){super.ngOnDestroy(),this.mapZoomEvent.complete(),this.subscription.unsubscribe()}setViewDimension(){const e=this.getDimension(),t=e.width,n=e.height,a=this.mapProjection.getTileSize(),s=Math.floor(Math.min(t,n)*Math.PI*.618),p=a<<18;let c=this.mapZoomEvent.value.transform;this.content.attr("viewBox",[0,0,t,n]),this.content.select("clipPath > rect").attr("width",t).attr("height",n),this.zoom.extent([[0,0],[t,n]]).scaleExtent([s,p]),c=c.translate(t>>1,n>>1),c.k<s&&(c=c.scale(s)),this.mapZoomEvent.next({...this.mapZoomEvent.value,transform:c})}render(e){const t=this.mapProjection;console.log(`transform: ${e}`),console.log(t.getRadius());const n=t.getZoom(),a=1<<n,s=360/a,p=180/a,c=t.getCenter(),i=this.getDimension(),h=i.width,l=i.height,y=this.content.select(".map-graticule");let m,P=0,d=h,r=0,g=l;P=0,d=h,r=0,g=l,m=[t.fromPointToLatLng([0,0]),t.fromPointToLatLng([d,0]),t.fromPointToLatLng([d,g]),t.fromPointToLatLng([0,g]),t.fromPointToLatLng([0,0])],m[0]=m[4]=[t.wrapLong(Math.floor(m[0][0]/s)*s),t.wrapLat(Math.ceil(m[0][1]/p)*p)],m[1]=[t.wrapLong(Math.ceil(m[1][0]/s)*s),t.wrapLat(Math.ceil(m[1][1]/p)*p)],m[2]=[t.wrapLong(Math.ceil(m[2][0]/s)*s),t.wrapLat(Math.floor(m[2][1]/p)*p)],m[3]=[t.wrapLong(Math.floor(m[3][0]/s)*s),t.wrapLat(Math.floor(m[3][1]/p)*p)];const v=M.SaU().step([s,p]).precision(p)();console.log(`stepDegX: ${s} | stepDegY: ${p}`),y.attr("d",t.geoPath(v)),console.log(m),console.log(`center: ${c}`),console.log(`${n} <=> ${a}`),this.content.select(".view-edge").attr("d",t.geoPath({type:"Polygon",coordinates:[m]})),this.showGuideline(m,s,p),this.brushTiles(m,s,p,n,a)}brushTiles(e,t,n,a,s){const p=this.mapSource,c=this.mapProjection,i=this.sphereSurface,h=this.mapProjection.getTileSize(),l=this.document.createElement("canvas"),y=l.getContext("2d"),P=this.surfaceContext,d=[];l.width=l.height=h;for(let r=e[0][0];r<=e[2][0];r=c.wrapLong(r+t)){for(let g=e[2][1];g<=e[0][1]&&(d.push([r,g]),M.BHj(p.url.apply(p,w([r/t,g/n,a])),{crossOrigin:"anonymous"}).then(m=>{y.drawImage(m,0,0,h,h),P.putImageData(new ImageData(i.mapMatrixToSphere(y.getImageData(0,0,h,h).data,[r,g],[c.wrapLong(r+t),c.wrapLat(g+n)],c.d3Projection.rotate(),c.getRadius(),h),h,h),0,0)}),!(d.length>=s));g=c.wrapLat(g+n));if(d.length>=s)break}}showGuideline(e,t,n){const a=this.mapProjection,s=M.ut0().domain([-180,-91,-90,-1,1,89,90,180]).range(["blue","blue","green","green","black","red","red","yellow"]),p=[],c=this.content.select(".map-sphere");c.selectAll(".bounds-point").data(e).join("path").attr("class","bounds-point").attr("stroke","black").attr("stroke-width",2).attr("d",i=>a.geoPath({type:"Point",coordinates:i})).on("click",function(i){console.log(M.Ys(i.target).data()[0]),i.stopPropagation()});for(let i=-180;i<=180;i+=t)p.push([i,0]);for(let i=-90;i<=90;i+=n)p.push([0,i]);c.selectAll(".grid-point").data(p).join("path").attr("class","grid-point").attr("fill",function(i){return s(i[0]||i[1])}).attr("stroke-width",0).attr("d",i=>a.geoPath({type:"Point",coordinates:i})).on("click",function(i){console.log(M.Ys(i.target).data()[0]),i.stopPropagation()})}getDimension(){return(0,L.fI)(this.elementRef).getBoundingClientRect()}}return o.\u0275fac=function(e){return new(e||o)(u.Y36(tt.Dx),u.Y36(u.SBq),u.Y36(u.Qsj),u.Y36(R.K0),u.Y36(mt.rL),u.Y36(U),u.Y36(G),u.Y36(at))},o.\u0275cmp=u.Xpm({type:o,selectors:[["app-earth"]],hostVars:2,hostBindings:function(e,t){2&e&&u.Tol(t.hostClassList)},features:[u._Bn([st,{provide:X,useValue:M.WvA()},G]),u.qOj],decls:0,vars:0,template:function(e,t){},encapsulation:2}),o})();function dt(o){return o.k}function gt(o){return[o.x,o.y]}function rt(o){return function(){return o}}var yt=x(3238);const k=864e5,Pt=M.i$Z("%d"),xt=M.i$Z("%B"),Et=M.i$Z("%Y"),Tt=[{path:"earth",component:ft},{path:"map",component:(()=>{class o extends nt{constructor(e,t,n,a,s){super(e),this.elementRef=t,this.dateAdapter=n,this.mapSource=a,this.mapProjection=s,this.mapZoomEvent=new u.vpe,this.axisZoomEvent=new u.vpe,this.useScaleType="year",this.setTitle("Demo d3 Map")}ngAfterViewInit(){const e=(0,L.fI)(this.elementRef),t=e.getBoundingClientRect(),n=t.width,a=t.height,s=M.Ue8("svg").attr("viewBox",[0,0,n,a]);s.append("clipPath").attr("id","rect-clip").append("rect").attr("x",0).attr("y",0).attr("width",n).attr("height",a),this.createMapTiles(s,n,a),this.createXAxis(s,n,a),e.appendChild(s.node())}ngOnDestroy(){super.ngOnDestroy(),this.mapZoomEvent.complete(),this.axisZoomEvent.complete()}createMapTiles(e,t,n){const a=this.mapSource,s=this.mapProjection,p=s.getTileSize(),i=[Math.min(t,n),p<<18],h=function Mt(){let o=0,f=0,e=960,t=500,n=!0,a=!0,s=256,p=dt,c=gt,i=0;function h(){const l=+p.apply(this,arguments),y=c.apply(this,arguments),P=Math.log2(l/s),d=Math.round(Math.max(P+i,0)),r=Math.pow(2,P-d)*s,g=+y[0]-l/2,m=+y[1]-l/2,S=Math.max(n?0:-1/0,Math.floor((o-g)/r)),v=Math.min(n?1<<d:1/0,Math.ceil((e-g)/r)),b=Math.max(a?0:-1/0,Math.floor((f-m)/r)),j=Math.min(a?1<<d:1/0,Math.ceil((t-m)/r)),Y=[];for(let F=b;F<j;++F)for(let C=S;C<v;++C)Y.push([C,F,d]);return Y.translate=[g/r,m/r],Y.scale=r,Y}return h.size=function(l){return arguments.length?(o=f=0,e=+l[0],t=+l[1],h):[e-o,t-f]},h.extent=function(l){return arguments.length?(o=+l[0][0],f=+l[0][1],e=+l[1][0],t=+l[1][1],h):[[o,f],[e,t]]},h.scale=function(l){return arguments.length?(p="function"==typeof l?l:rt(+l),h):p},h.translate=function(l){return arguments.length?(c="function"==typeof l?l:rt([+l[0],+l[1]]),h):c},h.zoomDelta=function(l){return arguments.length?(i=+l,h):i},h.tileSize=function(l){return arguments.length?(s=+l,h):s},h.clamp=function(l){return arguments.length?(n=a=!!l,h):n&&a},h.clampX=function(l){return arguments.length?(n=!!l,h):n},h.clampY=function(l){return arguments.length?(a=!!l,h):a},h}().extent([[0,0],[t,n]]).tileSize(p).clampX(!1).clampY(!1),l=M.CRH.translate(t>>1,n>>1).scale(4096),y=M.sPX().scaleExtent(i).extent([[0,0],[t,n]]).on("zoom",r=>{let v,g=r.transform.k,m=r.transform.x,S=r.transform.y;g<=i[0]&&(g=i[0],S=n/2),g=Math.round(g),m=Math.round(m),S=Math.round(S),v=new M.axH(g,m,S),s.d3Projection.translate([m,S]),s.setRadius(g),this.mapZoomEvent.next({...r,transform:v})}),P=e.append("g").attr("class","map-content"),d=P.selectAll("g").data([-100,-2,-1,0]).join("g").attr("class","map-layer");this.mapZoomEvent.pipe((0,Z.D)(r=>{const g=r.sourceEvent?.type;return(0,O.F)("mousemove"===g||"touchmove"===g?0:100)})).subscribe(r=>{let m,g=s.getTileSize();d.each((S,v,b)=>{m=h.zoomDelta(S)(r.transform),g=m.scale,M.Ys(b[v]).selectAll("image").data(m).join("image").attr("xlink:href",j=>a.url.apply(a,w(j))).attr("x",j=>(j[0]+m.translate[0])*g).attr("y",j=>(j[1]+m.translate[1])*g).attr("width",g).attr("height",g).attr("class","map-tile").on("error",function(){M.Ys(this).style("opacity",0)})})}),P.call(y).call(y.transform,l).on("click",r=>{console.log(s.fromPointToLatLng([r.offsetX,r.offsetY]))})}createXAxis(e,t,n){const a=this.dateAdapter.today(),s=this.dateAdapter.addCalendarYears(a,-20),p=Math.ceil((a.valueOf()-s.valueOf())/k),c=e.append("g").attr("clip-path","url(#rect-clip)"),i=M.Xf().domain([s,a]).rangeRound([0,t]).nice(M.jBk),l=[[0,0],[t,30]],y=M.sPX().scaleExtent([1,Math.max(t/40,Math.min(365,p))]).translateExtent(l).extent(l).on("zoom",r=>{this.axisZoomEvent.next(r)}),P=M.LLu(i).tickSize(8).tickPadding(5).ticks(t/80).tickFormat(r=>(M.F0B(r)<r?Pt:M.jBk(r)<r?xt:Et)(r));let d=M.CRH.scale(t/(i(a)-i(s))).translate(-i(s),0);this.axisZoomEvent.subscribe(r=>{d=r.transform,this.useScaleType=d.k<=12?"year":d.k<=30?"month":"day",c.select(".x-axis").call(P.scale(d.rescaleX(i)))}),c.append("rect").attr("fill","white").attr("x",0).attr("y",n-30).attr("width",t).attr("height",30),c.append("g").attr("class","x-axis").attr("transform",`translate(0,${n-30})`).style("user-select","none").call(P),c.call(y).transition().duration(1500).call(y.transform,d),c.on("click",r=>{console.log(M.rr1(d.rescaleX(i).invert(r.offsetX)))})}createTimeInterval(e){return M.JZ7(t=>{switch(this.useScaleType){case"year":t.setMonth(0,1);break;case"month":t.setDate(1)}t.setHours(0,0,0,0)},(t,n)=>{switch(this.useScaleType){case"year":t.setFullYear(t.getFullYear()+n);break;case"month":t.setMonth(t.getMonth()+n);break;default:t.setDate(t.getDate()+n)}},(t,n)=>{const a=(n.valueOf()-t.valueOf()-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/k;return console.log(a),a<=60?e/60:e/80},t=>{switch(this.useScaleType){case"year":return t.getFullYear();case"month":return t.getMonth();default:return t.getDate()-1}})}}return o.\u0275fac=function(e){return new(e||o)(u.Y36(tt.Dx),u.Y36(u.SBq),u.Y36(yt._A),u.Y36(U),u.Y36(G))},o.\u0275cmp=u.Xpm({type:o,selectors:[["app-map"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],features:[u._Bn([st,ht,G]),u.qOj],decls:0,vars:0,template:function(e,t){},encapsulation:2}),o})()},{path:"",redirectTo:"map",pathMatch:"full"},{path:"**",redirectTo:"map"}];let St=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=u.oAB({type:o}),o.\u0275inj=u.cJS({imports:[A.Bz.forChild(Tt),A.Bz]}),o})(),vt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=u.oAB({type:o}),o.\u0275inj=u.cJS({providers:[at],imports:[R.ez]}),o})(),wt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=u.oAB({type:o}),o.\u0275inj=u.cJS({imports:[R.ez,St,vt]}),o})()},7445:(et,z,x)=>{x.d(z,{F:()=>L});var R=x(4986),A=x(5963);function L(D=0,I=R.z){return D<0&&(D=0),(0,A.H)(D,D,I)}},7331:(et,z,x)=>{x.d(z,{D:()=>I});var R=x(4482),A=x(5032),L=x(5403),D=x(8421);function I(q){return(0,R.e)((Z,O)=>{let B=!1,M=null,w=null;const u=()=>{if(w?.unsubscribe(),w=null,B){B=!1;const T=M;M=null,O.next(T)}};Z.subscribe((0,L.x)(O,T=>{w?.unsubscribe(),B=!0,M=T,w=(0,L.x)(O,u,A.Z),(0,D.Xf)(q(T)).subscribe(w)},()=>{u(),O.complete()},void 0,()=>{M=w=null}))})}}}]);