import{Sa as T,cb as M}from"./chunk-G7ELUQVO.js";import{h as y,pa as E}from"./chunk-GW7E2URU.js";import{d as f,g as m}from"./chunk-FZK3JXLQ.js";import{H as C,aa as S,ka as l,o as u,oa as h,s as A,y as k}from"./chunk-XEUUNI7X.js";import{a as b,g as D}from"./chunk-LO4PBWZP.js";var R=(()=>{class c{http;TIME_ZONE_ID="Asia/Shanghai";REQUST_HEADERS=new f({Accept:"application/json, text/plain, */*","Content-Type":"application/json"});domain="https://wxmp.zhongkangcloud.com/api";constructor(e){this.http=e}get(e,t){return this.http.get(this.domain+"/"+e,{headers:this.REQUST_HEADERS,responseType:"json",params:t,withCredentials:!0})}post(e,t){return this.http.post(this.domain+"/"+e,JSON.stringify(t),{headers:this.REQUST_HEADERS,responseType:"json",withCredentials:!0})}getDefaultHeaders(){return this.REQUST_HEADERS}static \u0275fac=function(t){return new(t||c)(h(m))};static \u0275prov=l({token:c,factory:c.\u0275fac})}return c})();var _=D(T());var j=/(\[[\u4e00-\u9fa5]+\])|(\([\u4e00-\u9fa5]+\))|(（[\u4e00-\u9fa5]+）)/g,K=(()=>{class c{http;dateAdapter;requestService;testSetRules=new Map;constructor(e,t,i){this.http=e,this.dateAdapter=t,this.requestService=i}signInViaWechat(e){return this.requestService.post("user/profile",{code:"091GNb00088WeM18qy200BbbLN2GNb06",encrypted_data:"+UUPxyb72hv/GyKJdrk3O+PWV1C8lkyKnhAuRuxW8QGVO8waBR36c1Ygu2GhZAZ5S6YqkB4bD69mYybj7bTp+5zZUcEVhIAvvGml0j6xfQWV+aWmOm2B9sNV8/WTlTZsIMUzkyGsHCwXTwer0s4xJtlXUiu0JdnwDvUEXpAl5z+9IiOdlAsZlBTaAwZ7mK731pLg5129tYEXc/w8eN12fv0sjho+vvmTkRtDNUbenc+lx9DhlL79N8qJ4OxcyFhl3RzdBpwXoNGSOOuCbFEVkCXPROh2hp0SoeFiR68fiUigAQIQBWrhEFDjSO9j+oB9KWK/qOV39eqSGiKMj/wUpVggOqbqDpTjvMSHmE7CRsLK6Jx8hhVoumMXe2S2Gb+K9DDp9qYszgxVtjM1tHuqY8FMV9RzpvUYsfv2s9jbS7e9p6P1x1KOxDyLT4/rlX9lsWElx++KU7Np9qvzZQtqTdj97m4ca0D6jjDUabU/23G44XGEPCKdKftCPMu5Uw+nFs1+NgTWfdrxHT27c4RffA==",iv:"EuZBQVwf0F85cqTdk84kvw==",userInfo:{nickName:"\u5FAE\u4FE1\u7528\u6237",gender:0,language:"",city:"",province:"",country:"",avatarUrl:"https://thirdwx.qlogo.cn/mmopen/vi_32/POgEwh4mIHO4nibH0KlMECNjjGxQUq24ZEaGT4poC6icRiccVGKSyXwibcPq4BWmiaIGuG1icwxaQX6grC9VemZoJ8rg/132"},hospitalCode:e})}getUserInfo(e,t=M){return this.http.post("https://wxmp.zhongkangcloud.com/api/user/profile",JSON.stringify({id:Number(e),hospitalCode:t}),{headers:new f({Accept:"application/json, text/plain, */*","Content-Type":"application/json"}),responseType:"json",withCredentials:!0}).pipe(A(i=>{let o=null;return i.success&&i.data.list[0]&&(o=i.data.list[0],o.wxid=i.data.wx.wxid+""),o}))}getMedicalRecords(e,t,i,o){return this.requestService.post("register/queryRegRecord",{hospitalCode:e,patient_id:t,start_date:this.formatDate(i),end_date:this.formatDate(o)})}getReportIds(e,t){return this.requestService.post("report/getIdsByAdm",{hospitalCode:e,adm:t})}getReportDetail(e,t){return this.requestService.post("report/getById",{hospitalCode:e,rid:t})}getReportsWithIds(e,t){return k(t.map(i=>this.getReportDetail(e,i).pipe(C(()=>u({data:{data:{report_msg:null}}})),A(o=>o.data.data.report_msg)))).pipe(A(i=>{let o=new Map,p=new Map,r,n;i.forEach(a=>{if(!a)return;let d={};if(r=this.testSetCodeMapping(a.test_set_code),r||a.result_msgs.some(s=>(r=this.testSetCodeMapping(s.test_code),!!s)),a.resultMap||(a.resultMap={}),a.result_msgs.forEach(s=>{n=r+"_"+this.testCodeMapping(s.test_code),d[n]={test_code:n,test_name:s.test_name,test_eng_name:s.test_eng_name,ranges:d[n]&&d[n].ranges||s.ranges,units:d[n]&&d[n].units||s.units},a.resultMap[n]=s}),p.has(r)){let s=p.get(r);a.test_set_desc.replace(j,"").split("+").forEach(w=>{s.test_set_desc.includes(w)||(s.test_set_desc+=`+${w}`)}),s.resultMap=b(b({},s.resultMap),d),s.resultSize=(0,_.keys)(s.resultMap).length}else p.set(r,{test_set_code:r,test_set_desc:a.test_set_desc.replace(j,""),resultMap:d,resultSize:a.result_msgs.length});if(delete a.result_msgs,o.has(a.rec_date)){let s=o.get(a.rec_date);s[r]?s[r]=(0,_.merge)(s[r],a):s[r]=a}else o.set(a.rec_date,{datetime:this.dateAdapter.deserialize(a.rec_date+"T"+a.rec_time),patient:{pat_name:a.pat_name},[r]:a})});let g=Array.from(p.values()).sort((a,d)=>a.test_set_code>d.test_set_code?1:-1);return g.unshift({test_set_code:"datetime",test_set_desc:"Datetime"}),{reportCategories:g,reports:Array.from(o.values())}}))}getReports(e,t,i,o){return this.getMedicalRecords(e,t,i,o).pipe(S(p=>{let r=p.data.is_success?p.data.data.orders:[];return r.length?k(r.map(n=>this.getReportIds(e,n.adm_no).pipe(C(()=>u({data:{data:{report_dr:null}}})),A(g=>g.data.data.report_dr?g.data.data.report_dr.split(","):[])))):u([])}),S(p=>{let r=[];return p.forEach(n=>{r=r.concat(n)}),r.length?this.getReportsWithIds(e,r):u({reportCategories:[],reports:[]})}))}formatDate(e){return this.dateAdapter.toIso8601(e).slice(0,10)}testSetCodeMapping(e){let t=e.slice(0,1).toUpperCase(),i=y(e.slice(1)),o,p=this.testSetRules.get(t);if(p){let r=p.find(n=>i>=n[1]&&i<=n[2]);o=r?r[0]:t}else o=t;return o}testCodeMapping(e){switch(e){case"A0034":e="A0527";break;case"A0035":e="A0528";break;case"A0036":e="A0529";break;case"A0037":e="A0532";break;case"A0038":e="A0531";break;case"A0040":e="A0530";break;case"A0041":e="A0533";break;case"A0042":e="A0534";break;case"A0043":e="A0535";break;case"A0044":e="A0538";break;case"A0045":e="A0536";break;case"A0046":e="A0537";break;case"A0047":e="A0514";break;case"A0048":e="A0515";break;case"A0049":e="A0517";break;case"A0054":e="A0522";break;case"A0055":e="A0523";break;case"A0057":e="A0520";break;case"A0058":e="A0521";break;case"A0059":e="A0525";break;case"A0062":e="A0518";break;case"A0163":e="A0516";break;case"H0137":e="H0010";break}return e}static \u0275fac=function(t){return new(t||c)(h(m),h(E),h(R))};static \u0275prov=l({token:c,factory:c.\u0275fac})}return c})();export{R as a,K as b};
/**i18n:4e954d11e025817f1aceae10dbbd8d111274144b3c3dbbdb81deac1f9b9c7958*/
