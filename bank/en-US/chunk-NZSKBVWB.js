import{a as Jt,b as gi,c as Si,d as Ai,e as Ti,f as bi,h as en}from"./chunk-PN4GA2IW.js";import"./chunk-5GEKUOPM.js";import{a as ke}from"./chunk-K73IZGTV.js";import{b as Ei}from"./chunk-BS5C5AVF.js";import{b as We,c as fi,d as Ve,e as Ge,f as Xe,g as Be,h as He,i as Ye,j as ze,k as Fe,l as je,m as Ue,n as Ci,o as Wt}from"./chunk-HVLTLSMS.js";import{a as Kt,b as Qt,c as si}from"./chunk-5WS6TE4O.js";import{a as Zt,b as ui,c as pi}from"./chunk-BMS6JMV4.js";import{$a as z,Ab as di,Ba as Pe,Bb as xe,Cb as $e,Da as mt,Db as Le,Ga as Ft,Ha as jt,I as me,Ia as li,Ja as ge,Ka as st,La as ut,Lb as mi,M as se,Ma as pt,N as ue,Na as Et,O as ot,Oa as _i,P as pe,Q as Ne,R as ye,S as rt,T as ct,V as lt,W as _t,X as ri,Y as Ht,Za as Ut,_a as Q,ab as ft,cb as qt,gb as Ct,ia as fe,la as ve,oa as Ce,ra as Oe,ta as we,va as K,zb as Se}from"./chunk-TO5HF64O.js";import{$ as Ee,X as un,b as Yt,ka as ci,ma as dt,v as zt}from"./chunk-FPVVTWH7.js";import{c as ni,e as ii,f as ai,g as oi,s as ae,u as De,x as sn}from"./chunk-VEGMBXJ5.js";import"./chunk-B5CQEDI6.js";import"./chunk-NM3VG7M7.js";import"./chunk-Z5IRLV5N.js";import"./chunk-E2CVKBY2.js";import{$ as Gt,Ab as _,Ad as Xt,Ba as f,Bd as Bt,Ca as C,Cb as de,F as Wn,H as te,K as re,Kb as o,Lb as c,Lc as Jn,Ma as U,Mb as T,Nb as s,O as Vn,Ob as u,Q as V,Qb as P,Tb as p,Wb as R,Yb as A,Zb as jn,_ as Gn,_b as Un,a as ne,ac as Te,bc as be,cb as Yn,cc as he,da as Xn,fb as l,fc as ce,gb as S,gc as E,hc as X,ia as le,ic as M,ja as et,jc as ie,kc as qn,la as Bn,lc as h,mc as N,na as _e,nc as I,od as Ie,p as G,pc as Kn,pd as nt,q as Vt,qc as Qn,qd as Me,rd as Re,sa as Y,sd as it,t as oe,ta as tt,tb as zn,ua as Hn,uc as j,vc as Zn,vd as ei,wc as q,wd as ti,yb as g,yd as at,z as ee,zb as Fn}from"./chunk-V2NSBNR3.js";import"./chunk-XGK45UGL.js";import{a as Ln,b as kn}from"./chunk-NQUV66Z4.js";var Xi=["*"];var Bi=new Bn("MAT_CARD_CONFIG"),hi=(()=>{let r=class r{constructor(i){this.appearance=i?.appearance||"raised";}};r.ɵfac=function(n){return new(n||r)(S(Bi,8));},r.ɵcmp=Y({type:r,selectors:[["mat-card"]],hostAttrs:[1,"mat-mdc-card","mdc-card"],hostVars:4,hostBindings:function(n,a){n&2&&de("mat-mdc-card-outlined",a.appearance==="outlined")("mdc-card--outlined",a.appearance==="outlined");},inputs:{appearance:"appearance"},exportAs:["matCard"],standalone:!0,features:[Kn],ngContentSelectors:Xi,decls:1,vars:0,template:function(n,a){n&1&&(jn(),Un(0));},styles:['.mat-mdc-card{display:flex;flex-direction:column;box-sizing:border-box;position:relative;border-style:solid;border-width:0;background-color:var(--mdc-elevated-card-container-color, var(--mat-app-surface));border-color:var(--mdc-elevated-card-container-color, var(--mat-app-surface));border-radius:var(--mdc-elevated-card-container-shape, var(--mat-app-corner-medium));box-shadow:var(--mdc-elevated-card-container-elevation, var(--mat-app-level1))}.mat-mdc-card::after{position:absolute;top:0;left:0;width:100%;height:100%;border:solid 1px rgba(0,0,0,0);content:"";display:block;pointer-events:none;box-sizing:border-box;border-radius:var(--mdc-elevated-card-container-shape, var(--mat-app-corner-medium))}.mat-mdc-card-outlined{background-color:var(--mdc-outlined-card-container-color, var(--mat-app-surface));border-radius:var(--mdc-outlined-card-container-shape, var(--mat-app-corner-medium));border-width:var(--mdc-outlined-card-outline-width);border-color:var(--mdc-outlined-card-outline-color, var(--mat-app-outline-variant));box-shadow:var(--mdc-outlined-card-container-elevation, var(--mat-app-level0))}.mat-mdc-card-outlined::after{border:none}.mdc-card__media{position:relative;box-sizing:border-box;background-repeat:no-repeat;background-position:center;background-size:cover}.mdc-card__media::before{display:block;content:""}.mdc-card__media:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__media:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mat-mdc-card-actions{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;min-height:52px;padding:8px}.mat-mdc-card-title{font-family:var(--mat-card-title-text-font, var(--mat-app-title-large-font));line-height:var(--mat-card-title-text-line-height, var(--mat-app-title-large-line-height));font-size:var(--mat-card-title-text-size, var(--mat-app-title-large-size));letter-spacing:var(--mat-card-title-text-tracking, var(--mat-app-title-large-tracking));font-weight:var(--mat-card-title-text-weight, var(--mat-app-title-large-weight))}.mat-mdc-card-subtitle{color:var(--mat-card-subtitle-text-color, var(--mat-app-on-surface));font-family:var(--mat-card-subtitle-text-font, var(--mat-app-title-medium-font));line-height:var(--mat-card-subtitle-text-line-height, var(--mat-app-title-medium-line-height));font-size:var(--mat-card-subtitle-text-size, var(--mat-app-title-medium-size));letter-spacing:var(--mat-card-subtitle-text-tracking, var(--mat-app-title-medium-tracking));font-weight:var(--mat-card-subtitle-text-weight, var(--mat-app-title-medium-weight))}.mat-mdc-card-title,.mat-mdc-card-subtitle{display:block;margin:0}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle{padding:16px 16px 0}.mat-mdc-card-header{display:flex;padding:16px 16px 0}.mat-mdc-card-content{display:block;padding:0 16px}.mat-mdc-card-content:first-child{padding-top:16px}.mat-mdc-card-content:last-child{padding-bottom:16px}.mat-mdc-card-title-group{display:flex;justify-content:space-between;width:100%}.mat-mdc-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;margin-bottom:16px;object-fit:cover}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title{line-height:normal}.mat-mdc-card-sm-image{width:80px;height:80px}.mat-mdc-card-md-image{width:112px;height:112px}.mat-mdc-card-lg-image{width:152px;height:152px}.mat-mdc-card-xl-image{width:240px;height:240px}.mat-mdc-card-subtitle~.mat-mdc-card-title,.mat-mdc-card-title~.mat-mdc-card-subtitle,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-title-group .mat-mdc-card-title,.mat-mdc-card-title-group .mat-mdc-card-subtitle{padding-top:0}.mat-mdc-card-content>:last-child:not(.mat-mdc-card-footer){margin-bottom:0}.mat-mdc-card-actions-align-end{justify-content:flex-end}'],encapsulation:2,changeDetection:0});let t=r;return t;})();var Ni=(()=>{let r=class r{};r.ɵfac=function(n){return new(n||r)();},r.ɵdir=Hn({type:r,selectors:[["mat-card-content"]],hostAttrs:[1,"mat-mdc-card-content"],standalone:!0});let t=r;return t;})();var Ii=(()=>{let r=class r{};r.ɵfac=function(n){return new(n||r)();},r.ɵmod=tt({type:r}),r.ɵinj=et({imports:[un,Bt,un]});let t=r;return t;})();var qe=function(t){return t[t.REVENUE=2]="REVENUE",t[t.PAY=3]="PAY",t;}(qe||{}),$=function(t){return t[t.PAY=1]="PAY",t[t.REVENUE=2]="REVENUE",t[t.TRANSFER=3]="TRANSFER",t[t.BORROW=4]="BORROW",t[t.RETURN=5]="RETURN",t;}($||{}),J=function(t){return t[t.BORROW=1]="BORROW",t[t.LEND=2]="LEND",t[t.RECEIVE=3]="RECEIVE",t[t.REPAYMENT=4]="REPAYMENT",t;}(J||{});var F=(()=>{class t{requestService;books;constructor(e){this.requestService=e;}getBooks(){return this.books?G({code:null,error:null,data:{books:this.books}}):this.requestService.get("activity/bkk-frontier/api/v2/book/web/query").pipe(oe(e=>(e&&e.data&&e.data.books&&(this.books=e.data.books),e)));}getAccountTypeList(){return this.requestService.get("setting/account_allAccountTypes.action",{timesamp:Date.now()});}getAccountList(e=!0,i=!1,n=!0){return this.requestService.get("setting/account_list.action",{timesamp:Date.now(),hidden:e,reqBalance:i,loanFlag:n});}getVisibleAccountList(){return this.requestService.post("activity/bkk-frontier/api/account/index",{localTime:Date.now(),timeZoneId:this.requestService.TIME_ZONE_ID,useCompleteSort:!0});}getHiddenAccountList(){return this.requestService.post("activity/bkk-frontier/api/account/hiddenList",{localTime:Date.now(),timeZoneId:this.requestService.TIME_ZONE_ID,useCompleteSort:!0});}getShortAccounts(e=1){return this.requestService.get("activity/bkk-frontier/api/account/web/query",{accountOption:e});}getEntryCategories(e,i){return this.requestService.get("activity/bkk-frontier/api/v2/category/web/query",{bkId:e,categoryType:i});}getTransactionObjects(e){return this.requestService.get("activity/bkk-frontier/api/v2/trade/target/web/query",{bkId:e});}getBookProjects(e){return this.requestService.get("activity/bkk-frontier/api/v2/project/web/query",{bkId:e});}getMembers(e){return this.requestService.get("activity/bkk-frontier/api/v2/book/member/web/query",{bkId:e});}queryEntries(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/list/web",e);}getEntries(e,i,n){let a={accountId:e,startDate:i.valueOf(),endDate:n.valueOf(),timeZoneId:this.requestService.TIME_ZONE_ID,localTime:Date.now()};return this.requestService.post("activity/bkk-frontier/api/account/detail/flow",a);}getEntry(e,i){return this.requestService.get("activity/bkk-frontier/api/v2/flow/query/web/"+e+"/"+i);}saveEntry(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/save",{flows:e});}deleteEntries(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/batch/delete",{flowIds:e});}static ɵfac=function(i){return new(i||t)(_e(ke));};static ɵprov=le({token:t,factory:t.ɵfac});}return t;})();var tn=(()=>{class t{requestService;constructor(e){this.requestService=e;}getCategoryStatistics(e,i,n,a=1){return this.requestService.post("activity/bkk-frontier/api/v2/report/chartStat",{bkId:e,startTime:i.valueOf(),endTime:n.valueOf(),statNo:a});}getRevenueNExpenditureStatistics(e,i,n,a=11){return this.requestService.post("activity/bkk-frontier/api/v2/report/monthStat",{bkId:e,startTime:i.valueOf(),endTime:n.valueOf(),statNo:a});}static ɵfac=function(i){return new(i||t)(_e(ke));};static ɵprov=le({token:t,factory:t.ɵfac});}return t;})();function zi(t,r){t&1&&(o(0,"mat-label"),s(1),p(2,2),u(),c());}function Fi(t,r){if(t&1&&(o(0,"mat-option",20),E(1),c()),t&2){let e=r.$implicit;_("value",e.id),l(),M(" ",e.name," ");}}var vi=(()=>{class t{elementRef;currencyPipe;datePipe;dateAdapter;notification;communication;datetimeService;database;statistics;currencyValueFormat=e=>this.currencyPipe.transform(e/100,"CNY","symbol-narrow","0.0-2");dateRange=new ot({start:new Ne(null),end:new Ne(null)});books=[];selectedBook;payCategoriesData;revenueCategoriesData;revNExpndData;totalBalance="";sunburstChartOptions={valueFun:this.currencyValueFormat};barChartOptions={layout:"stacked",lineStyle:{stroke:"#5e92a8","stroke-width":2},valueFun:this.currencyValueFormat,tooltip:{content:e=>`${this.datePipe.transform(e[0],"MMMM, y")}
        	 ${e.slice(1).reduce((i,n,a)=>i+`${a>0?`
`:""} ${n<0?"":"+"}${this.currencyValueFormat(n)}`,"")}
        	 =${this.currencyValueFormat(e.slice(1).reduce((i,n)=>i+n,0))}
      `},xAxis:{baseline:{style:{stroke:"#808080"}},font:{color:"#808080"},format:e=>this.datePipe.transform(e,"MMM, y")},yAxis:{baseline:{style:{stroke:"transparent"}},font:{color:"#808080"},format:this.currencyValueFormat}};subscription=new ne();constructor(e,i,n,a,m,d,D,O,k){this.elementRef=e,this.currencyPipe=i,this.datePipe=n,this.dateAdapter=a,this.notification=m,this.communication=d,this.datetimeService=D,this.database=O,this.statistics=k;}ngOnInit(){this.dateRange.valueChanges.subscribe(()=>{this.communication.giveRefreshCommand();}),this.datetimeService.initTimeRange(this.dateRange);}ngAfterViewInit(){setTimeout(()=>{this.database.getBooks().subscribe(e=>{this.books=e.data.books;let i=this.books[0];this.selectedBook=i.id,this.initRefreshIndicator();});});}ngOnDestroy(){this.subscription.unsubscribe(),this.datetimeService.destoryTimeRange();}onBookSelectionChange(e){this.communication.giveRefreshCommand();}prevYear(){let e=this.dateRange.value.start,i=this.dateAdapter.getYear(e)-1;this.dateRange.setValue({start:this.dateAdapter.createDate(i,0,1),end:this.dateAdapter.createDate(i,11,31)});}nextYear(){let e=this.dateRange.value.end,i=this.dateAdapter.getYear(e)+1;this.dateRange.setValue({start:this.dateAdapter.createDate(i,0,1),end:this.dateAdapter.createDate(i,11,31)});}prevMonth(){let e=this.dateAdapter,i=e.clone(this.dateRange.value.start),n=e.today(),a=e.getYear(i),m=e.getMonth(i)-1;m<0?(i=e.createDate(a-1,11,1),n=e.createDate(a,0,1)):(i=e.createDate(a,m,1),n=e.createDate(a,m+1,1)),n=e.addCalendarDays(n,-1),this.dateRange.setValue({start:i,end:n});}nextMonth(){let e=this.dateAdapter,i=e.clone(this.dateRange.value.start),n=e.today(),a=e.getYear(i),m=e.getMonth(i)+1;m>11?(i=e.createDate(a+1,0,1),n=e.createDate(a+1,1,1)):(i=e.createDate(a,m,1),m+1>11?n=e.createDate(a+1,0,1):n=e.createDate(a,m+1,1)),n=e.addCalendarDays(n,-1),this.dateRange.setValue({start:i,end:n});}showAllHistory(){this.dateRange.setValue({start:this.datetimeService.getMinDate(),end:this.datetimeService.getMaxDate()});}initRefreshIndicator(){this.subscription.add(this.communication.acceptRefreshCommand().pipe(re(500),Gn({}),Gt(()=>{let e=this.dateRange.controls.start.value,i=this.dateRange.controls.end.value;return this.dateRange.invalid?G(null):(this.notification.showLoading(this.elementRef.nativeElement),e&&i?(e=this.dateAdapter.deserialize(this.datetimeService.getStartDatetime(e)),i=this.dateAdapter.deserialize(this.datetimeService.getEndDatetime(i)),ee([this.assemblePayCategoriesStatistics(e,i),this.assembleRevenueCategoriesStatistics(e,i),this.assembleRevenueNExpenditureStatistics(e,i)])):G(null));}),V(()=>{this.notification.hideLoading();})).subscribe(()=>{this.notification.hideLoading();}));}assemblePayCategoriesStatistics(e,i){return ee([this.database.getEntryCategories(this.selectedBook,qe.PAY),this.statistics.getCategoryStatistics(this.selectedBook,e,i,1),this.statistics.getCategoryStatistics(this.selectedBook,e,i,2)]).pipe(te(()=>G([])),oe(n=>{let a=!1;if(n.forEach(O=>{O.error&&(a=!0),a=!O.data||a;}),a){this.payCategoriesData=[];return;}let m=n[0].data.bookCategories,d=n[1].data,D=n[2].data.groups;return this.payCategoriesData=[{id:"_",name:d.title,value:d.totalAmount,children:d.groups.map(O=>{let k=O.id,L=m.find(y=>y.categoryId===k)?.outgoSubTypes,W=D.filter(y=>L.some(w=>w.categoryId===y.id)).map(y=>({id:y.id,name:y.name,value:y.amount}));return{id:O.id,name:O.name,value:O.amount,children:W};})}],null;}));}assembleRevenueCategoriesStatistics(e,i){return this.statistics.getCategoryStatistics(this.selectedBook,e,i,6).pipe(te(()=>G({})),oe(n=>{let a=n.data;if(!a||!a.groups){this.revenueCategoriesData=[];return;}return this.revenueCategoriesData=[{id:"_",name:a.title,value:a.totalAmount,children:a.groups.map(m=>({id:m.id,name:m.name,value:m.amount}))}],null;}));}assembleRevenueNExpenditureStatistics(e,i){return this.statistics.getRevenueNExpenditureStatistics(this.selectedBook,e,i,11).pipe(te(()=>G({})),oe(n=>{let a=this.dateAdapter,m=n.data;if(m){if(this.totalBalance=m.currency+" "+m.totalBalance/100,!m.groups){this.revNExpndData=[];return;}this.revNExpndData=m.groups.map(d=>[a.deserialize(d.startTime),d.balanceMoney+d.outgoMoney,-d.outgoMoney]);}else this.totalBalance="",this.revNExpndData=[];return null;}));}static ɵfac=function(i){return new(i||t)(S(U),S(Xt),S(ti),S(Ee),S(z),S(Q),S(Ct),S(F),S(tn));};static ɵcmp=Y({type:t,selectors:[["app-dashboard"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:50,vars:21,consts:()=>{let e;return e="Account book",[["bookSelect",""],["dateRangePicker",""],e,["role","group",1,"btn-group"],["mat-button","",3,"for"],["matDatepickerToggleIcon",""],["type","button","mat-button","",3,"click"],["appearance","fill",1,"mat-form-field-mini"],[4,"ngIf"],["name","book",3,"valueChange","selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[1,"align-middle","ms-2"],[1,"visually-hidden",3,"formGroup","rangePicker"],["matStartDate","","formControlName","start"],["matEndDate","","formControlName","end"],[1,"flex-fill","px-2",2,"overflow-x","hidden","overflow-y","auto"],[1,"row"],[1,"col-12","col-lg-6","py-2","sunburst-chart"],[3,"data","options"],[1,"col-12","py-2","bar-chart"],[3,"value"]];},template:function(i,n){if(i&1){let a=P();o(0,"app-operation-toolbar")(1,"div",3)(2,"mat-datepicker-toggle",4)(3,"mat-icon",5),E(4,"date_range"),c()(),o(5,"button",6),R("click",function(){return f(a),C(n.showAllHistory());}),o(6,"mat-icon"),E(7,"history_toggle_off"),c()(),o(8,"button",6),R("click",function(){return f(a),C(n.prevYear());}),o(9,"mat-icon"),E(10,"first_page"),c()(),o(11,"button",6),R("click",function(){return f(a),C(n.prevMonth());}),o(12,"mat-icon"),E(13,"chevron_left"),c()(),o(14,"button",6),R("click",function(){return f(a),C(n.nextMonth());}),o(15,"mat-icon"),E(16,"chevron_right"),c()(),o(17,"button",6),R("click",function(){return f(a),C(n.nextYear());}),o(18,"mat-icon"),E(19,"last_page"),c()()(),o(20,"mat-form-field",7),g(21,zi,3,0,"mat-label",8),o(22,"mat-select",9,0),I("valueChange",function(d){return f(a),N(n.selectedBook,d)||(n.selectedBook=d),C(d);}),R("selectionChange",function(d){return f(a),C(n.onBookSelectionChange(d));}),g(24,Fi,2,2,"mat-option",10),c()()(),o(25,"app-breadcrumb")(26,"span",11),E(27),j(28,"date"),j(29,"date"),c()(),o(30,"mat-date-range-input",12),T(31,"input",13)(32,"input",14),c(),T(33,"mat-date-range-picker",null,1),o(35,"div",15)(36,"div",16)(37,"div",17)(38,"mat-card")(39,"mat-card-content"),T(40,"app-sunburst-chart",18),c()()(),o(41,"div",17)(42,"mat-card")(43,"mat-card-content"),T(44,"app-sunburst-chart",18),c()()()(),o(45,"div",16)(46,"div",19)(47,"mat-card")(48,"mat-card-content"),T(49,"app-bar-chart",18),c()()()()();}if(i&2){let a=ce(23),m=ce(34);l(2),_("for",m),l(19),_("ngIf",!a.triggerValue),l(),h("value",n.selectedBook),l(2),_("ngForOf",n.books),l(3),qn(" (",q(28,15,n.dateRange.value.start,"longDate")," - ",q(29,18,n.dateRange.value.end,"longDate")," => ",n.totalBalance,") "),l(3),_("formGroup",n.dateRange)("rangePicker",m),l(10),_("data",n.payCategoriesData)("options",n.sunburstChartOptions),l(4),_("data",n.revenueCategoriesData)("options",n.sunburstChartOptions),l(5),_("data",n.revNExpndData)("options",n.barChartOptions);}},dependencies:[Si,Ai,Ie,nt,hi,Ni,me,se,ue,Oe,ge,li,pt,st,ut,Et,Ce,fe,K,Pe,dt,lt,_t,Se,di,ft],styles:[".sunburst-chart[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{height:calc(60vh - 140px);min-height:300px}.bar-chart[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{height:calc(40vh - 100px);min-height:300px}.chart[_ngcontent-%COMP%]{width:100%;height:100%}"]});}return t;})();var Tt=(()=>{class t{requestService;constructor(e){this.requestService=e;}getBankList(){return this.requestService.get("setting/account_bankList.action",{type:""});}getCardTypeList(){return this.requestService.get("setting/account_cardList.action",{type:""});}static ɵfac=function(i){return new(i||t)(_e(ke));};static ɵprov=le({token:t,factory:t.ɵfac});}return t;})();function ji(t,r){t&1&&(o(0,"th",22),s(1),p(2,0),u(),c());}function Ui(t,r){if(t&1&&(o(0,"td",23),E(1),o(2,"span",24),E(3),c()()),t&2){let e=r.$implicit;l(),M("",e.name," "),l(2),X(e.tailNo);}}function qi(t,r){t&1&&(o(0,"th",22),s(1),p(2,1),u(),c());}function Ki(t,r){if(t&1&&(o(0,"td",23),E(1),c()),t&2){let e=r.$implicit;l(),X(e.groupName);}}function Qi(t,r){t&1&&(o(0,"th",22),s(1),p(2,2),u(),c());}function Zi(t,r){if(t&1&&(o(0,"td",23),E(1),j(2,"number"),c()),t&2){let e=r.$implicit;l(),ie("",e.moneyType.flag," ",q(2,2,e.balanceMoney,"0.2-2"),"");}}function Ji(t,r){t&1&&T(0,"th",25);}function ea(t,r){if(t&1){let e=P();o(0,"td",23)(1,"button",26),R("click",function(){let n=f(e).$implicit,a=A();return C(a.goToEntryList(n));}),o(2,"mat-icon"),E(3,"receipt"),c()()();}}function ta(t,r){t&1&&T(0,"tr",27);}function na(t,r){t&1&&T(0,"tr",28);}function ia(t,r){t&1&&(o(0,"th",22),s(1),p(2,3),u(),c());}function aa(t,r){if(t&1&&(o(0,"td",23),E(1),c()),t&2){let e=r.$implicit;l(),X(e.name);}}function oa(t,r){t&1&&(o(0,"th",22),s(1),p(2,4),u(),c());}function ra(t,r){if(t&1&&(s(0),E(1),u()),t&2){let e=A().$implicit;l(),M(" ",e.groupName," ");}}function ca(t,r){if(t&1&&(s(0),o(1,"mat-icon",34),E(2),j(3,"lowercase"),c(),u()),t&2){let e=A(2).$implicit;l(2),X(Zn(3,1,e.bank==null?null:e.bank.ename));}}function la(t,r){if(t&1&&(s(0),T(1,"img",35),u()),t&2){let e=A(2).$implicit;l(),_("alt",e.bank==null?null:e.bank.ename)("src",e.iconUrl,Yn);}}function _a(t,r){if(t&1&&(s(0,32),g(1,ca,4,3,"ng-container",30)(2,la,2,2,"ng-container",33),E(3),u()),t&2){let e=A().$implicit;_("ngSwitch",e.type===2&&!e.iconUrl),l(),_("ngSwitchCase",!0),l(2),M(" ",e.tailNo," ");}}function da(t,r){if(t&1&&(o(0,"td",29),g(1,ra,2,1,"ng-container",30)(2,_a,4,3,"ng-container",31),c()),t&2){let e=r.$implicit;_("ngSwitch",!e.name),l(),_("ngSwitchCase",!0);}}function ma(t,r){if(t&1&&(o(0,"th",22),s(1),p(2,5),u(),E(3),c()),t&2){let e=A();l(3),M(" ",e.totalBalance," ");}}function sa(t,r){if(t&1&&(o(0,"td",23),E(1),j(2,"number"),c()),t&2){let e=r.$implicit;l(),ie("",e.moneyType.flag," ",q(2,2,e.balanceMoney,"0.2-2"),"");}}function ua(t,r){t&1&&T(0,"th",25);}function pa(t,r){if(t&1){let e=P();o(0,"button",37),R("click",function(){f(e);let n=A().$implicit,a=A();return C(a.goToEntryList(n));}),o(1,"mat-icon"),E(2,"receipt"),c()();}}function Ea(t,r){if(t&1&&(o(0,"td",23),g(1,pa,3,0,"button",36),c()),t&2){let e=r.$implicit;l(),_("ngIf",!!e.uuid);}}function fa(t,r){t&1&&T(0,"tr",27);}function Ca(t,r){if(t&1&&T(0,"tr",28),t&2){let e=r.$implicit;de("table-primary",!e.name);}}var wi=(()=>{class t{route;router;elementRef;communication;notification;databaseService;additionalData;dataSource;secondaryDataSource;displayedColumns=["name","groupName","balanceMoney","tailNo"];totalBalance="";subscription=new ne();constructor(e,i,n,a,m,d,D){this.route=e,this.router=i,this.elementRef=n,this.communication=a,this.notification=m,this.databaseService=d,this.additionalData=D,this.dataSource=new Wt(),this.secondaryDataSource=new Wt();}ngOnInit(){this.subscription.add(this.communication.acceptRefreshCommand().pipe(re(300)).subscribe(()=>{this.updateAccounts();})),this.communication.giveRefreshCommand();}ngOnDestroy(){this.subscription.unsubscribe();}goToEntryList(e){this.router.navigate(["accounts",e.uuid],{queryParams:{title:e.name},relativeTo:this.route.parent});}updateAccounts(){this.notification.showLoading(this.elementRef.nativeElement),ee([this.databaseService.getVisibleAccountList(),this.databaseService.getHiddenAccountList(),this.additionalData.getBankList()]).pipe(V(()=>{this.notification.hideLoading();})).subscribe(e=>{let i=e[0],n=e[1],a=e[2].banks,m=i.data.accountSummary[0],d=[],D;i.data.accountList.forEach(O=>{O.accountData.forEach(k=>{D=a.find(L=>k.bankId===L.id.toString()),k.groupName=O.groupName,k.balanceMoney=k.balanceMoney/100,k.bank=D;}),d.push({name:"",groupName:O.groupName,balanceMoney:O.groupMoney.summaryAssets/100,moneyType:O.groupMoney.allMoneyCategory[0].moneyType}),d=d.concat(O.accountData);}),this.dataSource.data=d,this.totalBalance=m.moneyType.flag+" "+m.assets/100,this.secondaryDataSource.data=n.data;});}static ɵfac=function(i){return new(i||t)(S(ae),S(De),S(U),S(Q),S(z),S(F),S(Tt));};static ɵcmp=Y({type:t,selectors:[["app-accounts"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:36,vars:8,consts:()=>{let e;e="Alias";let i;i="Type";let n;n="Balance";let a;a="Alias";let m;m="Type";let d;return d="Balance",[e,i,n,a,m,d,["appStartContent","",1,"d-flex","flex-column","h-100"],[1,"w-100","h-100","overflow-auto"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","groupName"],["matColumnDef","balanceMoney"],["matColumnDef","tailNo","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-cell","",3,"ngSwitch",4,"matCellDef"],["matColumnDef","tailNo"],["mat-row","",3,"table-primary",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"text-muted"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""],["mat-cell","",3,"ngSwitch"],[4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchDefault"],[3,"ngSwitch"],[4,"ngSwitchDefault"],["fontSet","Marching"],["width","32","height","32",3,"alt","src"],["type","button","mat-icon-button","","color","primary","class","mat-button-mini","y","",3,"click",4,"ngIf"],["type","button","mat-icon-button","","color","primary","y","",1,"mat-button-mini",3,"click"]];},template:function(i,n){i&1&&(T(0,"app-default-operation-toolbar")(1,"app-breadcrumb"),o(2,"app-two-cols-layout")(3,"div",6)(4,"div",7)(5,"table",8),s(6,9),g(7,ji,3,0,"th",10)(8,Ui,4,2,"td",11),u(),s(9,12),g(10,qi,3,0,"th",10)(11,Ki,2,1,"td",11),u(),s(12,13),g(13,Qi,3,0,"th",10)(14,Zi,3,5,"td",11),u(),s(15,14),g(16,Ji,1,0,"th",15)(17,ea,4,0,"td",11),u(),g(18,ta,1,0,"tr",16)(19,na,1,0,"tr",17),c()()(),o(20,"div",18)(21,"table",8),s(22,9),g(23,ia,3,0,"th",10)(24,aa,2,1,"td",11),u(),s(25,12),g(26,oa,3,0,"th",10)(27,da,3,2,"td",19),u(),s(28,13),g(29,ma,4,1,"th",10)(30,sa,3,5,"td",11),u(),s(31,20),g(32,ua,1,0,"th",15)(33,Ea,2,1,"td",11),u(),g(34,fa,1,0,"tr",16)(35,Ca,1,2,"tr",21),c()()()),i&2&&(l(5),_("dataSource",n.secondaryDataSource),l(13),_("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),l(),_("matRowDefColumns",n.displayedColumns),l(2),_("dataSource",n.dataSource),l(13),_("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),l(),_("matRowDefColumns",n.displayedColumns));},dependencies:[nt,Me,Re,it,we,K,Ve,Xe,ze,Be,Ge,Fe,He,Ye,je,Ue,Se,xe,$e,Le,ei,at],styles:[".table[_ngcontent-%COMP%]{font-size:.75rem}img[_ngcontent-%COMP%]{width:32px;height:32px;vertical-align:middle}"]});}return t;})();function ga(t,r){t&1&&(o(0,"th",12),s(1),p(2,0),u(),c());}function Sa(t,r){if(t&1&&(o(0,"td",13),E(1),o(2,"span",14),E(3),c()()),t&2){let e=r.$implicit;l(),M("",e.name," "),l(2),X(e.tailNo);}}function Aa(t,r){t&1&&T(0,"th",15);}function Ta(t,r){if(t&1){let e=P();o(0,"td",13)(1,"button",16),R("click",function(){let n=f(e).$implicit,a=A();return C(a.edit(n));}),o(2,"mat-icon"),E(3,"pen"),c()()();}}function ba(t,r){t&1&&T(0,"tr",17);}function ha(t,r){t&1&&T(0,"tr",18);}var Pi=(()=>{class t{route;router;elementRef;communication;notification;databaseService;additionalData;dataSource;displayedColumns=["name","operation"];totalBalance="";subscription=new ne();constructor(e,i,n,a,m,d,D){this.route=e,this.router=i,this.elementRef=n,this.communication=a,this.notification=m,this.databaseService=d,this.additionalData=D,this.dataSource=new Wt();}ngOnInit(){this.subscription.add(this.communication.acceptRefreshCommand().pipe(re(300)).subscribe(()=>{this.updateAccounts();})),this.communication.giveRefreshCommand();}ngOnDestroy(){this.subscription.unsubscribe();}edit(e){this.router.navigate(["accounts",e.uuid],{queryParams:{title:e.name},relativeTo:this.route.parent});}updateAccounts(){this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.getBooks().pipe(Gt(e=>ee(e.data.books.map(i=>this.databaseService.getMembers(i.id))))).pipe(V(()=>{this.notification.hideLoading();})).subscribe(e=>{console.log(e);let i=[];this.dataSource.data=i;});}static ɵfac=function(i){return new(i||t)(S(ae),S(De),S(U),S(Q),S(z),S(F),S(Tt));};static ɵcmp=Y({type:t,selectors:[["app-members"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:15,vars:4,consts:()=>{let e;return e="Alias",[e,["appStartContent","",1,"d-flex","flex-column","h-100"],[1,"w-100","h-100","overflow-auto"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","operation","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-header-cell",""],["mat-cell",""],[1,"text-muted"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""]];},template:function(i,n){i&1&&(T(0,"app-default-operation-toolbar")(1,"app-breadcrumb"),o(2,"app-two-cols-layout")(3,"div",1)(4,"div",2)(5,"table",3),s(6,4),g(7,ga,3,0,"th",5)(8,Sa,4,2,"td",6),u(),s(9,7),g(10,Aa,1,0,"th",8)(11,Ta,4,0,"td",6),u(),g(12,ba,1,0,"tr",9)(13,ha,1,0,"tr",10),c()()(),T(14,"div",11),c()),i&2&&(l(5),_("dataSource",n.dataSource),l(7),_("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),l(),_("matRowDefColumns",n.displayedColumns));},dependencies:[we,K,Ve,Xe,ze,Be,Ge,Fe,He,Ye,je,Ue,Se,xe,$e,Le]});}return t;})();var Ae=(()=>{class t{router;constructor(e){this.router=e;}addNewOne(e,i){this.router.navigate([{outlets:{secondary:["entry","add",e]}}],{queryParamsHandling:"preserve",relativeTo:i});}edit(e,i){let n;e.recType===null?n=["balance",e.id]:n=["entry",e.bkId,e.id],this.router.navigate([{outlets:{secondary:n}}],{queryParamsHandling:"preserve",relativeTo:i,state:e});}closeSecondaryOutlet(e){this.router.navigate([{outlets:{secondary:null}}],{queryParamsHandling:"preserve",relativeTo:e});}static ɵfac=function(i){return new(i||t)(_e(De));};static ɵprov=le({token:t,factory:t.ɵfac});}return t;})();var ya=()=>["daySummary"];function Da(t,r){if(t&1&&(o(0,"mat-option",42),E(1),c()),t&2){let e=r.$implicit;_("value",e.id),l(),M(" ",e.name," ");}}function va(t,r){t&1&&(s(0),p(1,17),u());}function Oa(t,r){t&1&&(s(0),p(1,18),u());}function wa(t,r){t&1&&(s(0),p(1,19),u());}function Pa(t,r){t&1&&(s(0),p(1,20),u());}function xa(t,r){t&1&&(s(0),p(1,21),u());}function $a(t,r){if(t&1&&(o(0,"mat-option",42),s(1,83),g(2,va,2,0,"ng-container",84)(3,Oa,2,0,"ng-container",84)(4,wa,2,0,"ng-container",84)(5,Pa,2,0,"ng-container",84)(6,xa,2,0,"ng-container",84),u(),c()),t&2){let e=r.$implicit;_("value",e),l(),_("ngSwitch",e),l(),_("ngSwitchCase",1),l(),_("ngSwitchCase",2),l(),_("ngSwitchCase",3),l(),_("ngSwitchCase",4),l(),_("ngSwitchCase",5);}}function La(t,r){if(t&1&&(o(0,"mat-option",42),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function ka(t,r){if(t&1&&(o(0,"mat-option",42),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function Wa(t,r){if(t&1&&(o(0,"mat-option",42),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function Va(t,r){if(t&1&&(o(0,"mat-option",42),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function Ga(t,r){if(t&1){let e=P();o(0,"th",85)(1,"mat-checkbox",86),R("change",function(n){f(e);let a=A();return C(n?a.masterToggle():null);}),c()();}if(t&2){let e=A();l(),_("checked",e.selection.hasValue()&&e.isAllSelected())("indeterminate",e.selection.hasValue()&&!e.isAllSelected())("matBadge",e.selection.selected.length);}}function Xa(t,r){if(t&1){let e=P();o(0,"td",87)(1,"mat-checkbox",88),R("click",function(n){return f(e),C(n.stopPropagation());})("change",function(n){let a=f(e).$implicit,m=A();return C(n?m.selection.toggle(a):null);}),c()();}if(t&2){let e=r.$implicit,i=A();l(),_("checked",i.selection.isSelected(e));}}function Ba(t,r){t&1&&(o(0,"th",89),s(1),p(2,22),u(),c());}function Ha(t,r){if(t&1&&(o(0,"td",87)(1,"span",90),E(2),j(3,"date"),c()()),t&2){let e=r.$implicit;l(2),X(q(3,1,e.bizTime,"yyyy-MM-dd HH:mm:ss"));}}function Ya(t,r){t&1&&(o(0,"th",89),s(1),p(2,23),u(),c());}function za(t,r){t&1&&(o(0,"mat-icon",97),E(1,"remove"),c());}function Fa(t,r){t&1&&(o(0,"mat-icon",98),E(1,"add"),c());}function ja(t,r){if(t&1&&(o(0,"mat-icon",99),E(1),c()),t&2){let e=A().$implicit,i=A();l(),X(e.targetId===i.accountId?"add":"remove");}}function Ua(t,r){if(t&1&&(o(0,"mat-icon"),E(1),c()),t&2){let e=A().$implicit;de("text-info",e.recSubtype===0)("text-warning",e.recSubtype!==0),l(),M(" ",e.recSubtype===0?"add":"remove"," ");}}function qa(t,r){if(t&1&&(o(0,"mat-icon"),E(1),c()),t&2){let e=A().$implicit;de("text-info",e.recSubtype===0)("text-warning",e.recSubtype!==0),l(),M(" ",e.recSubtype===0?"add":"remove"," ");}}function Ka(t,r){t&1&&(o(0,"mat-icon",99),E(1,"help_outline"),c());}function Qa(t,r){if(t&1&&(o(0,"td",91),g(1,za,2,0,"mat-icon",92)(2,Fa,2,0,"mat-icon",93)(3,ja,2,1,"mat-icon",94)(4,Ua,2,5,"mat-icon",95)(5,qa,2,5,"mat-icon",95)(6,Ka,2,0,"mat-icon",96),E(7),j(8,"number"),c()),t&2){let e=r.$implicit;_("ngSwitch",e.recType),l(),_("ngSwitchCase",1),l(),_("ngSwitchCase",2),l(),_("ngSwitchCase",3),l(),_("ngSwitchCase",4),l(),_("ngSwitchCase",5),l(2),ie(" ",e.currencyFlag," ",q(8,8,e.amount/100,"0.2-2")," ");}}function Za(t,r){t&1&&(o(0,"th",89),s(1),p(2,24),u(),c());}function Ja(t,r){if(t&1&&(o(0,"td",100),E(1),c()),t&2){let e=r.$implicit;l(),M(" ",e.categoryName," ");}}function eo(t,r){t&1&&(o(0,"th",89),s(1),p(2,25),u(),c());}function to(t,r){if(t&1&&(s(0),E(1),u()),t&2){let e=r.$implicit,i=r.last;l(),ie(" ",e.name,"",i?"":"/"," ");}}function no(t,r){if(t&1&&(o(0,"td",100),g(1,to,2,2,"ng-container",101),c()),t&2){let e=r.$implicit;l(),_("ngForOf",e.members);}}function io(t,r){t&1&&(o(0,"th",89),s(1),p(2,26),u(),c());}function ao(t,r){if(t&1&&(o(0,"td",100),E(1),c()),t&2){let e=r.$implicit;l(),X(e.tradetgtName);}}function oo(t,r){t&1&&(o(0,"th",89),s(1),p(2,27),u(),E(3,"/ "),s(4),p(5,28),u(),c());}function ro(t,r){if(t&1&&(s(0)(1),E(2),u()()),t&2){let e=r.$implicit,i=r.last;l(2),ie("",e.name,"",i?"":", ","");}}function co(t,r){if(t&1&&(o(0,"td",102)(1,"small",90),g(2,ro,3,2,"ng-container",101),c(),T(3,"br"),o(4,"small",90),E(5),c()()),t&2){let e=r.$implicit;l(2),_("ngForOf",e.tags),l(3),X(e.accountName);}}function lo(t,r){t&1&&(o(0,"th",89),s(1),p(2,29),u(),c());}function _o(t,r){if(t&1&&(o(0,"td",103)(1,"span",104),E(2),c()()),t&2){let e=r.$implicit;l(2),X(e.comment);}}function mo(t,r){t&1&&T(0,"th",105);}function so(t,r){if(t&1){let e=P();o(0,"td",87)(1,"button",106),R("click",function(){let n=f(e).$implicit,a=A();return C(a.edit(n));}),o(2,"mat-icon"),E(3,"edit"),c()()();}}function uo(t,r){if(t&1&&(o(0,"td",87),E(1),j(2,"date"),c()),t&2){let e=r.$implicit,i=A();Fn("colspan",i.displayedColumns.length),l(),ie(" ",q(2,3,e.bizTime,"yyyy-MM-dd EEEE")," \xA0\xA0\xA0\xA0\xA0 ",e.comment," ");}}function po(t,r){t&1&&T(0,"tr",107);}function Eo(t,r){t&1&&T(0,"tr",108);}function fo(t,r){t&1&&T(0,"tr",109);}var $i=(()=>{class t extends bi(class{}){route;elementRef;dateAdapter;algorithm;communication;notification;datetimeService;databaseService;operation;books=[];recordTypes=[$.PAY,$.REVENUE,$.TRANSFER,$.BORROW,$.RETURN];accounts=[];projects=[];members=[];payCategories=[];txnObjects=[];searchKeys={bkId:null,startTime:0,endTime:0,amountStart:null,amountEnd:null,comment:null,recTypeList:null,mainTypeIdList:null,subTypeIdList:null,accountIdList:null,projectIdList:null,tradetgtIdList:null,memberIdList:null,reimburseList:null,categoryIdList:null,queryFlowCount:!0};displayedColumns=[];dataSource;selection=new zt(!0,[]);totalEntry;range=new ot({start:new Ne(null),end:new Ne(null)});paginator;deleting=!1;columnsToDisplay=["select","bizTime","amount","categoryName","members","tradetgtName","tags","comment","operation"];constructor(e,i,n,a,m,d,D,O,k){super(),this.route=e,this.elementRef=i,this.dateAdapter=n,this.algorithm=a,this.communication=m,this.notification=d,this.datetimeService=D,this.databaseService=O,this.operation=k,this.dataSource=new en(L=>{let W=this.range.controls.start.value,y=this.range.controls.end.value,w=kn(Ln({},this.searchKeys),{startTime:W?this.datetimeService.getStartDatetime(W).valueOf():null,endTime:y?this.datetimeService.getEndDatetime(y).valueOf():null,pageSize:L.pageSize,pageIndex:L.pageIndex+1}),B;for(let x in w)B=w[x],Array.isArray(B)&&!B.length&&(w[x]=null);return this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.queryEntries(w).pipe(te(()=>G({code:500,data:{dailyItems:[],flowCount:0},error:""})));},L=>{let W=this.dateAdapter,y=this.accounts,w=[];return this.selection.clear(),this.notification.hideLoading(),L.data.dailyItems?.forEach(B=>{w.push({bizTime:W.toIso8601(W.deserialize(B.date)),comment:" + "+B.income+"   |   - "+B.outgo}),B.flowList.forEach(x=>{x.accountName=y.find(Ke=>Ke.uuid===x.accountId)?.name;}),w=w.concat(B.flowList);}),this.totalEntry=`${L.data.totalIncomeString} | -${L.data.totalOutgoString}`,this.paginator.length=Yt(L?.data?.flowCount),w;},!0,!1);}ngOnInit(){this.dataSource.paginator=this.paginator,this.datetimeService.initTimeRange(this.range),this.displayedColumns=this.columnsToDisplay,ee([this.databaseService.getBooks(),this.databaseService.getShortAccounts()]).pipe(V(()=>{this.notification.hideLoading();})).subscribe(e=>{this.books=e[0].data.books;let i=this.books[0];i&&(this.searchKeys.bkId=i.id,this.dataSource.readied=!0,this.onBookSelectionChange({value:i.id})),this.accounts=e[1].data.accounts,this.initRefreshIndicator();});}ngOnDestroy(){this.datetimeService.destoryTimeRange();}isSummary=(e,i)=>!i.id;isNotSummary=(e,i)=>!!i.id;onBookSelectionChange(e){let i=e.value;this.notification.showLoading(this.elementRef.nativeElement),ee([this.databaseService.getTransactionObjects(i),this.databaseService.getBookProjects(i),this.databaseService.getMembers(i),this.databaseService.getEntryCategories(i,qe.PAY)]).pipe(V(()=>{this.notification.hideLoading(),this.communication.giveRefreshCommand();})).subscribe(n=>{this.txnObjects=n[0].data.bookTradeTargets,this.projects=n[1].data.bookProjects,this.members=n[2].data.bookMembers,this.payCategories=n[3].data.bookCategories;});}isAllSelected(){let e=this.selection.selected.length,i=this.dataSource.data.length;return i>0&&e===i;}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(e=>this.selection.select(e));}search(){this.dataSource.reset();}reset(){let e=this.dateAdapter,i=this.searchKeys,n=e.today(),a=e.createDate(e.getYear(n),e.getMonth(n),1),m=n;this.range.setValue({start:a,end:m}),i.bkId=this.books[0].id,i.amountStart=null,i.amountEnd=null,i.comment=null,i.recTypeList=null,i.mainTypeIdList=null,i.subTypeIdList=null,i.accountIdList=null,i.projectIdList=null,i.tradetgtIdList=null,i.memberIdList=null,i.reimburseList=null,this.dataSource.reset();}addNewOne(){this.operation.addNewOne("new",this.route.parent);}edit(e){this.operation.edit(e,this.route.parent);}delete(){let e=this.selection.selected.map(i=>i.id);!e.length||this.deleting||(this.deleting=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.deleteEntries(e).pipe(V(()=>{this.deleting=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand();})).subscribe());}initRefreshIndicator(){this.subscription.add(this.communication.acceptRefreshCommand().pipe(re(300)).subscribe(()=>{this.dataSource.reload();}));}static ɵfac=function(i){return new(i||t)(S(ae),S(U),S(Ee),S(Ut),S(Q),S(z),S(Ct),S(F),S(Ae));};static ɵcmp=Y({type:t,selectors:[["app-search-entries"]],viewQuery:function(i,n){if(i&1&&Te(We,7),i&2){let a;be(a=he())&&(n.paginator=a.first);}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],features:[zn],decls:122,vars:34,consts:()=>{let e;e="Start date";let i;i="End date";let n;n="Account book";let a;a="Date range";let m;m="Type";let d;d="Balance modification";let D;D="Amount";let O;O="Comment";let k;k="Account";let L;L="Member";let W;W="Trader";let y;y="Tags";let w;w="Reimburse";let B;B="To be reimbursed";let x;x="Reimbursed";let Ke;Ke="Non-reimbursable";let ht;ht="Search";let Nt;Nt="Reset";let It;It="Pay";let Mt;Mt="Revenue";let Rt;Rt="Transfer";let yt;yt="Loan(incoming)";let Dt;Dt="Loan(outing)";let vt;vt="Time";let Ot;Ot="Amount";let wt;wt="Category";let Pt;Pt="Member";let xt;xt="Trader";let $t;$t="Tags";let Lt;Lt="Account";let kt;return kt="Comment",[["picker",""],n,a,m,d,D,O,k,L,W,y,w,B,x,Ke,ht,Nt,It,Mt,Rt,yt,Dt,vt,Ot,wt,Pt,xt,$t,Lt,kt,[3,"new","delete"],[1,"align-middle","ms-2"],["appStartContent","",1,"d-flex","flex-column","h-100",3,"ngSubmit"],[1,"flex-fill","overflow-auto","p-3"],["appearance","outline",1,"w-100"],["name","book",3,"valueChange","selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder",e],["matEndDate","","formControlName","end","placeholder",i],["matSuffix","",3,"for"],["name","recordTypes","multiple","",3,"valueChange","value"],[3,"value"],[1,"d-flex","flex-row","flex-nowrap","w-100"],["name","amountStart","type","number","matInput","",3,"ngModelChange","ngModel"],[1,"mx-2","flex-grow-0","flex-shrink-0"],["name","amountEnd","type","number","matInput","",3,"ngModelChange","click","ngModel"],["name","comment","type","text","matInput","",3,"ngModelChange","ngModel"],["name","accounts","multiple","",3,"valueChange","value"],["name","members","multiple","",3,"valueChange","value"],["name","txnObjects","multiple","",3,"valueChange","value"],["name","tags","multiple","",3,"ngModelChange","ngModel"],["name","reimburse","multiple","",3,"ngModelChange","ngModel"],[1,"container-fluid","py-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2"],["fontset","Marching"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"d-flex","flex-column","flex-nowrap","h-100"],[1,"flex-fill","overflow-hidden"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","select","sticky","true"],["mat-header-cell","","style","width: 50px;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","bizTime"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","amount"],["mat-cell","","class","text-nowrap",3,"ngSwitch",4,"matCellDef"],["matColumnDef","categoryName"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","members"],["matColumnDef","tradetgtName"],["matColumnDef","tags"],["mat-cell","","style","line-height: 1.1;",4,"matCellDef"],["matColumnDef","comment"],["mat-cell","","width","1000",4,"matCellDef"],["matColumnDef","operation","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["matColumnDef","daySummary"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["class","table-primary text-start","mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["showFirstLastButtons","",3,"pageSizeOptions","pageSize"],[3,"ngSwitch"],[4,"ngSwitchCase"],["mat-header-cell","",2,"width","50px"],["matBadgeColor","warn",1,"mat-checkbox-mini",3,"change","checked","indeterminate","matBadge"],["mat-cell",""],[1,"mat-checkbox-mini",3,"click","change","checked"],["mat-header-cell",""],[1,"text-nowrap"],["mat-cell","",1,"text-nowrap",3,"ngSwitch"],["class","text-danger",4,"ngSwitchCase"],["class","text-success",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchCase"],[3,"text-info","text-warning",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchDefault"],[1,"text-danger"],[1,"text-success"],[1,"text-muted"],["mat-cell","",1,"text-nowrap"],[4,"ngFor","ngForOf"],["mat-cell","",2,"line-height","1.1"],["mat-cell","","width","1000"],[1,"ellipsis-description-line-2"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""],["mat-row","",1,"table-primary","text-start"]];},template:function(i,n){if(i&1){let a=P();o(0,"app-default-operation-toolbar",30),R("new",function(){return f(a),C(n.addNewOne());})("delete",function(){return f(a),C(n.delete());}),c(),o(1,"app-breadcrumb")(2,"span",31),E(3),c()(),o(4,"app-two-cols-layout")(5,"form",32),R("ngSubmit",function(){return f(a),C(n.search());}),o(6,"div",33)(7,"mat-form-field",34)(8,"mat-label"),s(9),p(10,1),u(),c(),o(11,"mat-select",35),I("valueChange",function(d){return f(a),N(n.searchKeys.bkId,d)||(n.searchKeys.bkId=d),C(d);}),R("selectionChange",function(d){return f(a),C(n.onBookSelectionChange(d));}),g(12,Da,2,2,"mat-option",36),c()(),o(13,"mat-form-field",34)(14,"mat-label"),p(15,2),c(),o(16,"mat-date-range-input",37),T(17,"input",38)(18,"input",39),c(),T(19,"mat-datepicker-toggle",40)(20,"mat-date-range-picker",null,0),c(),o(22,"mat-form-field",34)(23,"mat-label"),p(24,3),c(),o(25,"mat-select",41),I("valueChange",function(d){return f(a),N(n.searchKeys.recTypeList,d)||(n.searchKeys.recTypeList=d),C(d);}),g(26,$a,7,7,"mat-option",36),o(27,"mat-option",42),p(28,4),c()()(),o(29,"mat-form-field",34)(30,"mat-label"),p(31,5),c(),o(32,"div",43)(33,"input",44),I("ngModelChange",function(d){return f(a),N(n.searchKeys.amountStart,d)||(n.searchKeys.amountStart=d),C(d);}),c(),o(34,"mat-icon",45),E(35,"settings_ethernet"),c(),o(36,"input",46),I("ngModelChange",function(d){return f(a),N(n.searchKeys.amountEnd,d)||(n.searchKeys.amountEnd=d),C(d);}),R("click",function(d){return f(a),C(d.stopPropagation());}),c()()(),o(37,"mat-form-field",34)(38,"mat-label"),p(39,6),c(),o(40,"input",47),I("ngModelChange",function(d){return f(a),N(n.searchKeys.comment,d)||(n.searchKeys.comment=d),C(d);}),c()(),o(41,"mat-form-field",34)(42,"mat-label"),p(43,7),c(),o(44,"mat-select",48),I("valueChange",function(d){return f(a),N(n.searchKeys.accountIdList,d)||(n.searchKeys.accountIdList=d),C(d);}),g(45,La,2,2,"mat-option",36),c()(),o(46,"mat-form-field",34)(47,"mat-label"),p(48,8),c(),o(49,"mat-select",49),I("valueChange",function(d){return f(a),N(n.searchKeys.memberIdList,d)||(n.searchKeys.memberIdList=d),C(d);}),g(50,ka,2,2,"mat-option",36),c()(),o(51,"mat-form-field",34)(52,"mat-label"),p(53,9),c(),o(54,"mat-select",50),I("valueChange",function(d){return f(a),N(n.searchKeys.tradetgtIdList,d)||(n.searchKeys.tradetgtIdList=d),C(d);}),g(55,Wa,2,2,"mat-option",36),c()(),o(56,"mat-form-field",34)(57,"mat-label"),p(58,10),c(),o(59,"mat-select",51),I("ngModelChange",function(d){return f(a),N(n.searchKeys.projectIdList,d)||(n.searchKeys.projectIdList=d),C(d);}),g(60,Va,2,2,"mat-option",36),c()(),o(61,"mat-form-field",34)(62,"mat-label"),p(63,11),c(),o(64,"mat-select",52),I("ngModelChange",function(d){return f(a),N(n.searchKeys.reimburseList,d)||(n.searchKeys.reimburseList=d),C(d);}),o(65,"mat-option",42),s(66),p(67,12),u(),c(),o(68,"mat-option",42),s(69),p(70,13),u(),c(),o(71,"mat-option",42),s(72),p(73,14),u(),c()()()(),o(74,"div",53)(75,"button",54)(76,"mat-icon",55),E(77,"search"),c(),s(78),p(79,15),u(),c(),o(80,"button",56),R("click",function(){return f(a),C(n.reset());}),o(81,"mat-icon"),E(82,"search_off"),c(),s(83),p(84,16),u(),c()()(),o(85,"div",57)(86,"div",58)(87,"div",59)(88,"table",60),s(89,61),g(90,Ga,2,3,"th",62)(91,Xa,2,1,"td",63),u(),s(92,64),g(93,Ba,3,0,"th",65)(94,Ha,4,4,"td",63),u(),s(95,66),g(96,Ya,3,0,"th",65)(97,Qa,9,11,"td",67),u(),s(98,68),g(99,Za,3,0,"th",65)(100,Ja,2,1,"td",69),u(),s(101,70),g(102,eo,3,0,"th",65)(103,no,2,1,"td",69),u(),s(104,71),g(105,io,3,0,"th",65)(106,ao,2,1,"td",69),u(),s(107,72),g(108,oo,6,0,"th",65)(109,co,6,2,"td",73),u(),s(110,74),g(111,lo,3,0,"th",65)(112,_o,3,1,"td",75),u(),s(113,76),g(114,mo,1,0,"th",77)(115,so,4,0,"td",63),u(),s(116,78),g(117,uo,3,6,"td",63),u(),g(118,po,1,0,"tr",79)(119,Eo,1,0,"tr",80)(120,fo,1,0,"tr",81),c()()(),T(121,"mat-paginator",82),c()();}if(i&2){let a=ce(21);l(3),X(n.totalEntry),l(8),h("value",n.searchKeys.bkId),l(),_("ngForOf",n.books),l(4),_("formGroup",n.range)("rangePicker",a),l(3),_("for",a),l(6),h("value",n.searchKeys.recTypeList),l(),_("ngForOf",n.recordTypes),l(),_("value",null),l(6),h("ngModel",n.searchKeys.amountStart),l(3),h("ngModel",n.searchKeys.amountEnd),l(4),h("ngModel",n.searchKeys.comment),l(4),h("value",n.searchKeys.accountIdList),l(),_("ngForOf",n.accounts),l(4),h("value",n.searchKeys.memberIdList),l(),_("ngForOf",n.members),l(4),h("value",n.searchKeys.tradetgtIdList),l(),_("ngForOf",n.txnObjects),l(4),h("ngModel",n.searchKeys.projectIdList),l(),_("ngForOf",n.projects),l(4),h("ngModel",n.searchKeys.reimburseList),l(),_("value",1),l(3),_("value",2),l(3),_("value",0),l(17),_("dataSource",n.dataSource),l(30),_("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),l(),_("matRowDefColumns",n.displayedColumns)("matRowDefWhen",n.isNotSummary),l(),_("matRowDefColumns",Qn(33,ya))("matRowDefWhen",n.isSummary),l(),_("pageSizeOptions",n.dataSource.pageSizeOptions)("pageSize",n.dataSource.pageSizeOptions[0]);}},dependencies:[Ie,Me,Re,it,Jt,rt,me,ct,se,ue,ye,pe,Oe,we,Zt,ge,pt,st,ut,Et,Ce,fe,ve,K,mt,Pe,dt,lt,_t,We,Ve,Xe,ze,Be,Ge,Fe,He,Ye,je,Ue,Se,xe,$e,Le,at,ft],encapsulation:2});}return t;})();function Co(t,r){if(t&1){let e=P();o(0,"th",42)(1,"mat-checkbox",43),R("change",function(n){f(e);let a=A();return C(n?a.masterToggle():null);}),c()();}if(t&2){let e=A();l(),_("checked",e.selection.hasValue()&&e.isAllSelected())("indeterminate",e.selection.hasValue()&&!e.isAllSelected())("matBadge",e.selection.selected.length);}}function go(t,r){if(t&1){let e=P();o(0,"td",44)(1,"mat-checkbox",45),R("click",function(n){return f(e),C(n.stopPropagation());})("change",function(n){let a=f(e).$implicit,m=A();return C(n?m.selection.toggle(a):null);}),c()();}if(t&2){let e=r.$implicit,i=A();l(),_("checked",i.selection.isSelected(e));}}function So(t,r){t&1&&(o(0,"th",46),s(1),p(2,4),u(),c());}function Ao(t,r){if(t&1&&(o(0,"td",44)(1,"span",47),E(2),j(3,"date"),c()()),t&2){let e=r.$implicit;l(2),X(q(3,1,e.bizTime,"yyyy-MM-dd HH:mm:ss"));}}function To(t,r){t&1&&(o(0,"th",46),s(1),p(2,5),u(),c());}function bo(t,r){t&1&&(o(0,"mat-icon",54),E(1,"remove"),c());}function ho(t,r){t&1&&(o(0,"mat-icon",55),E(1,"add"),c());}function No(t,r){if(t&1&&(o(0,"mat-icon",56),E(1),c()),t&2){let e=A().$implicit,i=A();l(),X(e.targetId===i.accountId?"add":"remove");}}function Io(t,r){if(t&1&&(o(0,"mat-icon"),E(1),c()),t&2){let e=A().$implicit;de("text-info",e.recSubtype===0)("text-warning",e.recSubtype!==0),l(),M(" ",e.recSubtype===0?"add":"remove"," ");}}function Mo(t,r){if(t&1&&(o(0,"mat-icon"),E(1),c()),t&2){let e=A().$implicit;de("text-info",e.recSubtype===0)("text-warning",e.recSubtype!==0),l(),M(" ",e.recSubtype===0?"add":"remove"," ");}}function Ro(t,r){t&1&&(o(0,"mat-icon",56),E(1,"help_outline"),c());}function yo(t,r){if(t&1&&(o(0,"td",48),g(1,bo,2,0,"mat-icon",49)(2,ho,2,0,"mat-icon",50)(3,No,2,1,"mat-icon",51)(4,Io,2,5,"mat-icon",52)(5,Mo,2,5,"mat-icon",52)(6,Ro,2,0,"mat-icon",53),E(7),j(8,"number"),c()),t&2){let e=r.$implicit;_("ngSwitch",e.recType),l(),_("ngSwitchCase",1),l(),_("ngSwitchCase",2),l(),_("ngSwitchCase",3),l(),_("ngSwitchCase",4),l(),_("ngSwitchCase",5),l(2),ie(" ",e.moneyType.flag," ",q(8,8,e.amount/100,"0.2-2")," ");}}function Do(t,r){t&1&&(o(0,"th",46),s(1),p(2,6),u(),c());}function vo(t,r){if(t&1&&(o(0,"td",57),E(1),j(2,"number"),c()),t&2){let e=r.$implicit;l(),ie(" ",e.moneyType.flag," ",q(2,2,e.accountBalance,"0.2-2")," ");}}function Oo(t,r){t&1&&(o(0,"th",46),s(1),p(2,7),u(),c());}function wo(t,r){if(t&1&&(o(0,"td",57),E(1),c()),t&2){let e=r.$implicit;l(),M(" ",e.categoryName," ");}}function Po(t,r){t&1&&(o(0,"th",46),s(1),p(2,8),u(),c());}function xo(t,r){if(t&1&&(s(0)(1),E(2),u()()),t&2){let e=r.$implicit,i=r.last;l(2),ie("",e.name,"",i?"":", ","");}}function $o(t,r){if(t&1&&(o(0,"td",44)(1,"small",47),g(2,xo,3,2,"ng-container",58),c()()),t&2){let e=r.$implicit;l(2),_("ngForOf",e.tags);}}function Lo(t,r){t&1&&(o(0,"th",46),s(1),p(2,9),u(),c());}function ko(t,r){if(t&1&&(o(0,"td",59)(1,"span",60),E(2),c()()),t&2){let e=r.$implicit;l(2),X(e.comment);}}function Wo(t,r){t&1&&T(0,"th",61);}function Vo(t,r){if(t&1){let e=P();o(0,"td",44)(1,"button",62),R("click",function(){let n=f(e).$implicit,a=A();return C(a.edit(n));}),o(2,"mat-icon"),E(3,"edit"),c()()();}}function Go(t,r){t&1&&T(0,"tr",63);}function Xo(t,r){t&1&&T(0,"tr",64);}var Li=(()=>{class t{elementRef;route;dateAdapter;algorithm;notification;communication;datetimeService;databaseService;operation;breads=[{title:"*"}];displayedColumns=[];selection=new zt(!0,[]);dataSource;showBalance=!1;range=new ot({start:new Ne(null),end:new Ne(null)});paginator;accountId;deleting=!1;columnsToDisplay=["select","bizTime","amount","accountBalance","categoryName","comment","operation"];subscription=new ne();constructor(e,i,n,a,m,d,D,O,k){this.elementRef=e,this.route=i,this.dateAdapter=n,this.algorithm=a,this.notification=m,this.communication=d,this.datetimeService=D,this.databaseService=O,this.operation=k,this.dataSource=new en(L=>{let W=this.range.controls.start.value,y=this.range.controls.end.value;return this.notification.showLoading(this.elementRef.nativeElement),(W&&y?this.databaseService.getEntries(this.accountId,this.datetimeService.getStartDatetime(W),this.datetimeService.getEndDatetime(y)):Vt(()=>new Error("No datetime conditions"))).pipe(te(()=>G({code:500,data:{flows:[]},error:""})));},L=>{this.selection.clear(),this.notification.hideLoading();let W=this.accountId,y=L.data.flows,w=0,B=x=>{switch(x.recType){case $.PAY:w-=x.amount;break;case $.REVENUE:w+=x.amount;break;case $.TRANSFER:x.targetId===W?w+=x.amount:w-=x.amount;break;case $.BORROW:case $.RETURN:x.recSubtype===0?w+=x.amount:w-=x.amount;break;default:w=x.amount,x.recType;}x.accountBalance=w/100;};return this.showBalance&&this.algorithm.reverseDeviceOfDuff(y,B),y;},!1,!0);}ngOnInit(){this.breads[0].title=this.route.snapshot.queryParamMap.get("title"),this.displayedColumns=this.columnsToDisplay.filter(e=>e!=="accountBalance"||this.showBalance),this.dataSource.paginator=this.paginator,this.subscription.add(this.route.paramMap.subscribe(e=>{this.accountId=e.get("accountId");})),this.subscription.add(this.communication.acceptRefreshCommand().pipe(re(300)).subscribe(()=>{this.dataSource.reload();})),this.subscription.add(this.range.valueChanges.pipe(re(300)).subscribe(()=>{this.dataSource.reset();})),this.datetimeService.initTimeRange(this.range);}ngOnDestroy(){this.datetimeService.destoryTimeRange(),this.subscription.unsubscribe();}isAllSelected(){let e=this.selection.selected.length,i=this.dataSource.data.length;return i>0&&e===i;}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(e=>this.selection.select(e));}onShowBalanceChange(e){e.checked?(this.range.setValue({start:this.datetimeService.getMinDate(),end:this.datetimeService.getMaxDate()}),this.range.disable()):this.range.enable(),this.displayedColumns=this.columnsToDisplay.filter(i=>i!=="accountBalance"||this.showBalance);}addNewOne(){this.operation.addNewOne(this.accountId,this.route.parent);}edit(e){this.operation.edit(e,this.route.parent);}delete(){let e=this.selection.selected.map(i=>i.id);!e.length||this.deleting||(this.deleting=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.deleteEntries(e).pipe(V(()=>{this.deleting=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand();})).subscribe());}static ɵfac=function(i){return new(i||t)(S(U),S(ae),S(Ee),S(Ut),S(z),S(Q),S(Ct),S(F),S(Ae));};static ɵcmp=Y({type:t,selectors:[["app-account-entries"]],viewQuery:function(i,n){if(i&1&&Te(We,7),i&2){let a;be(a=he())&&(n.paginator=a.first);}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:53,vars:12,consts:()=>{let e;e="Start date";let i;i="End date";let n;n="Date range";let a;a="Show balance";let m;m="Review all entries of this account.";let d;d="Time";let D;D="Amount";let O;O="Balance";let k;k="Category";let L;L="Tags";let W;return W="Comment",[["picker",""],n,a,m,d,D,O,k,L,W,[3,"new","delete"],[3,"items"],["appStartContent","",1,"d-flex","flex-column","h-100"],[1,"p-3"],["appearance","outline",1,"w-100"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder",e],["matEndDate","","formControlName","end","placeholder",i],["matSuffix","",3,"for","disabled"],["color","primary",3,"ngModelChange","change","ngModel"],[1,"d-flex","flex-column","flex-nowrap","h-100"],[1,"flex-fill","overflow-hidden"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","select","sticky","true"],["mat-header-cell","","style","min-width: 50px;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","bizTime"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","amount"],["mat-cell","","class","text-nowrap",3,"ngSwitch",4,"matCellDef"],["matColumnDef","accountBalance"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","categoryName"],["matColumnDef","tags"],["matColumnDef","comment"],["mat-cell","","width","1000",4,"matCellDef"],["matColumnDef","operation","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions","pageSize"],["mat-header-cell","",2,"min-width","50px"],["matBadgeColor","warn",1,"mat-checkbox-mini",3,"change","checked","indeterminate","matBadge"],["mat-cell",""],[1,"mat-checkbox-mini",3,"click","change","checked"],["mat-header-cell",""],[1,"text-nowrap"],["mat-cell","",1,"text-nowrap",3,"ngSwitch"],["class","text-danger",4,"ngSwitchCase"],["class","text-success",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchCase"],[3,"text-info","text-warning",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchDefault"],[1,"text-danger"],[1,"text-success"],[1,"text-muted"],["mat-cell","",1,"text-nowrap"],[4,"ngFor","ngForOf"],["mat-cell","","width","1000"],[1,"ellipsis-description-line-2"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""]];},template:function(i,n){if(i&1){let a=P();o(0,"app-default-operation-toolbar",10),R("new",function(){return f(a),C(n.addNewOne());})("delete",function(){return f(a),C(n.delete());}),c(),T(1,"app-breadcrumb",11),o(2,"app-two-cols-layout")(3,"div",12)(4,"div",13)(5,"mat-form-field",14)(6,"mat-label"),p(7,1),c(),o(8,"mat-date-range-input",15),T(9,"input",16)(10,"input",17),c(),T(11,"mat-datepicker-toggle",18)(12,"mat-date-range-picker",null,0),c(),o(14,"div")(15,"mat-slide-toggle",19),I("ngModelChange",function(d){return f(a),N(n.showBalance,d)||(n.showBalance=d),C(d);}),R("change",function(d){return f(a),C(n.onShowBalanceChange(d));}),s(16),p(17,2),u(),c()(),o(18,"p")(19,"small"),s(20),p(21,3),u(),c()()()(),o(22,"div",20)(23,"div",21)(24,"div",22)(25,"table",23),s(26,24),g(27,Co,2,3,"th",25)(28,go,2,1,"td",26),u(),s(29,27),g(30,So,3,0,"th",28)(31,Ao,4,4,"td",26),u(),s(32,29),g(33,To,3,0,"th",28)(34,yo,9,11,"td",30),u(),s(35,31),g(36,Do,3,0,"th",28)(37,vo,3,5,"td",32),u(),s(38,33),g(39,Oo,3,0,"th",28)(40,wo,2,1,"td",32),u(),s(41,34),g(42,Po,3,0,"th",28)(43,$o,3,1,"td",26),u(),s(44,35),g(45,Lo,3,0,"th",28)(46,ko,3,1,"td",36),u(),s(47,37),g(48,Wo,1,0,"th",38)(49,Vo,4,0,"td",26),u(),g(50,Go,1,0,"tr",39)(51,Xo,1,0,"tr",40),c()()(),T(52,"mat-paginator",41),c()();}if(i&2){let a=ce(13);l(),_("items",n.breads),l(7),_("formGroup",n.range)("rangePicker",a),l(3),_("for",a)("disabled",n.showBalance),l(4),h("ngModel",n.showBalance),l(10),_("dataSource",n.dataSource),l(25),_("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),l(),_("matRowDefColumns",n.displayedColumns),l(),_("pageSizeOptions",n.dataSource.pageSizeOptions)("pageSize",n.dataSource.pageSizeOptions[0]);}},dependencies:[Ie,Me,Re,it,Jt,me,se,ue,ye,we,Zt,ge,pt,st,ut,Et,Ce,fe,ve,K,ui,lt,_t,We,Ve,Xe,ze,Be,Ge,Fe,He,Ye,je,Ue,Se,xe,$e,Le,at,ft],encapsulation:2});}return t;})();var H=[];for(dn=0;dn<256;++dn)H.push((dn+256).toString(16).slice(1));var dn;function ki(t,r=0){return(H[t[r+0]]+H[t[r+1]]+H[t[r+2]]+H[t[r+3]]+"-"+H[t[r+4]]+H[t[r+5]]+"-"+H[t[r+6]]+H[t[r+7]]+"-"+H[t[r+8]]+H[t[r+9]]+"-"+H[t[r+10]]+H[t[r+11]]+H[t[r+12]]+H[t[r+13]]+H[t[r+14]]+H[t[r+15]]).toLowerCase();}var mn,Bo=new Uint8Array(16);function gn(){if(!mn&&(mn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!mn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mn(Bo);}var Ho=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Sn={randomUUID:Ho};function Yo(t,r,e){if(Sn.randomUUID&&!r&&!t)return Sn.randomUUID();t=t||{};var i=t.random||(t.rng||gn)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,r){e=e||0;for(var n=0;n<16;++n)r[e+n]=i[n];return r;}return ki(i);}var An=Yo;var Je=class{amount;accountId;accountName;bizId;bizTime;bkId;bookId;categoryId;comment;address;attachments;members;recType;recSubtype;lendType;flag;profit;reimburse;sourceSystem;tags;tradetgtId;tradetgtName;id;edited;deleted;accountBalance;account;category;member;project;targetId;targetName;targetAmount;tradetgt;constructor(){this.id=0,this.amount=0,this.comment="",this.address="",this.attachments="",this.reimburse=0,this.edited=0,this.deleted=0,this.sourceSystem=201;}};function jo(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function Uo(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.categoryId),l(),M(" ",e.name," ");}}function qo(t,r){if(t&1&&(o(0,"mat-optgroup",77),g(1,Uo,2,2,"mat-option",55),c()),t&2){let e=r.$implicit;_("label",e.name),l(),_("ngForOf",e.outgoSubTypes);}}function Ko(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e),l(),M(" ",e.name," ");}}function Qo(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function Zo(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function Jo(t,r){if(t&1){let e=P();o(0,"div",67)(1,"div",51)(2,"div",52)(3,"mat-form-field",53)(4,"mat-label"),p(5,9),c(),o(6,"mat-select",68),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.accountId,n)||(a.entry.accountId=n),C(n);}),g(7,jo,2,2,"mat-option",55),c()()(),o(8,"div",52)(9,"mat-form-field",53)(10,"mat-label"),p(11,10),c(),o(12,"mat-select",69),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.categoryId,n)||(a.entry.categoryId=n),C(n);}),g(13,qo,2,2,"mat-optgroup",70),c()()()(),o(14,"div",51)(15,"div",52)(16,"mat-form-field",53)(17,"mat-label"),p(18,11),c(),o(19,"mat-select",71),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.tags,n)||(a.entry.tags=n),C(n);}),g(20,Ko,2,2,"mat-option",55),c()()(),o(21,"div",52)(22,"mat-form-field",53)(23,"mat-label"),p(24,12),c(),o(25,"mat-select",72),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.tradetgtId,n)||(a.entry.tradetgtId=n),C(n);}),o(26,"mat-option",73),E(27,"-"),c(),g(28,Qo,2,2,"mat-option",55),c()()()(),o(29,"div",51)(30,"div",52)(31,"mat-form-field",53)(32,"mat-label"),p(33,13),c(),o(34,"mat-select",74),I("ngModelChange",function(n){f(e);let a=A();return N(a.selectedMembers,n)||(a.selectedMembers=n),C(n);}),g(35,Zo,2,2,"mat-option",55),c()()(),o(36,"div",52)(37,"mat-form-field",53)(38,"mat-label"),p(39,14),c(),o(40,"mat-select",75),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.reimburse,n)||(a.entry.reimburse=n),C(n);}),o(41,"mat-option",76),s(42),p(43,15),u(),c(),o(44,"mat-option",76),s(45),p(46,16),u(),c(),o(47,"mat-option",76),s(48),p(49,17),u(),c()()()()()();}if(t&2){let e=A();l(6),h("ngModel",e.entry.accountId),l(),_("ngForOf",e.accounts),l(5),h("ngModel",e.entry.categoryId),l(),_("ngForOf",e.payCategories),l(6),_("compareWith",e.compareTagWith),h("ngModel",e.entry.tags),l(),_("ngForOf",e.tags),l(5),h("ngModel",e.entry.tradetgtId),l(3),_("ngForOf",e.txnObjects),l(6),h("ngModel",e.selectedMembers),l(),_("ngForOf",e.members),l(5),h("ngModel",e.entry.reimburse),l(),_("value",1),l(3),_("value",2),l(3),_("value",0);}}function er(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function tr(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.categoryId),l(),M(" ",e.name," ");}}function nr(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e),l(),M(" ",e.name," ");}}function ir(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function ar(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function or(t,r){if(t&1){let e=P();o(0,"div",67)(1,"div",51)(2,"div",52)(3,"mat-form-field",53)(4,"mat-label"),p(5,18),c(),o(6,"mat-select",68),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.accountId,n)||(a.entry.accountId=n),C(n);}),g(7,er,2,2,"mat-option",55),c()()(),o(8,"div",52)(9,"mat-form-field",53)(10,"mat-label"),p(11,19),c(),o(12,"mat-select",78),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.categoryId,n)||(a.entry.categoryId=n),C(n);}),g(13,tr,2,2,"mat-option",55),c()()()(),o(14,"div",51)(15,"div",52)(16,"mat-form-field",53)(17,"mat-label"),p(18,20),c(),o(19,"mat-select",71),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.tags,n)||(a.entry.tags=n),C(n);}),o(20,"mat-option",73),E(21,"-"),c(),g(22,nr,2,2,"mat-option",55),c()()(),o(23,"div",52)(24,"mat-form-field",53)(25,"mat-label"),p(26,21),c(),o(27,"mat-select",72),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.tradetgtId,n)||(a.entry.tradetgtId=n),C(n);}),o(28,"mat-option",73),E(29,"-"),c(),g(30,ir,2,2,"mat-option",55),c()()()(),o(31,"div",51)(32,"div",52)(33,"mat-form-field",53)(34,"mat-label"),p(35,22),c(),o(36,"mat-select",74),I("ngModelChange",function(n){f(e);let a=A();return N(a.selectedMembers,n)||(a.selectedMembers=n),C(n);}),g(37,ar,2,2,"mat-option",55),c()()(),o(38,"div",52)(39,"mat-form-field",53)(40,"mat-label"),p(41,23),c(),o(42,"mat-select",75),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.reimburse,n)||(a.entry.reimburse=n),C(n);}),o(43,"mat-option",76),s(44),p(45,24),u(),c(),o(46,"mat-option",76),s(47),p(48,25),u(),c(),o(49,"mat-option",76),s(50),p(51,26),u(),c()()()()()();}if(t&2){let e=A();l(6),h("ngModel",e.entry.accountId),l(),_("ngForOf",e.accounts),l(5),h("ngModel",e.entry.categoryId),l(),_("ngForOf",e.revenueCategories),l(6),_("compareWith",e.compareTagWith),h("ngModel",e.entry.tags),l(3),_("ngForOf",e.tags),l(5),h("ngModel",e.entry.tradetgtId),l(3),_("ngForOf",e.txnObjects),l(6),h("ngModel",e.selectedMembers),l(),_("ngForOf",e.members),l(5),h("ngModel",e.entry.reimburse),l(),_("value",1),l(3),_("value",2),l(3),_("value",0);}}function rr(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function cr(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function lr(t,r){if(t&1){let e=P();o(0,"div",67)(1,"div",51)(2,"div",52)(3,"mat-form-field",53)(4,"mat-label"),p(5,27),c(),o(6,"mat-select",79),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.accountId,n)||(a.entry.accountId=n),C(n);}),g(7,rr,2,2,"mat-option",55),c()()(),o(8,"div",52)(9,"mat-form-field",53)(10,"mat-label"),p(11,28),c(),o(12,"mat-select",80),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.targetId,n)||(a.entry.targetId=n),C(n);}),g(13,cr,2,2,"mat-option",55),c()()()()();}if(t&2){let e=A();l(6),h("ngModel",e.entry.accountId),_("forbiddenSame",e.entry.targetId),l(),_("ngForOf",e.accounts),l(5),h("ngModel",e.entry.targetId),_("forbiddenSame",e.entry.accountId),l(),_("ngForOf",e.accounts);}}function _r(t,r){t&1&&(s(0)(1),p(2,30),u()());}function dr(t,r){t&1&&(s(0)(1),p(2,31),u()());}function mr(t,r){t&1&&(s(0)(1),p(2,32),u()());}function sr(t,r){t&1&&(s(0)(1),p(2,33),u()());}function ur(t,r){if(t&1&&(o(0,"mat-option",86),g(1,_r,3,0,"ng-container",84)(2,dr,3,0,"ng-container",84)(3,mr,3,0,"ng-container",84)(4,sr,3,0,"ng-container",84),c()),t&2){let e=r.$implicit;_("value",e)("ngSwitch",e),l(),_("ngSwitchCase",1),l(),_("ngSwitchCase",2),l(),_("ngSwitchCase",3),l(),_("ngSwitchCase",4);}}function pr(t,r){t&1&&(s(0)(1),p(2,34),u()());}function Er(t,r){t&1&&(s(0)(1),p(2,35),u()());}function fr(t,r){t&1&&(s(0)(1),p(2,36),u()());}function Cr(t,r){t&1&&(s(0)(1),p(2,37),u()());}function gr(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function Sr(t,r){t&1&&(s(0)(1),p(2,38),u()());}function Ar(t,r){t&1&&(s(0)(1),p(2,39),u()());}function Tr(t,r){t&1&&(s(0)(1),p(2,40),u()());}function br(t,r){t&1&&(s(0)(1),p(2,41),u()());}function hr(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.uuid),l(),M(" ",e.name," ");}}function Nr(t,r){if(t&1){let e=P();o(0,"div",67)(1,"div",51)(2,"div",52)(3,"mat-form-field",53)(4,"mat-label"),p(5,29),c(),o(6,"mat-select",81),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.lendType,n)||(a.entry.lendType=n),C(n);}),g(7,ur,5,6,"mat-option",82),c()()()(),o(8,"div",51)(9,"div",52)(10,"mat-form-field",53)(11,"mat-label",83),g(12,pr,3,0,"ng-container",84)(13,Er,3,0,"ng-container",84)(14,fr,3,0,"ng-container",84)(15,Cr,3,0,"ng-container",84),c(),o(16,"mat-select",85),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.accountId,n)||(a.entry.accountId=n),C(n);}),g(17,gr,2,2,"mat-option",55),c()()(),o(18,"div",52)(19,"mat-form-field",53)(20,"mat-label",83),g(21,Sr,3,0,"ng-container",84)(22,Ar,3,0,"ng-container",84)(23,Tr,3,0,"ng-container",84)(24,br,3,0,"ng-container",84),c(),o(25,"mat-select",68),I("ngModelChange",function(n){f(e);let a=A();return N(a.entry.targetId,n)||(a.entry.targetId=n),C(n);}),g(26,hr,2,2,"mat-option",55),c()()()()();}if(t&2){let e=A();l(6),h("ngModel",e.entry.lendType),l(),_("ngForOf",e.loanTypes),l(4),_("ngSwitch",e.entry.lendType),l(),_("ngSwitchCase",1),l(),_("ngSwitchCase",2),l(),_("ngSwitchCase",3),l(),_("ngSwitchCase",4),l(),h("ngModel",e.entry.accountId),l(),_("ngForOf",e.creditors),l(3),_("ngSwitch",e.entry.lendType),l(),_("ngSwitchCase",1),l(),_("ngSwitchCase",2),l(),_("ngSwitchCase",3),l(),_("ngSwitchCase",4),l(),h("ngModel",e.entry.targetId),l(),_("ngForOf",e.accounts);}}function Ir(t,r){if(t&1&&(o(0,"mat-option",76),E(1),c()),t&2){let e=r.$implicit;_("value",e.id),l(),M(" ",e.name," ");}}function Tn(){return An();}var bn=(()=>{class t{elementRef;route;dateAdapter;communication;notification;databaseService;operation;books=[];accounts=[];tags=[];members=[];payCategories=[];revenueCategories=[];txnObjects=[];creditors=[];loanTypes=[J.BORROW,J.LEND,J.RECEIVE,J.REPAYMENT];compareTagWith=(e,i)=>e?.tagId===i?.tagId;entry;selectedMembers;bizDatetime;isNew=!1;selectedTabIndex=0;saving=!1;accountId;entryForm;selects;getEntrySsp;subscription=new ne();constructor(e,i,n,a,m,d,D){this.elementRef=e,this.route=i,this.dateAdapter=n,this.communication=a,this.notification=m,this.databaseService=d,this.operation=D,this.entry=new Je(),this.entry.bizId=Tn(),this.entry.recType=$.PAY;}ngOnInit(){this.isNew=!this.route.snapshot.paramMap.get("accountId"),this.subscription.add(this.route.paramMap.subscribe(e=>{let i=e.get("entryId"),n=e.get("accountId");n?(this.accountId=n==="new"?void 0:n,this.entry.accountId=this.accountId,this.isNew=!0,this.bizDatetime=this.dateAdapter.today()):i&&(this.isNew=!1);}));}ngAfterViewInit(){this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.getBooks().pipe(Vn(100),te(e=>(this.notification.hideLoading(),Vt(()=>e)))).subscribe(e=>{if(e&&e.data&&e.data.books[0]){let i=e.data.books[0],n=i.id;this.books=e.data.books,this.isNew?(this.entry.bkId=i.id,this.entry.bookId=i.uuid):n=Yt(this.route.snapshot.paramMap.get("bookId")),ee([this.databaseService.getShortAccounts(),this.databaseService.getShortAccounts(-1),this.getAdditionalDatas(n)]).pipe(V(()=>{this.notification.hideLoading();})).subscribe(a=>{if(this.accounts=a[0].data.accounts,this.creditors=a[1].data.accounts,this.isNew)!this.entry.accountId&&this.accounts[0]&&(this.entry.accountId=this.accounts[0].uuid);else{let m=this.route.snapshot.paramMap.get("entryId");this.getCurrentEntry(n,m);}setTimeout(()=>{this.onSelectedTabChange({index:this.selectedTabIndex});});});}});}ngOnDestroy(){this.subscription.unsubscribe();}onSelectedTabChange(e){let i=this.entry,n=e.index+1,a;switch(i.recType=n,this.checkValuesWhetherExisted(),n){case $.PAY:a=this.payCategories[0];case $.REVENUE:if(a||(a=this.revenueCategories[0]),!i.accountId&&this.accountId){i.accountId=this.accountId;break;}!i.categoryId&&a&&(a.outgoSubTypes&&a.outgoSubTypes[0]?i.categoryId=a.outgoSubTypes[0].categoryId:i.categoryId=a.categoryId),!i.tags?.length&&this.tags&&this.tags.length&&(this.entry.tags=[this.tags[0]]),(!this.selectedMembers||!this.selectedMembers.length)&&this.members&&(this.selectedMembers=this.members.slice(0,1).map(m=>m.uuid));break;case $.TRANSFER:!i.accountId&&this.accountId&&(i.accountId=this.accountId),!i.targetId&&this.accounts[0]&&(i.targetId=this.accounts[0].uuid);break;default:typeof i.lendType>"u"&&(i.lendType=1),i.targetId||(i.targetId=this.accountId||(this.accounts[0]?this.accounts[0].uuid:void 0)),i.accountId||(i.accountId=this.creditors&&this.creditors[0]?this.creditors[0].uuid:void 0);break;}}onBookSelectionChange(e){let i=e.value;this.books&&this.books.some(n=>n.id===i?(this.entry.bookId=n.uuid,!0):!1),this.notification.showLoading(this.elementRef.nativeElement),this.getAdditionalDatas(i).pipe(V(()=>{this.notification.hideLoading,setTimeout(()=>{this.onSelectedTabChange({index:this.selectedTabIndex});});})).subscribe();}save(){this.update().subscribe(e=>{e&&this.cancel();});}saveAs(){let e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(let i in e)e[i].markAsTouched();this.entry.id=0,this.entry.bizId=Tn(),this.save();}saveAndNew(){let e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(let i in e)e[i].markAsTouched();this.update().subscribe(i=>{i&&(this.entry.id=0,this.entry.bizId=Tn());});}cancel(){this.operation.closeSecondaryOutlet(this.route.parent);}update(){if(this.checkValuesWhetherExisted(),this.entryForm&&this.entryForm.valid){let e=this.entry;switch(e.recType){case $.PAY:case $.REVENUE:e.targetId=void 0,e.profit=void 0,e.lendType=void 0,e.recSubtype=void 0,e.members=this.selectedMembers.map(i=>({memberId:i,amount:e.amount}));break;case $.TRANSFER:if(e.accountId===e.targetId)return;e.categoryId=void 0,e.tags=void 0,e.tradetgtId=void 0,e.profit=void 0,e.lendType=void 0,e.recSubtype=void 0,e.reimburse=0,e.targetAmount=e.amount,e.members=this.members.slice(0,1).map(i=>({memberId:i.uuid,amount:e.amount}));break;default:switch(e.categoryId=void 0,e.tags=void 0,e.tradetgtId=void 0,e.profit=0,e.reimburse=0,e.targetAmount=e.amount,e.lendType){case J.LEND:case J.REPAYMENT:e.recSubtype=1;break;default:e.recSubtype=0;}(e.lendType===J.RECEIVE||e.lendType===J.REPAYMENT)&&(e.recType=$.RETURN),e.members=[{amount:e.amount}];break;}return e.bizTime=this.dateAdapter.toIso8601(this.bizDatetime),typeof e.comment>"u"&&(e.comment=""),this.saving=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.saveEntry([e]).pipe(te(()=>G(!1)),oe(i=>!(typeof i!="boolean"&&i.error)),V(()=>{this.saving=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand();}));}return G(!1);}checkValuesWhetherExisted(){this.selects.forEach(e=>{if(e.options.length)if(e.multiple){if(e.value){let i=e.value.filter(n=>e.options.some(a=>a.value===n));e.ngControl.control.setValue(i);}}else e.options.some(i=>i.value===e.value)||e.ngControl.control.setValue(null);});}getCurrentEntry(e,i){this.getEntrySsp&&this.getEntrySsp.unsubscribe(),this.notification.showLoading(this.elementRef.nativeElement),this.getEntrySsp=this.databaseService.getEntry(e,i).pipe(Wn(n=>!n.error),V(()=>{this.getEntrySsp=void 0,this.notification.hideLoading();})).subscribe(n=>{let a=n.data;a.amount=a.amount/100,this.accountId=a.accountId,this.bizDatetime=this.dateAdapter.deserialize(a.bizTime),Array.isArray(a.members)?this.selectedMembers=this.members.filter(m=>a.members.some(d=>d.memberId===m.uuid)).map(m=>m.uuid):this.selectedMembers=this.members.slice(0,1).map(m=>m.uuid),a.recType===$.RETURN?a.lendType=a.recSubtype===0?J.RECEIVE:J.REPAYMENT:a.recType===$.BORROW&&(a.lendType=a.recSubtype===0?J.BORROW:J.LEND),this.entry=a,a.accountId&&!this.creditors.find(m=>m.uuid===a.accountId)&&this.creditors.push({uuid:a.accountId,name:a.accountName}),a.targetId&&!this.accounts.find(m=>m.uuid===a.targetId)&&this.accounts.push({uuid:a.targetId,name:a.targetName}),this.selectedTabIndex=(a.recType>5?4:a.recType)-1;});}getAdditionalDatas(e){return ee([this.databaseService.getTransactionObjects(e),this.databaseService.getBookProjects(e),this.databaseService.getMembers(e),this.databaseService.getEntryCategories(e,qe.PAY),this.databaseService.getEntryCategories(e,qe.REVENUE)]).pipe(V(()=>{this.notification.hideLoading();}),oe(i=>{this.txnObjects=i[0].data.bookTradeTargets,this.tags=i[1].data.bookProjects.map(n=>({tagId:n.uuid,name:n.name})),this.members=i[2].data.bookMembers,this.payCategories=i[3].data.bookCategories,this.revenueCategories=i[4].data.bookCategories;}));}static ɵfac=function(i){return new(i||t)(S(U),S(ae),S(Ee),S(Q),S(z),S(F),S(Ae));};static ɵcmp=Y({type:t,selectors:[["app-add-or-edit-entry"]],viewQuery:function(i,n){if(i&1&&(Te(pe,5),Te(Pe,5)),i&2){let a;be(a=he())&&(n.entryForm=a.first),be(a=he())&&(n.selects=a);}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:62,vars:16,consts:()=>{let e;e="Pay";let i;i="Revenue";let n;n="Transfer";let a;a="Loan";let m;m="Account book";let d;d="Amount";let D;D="Time";let O;O="Comment";let k;k="Save";let L;L="Save as";let W;W="Save and new";let y;y="Cancel";let w;w="Account";let B;B="Category";let x;x="Tags";let Ke;Ke="Trader";let ht;ht="Member";let Nt;Nt="Reimburse";let It;It="To be reimbursed";let Mt;Mt="Reimbursed";let Rt;Rt="Non-reimbursable";let yt;yt="Account";let Dt;Dt="Category";let vt;vt="Tags";let Ot;Ot="Payer";let wt;wt="Member";let Pt;Pt="Reimburse";let xt;xt="To be reimbursed";let $t;$t="Reimbursed";let Lt;Lt="Non-reimbursable";let kt;kt="From account";let v;v="To account";let hn;hn="Category";let Nn;Nn="Borrow";let In;In="Lend";let Mn;Mn="Receive";let Rn;Rn="Repayment";let yn;yn="Creditor";let Dn;Dn="Debtor";let vn;vn="Debtor";let On;On="Creditor";let wn;wn="Borrow account";let Pn;Pn="Lend account";let xn;xn="Receive account";let $n;return $n="Repayment account",[["picker",""],m,d,D,O,k,L,W,y,w,B,x,Ke,ht,Nt,It,Mt,Rt,yt,Dt,vt,Ot,wt,Pt,xt,$t,Lt,kt,v,hn,Nn,In,Mn,Rn,yn,Dn,vn,On,wn,Pn,xn,$n,["name","entryForm",1,"d-flex","flex-column","flex-nowrap","flex-fill","overflow-hidden","pt-2",3,"ngSubmit"],["color","primary",3,"selectedIndexChange","selectedTabChange","selectedIndex"],["label",e],["label",i],["label",n],["label",a],[1,"flex-fill","overflow-auto"],["class","container-fluid pt-3",4,"ngIf"],[1,"container-fluid","pb-3"],[1,"row"],[1,"col","col-lg-6"],["appearance","outline"],["name","book","required","",3,"ngModelChange","selectionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["name","amount","type","number","step","1","min","0.01","required","","matInput","",3,"ngModelChange","ngModel"],["name","bizDatetime","matInput","","required","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],["color","primary"],[1,"col"],["name","comment","matInput","",3,"ngModelChange","ngModel"],[1,"container-fluid","pt-3","pb-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2",3,"disabled"],["type","button","mat-flat-button","","color","primary",1,"me-2",3,"click","disabled"],["type","button","mat-flat-button","","color","accent",1,"me-2",3,"click","disabled"],["type","button","mat-stroked-button","","color","accent",1,"me-2",3,"click","disabled"],[1,"container-fluid","pt-3"],["name","account","required","",3,"ngModelChange","ngModel"],["name","payCategory","required","",3,"ngModelChange","ngModel"],[3,"label",4,"ngFor","ngForOf"],["name","tags","multiple","",3,"ngModelChange","compareWith","ngModel"],["name","txnObject",3,"ngModelChange","ngModel"],["value",""],["name","member","multiple","","required","",3,"ngModelChange","ngModel"],["name","reimburse",3,"ngModelChange","ngModel"],[3,"value"],[3,"label"],["name","revenueCategory","required","",3,"ngModelChange","ngModel"],["name","account","required","",3,"ngModelChange","ngModel","forbiddenSame"],["name","transferObject","required","",3,"ngModelChange","ngModel","forbiddenSame"],["name","lendType","required","",3,"ngModelChange","ngModel"],[3,"value","ngSwitch",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],["name","creditor","required","",3,"ngModelChange","ngModel"],[3,"value","ngSwitch"]];},template:function(i,n){if(i&1){let a=P();o(0,"form",42),R("ngSubmit",function(){return f(a),C(n.save());}),o(1,"mat-tab-group",43),I("selectedIndexChange",function(d){return f(a),N(n.selectedTabIndex,d)||(n.selectedTabIndex=d),C(d);}),R("selectedTabChange",function(d){return f(a),C(n.onSelectedTabChange(d));}),T(2,"mat-tab",44)(3,"mat-tab",45)(4,"mat-tab",46)(5,"mat-tab",47),c(),o(6,"div",48),g(7,Jo,50,15,"div",49)(8,or,52,15,"div",49)(9,lr,14,6,"div",49)(10,Nr,27,16,"div",49),o(11,"div",50)(12,"div",51)(13,"div",52)(14,"mat-form-field",53)(15,"mat-label"),p(16,1),c(),o(17,"mat-select",54),I("ngModelChange",function(d){return f(a),N(n.entry.bkId,d)||(n.entry.bkId=d),C(d);}),R("selectionChange",function(d){return f(a),C(n.onBookSelectionChange(d));}),g(18,Ir,2,2,"mat-option",55),c()()()(),o(19,"div",51)(20,"div",52)(21,"mat-form-field",53)(22,"mat-label"),p(23,2),c(),o(24,"input",56),I("ngModelChange",function(d){return f(a),N(n.entry.amount,d)||(n.entry.amount=d),C(d);}),c()()(),o(25,"div",52)(26,"mat-form-field",53)(27,"mat-label"),p(28,3),c(),o(29,"input",57),I("ngModelChange",function(d){return f(a),N(n.bizDatetime,d)||(n.bizDatetime=d),C(d);}),c(),T(30,"mat-datepicker-toggle",58),o(31,"mat-datepicker",59,0)(33,"mat-datepicker-actions"),T(34,"mat-timepicker"),c()()()()(),o(35,"div",51)(36,"div",60)(37,"mat-form-field",53)(38,"mat-label"),p(39,4),c(),o(40,"textarea",61),I("ngModelChange",function(d){return f(a),N(n.entry.comment,d)||(n.entry.comment=d),C(d);}),c()()()()()(),o(41,"div",62)(42,"button",63)(43,"mat-icon"),E(44,"save"),c(),s(45),p(46,5),u(),c(),o(47,"button",64),R("click",function(){return f(a),C(n.saveAs());}),o(48,"mat-icon"),E(49,"file_copy"),c(),s(50),p(51,6),u(),c(),o(52,"button",65),R("click",function(){return f(a),C(n.saveAndNew());}),o(53,"mat-icon"),E(54,"post_add"),c(),s(55),p(56,7),u(),c(),o(57,"button",66),R("click",function(){return f(a),C(n.cancel());}),o(58,"mat-icon"),E(59,"cancel"),c(),s(60),p(61,8),u(),c()()();}if(i&2){let a=ce(32);l(),h("selectedIndex",n.selectedTabIndex),l(6),_("ngIf",n.selectedTabIndex===0),l(),_("ngIf",n.selectedTabIndex===1),l(),_("ngIf",n.selectedTabIndex===2),l(),_("ngIf",n.selectedTabIndex===3),l(7),h("ngModel",n.entry.bkId),l(),_("ngForOf",n.books),l(6),h("ngModel",n.entry.amount),l(5),_("matDatepicker",a),h("ngModel",n.bizDatetime),l(),_("for",a),l(10),h("ngModel",n.entry.comment),l(2),_("disabled",n.saving),l(5),_("disabled",n.saving||n.isNew),l(5),_("disabled",n.saving),l(5),_("disabled",n.saving);}},dependencies:[Ie,nt,Me,Re,rt,me,ct,se,ue,Ht,ri,ye,pe,Oe,Ft,jt,ge,_i,Ce,fe,ve,K,mt,Pe,dt,ci,qt,Kt,Qt],styles:[".mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}"]});}return t;})();var Wi=(()=>{class t{elementRef;router;route;dateAdapter;communication;notification;databaseService;operation;entry;bizDatetime;selectedTabIndex=0;saving=!1;entryForm;subscription=new ne();constructor(e,i,n,a,m,d,D,O){this.elementRef=e,this.router=i,this.route=n,this.dateAdapter=a,this.communication=m,this.notification=d,this.databaseService=D,this.operation=O,this.router.getCurrentNavigation()?(this.entry=this.router.getCurrentNavigation().extras.state,this.entry?(this.entry.amount=this.entry.accountBalance,this.bizDatetime=this.dateAdapter.deserialize(this.entry.bizTime)):this.entry=new Je()):this.entry=new Je();}ngOnInit(){}ngOnDestroy(){this.subscription.unsubscribe();}save(){this.update().subscribe(e=>{e&&this.cancel();});}saveAndNew(){let e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(let i in e)e[i].markAsTouched();this.update().subscribe(i=>{i&&(this.entry.id=0);});}cancel(){this.operation.closeSecondaryOutlet(this.route.parent);}update(){if(this.entryForm&&this.entryForm.valid){let e=this.entry;return e.bizTime=this.bizDatetime.toISOString(),typeof e.comment>"u"&&(e.comment=""),this.saving=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.saveEntry([e]).pipe(te(()=>G(!1)),oe(i=>!(typeof i!="boolean"&&i.error)),V(()=>{this.saving=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand();}));}return G(!1);}static ɵfac=function(i){return new(i||t)(S(U),S(De),S(ae),S(Ee),S(Q),S(z),S(F),S(Ae));};static ɵcmp=Y({type:t,selectors:[["app-balance-modifier"]],viewQuery:function(i,n){if(i&1&&Te(pe,5),i&2){let a;be(a=he())&&(n.entryForm=a.first);}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:31,vars:6,consts:()=>{let e;e="Balance modification";let i;i="Amount";let n;n="Time";let a;a="Save";let m;return m="Cancel",[["picker",""],i,n,a,m,["name","entryForm",1,"d-flex","flex-column","flex-nowrap","flex-fill","overflow-hidden",3,"ngSubmit"],["color","primary"],["label",e],[1,"flex-fill","overflow-auto"],[1,"container-fluid","py-3"],[1,"row"],[1,"col","col-lg-6"],["appearance","fill"],["name","amount","type","number","step","1","required","","matInput","",3,"ngModelChange","ngModel"],["name","bizDatetime","matInput","","required","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[1,"container-fluid","pt-3","pb-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2",3,"disabled"],["type","button","mat-flat-button","","color","warn",1,"me-2",3,"click","disabled"]];},template:function(i,n){if(i&1){let a=P();o(0,"form",5),R("ngSubmit",function(){return f(a),C(n.save());}),o(1,"mat-tab-group",6),T(2,"mat-tab",7),c(),o(3,"div",8)(4,"div",9)(5,"div",10)(6,"div",11)(7,"mat-form-field",12)(8,"mat-label"),p(9,1),c(),o(10,"input",13),I("ngModelChange",function(d){return f(a),N(n.entry.amount,d)||(n.entry.amount=d),C(d);}),c()()(),o(11,"div",11)(12,"mat-form-field",12)(13,"mat-label"),p(14,2),c(),o(15,"input",14),I("ngModelChange",function(d){return f(a),N(n.bizDatetime,d)||(n.bizDatetime=d),C(d);}),c(),T(16,"mat-datepicker-toggle",15),o(17,"mat-datepicker",6,0),T(19,"mat-timepicker"),c()()()()()(),o(20,"div",16)(21,"button",17)(22,"mat-icon"),E(23,"save"),c(),s(24),p(25,3),u(),c(),o(26,"button",18),R("click",function(){return f(a),C(n.cancel());}),o(27,"mat-icon"),E(28,"cancel"),c(),s(29),p(30,4),u(),c()()();}if(i&2){let a=ce(18);l(10),h("ngModel",n.entry.amount),l(5),_("matDatepicker",a),h("ngModel",n.bizDatetime),l(),_("for",a),l(5),_("disabled",n.saving),l(5),_("disabled",n.saving);}},dependencies:[rt,me,ct,se,ue,Ht,ye,pe,Oe,Ft,jt,ge,Ce,fe,ve,K,mt,qt,Kt,Qt],styles:[".mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}"]});}return t;})();var Mr=[{path:"dashboard",component:vi},{path:"accounts",component:wi},{path:"members",component:Pi},{path:"search",component:$i},{path:"accounts/:accountId",component:Li},{path:"entry/add/:accountId",outlet:"secondary",component:bn},{path:"entry/:bookId/:entryId",outlet:"secondary",component:bn},{path:"balance/:entryId",outlet:"secondary",component:Wi}],Vi=(()=>{class t{static ɵfac=function(i){return new(i||t)();};static ɵmod=tt({type:t});static ɵinj=et({imports:[sn.forChild(Mr),sn]});}return t;})();var Gi=(()=>{class t{notification;constructor(e){this.notification=e;}intercept(e,i){let n=Date.now(),a;return i.handle(e).pipe(Xn({next:m=>{m instanceof ni&&m.body?.error&&this.notification.openError(m.body.error);}}));}static ɵfac=function(i){return new(i||t)(_e(z));};static ɵprov=le({token:t,factory:t.ɵfac});}return t;})();var Wl=(()=>{class t{static ɵfac=function(i){return new(i||t)();};static ɵmod=tt({type:t});static ɵinj=et({providers:[{provide:Jn,useValue:"CNY"},{provide:ii,useClass:Gi,multi:!0},Tt,Xt,F,Ae,ke,tn,ai(oi())],imports:[Ti,Bt,gi,Ii,pi,fi,Ei,Ci,si,mi,Vi]});}return t;})();export{Wl as WacaiModule};/**i18n:4ec78395217facedd742edef8dfa814b1ea6af3fbb33fa1f9a497a05293d0698*/