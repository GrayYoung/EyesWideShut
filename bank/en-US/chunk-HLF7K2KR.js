import{a as nn,b as Mi,c as Ni,d as hi,e as Ri,f as yi,h as an}from"./chunk-O73WB2W2.js";import"./chunk-YTPV4276.js";import{a as Ve}from"./chunk-NDDGNABB.js";import{b as Ti}from"./chunk-JOGXXG4D.js";import{b as Ge,c as bi,d as Be,e as Xe,f as He,g as Ye,h as ze,i as Fe,j as je,k as Ue,l as qe,m as Ke,n as Ii,o as Bt}from"./chunk-ZQC6LSU5.js";import{a as Jt,b as en,c as gi}from"./chunk-X5H4N4ME.js";import{a as tn,b as Si,c as Ai}from"./chunk-ITBIAQEO.js";import{A as lt,Aa as ft,Ab as fi,B as Se,Ba as Ci,C as De,D as ve,Da as gt,E as _t,F as dt,H as mt,I as st,J as si,K as Ft,Oa as Qt,Pa as ee,Qa as U,Ra as St,Ta as Zt,W as Ae,Xa as At,Z as we,aa as Te,ca as Pe,da as xe,ga as J,oa as Ut,ob as Me,pb as Ei,qa as $e,qb as Le,rb as ke,sb as We,ta as qt,u as Ee,ua as Kt,va as pi,wa as Ie,xa as pt,y as fe,ya as Ct,z as ge,za as Et}from"./chunk-ZHNDKHWE.js";import{ba as ui,da as ut,ga as un,h as jt,oa as be}from"./chunk-CEGVERYJ.js";import{f as li,h as _i,i as di,j as mi,u as ce,w as Oe,z as sn}from"./chunk-AJ2ABEQE.js";import"./chunk-RAFVY6Q4.js";import"./chunk-ZYVHQIOC.js";import"./chunk-HPOMB5AY.js";import"./chunk-UC2JMEVD.js";import{$ as Ht,Ac as ti,Ad as ri,Cd as ct,E as Xn,Ec as K,Ed as zt,Fc as ni,Fd as ci,G as ae,Gc as Z,J as _e,Jb as Qn,Ka as Q,Kb as ue,Kc as ii,Lb as pe,Mb as G,N as Hn,Nb as B,Ob as X,P as V,Pb as m,Qb as o,Rb as r,Sb as T,Tb as s,Ub as u,Wb as P,Zb as p,_ as Yn,a as oe,ac as R,bb as Un,bc as S,cc as Zn,da as zn,db as l,dc as Jn,fc as he,gc as Re,hc as ye,ia as me,ib as g,ja as nt,la as Fn,lc as de,ma as se,na as jn,nc as Ce,o as H,p as Xt,pb as j,qb as it,qc as C,rb as qn,rc as Y,s as le,sa as E,sc as h,sd as Yt,ta as f,tb as Kn,tc as re,td as ai,uc as ei,ud as at,vb as A,vc as I,vd as ot,wc as M,wd as rt,xc as N,y as ie,zd as oi}from"./chunk-DAKW3Y5S.js";import"./chunk-6B763VMG.js";import{a as Gn,b as Bn}from"./chunk-LO4PBWZP.js";var Fi=["*"];var ji=new Fn("MAT_CARD_CONFIG"),Di=(()=>{class t{appearance;constructor(){let e=jn(ji,{optional:!0});this.appearance=e?.appearance||"raised";}static ɵfac=function(i){return new(i||t)();};static ɵcmp=j({type:t,selectors:[["mat-card"]],hostAttrs:[1,"mat-mdc-card","mdc-card"],hostVars:8,hostBindings:function(i,n){i&2&&Ce("mat-mdc-card-outlined",n.appearance==="outlined")("mdc-card--outlined",n.appearance==="outlined")("mat-mdc-card-filled",n.appearance==="filled")("mdc-card--filled",n.appearance==="filled");},inputs:{appearance:"appearance"},exportAs:["matCard"],ngContentSelectors:Fi,decls:1,vars:0,template:function(i,n){i&1&&(Zn(),Jn(0));},styles:[`.mat-mdc-card{display:flex;flex-direction:column;box-sizing:border-box;position:relative;border-style:solid;border-width:0;background-color:var(--mat-card-elevated-container-color, var(--mat-sys-surface-container-low));border-color:var(--mat-card-elevated-container-color, var(--mat-sys-surface-container-low));border-radius:var(--mat-card-elevated-container-shape, var(--mat-sys-corner-medium));box-shadow:var(--mat-card-elevated-container-elevation, var(--mat-sys-level1))}.mat-mdc-card::after{position:absolute;top:0;left:0;width:100%;height:100%;border:solid 1px rgba(0,0,0,0);content:"";display:block;pointer-events:none;box-sizing:border-box;border-radius:var(--mat-card-elevated-container-shape, var(--mat-sys-corner-medium))}.mat-mdc-card-outlined{background-color:var(--mat-card-outlined-container-color, var(--mat-sys-surface));border-radius:var(--mat-card-outlined-container-shape, var(--mat-sys-corner-medium));border-width:var(--mat-card-outlined-outline-width, 1px);border-color:var(--mat-card-outlined-outline-color, var(--mat-sys-outline-variant));box-shadow:var(--mat-card-outlined-container-elevation, var(--mat-sys-level0))}.mat-mdc-card-outlined::after{border:none}.mat-mdc-card-filled{background-color:var(--mat-card-filled-container-color, var(--mat-sys-surface-container-highest));border-radius:var(--mat-card-filled-container-shape, var(--mat-sys-corner-medium));box-shadow:var(--mat-card-filled-container-elevation, var(--mat-sys-level0))}.mdc-card__media{position:relative;box-sizing:border-box;background-repeat:no-repeat;background-position:center;background-size:cover}.mdc-card__media::before{display:block;content:""}.mdc-card__media:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__media:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mat-mdc-card-actions{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;min-height:52px;padding:8px}.mat-mdc-card-title{font-family:var(--mat-card-title-text-font, var(--mat-sys-title-large-font));line-height:var(--mat-card-title-text-line-height, var(--mat-sys-title-large-line-height));font-size:var(--mat-card-title-text-size, var(--mat-sys-title-large-size));letter-spacing:var(--mat-card-title-text-tracking, var(--mat-sys-title-large-tracking));font-weight:var(--mat-card-title-text-weight, var(--mat-sys-title-large-weight))}.mat-mdc-card-subtitle{color:var(--mat-card-subtitle-text-color, var(--mat-sys-on-surface));font-family:var(--mat-card-subtitle-text-font, var(--mat-sys-title-medium-font));line-height:var(--mat-card-subtitle-text-line-height, var(--mat-sys-title-medium-line-height));font-size:var(--mat-card-subtitle-text-size, var(--mat-sys-title-medium-size));letter-spacing:var(--mat-card-subtitle-text-tracking, var(--mat-sys-title-medium-tracking));font-weight:var(--mat-card-subtitle-text-weight, var(--mat-sys-title-medium-weight))}.mat-mdc-card-title,.mat-mdc-card-subtitle{display:block;margin:0}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle{padding:16px 16px 0}.mat-mdc-card-header{display:flex;padding:16px 16px 0}.mat-mdc-card-content{display:block;padding:0 16px}.mat-mdc-card-content:first-child{padding-top:16px}.mat-mdc-card-content:last-child{padding-bottom:16px}.mat-mdc-card-title-group{display:flex;justify-content:space-between;width:100%}.mat-mdc-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;margin-bottom:16px;object-fit:cover}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title{line-height:normal}.mat-mdc-card-sm-image{width:80px;height:80px}.mat-mdc-card-md-image{width:112px;height:112px}.mat-mdc-card-lg-image{width:152px;height:152px}.mat-mdc-card-xl-image{width:240px;height:240px}.mat-mdc-card-subtitle~.mat-mdc-card-title,.mat-mdc-card-title~.mat-mdc-card-subtitle,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-title-group .mat-mdc-card-title,.mat-mdc-card-title-group .mat-mdc-card-subtitle{padding-top:0}.mat-mdc-card-content>:last-child:not(.mat-mdc-card-footer){margin-bottom:0}.mat-mdc-card-actions-align-end{justify-content:flex-end}
`],encapsulation:2,changeDetection:0});}return t;})();var vi=(()=>{class t{static ɵfac=function(i){return new(i||t)();};static ɵdir=qn({type:t,selectors:[["mat-card-content"]],hostAttrs:[1,"mat-mdc-card-content"]});}return t;})();var Oi=(()=>{class t{static ɵfac=function(i){return new(i||t)();};static ɵmod=it({type:t});static ɵinj=nt({imports:[un,un]});}return t;})();var Qe=function(t){return t[t.REVENUE=2]="REVENUE",t[t.PAY=3]="PAY",t;}(Qe||{}),$=function(t){return t[t.PAY=1]="PAY",t[t.REVENUE=2]="REVENUE",t[t.TRANSFER=3]="TRANSFER",t[t.BORROW=4]="BORROW",t[t.RETURN=5]="RETURN",t;}($||{}),ne=function(t){return t[t.BORROW=1]="BORROW",t[t.LEND=2]="LEND",t[t.RECEIVE=3]="RECEIVE",t[t.REPAYMENT=4]="REPAYMENT",t;}(ne||{});var q=(()=>{class t{requestService;books;constructor(e){this.requestService=e;}getBooks(){return this.books?H({code:null,error:null,data:{books:this.books}}):this.requestService.get("activity/bkk-frontier/api/v2/book/web/query").pipe(le(e=>(e&&e.data&&e.data.books&&(this.books=e.data.books),e)));}getAccountTypeList(){return this.requestService.get("setting/account_allAccountTypes.action",{timesamp:Date.now()});}getAccountList(e=!0,i=!1,n=!0){return this.requestService.get("setting/account_list.action",{timesamp:Date.now(),hidden:e,reqBalance:i,loanFlag:n});}getVisibleAccountList(){return this.requestService.post("activity/bkk-frontier/api/account/index",{localTime:Date.now(),timeZoneId:this.requestService.TIME_ZONE_ID,useCompleteSort:!0});}getHiddenAccountList(){return this.requestService.post("activity/bkk-frontier/api/account/hiddenList",{localTime:Date.now(),timeZoneId:this.requestService.TIME_ZONE_ID,useCompleteSort:!0});}getShortAccounts(e=1){return this.requestService.get("activity/bkk-frontier/api/account/web/query",{accountOption:e});}getEntryCategories(e,i){return this.requestService.get("activity/bkk-frontier/api/v2/category/web/query",{bkId:e,categoryType:i});}getTransactionObjects(e){return this.requestService.get("activity/bkk-frontier/api/v2/trade/target/web/query",{bkId:e});}getBookProjects(e){return this.requestService.get("activity/bkk-frontier/api/v2/project/web/query",{bkId:e});}getMembers(e){return this.requestService.get("activity/bkk-frontier/api/v2/book/member/web/query",{bkId:e});}queryEntries(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/list/web",e);}getEntries(e,i,n){let a={accountId:e,startDate:i.valueOf(),endDate:n.valueOf(),timeZoneId:this.requestService.TIME_ZONE_ID,localTime:Date.now()};return this.requestService.post("activity/bkk-frontier/api/account/detail/flow",a);}getEntry(e,i){return this.requestService.get("activity/bkk-frontier/api/v2/flow/query/web/"+e+"/"+i);}saveEntry(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/save",{flows:e});}deleteEntries(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/batch/delete",{flowIds:e});}static ɵfac=function(i){return new(i||t)(se(Ve));};static ɵprov=me({token:t,factory:t.ɵfac});}return t;})();var on=(()=>{class t{requestService;constructor(e){this.requestService=e;}getCategoryStatistics(e,i,n,a=1){return this.requestService.post("activity/bkk-frontier/api/v2/report/chartStat",{bkId:e,startTime:i.valueOf(),endTime:n.valueOf(),statNo:a});}getRevenueNExpenditureStatistics(e,i,n,a=11){return this.requestService.post("activity/bkk-frontier/api/v2/report/monthStat",{bkId:e,startTime:i.valueOf(),endTime:n.valueOf(),statNo:a});}static ɵfac=function(i){return new(i||t)(se(Ve));};static ɵprov=me({token:t,factory:t.ɵfac});}return t;})();function Ki(t,c){t&1&&(o(0,"mat-label"),s(1),p(2,2),u(),r());}function Qi(t,c){if(t&1&&(o(0,"mat-option",9),C(1),r()),t&2){let e=c.$implicit;m("value",e.id),l(),h(" ",e.name," ");}}var ki=(()=>{class t{elementRef;currencyPipe;datePipe;dateAdapter;notification;communication;datetimeService;database;statistics;currencyValueFormat=e=>this.currencyPipe.transform(e/100,"CNY","symbol-narrow","0.0-2");dateRange=new lt({start:new De(null),end:new De(null)});books=[];selectedBook;payCategoriesData;revenueCategoriesData;revNExpndData;totalBalance="";sunburstChartOptions={valueFun:this.currencyValueFormat};barChartOptions={layout:"stacked",lineStyle:{stroke:"#5e92a8","stroke-width":2},valueFun:this.currencyValueFormat,tooltip:{content:e=>`${this.datePipe.transform(e[0],"MMMM, y")}
        	 ${e.slice(1).reduce((i,n,a)=>i+`${a>0?`
`:""} ${n<0?"":"+"}${this.currencyValueFormat(n)}`,"")}
        	 =${this.currencyValueFormat(e.slice(1).reduce((i,n)=>i+n,0))}
      `},xAxis:{baseline:{style:{stroke:"#808080"}},font:{color:"#808080"},format:e=>this.datePipe.transform(e,"MMM, y")},yAxis:{baseline:{style:{stroke:"transparent"}},font:{color:"#808080"},format:this.currencyValueFormat}};subscription=new oe();constructor(e,i,n,a,d,_,D,O,k){this.elementRef=e,this.currencyPipe=i,this.datePipe=n,this.dateAdapter=a,this.notification=d,this.communication=_,this.datetimeService=D,this.database=O,this.statistics=k;}ngOnInit(){this.dateRange.valueChanges.subscribe(()=>{this.communication.giveRefreshCommand();}),this.datetimeService.initTimeRange(this.dateRange);}ngAfterViewInit(){setTimeout(()=>{this.database.getBooks().subscribe(e=>{this.books=e.data.books;let i=this.books[0];this.selectedBook=i.id,this.initRefreshIndicator();});});}ngOnDestroy(){this.subscription.unsubscribe(),this.datetimeService.destoryTimeRange();}onBookSelectionChange(e){this.communication.giveRefreshCommand();}prevYear(){let e=this.dateRange.value.start,i=this.dateAdapter.getYear(e)-1;this.dateRange.setValue({start:this.dateAdapter.createDate(i,0,1),end:this.dateAdapter.createDate(i,11,31)});}nextYear(){let e=this.dateRange.value.end,i=this.dateAdapter.getYear(e)+1;this.dateRange.setValue({start:this.dateAdapter.createDate(i,0,1),end:this.dateAdapter.createDate(i,11,31)});}prevMonth(){let e=this.dateAdapter,i=e.clone(this.dateRange.value.start),n=e.today(),a=e.getYear(i),d=e.getMonth(i)-1;d<0?(i=e.createDate(a-1,11,1),n=e.createDate(a,0,1)):(i=e.createDate(a,d,1),n=e.createDate(a,d+1,1)),n=e.addCalendarDays(n,-1),this.dateRange.setValue({start:i,end:n});}nextMonth(){let e=this.dateAdapter,i=e.clone(this.dateRange.value.start),n=e.today(),a=e.getYear(i),d=e.getMonth(i)+1;d>11?(i=e.createDate(a+1,0,1),n=e.createDate(a+1,1,1)):(i=e.createDate(a,d,1),d+1>11?n=e.createDate(a+1,0,1):n=e.createDate(a,d+1,1)),n=e.addCalendarDays(n,-1),this.dateRange.setValue({start:i,end:n});}showAllHistory(){this.dateRange.setValue({start:this.datetimeService.getMinDate(),end:this.datetimeService.getMaxDate()});}initRefreshIndicator(){this.subscription.add(this.communication.acceptRefreshCommand().pipe(_e(500),Yn({}),Ht(()=>{let e=this.dateRange.controls.start.value,i=this.dateRange.controls.end.value;return this.dateRange.invalid?H(null):(this.notification.showLoading(this.elementRef.nativeElement),e&&i?(e=this.dateAdapter.deserialize(this.datetimeService.getStartDatetime(e)),i=this.dateAdapter.deserialize(this.datetimeService.getEndDatetime(i)),ie([this.assemblePayCategoriesStatistics(e,i),this.assembleRevenueCategoriesStatistics(e,i),this.assembleRevenueNExpenditureStatistics(e,i)])):H(null));}),V(()=>{this.notification.hideLoading();})).subscribe(()=>{this.notification.hideLoading();}));}assemblePayCategoriesStatistics(e,i){return ie([this.database.getEntryCategories(this.selectedBook,Qe.PAY),this.statistics.getCategoryStatistics(this.selectedBook,e,i,1),this.statistics.getCategoryStatistics(this.selectedBook,e,i,2)]).pipe(ae(()=>H([])),le(n=>{let a=!1;if(n.forEach(O=>{O.error&&(a=!0),a=!O.data||a;}),a){this.payCategoriesData=[];return;}let d=n[0].data.bookCategories,_=n[1].data,D=n[2].data.groups;return this.payCategoriesData=[{id:"_",name:_.title,value:_.totalAmount,children:_.groups.map(O=>{let k=O.id,L=d.find(y=>y.categoryId===k)?.outgoSubTypes,W=D.filter(y=>L.some(w=>w.categoryId===y.id)).map(y=>({id:y.id,name:y.name,value:y.amount}));return{id:O.id,name:O.name,value:O.amount,children:W};})}],null;}));}assembleRevenueCategoriesStatistics(e,i){return this.statistics.getCategoryStatistics(this.selectedBook,e,i,6).pipe(ae(()=>H({})),le(n=>{let a=n.data;if(!a||!a.groups){this.revenueCategoriesData=[];return;}return this.revenueCategoriesData=[{id:"_",name:a.title,value:a.totalAmount,children:a.groups.map(d=>({id:d.id,name:d.name,value:d.amount}))}],null;}));}assembleRevenueNExpenditureStatistics(e,i){return this.statistics.getRevenueNExpenditureStatistics(this.selectedBook,e,i,11).pipe(ae(()=>H({})),le(n=>{let a=this.dateAdapter,d=n.data;if(d){if(this.totalBalance=d.currency+" "+d.totalBalance/100,!d.groups){this.revNExpndData=[];return;}this.revNExpndData=d.groups.map(_=>[a.deserialize(_.startTime),_.balanceMoney+_.outgoMoney,-_.outgoMoney]);}else this.totalBalance="",this.revNExpndData=[];return null;}));}static ɵfac=function(i){return new(i||t)(g(Q),g(zt),g(ri),g(be),g(U),g(ee),g(At),g(q),g(on));};static ɵcmp=j({type:t,selectors:[["app-dashboard"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],standalone:!1,decls:51,vars:20,consts:()=>{let e;return e="Account book",[["bookSelect",""],["dateRangePicker",""],e,["role","group",1,"btn-group"],["mat-button","",3,"for"],["matDatepickerToggleIcon",""],["type","button","mat-button","",3,"click"],["appearance","fill",1,"mat-form-field-mini"],["name","book",3,"valueChange","selectionChange","value"],[3,"value"],[1,"align-middle","ms-2"],[1,"visually-hidden",3,"formGroup","rangePicker"],["matStartDate","","formControlName","start"],["matEndDate","","formControlName","end"],[1,"flex-fill","px-2",2,"overflow-x","hidden","overflow-y","auto"],[1,"row"],[1,"col-12","col-lg-6","py-2","sunburst-chart"],[3,"data","options"],[1,"col-12","py-2","bar-chart"]];},template:function(i,n){if(i&1){let a=P();o(0,"app-operation-toolbar")(1,"div",3)(2,"mat-datepicker-toggle",4)(3,"mat-icon",5),C(4,"date_range"),r()(),o(5,"button",6),R("click",function(){return E(a),f(n.showAllHistory());}),o(6,"mat-icon"),C(7,"history_toggle_off"),r()(),o(8,"button",6),R("click",function(){return E(a),f(n.prevYear());}),o(9,"mat-icon"),C(10,"first_page"),r()(),o(11,"button",6),R("click",function(){return E(a),f(n.prevMonth());}),o(12,"mat-icon"),C(13,"chevron_left"),r()(),o(14,"button",6),R("click",function(){return E(a),f(n.nextMonth());}),o(15,"mat-icon"),C(16,"chevron_right"),r()(),o(17,"button",6),R("click",function(){return E(a),f(n.nextYear());}),o(18,"mat-icon"),C(19,"last_page"),r()()(),o(20,"mat-form-field",7),ue(21,Ki,3,0,"mat-label"),o(22,"mat-select",8,0),N("valueChange",function(_){return E(a),M(n.selectedBook,_)||(n.selectedBook=_),f(_);}),R("selectionChange",function(_){return E(a),f(n.onBookSelectionChange(_));}),B(24,Qi,2,2,"mat-option",9,G),r()()(),o(26,"app-breadcrumb")(27,"span",10),C(28),K(29,"date"),K(30,"date"),r()(),o(31,"mat-date-range-input",11),T(32,"input",12)(33,"input",13),r(),T(34,"mat-date-range-picker",null,1),o(36,"div",14)(37,"div",15)(38,"div",16)(39,"mat-card")(40,"mat-card-content"),T(41,"app-sunburst-chart",17),r()()(),o(42,"div",16)(43,"mat-card")(44,"mat-card-content"),T(45,"app-sunburst-chart",17),r()()()(),o(46,"div",15)(47,"div",18)(48,"mat-card")(49,"mat-card-content"),T(50,"app-bar-chart",17),r()()()()();}if(i&2){let a=de(23),d=de(35);l(2),m("for",d),l(19),pe(a.triggerValue?-1:21),l(),I("value",n.selectedBook),l(2),X(n.books),l(4),ei(" (",Z(29,14,n.dateRange.value.start,"longDate")," - ",Z(30,17,n.dateRange.value.end,"longDate")," => ",n.totalBalance,") "),l(3),m("formGroup",n.dateRange)("rangePicker",d),l(10),m("data",n.payCategoriesData)("options",n.sunburstChartOptions),l(4),m("data",n.revenueCategoriesData)("options",n.sunburstChartOptions),l(5),m("data",n.revNExpndData)("options",n.barChartOptions);}},dependencies:[Ni,hi,Di,vi,Ee,fe,ge,xe,Ie,pi,pt,Ct,Et,ft,Te,Ae,J,$e,ut,mt,st,Me,Ei,St],styles:[".sunburst-chart[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{height:calc(60vh - 140px);min-height:300px}.bar-chart[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{height:calc(40vh - 100px);min-height:300px}.chart[_ngcontent-%COMP%]{width:100%;height:100%}"]});}return t;})();var Mt=(()=>{class t{requestService;constructor(e){this.requestService=e;}getBankList(){return this.requestService.get("setting/account_bankList.action",{type:""});}getCardTypeList(){return this.requestService.get("setting/account_cardList.action",{type:""});}static ɵfac=function(i){return new(i||t)(se(Ve));};static ɵprov=me({token:t,factory:t.ɵfac});}return t;})();function Zi(t,c){t&1&&(o(0,"th",22),s(1),p(2,0),u(),r());}function Ji(t,c){if(t&1&&(o(0,"td",23),C(1),o(2,"span",24),C(3),r()()),t&2){let e=c.$implicit;l(),h("",e.name," "),l(2),Y(e.tailNo);}}function ea(t,c){t&1&&(o(0,"th",22),s(1),p(2,1),u(),r());}function ta(t,c){if(t&1&&(o(0,"td",23),C(1),r()),t&2){let e=c.$implicit;l(),Y(e.groupName);}}function na(t,c){t&1&&(o(0,"th",22),s(1),p(2,2),u(),r());}function ia(t,c){if(t&1&&(o(0,"td",23),C(1),K(2,"number"),r()),t&2){let e=c.$implicit;l(),re("",e.moneyType.flag," ",Z(2,2,e.balanceMoney,"0.2-2"));}}function aa(t,c){t&1&&T(0,"th",25);}function oa(t,c){if(t&1){let e=P();o(0,"td",23)(1,"button",26),R("click",function(){let n=E(e).$implicit,a=S();return f(a.goToEntryList(n));}),o(2,"mat-icon"),C(3,"receipt"),r()()();}}function ra(t,c){t&1&&T(0,"tr",27);}function ca(t,c){t&1&&T(0,"tr",28);}function la(t,c){t&1&&(o(0,"th",22),s(1),p(2,3),u(),r());}function _a(t,c){if(t&1&&(o(0,"td",23),C(1),r()),t&2){let e=c.$implicit;l(),Y(e.name);}}function da(t,c){t&1&&(o(0,"th",22),s(1),p(2,4),u(),r());}function ma(t,c){if(t&1&&(s(0),C(1),u()),t&2){let e=S().$implicit;l(),h(" ",e.groupName," ");}}function sa(t,c){if(t&1&&(s(0),o(1,"mat-icon",34),C(2),K(3,"lowercase"),r(),u()),t&2){let e=S(2).$implicit;l(2),Y(ni(3,1,e.bank==null?null:e.bank.ename));}}function ua(t,c){if(t&1&&(s(0),T(1,"img",35),u()),t&2){let e=S(2).$implicit;l(),m("alt",e.bank==null?null:e.bank.ename)("src",e.iconUrl,Un);}}function pa(t,c){if(t&1&&(s(0,32),A(1,sa,4,3,"ng-container",30)(2,ua,2,2,"ng-container",33),C(3),u()),t&2){let e=S().$implicit;m("ngSwitch",e.type===2&&!e.iconUrl),l(),m("ngSwitchCase",!0),l(2),h(" ",e.tailNo," ");}}function Ca(t,c){if(t&1&&(o(0,"td",29),A(1,ma,2,1,"ng-container",30)(2,pa,4,3,"ng-container",31),r()),t&2){let e=c.$implicit;m("ngSwitch",!e.name),l(),m("ngSwitchCase",!0);}}function Ea(t,c){if(t&1&&(o(0,"th",22),s(1),p(2,5),u(),C(3),r()),t&2){let e=S();l(3),h(" ",e.totalBalance," ");}}function fa(t,c){if(t&1&&(o(0,"td",23),C(1),K(2,"number"),r()),t&2){let e=c.$implicit;l(),re("",e.moneyType.flag," ",Z(2,2,e.balanceMoney,"0.2-2"));}}function ga(t,c){t&1&&T(0,"th",25);}function Sa(t,c){if(t&1){let e=P();o(0,"button",37),R("click",function(){E(e);let n=S().$implicit,a=S();return f(a.goToEntryList(n));}),o(1,"mat-icon"),C(2,"receipt"),r()();}}function Aa(t,c){if(t&1&&(o(0,"td",23),A(1,Sa,3,0,"button",36),r()),t&2){let e=c.$implicit;l(),m("ngIf",!!e.uuid);}}function Ta(t,c){t&1&&T(0,"tr",27);}function ba(t,c){if(t&1&&T(0,"tr",28),t&2){let e=c.$implicit;Ce("table-primary",!e.name);}}var Sn=(()=>{class t{route;router;elementRef;communication;notification;databaseService;additionalData;dataSource;secondaryDataSource;displayedColumns=["name","groupName","balanceMoney","tailNo"];totalBalance="";subscription=new oe();constructor(e,i,n,a,d,_,D){this.route=e,this.router=i,this.elementRef=n,this.communication=a,this.notification=d,this.databaseService=_,this.additionalData=D,this.dataSource=new Bt(),this.secondaryDataSource=new Bt();}ngOnInit(){this.subscription.add(this.communication.acceptRefreshCommand().pipe(_e(300)).subscribe(()=>{this.updateAccounts();})),this.communication.giveRefreshCommand();}ngOnDestroy(){this.subscription.unsubscribe();}goToEntryList(e){this.router.navigate(["accounts",e.uuid],{queryParams:{title:e.name},relativeTo:this.route.parent});}updateAccounts(){this.notification.showLoading(this.elementRef.nativeElement),ie([this.databaseService.getVisibleAccountList(),this.databaseService.getHiddenAccountList(),this.additionalData.getBankList()]).pipe(V(()=>{this.notification.hideLoading();})).subscribe(e=>{let i=e[0],n=e[1],a=e[2].banks,d=i.data.accountSummary[0],_=[],D;i.data.accountList.forEach(O=>{O.accountData.forEach(k=>{D=a.find(L=>k.bankId===L.id.toString()),k.groupName=O.groupName,k.balanceMoney=k.balanceMoney/100,k.bank=D;}),_.push({name:"",groupName:O.groupName,balanceMoney:O.groupMoney.summaryAssets/100,moneyType:O.groupMoney.allMoneyCategory[0].moneyType}),_=_.concat(O.accountData);}),this.dataSource.data=_,this.totalBalance=d.moneyType.flag+" "+d.assets/100,this.secondaryDataSource.data=n.data;});}static ɵfac=function(i){return new(i||t)(g(ce),g(Oe),g(Q),g(ee),g(U),g(q),g(Mt));};static ɵcmp=j({type:t,selectors:[["app-accounts"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],standalone:!1,decls:36,vars:8,consts:()=>{let e;e="Alias";let i;i="Type";let n;n="Balance";let a;a="Alias";let d;d="Type";let _;return _="Balance",[e,i,n,a,d,_,["appStartContent","",1,"d-flex","flex-column","h-100"],[1,"w-100","h-100","overflow-auto"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","groupName"],["matColumnDef","balanceMoney"],["matColumnDef","tailNo","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-cell","",3,"ngSwitch",4,"matCellDef"],["matColumnDef","tailNo"],["mat-row","",3,"table-primary",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"text-muted"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""],["mat-cell","",3,"ngSwitch"],[4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchDefault"],[3,"ngSwitch"],[4,"ngSwitchDefault"],["fontSet","Marching"],["width","32","height","32",3,"alt","src"],["type","button","mat-icon-button","","color","primary","class","mat-button-mini","y","",3,"click",4,"ngIf"],["type","button","mat-icon-button","","color","primary","y","",1,"mat-button-mini",3,"click"]];},template:function(i,n){i&1&&(T(0,"app-default-operation-toolbar")(1,"app-breadcrumb"),o(2,"app-two-cols-layout")(3,"div",6)(4,"div",7)(5,"table",8),s(6,9),A(7,Zi,3,0,"th",10)(8,Ji,4,2,"td",11),u(),s(9,12),A(10,ea,3,0,"th",10)(11,ta,2,1,"td",11),u(),s(12,13),A(13,na,3,0,"th",10)(14,ia,3,5,"td",11),u(),s(15,14),A(16,aa,1,0,"th",15)(17,oa,4,0,"td",11),u(),A(18,ra,1,0,"tr",16)(19,ca,1,0,"tr",17),r()()(),o(20,"div",18)(21,"table",8),s(22,9),A(23,la,3,0,"th",10)(24,_a,2,1,"td",11),u(),s(25,12),A(26,da,3,0,"th",10)(27,Ca,3,2,"td",19),u(),s(28,13),A(29,Ea,4,1,"th",10)(30,fa,3,5,"td",11),u(),s(31,20),A(32,ga,1,0,"th",15)(33,Aa,2,1,"td",11),u(),A(34,Ta,1,0,"tr",16)(35,ba,1,2,"tr",21),r()()()),i&2&&(l(5),m("dataSource",n.secondaryDataSource),l(13),m("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",n.displayedColumns),l(2),m("dataSource",n.dataSource),l(13),m("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",n.displayedColumns));},dependencies:[ai,at,ot,rt,Pe,J,Be,He,je,Ye,Xe,Ue,ze,Fe,qe,Ke,Me,Le,ke,We,oi,ct],styles:[".table[_ngcontent-%COMP%]{font-size:.75rem}img[_ngcontent-%COMP%]{width:32px;height:32px;vertical-align:middle}"]});}return t;})();function Ia(t,c){t&1&&(o(0,"th",12),s(1),p(2,0),u(),r());}function Ma(t,c){if(t&1&&(o(0,"td",13),C(1),o(2,"span",14),C(3),r()()),t&2){let e=c.$implicit;l(),h("",e.name," "),l(2),Y(e.tailNo);}}function Na(t,c){t&1&&T(0,"th",15);}function ha(t,c){if(t&1){let e=P();o(0,"td",13)(1,"button",16),R("click",function(){let n=E(e).$implicit,a=S();return f(a.edit(n));}),o(2,"mat-icon"),C(3,"pen"),r()()();}}function Ra(t,c){t&1&&T(0,"tr",17);}function ya(t,c){t&1&&T(0,"tr",18);}var An=(()=>{class t{route;router;elementRef;communication;notification;databaseService;additionalData;dataSource;displayedColumns=["name","operation"];totalBalance="";subscription=new oe();constructor(e,i,n,a,d,_,D){this.route=e,this.router=i,this.elementRef=n,this.communication=a,this.notification=d,this.databaseService=_,this.additionalData=D,this.dataSource=new Bt();}ngOnInit(){this.subscription.add(this.communication.acceptRefreshCommand().pipe(_e(300)).subscribe(()=>{this.updateAccounts();})),this.communication.giveRefreshCommand();}ngOnDestroy(){this.subscription.unsubscribe();}edit(e){this.router.navigate(["accounts",e.uuid],{queryParams:{title:e.name},relativeTo:this.route.parent});}updateAccounts(){this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.getBooks().pipe(Ht(e=>ie(e.data.books.map(i=>this.databaseService.getMembers(i.id))))).pipe(V(()=>{this.notification.hideLoading();})).subscribe(e=>{console.log(e);let i=[];this.dataSource.data=i;});}static ɵfac=function(i){return new(i||t)(g(ce),g(Oe),g(Q),g(ee),g(U),g(q),g(Mt));};static ɵcmp=j({type:t,selectors:[["app-members"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],standalone:!1,decls:15,vars:4,consts:()=>{let e;return e="Alias",[e,["appStartContent","",1,"d-flex","flex-column","h-100"],[1,"w-100","h-100","overflow-auto"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","operation","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-header-cell",""],["mat-cell",""],[1,"text-muted"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""]];},template:function(i,n){i&1&&(T(0,"app-default-operation-toolbar")(1,"app-breadcrumb"),o(2,"app-two-cols-layout")(3,"div",1)(4,"div",2)(5,"table",3),s(6,4),A(7,Ia,3,0,"th",5)(8,Ma,4,2,"td",6),u(),s(9,7),A(10,Na,1,0,"th",8)(11,ha,4,0,"td",6),u(),A(12,Ra,1,0,"tr",9)(13,ya,1,0,"tr",10),r()()(),T(14,"div",11),r()),i&2&&(l(5),m("dataSource",n.dataSource),l(7),m("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",n.displayedColumns));},dependencies:[Pe,J,Be,He,je,Ye,Xe,Ue,ze,Fe,qe,Ke,Me,Le,ke,We],encapsulation:2});}return t;})();var Ne=(()=>{class t{router;constructor(e){this.router=e;}addNewOne(e,i){this.router.navigate([{outlets:{secondary:["entry","add",e]}}],{queryParamsHandling:"preserve",relativeTo:i});}edit(e,i){let n;e.recType===null?n=["balance",e.id]:n=["entry",e.bkId,e.id],this.router.navigate([{outlets:{secondary:n}}],{queryParamsHandling:"preserve",relativeTo:i,state:e});}closeSecondaryOutlet(e){this.router.navigate([{outlets:{secondary:null}}],{queryParamsHandling:"preserve",relativeTo:e});}static ɵfac=function(i){return new(i||t)(se(Oe));};static ɵprov=me({token:t,factory:t.ɵfac});}return t;})();var Pa=()=>["daySummary"];function xa(t,c){if(t&1&&(o(0,"mat-option",42),C(1),r()),t&2){let e=c.$implicit;m("value",e.id),l(),h(" ",e.name," ");}}function $a(t,c){t&1&&(s(0),p(1,17),u());}function La(t,c){t&1&&(s(0),p(1,18),u());}function ka(t,c){t&1&&(s(0),p(1,19),u());}function Wa(t,c){t&1&&(s(0),p(1,20),u());}function Va(t,c){t&1&&(s(0),p(1,21),u());}function Ga(t,c){if(t&1&&(o(0,"mat-option",42),s(1,83),A(2,$a,2,0,"ng-container",84)(3,La,2,0,"ng-container",84)(4,ka,2,0,"ng-container",84)(5,Wa,2,0,"ng-container",84)(6,Va,2,0,"ng-container",84),u(),r()),t&2){let e=c.$implicit;m("value",e),l(),m("ngSwitch",e),l(),m("ngSwitchCase",1),l(),m("ngSwitchCase",2),l(),m("ngSwitchCase",3),l(),m("ngSwitchCase",4),l(),m("ngSwitchCase",5);}}function Ba(t,c){if(t&1&&(o(0,"mat-option",42),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function Xa(t,c){if(t&1&&(o(0,"mat-option",42),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function Ha(t,c){if(t&1&&(o(0,"mat-option",42),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function Ya(t,c){if(t&1&&(o(0,"mat-option",42),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function za(t,c){if(t&1){let e=P();o(0,"th",85)(1,"mat-checkbox",86),R("change",function(n){E(e);let a=S();return f(n?a.masterToggle():null);}),r()();}if(t&2){let e=S();l(),m("checked",e.selection.hasValue()&&e.isAllSelected())("indeterminate",e.selection.hasValue()&&!e.isAllSelected())("matBadge",e.selection.selected.length);}}function Fa(t,c){if(t&1){let e=P();o(0,"td",87)(1,"mat-checkbox",88),R("click",function(n){return E(e),f(n.stopPropagation());})("change",function(n){let a=E(e).$implicit,d=S();return f(n?d.selection.toggle(a):null);}),r()();}if(t&2){let e=c.$implicit,i=S();l(),m("checked",i.selection.isSelected(e));}}function ja(t,c){t&1&&(o(0,"th",89),s(1),p(2,22),u(),r());}function Ua(t,c){if(t&1&&(o(0,"td",87)(1,"span",90),C(2),K(3,"date"),r()()),t&2){let e=c.$implicit;l(2),Y(Z(3,1,e.bizTime,"yyyy-MM-dd HH:mm:ss"));}}function qa(t,c){t&1&&(o(0,"th",89),s(1),p(2,23),u(),r());}function Ka(t,c){t&1&&(o(0,"mat-icon",97),C(1,"remove"),r());}function Qa(t,c){t&1&&(o(0,"mat-icon",98),C(1,"add"),r());}function Za(t,c){if(t&1&&(o(0,"mat-icon",99),C(1),r()),t&2){let e=S().$implicit,i=S();l(),Y(e.targetId===i.accountId?"add":"remove");}}function Ja(t,c){if(t&1&&(o(0,"mat-icon"),C(1),r()),t&2){let e=S().$implicit;Ce("text-info",e.recSubtype===0)("text-warning",e.recSubtype!==0),l(),h(" ",e.recSubtype===0?"add":"remove"," ");}}function eo(t,c){if(t&1&&(o(0,"mat-icon"),C(1),r()),t&2){let e=S().$implicit;Ce("text-info",e.recSubtype===0)("text-warning",e.recSubtype!==0),l(),h(" ",e.recSubtype===0?"add":"remove"," ");}}function to(t,c){t&1&&(o(0,"mat-icon",99),C(1,"help_outline"),r());}function no(t,c){if(t&1&&(o(0,"td",91),A(1,Ka,2,0,"mat-icon",92)(2,Qa,2,0,"mat-icon",93)(3,Za,2,1,"mat-icon",94)(4,Ja,2,5,"mat-icon",95)(5,eo,2,5,"mat-icon",95)(6,to,2,0,"mat-icon",96),C(7),K(8,"number"),r()),t&2){let e=c.$implicit;m("ngSwitch",e.recType),l(),m("ngSwitchCase",1),l(),m("ngSwitchCase",2),l(),m("ngSwitchCase",3),l(),m("ngSwitchCase",4),l(),m("ngSwitchCase",5),l(2),re(" ",e.currencyFlag," ",Z(8,8,e.amount/100,"0.2-2")," ");}}function io(t,c){t&1&&(o(0,"th",89),s(1),p(2,24),u(),r());}function ao(t,c){if(t&1&&(o(0,"td",100),C(1),r()),t&2){let e=c.$implicit;l(),h(" ",e.categoryName," ");}}function oo(t,c){t&1&&(o(0,"th",89),s(1),p(2,25),u(),r());}function ro(t,c){if(t&1&&(s(0),C(1),u()),t&2){let e=c.$implicit,i=c.last;l(),re(" ",e.name,"",i?"":"/"," ");}}function co(t,c){if(t&1&&(o(0,"td",100),A(1,ro,2,2,"ng-container",101),r()),t&2){let e=c.$implicit;l(),m("ngForOf",e.members);}}function lo(t,c){t&1&&(o(0,"th",89),s(1),p(2,26),u(),r());}function _o(t,c){if(t&1&&(o(0,"td",100),C(1),r()),t&2){let e=c.$implicit;l(),Y(e.tradetgtName);}}function mo(t,c){t&1&&(o(0,"th",89),s(1),p(2,27),u(),C(3,"/ "),s(4),p(5,28),u(),r());}function so(t,c){if(t&1&&(s(0)(1),C(2),u()()),t&2){let e=c.$implicit,i=c.last;l(2),re("",e.name,"",i?"":", ");}}function uo(t,c){if(t&1&&(o(0,"td",102)(1,"small",90),A(2,so,3,2,"ng-container",101),r(),T(3,"br"),o(4,"small",90),C(5),r()()),t&2){let e=c.$implicit;l(2),m("ngForOf",e.tags),l(3),Y(e.accountName);}}function po(t,c){t&1&&(o(0,"th",89),s(1),p(2,29),u(),r());}function Co(t,c){if(t&1&&(o(0,"td",103)(1,"span",104),C(2),r()()),t&2){let e=c.$implicit;l(2),Y(e.comment);}}function Eo(t,c){t&1&&T(0,"th",105);}function fo(t,c){if(t&1){let e=P();o(0,"td",87)(1,"button",106),R("click",function(){let n=E(e).$implicit,a=S();return f(a.edit(n));}),o(2,"mat-icon"),C(3,"edit"),r()()();}}function go(t,c){if(t&1&&(o(0,"td",87),C(1),K(2,"date"),r()),t&2){let e=c.$implicit,i=S();Qn("colspan",i.displayedColumns.length),l(),re(" ",Z(2,3,e.bizTime,"yyyy-MM-dd EEEE")," \xA0\xA0\xA0\xA0\xA0 ",e.comment," ");}}function So(t,c){t&1&&T(0,"tr",107);}function Ao(t,c){t&1&&T(0,"tr",108);}function To(t,c){t&1&&T(0,"tr",109);}var Gi=(()=>{class t extends yi(class{}){route;elementRef;dateAdapter;algorithm;communication;notification;datetimeService;databaseService;operation;books=[];recordTypes=[$.PAY,$.REVENUE,$.TRANSFER,$.BORROW,$.RETURN];accounts=[];projects=[];members=[];payCategories=[];txnObjects=[];searchKeys={bkId:null,startTime:0,endTime:0,amountStart:null,amountEnd:null,comment:null,recTypeList:null,mainTypeIdList:null,subTypeIdList:null,accountIdList:null,projectIdList:null,tradetgtIdList:null,memberIdList:null,reimburseList:null,categoryIdList:null,queryFlowCount:!0};displayedColumns=[];dataSource;selection=new Ut(!0,[]);totalEntry;range=new lt({start:new De(null),end:new De(null)});paginator;deleting=!1;columnsToDisplay=["select","bizTime","amount","categoryName","members","tradetgtName","tags","comment","operation"];constructor(e,i,n,a,d,_,D,O,k){super(),this.route=e,this.elementRef=i,this.dateAdapter=n,this.algorithm=a,this.communication=d,this.notification=_,this.datetimeService=D,this.databaseService=O,this.operation=k,this.dataSource=new an(L=>{let W=this.range.controls.start.value,y=this.range.controls.end.value,w=Bn(Gn({},this.searchKeys),{startTime:W?this.datetimeService.getStartDatetime(W).valueOf():null,endTime:y?this.datetimeService.getEndDatetime(y).valueOf():null,pageSize:L.pageSize,pageIndex:L.pageIndex+1}),z;for(let x in w)z=w[x],Array.isArray(z)&&!z.length&&(w[x]=null);return this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.queryEntries(w).pipe(ae(()=>H({code:500,data:{dailyItems:[],flowCount:0},error:""})));},L=>{let W=this.dateAdapter,y=this.accounts,w=[];return this.selection.clear(),this.notification.hideLoading(),L.data.dailyItems?.forEach(z=>{w.push({bizTime:W.toIso8601(W.deserialize(z.date)),comment:" + "+z.income+"   |   - "+z.outgo}),z.flowList.forEach(x=>{x.accountName=y.find(Ze=>Ze.uuid===x.accountId)?.name;}),w=w.concat(z.flowList);}),this.totalEntry=`${L.data.totalIncomeString} | -${L.data.totalOutgoString}`,this.paginator.length=jt(L?.data?.flowCount),w;},!0,!1);}ngOnInit(){this.dataSource.paginator=this.paginator,this.datetimeService.initTimeRange(this.range),this.displayedColumns=this.columnsToDisplay,ie([this.databaseService.getBooks(),this.databaseService.getShortAccounts()]).pipe(V(()=>{this.notification.hideLoading();})).subscribe(e=>{this.books=e[0].data.books;let i=this.books[0];i&&(this.searchKeys.bkId=i.id,this.dataSource.readied=!0,this.onBookSelectionChange({value:i.id})),this.accounts=e[1].data.accounts,this.initRefreshIndicator();});}ngOnDestroy(){this.datetimeService.destoryTimeRange();}isSummary=(e,i)=>!i.id;isNotSummary=(e,i)=>!!i.id;onBookSelectionChange(e){let i=e.value;this.notification.showLoading(this.elementRef.nativeElement),ie([this.databaseService.getTransactionObjects(i),this.databaseService.getBookProjects(i),this.databaseService.getMembers(i),this.databaseService.getEntryCategories(i,Qe.PAY)]).pipe(V(()=>{this.notification.hideLoading(),this.communication.giveRefreshCommand();})).subscribe(n=>{this.txnObjects=n[0].data.bookTradeTargets,this.projects=n[1].data.bookProjects,this.members=n[2].data.bookMembers,this.payCategories=n[3].data.bookCategories;});}isAllSelected(){let e=this.selection.selected.length,i=this.dataSource.data.length;return i>0&&e===i;}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(e=>this.selection.select(e));}search(){this.dataSource.reset();}reset(){let e=this.dateAdapter,i=this.searchKeys,n=e.today(),a=e.createDate(e.getYear(n),e.getMonth(n),1),d=n;this.range.setValue({start:a,end:d}),i.bkId=this.books[0].id,i.amountStart=null,i.amountEnd=null,i.comment=null,i.recTypeList=null,i.mainTypeIdList=null,i.subTypeIdList=null,i.accountIdList=null,i.projectIdList=null,i.tradetgtIdList=null,i.memberIdList=null,i.reimburseList=null,this.dataSource.reset();}addNewOne(){this.operation.addNewOne("new",this.route.parent);}edit(e){this.operation.edit(e,this.route.parent);}delete(){let e=this.selection.selected.map(i=>i.id);!e.length||this.deleting||(this.deleting=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.deleteEntries(e).pipe(V(()=>{this.deleting=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand();})).subscribe());}initRefreshIndicator(){this.subscription.add(this.communication.acceptRefreshCommand().pipe(_e(300)).subscribe(()=>{this.dataSource.reload();}));}static ɵfac=function(i){return new(i||t)(g(ce),g(Q),g(be),g(Qt),g(ee),g(U),g(At),g(q),g(Ne));};static ɵcmp=j({type:t,selectors:[["app-search-entries"]],viewQuery:function(i,n){if(i&1&&he(Ge,7),i&2){let a;Re(a=ye())&&(n.paginator=a.first);}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],standalone:!1,features:[Kn],decls:122,vars:34,consts:()=>{let e;e="Start date";let i;i="End date";let n;n="Account book";let a;a="Date range";let d;d="Type";let _;_="Balance modification";let D;D="Amount";let O;O="Comment";let k;k="Account";let L;L="Member";let W;W="Trader";let y;y="Tags";let w;w="Reimburse";let z;z="To be reimbursed";let x;x="Reimbursed";let Ze;Ze="Non-reimbursable";let ht;ht="Search";let Rt;Rt="Reset";let yt;yt="Pay";let Dt;Dt="Revenue";let vt;vt="Transfer";let Ot;Ot="Loan(incoming)";let wt;wt="Loan(outing)";let Pt;Pt="Time";let xt;xt="Amount";let $t;$t="Category";let Lt;Lt="Member";let kt;kt="Trader";let Wt;Wt="Tags";let Vt;Vt="Account";let Gt;return Gt="Comment",[["picker",""],n,a,d,_,D,O,k,L,W,y,w,z,x,Ze,ht,Rt,yt,Dt,vt,Ot,wt,Pt,xt,$t,Lt,kt,Wt,Vt,Gt,[3,"new","delete"],[1,"align-middle","ms-2"],["appStartContent","",1,"d-flex","flex-column","h-100",3,"ngSubmit"],[1,"flex-fill","overflow-auto","p-3"],["appearance","outline",1,"w-100"],["name","book",3,"valueChange","selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder",e],["matEndDate","","formControlName","end","placeholder",i],["matSuffix","",3,"for"],["name","recordTypes","multiple","",3,"valueChange","value"],[3,"value"],[1,"d-flex","flex-row","flex-nowrap","w-100"],["name","amountStart","type","number","matInput","",3,"ngModelChange","ngModel"],[1,"mx-2","flex-grow-0","flex-shrink-0"],["name","amountEnd","type","number","matInput","",3,"ngModelChange","click","ngModel"],["name","comment","type","text","matInput","",3,"ngModelChange","ngModel"],["name","accounts","multiple","",3,"valueChange","value"],["name","members","multiple","",3,"valueChange","value"],["name","txnObjects","multiple","",3,"valueChange","value"],["name","tags","multiple","",3,"ngModelChange","ngModel"],["name","reimburse","multiple","",3,"ngModelChange","ngModel"],[1,"container-fluid","py-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2"],["fontset","Marching"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"d-flex","flex-column","flex-nowrap","h-100"],[1,"flex-fill","overflow-hidden"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","select","sticky","true"],["mat-header-cell","","style","width: 50px;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","bizTime"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","amount"],["mat-cell","","class","text-nowrap",3,"ngSwitch",4,"matCellDef"],["matColumnDef","categoryName"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","members"],["matColumnDef","tradetgtName"],["matColumnDef","tags"],["mat-cell","","style","line-height: 1.1;",4,"matCellDef"],["matColumnDef","comment"],["mat-cell","","width","1000",4,"matCellDef"],["matColumnDef","operation","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["matColumnDef","daySummary"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["class","table-primary text-start","mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["showFirstLastButtons","",3,"pageSizeOptions","pageSize"],[3,"ngSwitch"],[4,"ngSwitchCase"],["mat-header-cell","",2,"width","50px"],["matBadgeColor","warn",1,"mat-checkbox-mini",3,"change","checked","indeterminate","matBadge"],["mat-cell",""],[1,"mat-checkbox-mini",3,"click","change","checked"],["mat-header-cell",""],[1,"text-nowrap"],["mat-cell","",1,"text-nowrap",3,"ngSwitch"],["class","text-danger",4,"ngSwitchCase"],["class","text-success",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchCase"],[3,"text-info","text-warning",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchDefault"],[1,"text-danger"],[1,"text-success"],[1,"text-muted"],["mat-cell","",1,"text-nowrap"],[4,"ngFor","ngForOf"],["mat-cell","",2,"line-height","1.1"],["mat-cell","","width","1000"],[1,"ellipsis-description-line-2"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""],["mat-row","",1,"table-primary","text-start"]];},template:function(i,n){if(i&1){let a=P();o(0,"app-default-operation-toolbar",30),R("new",function(){return E(a),f(n.addNewOne());})("delete",function(){return E(a),f(n.delete());}),r(),o(1,"app-breadcrumb")(2,"span",31),C(3),r()(),o(4,"app-two-cols-layout")(5,"form",32),R("ngSubmit",function(){return E(a),f(n.search());}),o(6,"div",33)(7,"mat-form-field",34)(8,"mat-label"),s(9),p(10,1),u(),r(),o(11,"mat-select",35),N("valueChange",function(_){return E(a),M(n.searchKeys.bkId,_)||(n.searchKeys.bkId=_),f(_);}),R("selectionChange",function(_){return E(a),f(n.onBookSelectionChange(_));}),A(12,xa,2,2,"mat-option",36),r()(),o(13,"mat-form-field",34)(14,"mat-label"),p(15,2),r(),o(16,"mat-date-range-input",37),T(17,"input",38)(18,"input",39),r(),T(19,"mat-datepicker-toggle",40)(20,"mat-date-range-picker",null,0),r(),o(22,"mat-form-field",34)(23,"mat-label"),p(24,3),r(),o(25,"mat-select",41),N("valueChange",function(_){return E(a),M(n.searchKeys.recTypeList,_)||(n.searchKeys.recTypeList=_),f(_);}),A(26,Ga,7,7,"mat-option",36),o(27,"mat-option",42),p(28,4),r()()(),o(29,"mat-form-field",34)(30,"mat-label"),p(31,5),r(),o(32,"div",43)(33,"input",44),N("ngModelChange",function(_){return E(a),M(n.searchKeys.amountStart,_)||(n.searchKeys.amountStart=_),f(_);}),r(),o(34,"mat-icon",45),C(35,"settings_ethernet"),r(),o(36,"input",46),N("ngModelChange",function(_){return E(a),M(n.searchKeys.amountEnd,_)||(n.searchKeys.amountEnd=_),f(_);}),R("click",function(_){return E(a),f(_.stopPropagation());}),r()()(),o(37,"mat-form-field",34)(38,"mat-label"),p(39,6),r(),o(40,"input",47),N("ngModelChange",function(_){return E(a),M(n.searchKeys.comment,_)||(n.searchKeys.comment=_),f(_);}),r()(),o(41,"mat-form-field",34)(42,"mat-label"),p(43,7),r(),o(44,"mat-select",48),N("valueChange",function(_){return E(a),M(n.searchKeys.accountIdList,_)||(n.searchKeys.accountIdList=_),f(_);}),A(45,Ba,2,2,"mat-option",36),r()(),o(46,"mat-form-field",34)(47,"mat-label"),p(48,8),r(),o(49,"mat-select",49),N("valueChange",function(_){return E(a),M(n.searchKeys.memberIdList,_)||(n.searchKeys.memberIdList=_),f(_);}),A(50,Xa,2,2,"mat-option",36),r()(),o(51,"mat-form-field",34)(52,"mat-label"),p(53,9),r(),o(54,"mat-select",50),N("valueChange",function(_){return E(a),M(n.searchKeys.tradetgtIdList,_)||(n.searchKeys.tradetgtIdList=_),f(_);}),A(55,Ha,2,2,"mat-option",36),r()(),o(56,"mat-form-field",34)(57,"mat-label"),p(58,10),r(),o(59,"mat-select",51),N("ngModelChange",function(_){return E(a),M(n.searchKeys.projectIdList,_)||(n.searchKeys.projectIdList=_),f(_);}),A(60,Ya,2,2,"mat-option",36),r()(),o(61,"mat-form-field",34)(62,"mat-label"),p(63,11),r(),o(64,"mat-select",52),N("ngModelChange",function(_){return E(a),M(n.searchKeys.reimburseList,_)||(n.searchKeys.reimburseList=_),f(_);}),o(65,"mat-option",42),s(66),p(67,12),u(),r(),o(68,"mat-option",42),s(69),p(70,13),u(),r(),o(71,"mat-option",42),s(72),p(73,14),u(),r()()()(),o(74,"div",53)(75,"button",54)(76,"mat-icon",55),C(77,"search"),r(),s(78),p(79,15),u(),r(),o(80,"button",56),R("click",function(){return E(a),f(n.reset());}),o(81,"mat-icon"),C(82,"search_off"),r(),s(83),p(84,16),u(),r()()(),o(85,"div",57)(86,"div",58)(87,"div",59)(88,"table",60),s(89,61),A(90,za,2,3,"th",62)(91,Fa,2,1,"td",63),u(),s(92,64),A(93,ja,3,0,"th",65)(94,Ua,4,4,"td",63),u(),s(95,66),A(96,qa,3,0,"th",65)(97,no,9,11,"td",67),u(),s(98,68),A(99,io,3,0,"th",65)(100,ao,2,1,"td",69),u(),s(101,70),A(102,oo,3,0,"th",65)(103,co,2,1,"td",69),u(),s(104,71),A(105,lo,3,0,"th",65)(106,_o,2,1,"td",69),u(),s(107,72),A(108,mo,6,0,"th",65)(109,uo,6,2,"td",73),u(),s(110,74),A(111,po,3,0,"th",65)(112,Co,3,1,"td",75),u(),s(113,76),A(114,Eo,1,0,"th",77)(115,fo,4,0,"td",63),u(),s(116,78),A(117,go,3,6,"td",63),u(),A(118,So,1,0,"tr",79)(119,Ao,1,0,"tr",80)(120,To,1,0,"tr",81),r()()(),T(121,"mat-paginator",82),r()();}if(i&2){let a=de(21);l(3),Y(n.totalEntry),l(8),I("value",n.searchKeys.bkId),l(),m("ngForOf",n.books),l(4),m("formGroup",n.range)("rangePicker",a),l(3),m("for",a),l(6),I("value",n.searchKeys.recTypeList),l(),m("ngForOf",n.recordTypes),l(),m("value",null),l(6),I("ngModel",n.searchKeys.amountStart),l(3),I("ngModel",n.searchKeys.amountEnd),l(4),I("ngModel",n.searchKeys.comment),l(4),I("value",n.searchKeys.accountIdList),l(),m("ngForOf",n.accounts),l(4),I("value",n.searchKeys.memberIdList),l(),m("ngForOf",n.members),l(4),I("value",n.searchKeys.tradetgtIdList),l(),m("ngForOf",n.txnObjects),l(4),I("ngModel",n.searchKeys.projectIdList),l(),m("ngForOf",n.projects),l(4),I("ngModel",n.searchKeys.reimburseList),l(),m("value",1),l(3),m("value",2),l(3),m("value",0),l(17),m("dataSource",n.dataSource),l(30),m("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",n.displayedColumns)("matRowDefWhen",n.isNotSummary),l(),m("matRowDefColumns",ti(33,Pa))("matRowDefWhen",n.isSummary),l(),m("pageSizeOptions",n.dataSource.pageSizeOptions)("pageSize",n.dataSource.pageSizeOptions[0]);}},dependencies:[Yt,at,ot,rt,nn,_t,Ee,dt,fe,ge,ve,Se,xe,Pe,tn,Ie,pt,Ct,Et,ft,Te,Ae,we,J,gt,$e,ut,mt,st,Ge,Be,He,je,Ye,Xe,Ue,ze,Fe,qe,Ke,Me,Le,ke,We,ct,St],encapsulation:2});}return t;})();function bo(t,c){if(t&1){let e=P();o(0,"th",42)(1,"mat-checkbox",43),R("change",function(n){E(e);let a=S();return f(n?a.masterToggle():null);}),r()();}if(t&2){let e=S();l(),m("checked",e.selection.hasValue()&&e.isAllSelected())("indeterminate",e.selection.hasValue()&&!e.isAllSelected())("matBadge",e.selection.selected.length);}}function Io(t,c){if(t&1){let e=P();o(0,"td",44)(1,"mat-checkbox",45),R("click",function(n){return E(e),f(n.stopPropagation());})("change",function(n){let a=E(e).$implicit,d=S();return f(n?d.selection.toggle(a):null);}),r()();}if(t&2){let e=c.$implicit,i=S();l(),m("checked",i.selection.isSelected(e));}}function Mo(t,c){t&1&&(o(0,"th",46),s(1),p(2,4),u(),r());}function No(t,c){if(t&1&&(o(0,"td",44)(1,"span",47),C(2),K(3,"date"),r()()),t&2){let e=c.$implicit;l(2),Y(Z(3,1,e.bizTime,"yyyy-MM-dd HH:mm:ss"));}}function ho(t,c){t&1&&(o(0,"th",46),s(1),p(2,5),u(),r());}function Ro(t,c){t&1&&(o(0,"mat-icon",54),C(1,"remove"),r());}function yo(t,c){t&1&&(o(0,"mat-icon",55),C(1,"add"),r());}function Do(t,c){if(t&1&&(o(0,"mat-icon",56),C(1),r()),t&2){let e=S().$implicit,i=S();l(),Y(e.targetId===i.accountId?"add":"remove");}}function vo(t,c){if(t&1&&(o(0,"mat-icon"),C(1),r()),t&2){let e=S().$implicit;Ce("text-info",e.recSubtype===0)("text-warning",e.recSubtype!==0),l(),h(" ",e.recSubtype===0?"add":"remove"," ");}}function Oo(t,c){if(t&1&&(o(0,"mat-icon"),C(1),r()),t&2){let e=S().$implicit;Ce("text-info",e.recSubtype===0)("text-warning",e.recSubtype!==0),l(),h(" ",e.recSubtype===0?"add":"remove"," ");}}function wo(t,c){t&1&&(o(0,"mat-icon",56),C(1,"help_outline"),r());}function Po(t,c){if(t&1&&(o(0,"td",48),A(1,Ro,2,0,"mat-icon",49)(2,yo,2,0,"mat-icon",50)(3,Do,2,1,"mat-icon",51)(4,vo,2,5,"mat-icon",52)(5,Oo,2,5,"mat-icon",52)(6,wo,2,0,"mat-icon",53),C(7),K(8,"number"),r()),t&2){let e=c.$implicit;m("ngSwitch",e.recType),l(),m("ngSwitchCase",1),l(),m("ngSwitchCase",2),l(),m("ngSwitchCase",3),l(),m("ngSwitchCase",4),l(),m("ngSwitchCase",5),l(2),re(" ",e.moneyType.flag," ",Z(8,8,e.amount/100,"0.2-2")," ");}}function xo(t,c){t&1&&(o(0,"th",46),s(1),p(2,6),u(),r());}function $o(t,c){if(t&1&&(o(0,"td",57),C(1),K(2,"number"),r()),t&2){let e=c.$implicit;l(),re(" ",e.moneyType.flag," ",Z(2,2,e.accountBalance,"0.2-2")," ");}}function Lo(t,c){t&1&&(o(0,"th",46),s(1),p(2,7),u(),r());}function ko(t,c){if(t&1&&(o(0,"td",57),C(1),r()),t&2){let e=c.$implicit;l(),h(" ",e.categoryName," ");}}function Wo(t,c){t&1&&(o(0,"th",46),s(1),p(2,8),u(),r());}function Vo(t,c){if(t&1&&(s(0)(1),C(2),u()()),t&2){let e=c.$implicit,i=c.last;l(2),re("",e.name,"",i?"":", ");}}function Go(t,c){if(t&1&&(o(0,"td",44)(1,"small",47),A(2,Vo,3,2,"ng-container",58),r()()),t&2){let e=c.$implicit;l(2),m("ngForOf",e.tags);}}function Bo(t,c){t&1&&(o(0,"th",46),s(1),p(2,9),u(),r());}function Xo(t,c){if(t&1&&(o(0,"td",59)(1,"span",60),C(2),r()()),t&2){let e=c.$implicit;l(2),Y(e.comment);}}function Ho(t,c){t&1&&T(0,"th",61);}function Yo(t,c){if(t&1){let e=P();o(0,"td",44)(1,"button",62),R("click",function(){let n=E(e).$implicit,a=S();return f(a.edit(n));}),o(2,"mat-icon"),C(3,"edit"),r()()();}}function zo(t,c){t&1&&T(0,"tr",63);}function Fo(t,c){t&1&&T(0,"tr",64);}var Bi=(()=>{class t{elementRef;route;dateAdapter;algorithm;notification;communication;datetimeService;databaseService;operation;breads=[{title:"*"}];displayedColumns=[];selection=new Ut(!0,[]);dataSource;showBalance=!1;range=new lt({start:new De(null),end:new De(null)});paginator;accountId;deleting=!1;columnsToDisplay=["select","bizTime","amount","accountBalance","categoryName","comment","operation"];subscription=new oe();constructor(e,i,n,a,d,_,D,O,k){this.elementRef=e,this.route=i,this.dateAdapter=n,this.algorithm=a,this.notification=d,this.communication=_,this.datetimeService=D,this.databaseService=O,this.operation=k,this.dataSource=new an(L=>{let W=this.range.controls.start.value,y=this.range.controls.end.value;return this.notification.showLoading(this.elementRef.nativeElement),(W&&y?this.databaseService.getEntries(this.accountId,this.datetimeService.getStartDatetime(W),this.datetimeService.getEndDatetime(y)):Xt(()=>new Error("No datetime conditions"))).pipe(ae(()=>H({code:500,data:{flows:[]},error:""})));},L=>{this.selection.clear(),this.notification.hideLoading();let W=this.accountId,y=L.data.flows,w=0,z=x=>{switch(x.recType){case $.PAY:w-=x.amount;break;case $.REVENUE:w+=x.amount;break;case $.TRANSFER:x.targetId===W?w+=x.amount:w-=x.amount;break;case $.BORROW:case $.RETURN:x.recSubtype===0?w+=x.amount:w-=x.amount;break;default:w=x.amount,x.recType;}x.accountBalance=w/100;};return this.showBalance&&this.algorithm.reverseDeviceOfDuff(y,z),y;},!1,!0);}ngOnInit(){this.breads[0].title=this.route.snapshot.queryParamMap.get("title"),this.displayedColumns=this.columnsToDisplay.filter(e=>e!=="accountBalance"||this.showBalance),this.dataSource.paginator=this.paginator,this.subscription.add(this.route.paramMap.subscribe(e=>{this.accountId=e.get("accountId");})),this.subscription.add(this.communication.acceptRefreshCommand().pipe(_e(300)).subscribe(()=>{this.dataSource.reload();})),this.subscription.add(this.range.valueChanges.pipe(_e(300)).subscribe(()=>{this.dataSource.reset();})),this.datetimeService.initTimeRange(this.range);}ngOnDestroy(){this.datetimeService.destoryTimeRange(),this.subscription.unsubscribe();}isAllSelected(){let e=this.selection.selected.length,i=this.dataSource.data.length;return i>0&&e===i;}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(e=>this.selection.select(e));}onShowBalanceChange(e){e.checked?(this.range.setValue({start:this.datetimeService.getMinDate(),end:this.datetimeService.getMaxDate()}),this.range.disable()):this.range.enable(),this.displayedColumns=this.columnsToDisplay.filter(i=>i!=="accountBalance"||this.showBalance);}addNewOne(){this.operation.addNewOne(this.accountId,this.route.parent);}edit(e){this.operation.edit(e,this.route.parent);}delete(){let e=this.selection.selected.map(i=>i.id);!e.length||this.deleting||(this.deleting=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.deleteEntries(e).pipe(V(()=>{this.deleting=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand();})).subscribe());}static ɵfac=function(i){return new(i||t)(g(Q),g(ce),g(be),g(Qt),g(U),g(ee),g(At),g(q),g(Ne));};static ɵcmp=j({type:t,selectors:[["app-account-entries"]],viewQuery:function(i,n){if(i&1&&he(Ge,7),i&2){let a;Re(a=ye())&&(n.paginator=a.first);}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],standalone:!1,decls:53,vars:12,consts:()=>{let e;e="Start date";let i;i="End date";let n;n="Date range";let a;a="Show balance";let d;d="Review all entries of this account.";let _;_="Time";let D;D="Amount";let O;O="Balance";let k;k="Category";let L;L="Tags";let W;return W="Comment",[["picker",""],n,a,d,_,D,O,k,L,W,[3,"new","delete"],[3,"items"],["appStartContent","",1,"d-flex","flex-column","h-100"],[1,"p-3"],["appearance","outline",1,"w-100"],[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder",e],["matEndDate","","formControlName","end","placeholder",i],["matSuffix","",3,"for","disabled"],["color","primary",3,"ngModelChange","change","ngModel"],[1,"d-flex","flex-column","flex-nowrap","h-100"],[1,"flex-fill","overflow-hidden"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","select","sticky","true"],["mat-header-cell","","style","min-width: 50px;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","bizTime"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","amount"],["mat-cell","","class","text-nowrap",3,"ngSwitch",4,"matCellDef"],["matColumnDef","accountBalance"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","categoryName"],["matColumnDef","tags"],["matColumnDef","comment"],["mat-cell","","width","1000",4,"matCellDef"],["matColumnDef","operation","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions","pageSize"],["mat-header-cell","",2,"min-width","50px"],["matBadgeColor","warn",1,"mat-checkbox-mini",3,"change","checked","indeterminate","matBadge"],["mat-cell",""],[1,"mat-checkbox-mini",3,"click","change","checked"],["mat-header-cell",""],[1,"text-nowrap"],["mat-cell","",1,"text-nowrap",3,"ngSwitch"],["class","text-danger",4,"ngSwitchCase"],["class","text-success",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchCase"],[3,"text-info","text-warning",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchDefault"],[1,"text-danger"],[1,"text-success"],[1,"text-muted"],["mat-cell","",1,"text-nowrap"],[4,"ngFor","ngForOf"],["mat-cell","","width","1000"],[1,"ellipsis-description-line-2"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""]];},template:function(i,n){if(i&1){let a=P();o(0,"app-default-operation-toolbar",10),R("new",function(){return E(a),f(n.addNewOne());})("delete",function(){return E(a),f(n.delete());}),r(),T(1,"app-breadcrumb",11),o(2,"app-two-cols-layout")(3,"div",12)(4,"div",13)(5,"mat-form-field",14)(6,"mat-label"),p(7,1),r(),o(8,"mat-date-range-input",15),T(9,"input",16)(10,"input",17),r(),T(11,"mat-datepicker-toggle",18)(12,"mat-date-range-picker",null,0),r(),o(14,"div")(15,"mat-slide-toggle",19),N("ngModelChange",function(_){return E(a),M(n.showBalance,_)||(n.showBalance=_),f(_);}),R("change",function(_){return E(a),f(n.onShowBalanceChange(_));}),s(16),p(17,2),u(),r()(),o(18,"p")(19,"small"),s(20),p(21,3),u(),r()()()(),o(22,"div",20)(23,"div",21)(24,"div",22)(25,"table",23),s(26,24),A(27,bo,2,3,"th",25)(28,Io,2,1,"td",26),u(),s(29,27),A(30,Mo,3,0,"th",28)(31,No,4,4,"td",26),u(),s(32,29),A(33,ho,3,0,"th",28)(34,Po,9,11,"td",30),u(),s(35,31),A(36,xo,3,0,"th",28)(37,$o,3,5,"td",32),u(),s(38,33),A(39,Lo,3,0,"th",28)(40,ko,2,1,"td",32),u(),s(41,34),A(42,Wo,3,0,"th",28)(43,Go,3,1,"td",26),u(),s(44,35),A(45,Bo,3,0,"th",28)(46,Xo,3,1,"td",36),u(),s(47,37),A(48,Ho,1,0,"th",38)(49,Yo,4,0,"td",26),u(),A(50,zo,1,0,"tr",39)(51,Fo,1,0,"tr",40),r()()(),T(52,"mat-paginator",41),r()();}if(i&2){let a=de(13);l(),m("items",n.breads),l(7),m("formGroup",n.range)("rangePicker",a),l(3),m("for",a)("disabled",n.showBalance),l(4),I("ngModel",n.showBalance),l(10),m("dataSource",n.dataSource),l(25),m("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",n.displayedColumns),l(),m("pageSizeOptions",n.dataSource.pageSizeOptions)("pageSize",n.dataSource.pageSizeOptions[0]);}},dependencies:[Yt,at,ot,rt,nn,Ee,fe,ge,ve,Pe,tn,Ie,pt,Ct,Et,ft,Te,Ae,we,J,Si,mt,st,Ge,Be,He,je,Ye,Xe,Ue,ze,Fe,qe,Ke,Me,Le,ke,We,ct,St],encapsulation:2});}return t;})();var F=[];for(let t=0;t<256;++t)F.push((t+256).toString(16).slice(1));function Xi(t,c=0){return(F[t[c+0]]+F[t[c+1]]+F[t[c+2]]+F[t[c+3]]+"-"+F[t[c+4]]+F[t[c+5]]+"-"+F[t[c+6]]+F[t[c+7]]+"-"+F[t[c+8]]+F[t[c+9]]+"-"+F[t[c+10]]+F[t[c+11]]+F[t[c+12]]+F[t[c+13]]+F[t[c+14]]+F[t[c+15]]).toLowerCase();}var Tn,jo=new Uint8Array(16);function bn(){if(!Tn){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Tn=crypto.getRandomValues.bind(crypto);}return Tn(jo);}var Uo=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),In={randomUUID:Uo};function qo(t,c,e){if(In.randomUUID&&!c&&!t)return In.randomUUID();t=t||{};let i=t.random??t.rng?.()??bn();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,c){if(e=e||0,e<0||e+16>c.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let n=0;n<16;++n)c[e+n]=i[n];return c;}return Xi(i);}var Mn=qo;var tt=class{amount;accountId;accountName;bizId;bizTime;bkId;bookId;categoryId;comment;address;attachments;members;recType;recSubtype;lendType;flag;profit;reimburse;sourceSystem;tags;tradetgtId;tradetgtName;id;edited;deleted;accountBalance;account;category;member;project;targetId;targetName;targetAmount;tradetgt;constructor(){this.id=0,this.amount=0,this.comment="",this.address="",this.attachments="",this.reimburse=0,this.edited=0,this.deleted=0,this.sourceSystem=201;}};function Zo(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function Jo(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.categoryId),l(),h(" ",e.name," ");}}function er(t,c){if(t&1&&(o(0,"mat-optgroup",69),B(1,Jo,2,2,"mat-option",55,G),r()),t&2){let e=c.$implicit;m("label",e.name),l(),X(e.outgoSubTypes);}}function tr(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e),l(),h(" ",e.name," ");}}function nr(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function ir(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function ar(t,c){if(t&1){let e=P();o(0,"div",49)(1,"div",51)(2,"div",52)(3,"mat-form-field",53)(4,"mat-label"),p(5,9),r(),o(6,"mat-select",67),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.accountId,n)||(a.entry.accountId=n),f(n);}),B(7,Zo,2,2,"mat-option",55,G),r()()(),o(9,"div",52)(10,"mat-form-field",53)(11,"mat-label"),p(12,10),r(),o(13,"mat-select",68),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.categoryId,n)||(a.entry.categoryId=n),f(n);}),B(14,er,3,1,"mat-optgroup",69,G),r()()()(),o(16,"div",51)(17,"div",52)(18,"mat-form-field",53)(19,"mat-label"),p(20,11),r(),o(21,"mat-select",70),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.tags,n)||(a.entry.tags=n),f(n);}),B(22,tr,2,2,"mat-option",55,G),r()()(),o(24,"div",52)(25,"mat-form-field",53)(26,"mat-label"),p(27,12),r(),o(28,"mat-select",71),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.tradetgtId,n)||(a.entry.tradetgtId=n),f(n);}),o(29,"mat-option",72),C(30,"-"),r(),B(31,nr,2,2,"mat-option",55,G),r()()()(),o(33,"div",51)(34,"div",52)(35,"mat-form-field",53)(36,"mat-label"),p(37,13),r(),o(38,"mat-select",73),N("ngModelChange",function(n){E(e);let a=S();return M(a.selectedMembers,n)||(a.selectedMembers=n),f(n);}),B(39,ir,2,2,"mat-option",55,G),r()()(),o(41,"div",52)(42,"mat-form-field",53)(43,"mat-label"),p(44,14),r(),o(45,"mat-select",74),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.reimburse,n)||(a.entry.reimburse=n),f(n);}),o(46,"mat-option",55),s(47),p(48,15),u(),r(),o(49,"mat-option",55),s(50),p(51,16),u(),r(),o(52,"mat-option",55),s(53),p(54,17),u(),r()()()()()();}if(t&2){let e=S();l(6),I("ngModel",e.entry.accountId),l(),X(e.accounts),l(6),I("ngModel",e.entry.categoryId),l(),X(e.payCategories),l(7),m("compareWith",e.compareTagWith),I("ngModel",e.entry.tags),l(),X(e.tags),l(6),I("ngModel",e.entry.tradetgtId),l(3),X(e.txnObjects),l(7),I("ngModel",e.selectedMembers),l(),X(e.members),l(6),I("ngModel",e.entry.reimburse),l(),m("value",1),l(3),m("value",2),l(3),m("value",0);}}function or(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function rr(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.categoryId),l(),h(" ",e.name," ");}}function cr(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e),l(),h(" ",e.name," ");}}function lr(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function _r(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function dr(t,c){if(t&1){let e=P();o(0,"div",49)(1,"div",51)(2,"div",52)(3,"mat-form-field",53)(4,"mat-label"),p(5,18),r(),o(6,"mat-select",67),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.accountId,n)||(a.entry.accountId=n),f(n);}),B(7,or,2,2,"mat-option",55,G),r()()(),o(9,"div",52)(10,"mat-form-field",53)(11,"mat-label"),p(12,19),r(),o(13,"mat-select",75),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.categoryId,n)||(a.entry.categoryId=n),f(n);}),B(14,rr,2,2,"mat-option",55,G),r()()()(),o(16,"div",51)(17,"div",52)(18,"mat-form-field",53)(19,"mat-label"),p(20,20),r(),o(21,"mat-select",70),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.tags,n)||(a.entry.tags=n),f(n);}),o(22,"mat-option",72),C(23,"-"),r(),B(24,cr,2,2,"mat-option",55,G),r()()(),o(26,"div",52)(27,"mat-form-field",53)(28,"mat-label"),p(29,21),r(),o(30,"mat-select",71),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.tradetgtId,n)||(a.entry.tradetgtId=n),f(n);}),o(31,"mat-option",72),C(32,"-"),r(),B(33,lr,2,2,"mat-option",55,G),r()()()(),o(35,"div",51)(36,"div",52)(37,"mat-form-field",53)(38,"mat-label"),p(39,22),r(),o(40,"mat-select",73),N("ngModelChange",function(n){E(e);let a=S();return M(a.selectedMembers,n)||(a.selectedMembers=n),f(n);}),B(41,_r,2,2,"mat-option",55,G),r()()(),o(43,"div",52)(44,"mat-form-field",53)(45,"mat-label"),p(46,23),r(),o(47,"mat-select",74),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.reimburse,n)||(a.entry.reimburse=n),f(n);}),o(48,"mat-option",55),s(49),p(50,24),u(),r(),o(51,"mat-option",55),s(52),p(53,25),u(),r(),o(54,"mat-option",55),s(55),p(56,26),u(),r()()()()()();}if(t&2){let e=S();l(6),I("ngModel",e.entry.accountId),l(),X(e.accounts),l(6),I("ngModel",e.entry.categoryId),l(),X(e.revenueCategories),l(7),m("compareWith",e.compareTagWith),I("ngModel",e.entry.tags),l(3),X(e.tags),l(6),I("ngModel",e.entry.tradetgtId),l(3),X(e.txnObjects),l(7),I("ngModel",e.selectedMembers),l(),X(e.members),l(6),I("ngModel",e.entry.reimburse),l(),m("value",1),l(3),m("value",2),l(3),m("value",0);}}function mr(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function sr(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function ur(t,c){if(t&1){let e=P();o(0,"div",49)(1,"div",51)(2,"div",52)(3,"mat-form-field",53)(4,"mat-label"),p(5,27),r(),o(6,"mat-select",76),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.accountId,n)||(a.entry.accountId=n),f(n);}),B(7,mr,2,2,"mat-option",55,G),r()()(),o(9,"div",52)(10,"mat-form-field",53)(11,"mat-label"),p(12,28),r(),o(13,"mat-select",77),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.targetId,n)||(a.entry.targetId=n),f(n);}),B(14,sr,2,2,"mat-option",55,G),r()()()()();}if(t&2){let e=S();l(6),I("ngModel",e.entry.accountId),m("forbiddenSame",e.entry.targetId),l(),X(e.accounts),l(6),I("ngModel",e.entry.targetId),m("forbiddenSame",e.entry.accountId),l(),X(e.accounts);}}function pr(t,c){t&1&&(s(0),p(1,30),u());}function Cr(t,c){t&1&&(s(0),p(1,31),u());}function Er(t,c){t&1&&(s(0),p(1,32),u());}function fr(t,c){t&1&&(s(0),p(1,33),u());}function gr(t,c){if(t&1&&(o(0,"mat-option",55),ue(1,pr,2,0,"ng-container")(2,Cr,2,0,"ng-container")(3,Er,2,0,"ng-container")(4,fr,2,0,"ng-container"),r()),t&2){let e,i=c.$implicit;m("value",i),l(),pe((e=i)===1?1:e===2?2:e===3?3:e===4?4:-1);}}function Sr(t,c){t&1&&(s(0),p(1,34),u());}function Ar(t,c){t&1&&(s(0),p(1,35),u());}function Tr(t,c){t&1&&(s(0),p(1,36),u());}function br(t,c){t&1&&(s(0),p(1,37),u());}function Ir(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function Mr(t,c){t&1&&(s(0),p(1,38),u());}function Nr(t,c){t&1&&(s(0),p(1,39),u());}function hr(t,c){t&1&&(s(0),p(1,40),u());}function Rr(t,c){t&1&&(s(0),p(1,41),u());}function yr(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.uuid),l(),h(" ",e.name," ");}}function Dr(t,c){if(t&1){let e=P();o(0,"div",49)(1,"div",51)(2,"div",52)(3,"mat-form-field",53)(4,"mat-label"),p(5,29),r(),o(6,"mat-select",78),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.lendType,n)||(a.entry.lendType=n),f(n);}),B(7,gr,5,2,"mat-option",55,G),r()()()(),o(9,"div",51)(10,"div",52)(11,"mat-form-field",53)(12,"mat-label"),ue(13,Sr,2,0,"ng-container")(14,Ar,2,0,"ng-container")(15,Tr,2,0,"ng-container")(16,br,2,0,"ng-container"),r(),o(17,"mat-select",79),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.accountId,n)||(a.entry.accountId=n),f(n);}),B(18,Ir,2,2,"mat-option",55,G),r()()(),o(20,"div",52)(21,"mat-form-field",53)(22,"mat-label"),ue(23,Mr,2,0,"ng-container")(24,Nr,2,0,"ng-container")(25,hr,2,0,"ng-container")(26,Rr,2,0,"ng-container"),r(),o(27,"mat-select",67),N("ngModelChange",function(n){E(e);let a=S();return M(a.entry.targetId,n)||(a.entry.targetId=n),f(n);}),B(28,yr,2,2,"mat-option",55,G),r()()()()();}if(t&2){let e,i,n=S();l(6),I("ngModel",n.entry.lendType),l(),X(n.loanTypes),l(6),pe((e=n.entry.lendType)===1?13:e===2?14:e===3?15:e===4?16:-1),l(4),I("ngModel",n.entry.accountId),l(),X(n.creditors),l(5),pe((i=n.entry.lendType)===1?23:i===2?24:i===3?25:i===4?26:-1),l(4),I("ngModel",n.entry.targetId),l(),X(n.accounts);}}function vr(t,c){if(t&1&&(o(0,"mat-option",55),C(1),r()),t&2){let e=c.$implicit;m("value",e.id),l(),h(" ",e.name," ");}}function Nn(){return Mn();}var hn=(()=>{class t{elementRef;route;dateAdapter;communication;notification;databaseService;operation;books=[];accounts=[];tags=[];members=[];payCategories=[];revenueCategories=[];txnObjects=[];creditors=[];loanTypes=[ne.BORROW,ne.LEND,ne.RECEIVE,ne.REPAYMENT];compareTagWith=(e,i)=>e?.tagId===i?.tagId;entry;selectedMembers;bizDatetime;isNew=!1;selectedTabIndex=0;saving=!1;accountId;entryForm;selects;getEntrySsp;subscription=new oe();constructor(e,i,n,a,d,_,D){this.elementRef=e,this.route=i,this.dateAdapter=n,this.communication=a,this.notification=d,this.databaseService=_,this.operation=D,this.entry=new tt(),this.entry.bizId=Nn(),this.entry.recType=$.PAY;}ngOnInit(){this.isNew=!this.route.snapshot.paramMap.get("accountId"),this.subscription.add(this.route.paramMap.subscribe(e=>{let i=e.get("entryId"),n=e.get("accountId");n?(this.accountId=n==="new"?void 0:n,this.entry.accountId=this.accountId,this.isNew=!0,this.bizDatetime=this.dateAdapter.today()):i&&(this.isNew=!1);}));}ngAfterViewInit(){this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.getBooks().pipe(Hn(100),ae(e=>(this.notification.hideLoading(),Xt(()=>e)))).subscribe(e=>{if(e&&e.data&&e.data.books[0]){let i=e.data.books[0],n=i.id;this.books=e.data.books,this.isNew?(this.entry.bkId=i.id,this.entry.bookId=i.uuid):n=jt(this.route.snapshot.paramMap.get("bookId")),ie([this.databaseService.getShortAccounts(),this.databaseService.getShortAccounts(-1),this.getAdditionalDatas(n)]).pipe(V(()=>{this.notification.hideLoading();})).subscribe(a=>{if(this.accounts=a[0].data.accounts,this.creditors=a[1].data.accounts,this.isNew)!this.entry.accountId&&this.accounts[0]&&(this.entry.accountId=this.accounts[0].uuid);else{let d=this.route.snapshot.paramMap.get("entryId");this.getCurrentEntry(n,d);}setTimeout(()=>{this.onSelectedTabChange({index:this.selectedTabIndex});});});}});}ngOnDestroy(){this.subscription.unsubscribe();}onSelectedTabChange(e){let i=this.entry,n=e.index+1,a;switch(i.recType=n,this.checkValuesWhetherExisted(),n){case $.PAY:a=this.payCategories[0];case $.REVENUE:if(a||(a=this.revenueCategories[0]),!i.accountId&&this.accountId){i.accountId=this.accountId;break;}!i.categoryId&&a&&(a.outgoSubTypes&&a.outgoSubTypes[0]?i.categoryId=a.outgoSubTypes[0].categoryId:i.categoryId=a.categoryId),!i.tags?.length&&this.tags&&this.tags.length&&(this.entry.tags=[this.tags[0]]),(!this.selectedMembers||!this.selectedMembers.length)&&this.members&&(this.selectedMembers=this.members.slice(0,1).map(d=>d.uuid));break;case $.TRANSFER:!i.accountId&&this.accountId&&(i.accountId=this.accountId),!i.targetId&&this.accounts[0]&&(i.targetId=this.accounts[0].uuid);break;default:typeof i.lendType>"u"&&(i.lendType=1),i.targetId||(i.targetId=this.accountId||(this.accounts[0]?this.accounts[0].uuid:void 0)),i.accountId||(i.accountId=this.creditors&&this.creditors[0]?this.creditors[0].uuid:void 0);break;}}onBookSelectionChange(e){let i=e.value;this.books&&this.books.some(n=>n.id===i?(this.entry.bookId=n.uuid,!0):!1),this.notification.showLoading(this.elementRef.nativeElement),this.getAdditionalDatas(i).pipe(V(()=>{this.notification.hideLoading,setTimeout(()=>{this.onSelectedTabChange({index:this.selectedTabIndex});});})).subscribe();}save(){this.update().subscribe(e=>{e&&this.cancel();});}saveAs(){let e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(let i in e)e[i].markAsTouched();this.entry.id=0,this.entry.bizId=Nn(),this.save();}saveAndNew(){let e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(let i in e)e[i].markAsTouched();this.update().subscribe(i=>{i&&(this.entry.id=0,this.entry.bizId=Nn());});}cancel(){this.operation.closeSecondaryOutlet(this.route.parent);}update(){if(this.checkValuesWhetherExisted(),this.entryForm&&this.entryForm.valid){let e=this.entry;switch(e.recType){case $.PAY:case $.REVENUE:e.targetId=void 0,e.profit=void 0,e.lendType=void 0,e.recSubtype=void 0,e.members=this.selectedMembers.map(i=>({memberId:i,amount:e.amount}));break;case $.TRANSFER:if(e.accountId===e.targetId)return;e.categoryId=void 0,e.tags=void 0,e.tradetgtId=void 0,e.profit=void 0,e.lendType=void 0,e.recSubtype=void 0,e.reimburse=0,e.targetAmount=e.amount,e.members=this.members.slice(0,1).map(i=>({memberId:i.uuid,amount:e.amount}));break;default:switch(e.categoryId=void 0,e.tags=void 0,e.tradetgtId=void 0,e.profit=0,e.reimburse=0,e.targetAmount=e.amount,e.lendType){case ne.LEND:case ne.REPAYMENT:e.recSubtype=1;break;default:e.recSubtype=0;}(e.lendType===ne.RECEIVE||e.lendType===ne.REPAYMENT)&&(e.recType=$.RETURN),e.members=[{amount:e.amount}];break;}return e.bizTime=this.dateAdapter.toIso8601(this.bizDatetime),typeof e.comment>"u"&&(e.comment=""),this.saving=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.saveEntry([e]).pipe(ae(()=>H(!1)),le(i=>!(typeof i!="boolean"&&i.error)),V(()=>{this.saving=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand();}));}return H(!1);}checkValuesWhetherExisted(){this.selects.forEach(e=>{if(e.options.length)if(e.multiple){if(e.value){let i=e.value.filter(n=>e.options.some(a=>a.value===n));e.ngControl.control.setValue(i);}}else e.options.some(i=>i.value===e.value)||e.ngControl.control.setValue(null);});}getCurrentEntry(e,i){this.getEntrySsp&&this.getEntrySsp.unsubscribe(),this.notification.showLoading(this.elementRef.nativeElement),this.getEntrySsp=this.databaseService.getEntry(e,i).pipe(Xn(n=>!n.error),V(()=>{this.getEntrySsp=void 0,this.notification.hideLoading();})).subscribe(n=>{let a=n.data;a.amount=a.amount/100,this.accountId=a.accountId,this.bizDatetime=this.dateAdapter.deserialize(a.bizTime),Array.isArray(a.members)?this.selectedMembers=this.members.filter(d=>a.members.some(_=>_.memberId===d.uuid)).map(d=>d.uuid):this.selectedMembers=this.members.slice(0,1).map(d=>d.uuid),a.recType===$.RETURN?a.lendType=a.recSubtype===0?ne.RECEIVE:ne.REPAYMENT:a.recType===$.BORROW&&(a.lendType=a.recSubtype===0?ne.BORROW:ne.LEND),this.entry=a,a.accountId&&!this.creditors.find(d=>d.uuid===a.accountId)&&this.creditors.push({uuid:a.accountId,name:a.accountName}),a.targetId&&!this.accounts.find(d=>d.uuid===a.targetId)&&this.accounts.push({uuid:a.targetId,name:a.targetName}),this.selectedTabIndex=(a.recType>5?4:a.recType)-1;});}getAdditionalDatas(e){return ie([this.databaseService.getTransactionObjects(e),this.databaseService.getBookProjects(e),this.databaseService.getMembers(e),this.databaseService.getEntryCategories(e,Qe.PAY),this.databaseService.getEntryCategories(e,Qe.REVENUE)]).pipe(V(()=>{this.notification.hideLoading();}),le(i=>{this.txnObjects=i[0].data.bookTradeTargets,this.tags=i[1].data.bookProjects.map(n=>({tagId:n.uuid,name:n.name})),this.members=i[2].data.bookMembers,this.payCategories=i[3].data.bookCategories,this.revenueCategories=i[4].data.bookCategories;}));}static ɵfac=function(i){return new(i||t)(g(Q),g(ce),g(be),g(ee),g(U),g(q),g(Ne));};static ɵcmp=j({type:t,selectors:[["app-add-or-edit-entry"]],viewQuery:function(i,n){if(i&1&&(he(Se,5),he($e,5)),i&2){let a;Re(a=ye())&&(n.entryForm=a.first),Re(a=ye())&&(n.selects=a);}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],standalone:!1,decls:63,vars:15,consts:()=>{let e;e="Pay";let i;i="Revenue";let n;n="Transfer";let a;a="Loan";let d;d="Account book";let _;_="Amount";let D;D="Time";let O;O="Comment";let k;k="Save";let L;L="Save as";let W;W="Save and new";let y;y="Cancel";let w;w="Account";let z;z="Category";let x;x="Tags";let Ze;Ze="Trader";let ht;ht="Member";let Rt;Rt="Reimburse";let yt;yt="To be reimbursed";let Dt;Dt="Reimbursed";let vt;vt="Non-reimbursable";let Ot;Ot="Account";let wt;wt="Category";let Pt;Pt="Tags";let xt;xt="Payer";let $t;$t="Member";let Lt;Lt="Reimburse";let kt;kt="To be reimbursed";let Wt;Wt="Reimbursed";let Vt;Vt="Non-reimbursable";let Gt;Gt="From account";let v;v="To account";let Rn;Rn="Category";let yn;yn="Borrow";let Dn;Dn="Lend";let vn;vn="Receive";let On;On="Repayment";let wn;wn="Creditor";let Pn;Pn="Debtor";let xn;xn="Debtor";let $n;$n="Creditor";let Ln;Ln="Borrow account";let kn;kn="Lend account";let Wn;Wn="Receive account";let Vn;return Vn="Repayment account",[["picker",""],d,_,D,O,k,L,W,y,w,z,x,Ze,ht,Rt,yt,Dt,vt,Ot,wt,Pt,xt,$t,Lt,kt,Wt,Vt,Gt,v,Rn,yn,Dn,vn,On,wn,Pn,xn,$n,Ln,kn,Wn,Vn,["name","entryForm",1,"d-flex","flex-column","flex-nowrap","flex-fill","overflow-hidden","pt-2",3,"ngSubmit"],["color","primary",3,"selectedIndexChange","selectedTabChange","selectedIndex"],["label",e],["label",i],["label",n],["label",a],[1,"flex-fill","overflow-auto"],[1,"container-fluid","pt-3"],[1,"container-fluid","pb-3"],[1,"row"],[1,"col","col-lg-6"],["appearance","outline"],["name","book","required","",3,"ngModelChange","selectionChange","ngModel"],[3,"value"],["name","amount","type","number","step","1","min","0.01","required","","matInput","",3,"ngModelChange","ngModel"],["name","bizDatetime","matInput","","required","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],["color","primary"],[1,"col"],["name","comment","matInput","",3,"ngModelChange","ngModel"],[1,"container-fluid","pt-3","pb-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2",3,"disabled"],["type","button","mat-flat-button","","color","primary",1,"me-2",3,"click","disabled"],["type","button","mat-flat-button","","color","accent",1,"me-2",3,"click","disabled"],["type","button","mat-stroked-button","","color","accent",1,"me-2",3,"click","disabled"],["name","account","required","",3,"ngModelChange","ngModel"],["name","payCategory","required","",3,"ngModelChange","ngModel"],[3,"label"],["name","tags","multiple","",3,"ngModelChange","compareWith","ngModel"],["name","txnObject",3,"ngModelChange","ngModel"],["value",""],["name","member","multiple","","required","",3,"ngModelChange","ngModel"],["name","reimburse",3,"ngModelChange","ngModel"],["name","revenueCategory","required","",3,"ngModelChange","ngModel"],["name","account","required","",3,"ngModelChange","ngModel","forbiddenSame"],["name","transferObject","required","",3,"ngModelChange","ngModel","forbiddenSame"],["name","lendType","required","",3,"ngModelChange","ngModel"],["name","creditor","required","",3,"ngModelChange","ngModel"]];},template:function(i,n){if(i&1){let a=P();o(0,"form",42),R("ngSubmit",function(){return E(a),f(n.save());}),o(1,"mat-tab-group",43),N("selectedIndexChange",function(_){return E(a),M(n.selectedTabIndex,_)||(n.selectedTabIndex=_),f(_);}),R("selectedTabChange",function(_){return E(a),f(n.onSelectedTabChange(_));}),T(2,"mat-tab",44)(3,"mat-tab",45)(4,"mat-tab",46)(5,"mat-tab",47),r(),o(6,"div",48),ue(7,ar,55,10,"div",49),ue(8,dr,57,10,"div",49),ue(9,ur,16,4,"div",49),ue(10,Dr,30,5,"div",49),o(11,"div",50)(12,"div",51)(13,"div",52)(14,"mat-form-field",53)(15,"mat-label"),p(16,1),r(),o(17,"mat-select",54),N("ngModelChange",function(_){return E(a),M(n.entry.bkId,_)||(n.entry.bkId=_),f(_);}),R("selectionChange",function(_){return E(a),f(n.onBookSelectionChange(_));}),B(18,vr,2,2,"mat-option",55,G),r()()()(),o(20,"div",51)(21,"div",52)(22,"mat-form-field",53)(23,"mat-label"),p(24,2),r(),o(25,"input",56),N("ngModelChange",function(_){return E(a),M(n.entry.amount,_)||(n.entry.amount=_),f(_);}),r()()(),o(26,"div",52)(27,"mat-form-field",53)(28,"mat-label"),p(29,3),r(),o(30,"input",57),N("ngModelChange",function(_){return E(a),M(n.bizDatetime,_)||(n.bizDatetime=_),f(_);}),r(),T(31,"mat-datepicker-toggle",58),o(32,"mat-datepicker",59,0)(34,"mat-datepicker-actions"),T(35,"mat-timepicker"),r()()()()(),o(36,"div",51)(37,"div",60)(38,"mat-form-field",53)(39,"mat-label"),p(40,4),r(),o(41,"textarea",61),N("ngModelChange",function(_){return E(a),M(n.entry.comment,_)||(n.entry.comment=_),f(_);}),r()()()()()(),o(42,"div",62)(43,"button",63)(44,"mat-icon"),C(45,"save"),r(),s(46),p(47,5),u(),r(),o(48,"button",64),R("click",function(){return E(a),f(n.saveAs());}),o(49,"mat-icon"),C(50,"file_copy"),r(),s(51),p(52,6),u(),r(),o(53,"button",65),R("click",function(){return E(a),f(n.saveAndNew());}),o(54,"mat-icon"),C(55,"post_add"),r(),s(56),p(57,7),u(),r(),o(58,"button",66),R("click",function(){return E(a),f(n.cancel());}),o(59,"mat-icon"),C(60,"cancel"),r(),s(61),p(62,8),u(),r()()();}if(i&2){let a=de(33);l(),I("selectedIndex",n.selectedTabIndex),l(6),pe(n.selectedTabIndex===0?7:-1),l(),pe(n.selectedTabIndex===1?8:-1),l(),pe(n.selectedTabIndex===2?9:-1),l(),pe(n.selectedTabIndex===3?10:-1),l(7),I("ngModel",n.entry.bkId),l(),X(n.books),l(7),I("ngModel",n.entry.amount),l(5),m("matDatepicker",a),I("ngModel",n.bizDatetime),l(),m("for",a),l(10),I("ngModel",n.entry.comment),l(2),m("disabled",n.saving),l(5),m("disabled",n.saving||n.isNew),l(5),m("disabled",n.saving),l(5),m("disabled",n.saving);}},dependencies:[_t,Ee,dt,fe,ge,Ft,si,ve,Se,xe,qt,Kt,Ie,Ci,Te,Ae,we,J,gt,$e,ut,ui,Zt,Jt,en],styles:[".mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}"]});}return t;})();var Hi=(()=>{class t{elementRef;router;route;dateAdapter;communication;notification;databaseService;operation;entry;bizDatetime;selectedTabIndex=0;saving=!1;entryForm;subscription=new oe();constructor(e,i,n,a,d,_,D,O){this.elementRef=e,this.router=i,this.route=n,this.dateAdapter=a,this.communication=d,this.notification=_,this.databaseService=D,this.operation=O,this.router.getCurrentNavigation()?(this.entry=this.router.getCurrentNavigation().extras.state,this.entry?(this.entry.amount=this.entry.accountBalance,this.bizDatetime=this.dateAdapter.deserialize(this.entry.bizTime)):this.entry=new tt()):this.entry=new tt();}ngOnInit(){}ngOnDestroy(){this.subscription.unsubscribe();}save(){this.update().subscribe(e=>{e&&this.cancel();});}saveAndNew(){let e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(let i in e)e[i].markAsTouched();this.update().subscribe(i=>{i&&(this.entry.id=0);});}cancel(){this.operation.closeSecondaryOutlet(this.route.parent);}update(){if(this.entryForm&&this.entryForm.valid){let e=this.entry;return e.bizTime=this.bizDatetime.toISOString(),typeof e.comment>"u"&&(e.comment=""),this.saving=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.saveEntry([e]).pipe(ae(()=>H(!1)),le(i=>!(typeof i!="boolean"&&i.error)),V(()=>{this.saving=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand();}));}return H(!1);}static ɵfac=function(i){return new(i||t)(g(Q),g(Oe),g(ce),g(be),g(ee),g(U),g(q),g(Ne));};static ɵcmp=j({type:t,selectors:[["app-balance-modifier"]],viewQuery:function(i,n){if(i&1&&he(Se,5),i&2){let a;Re(a=ye())&&(n.entryForm=a.first);}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],standalone:!1,decls:31,vars:6,consts:()=>{let e;e="Balance modification";let i;i="Amount";let n;n="Time";let a;a="Save";let d;return d="Cancel",[["picker",""],i,n,a,d,["name","entryForm",1,"d-flex","flex-column","flex-nowrap","flex-fill","overflow-hidden",3,"ngSubmit"],["color","primary"],["label",e],[1,"flex-fill","overflow-auto"],[1,"container-fluid","py-3"],[1,"row"],[1,"col","col-lg-6"],["appearance","fill"],["name","amount","type","number","step","1","required","","matInput","",3,"ngModelChange","ngModel"],["name","bizDatetime","matInput","","required","",3,"ngModelChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],[1,"container-fluid","pt-3","pb-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2",3,"disabled"],["type","button","mat-flat-button","","color","warn",1,"me-2",3,"click","disabled"]];},template:function(i,n){if(i&1){let a=P();o(0,"form",5),R("ngSubmit",function(){return E(a),f(n.save());}),o(1,"mat-tab-group",6),T(2,"mat-tab",7),r(),o(3,"div",8)(4,"div",9)(5,"div",10)(6,"div",11)(7,"mat-form-field",12)(8,"mat-label"),p(9,1),r(),o(10,"input",13),N("ngModelChange",function(_){return E(a),M(n.entry.amount,_)||(n.entry.amount=_),f(_);}),r()()(),o(11,"div",11)(12,"mat-form-field",12)(13,"mat-label"),p(14,2),r(),o(15,"input",14),N("ngModelChange",function(_){return E(a),M(n.bizDatetime,_)||(n.bizDatetime=_),f(_);}),r(),T(16,"mat-datepicker-toggle",15),o(17,"mat-datepicker",6,0),T(19,"mat-timepicker"),r()()()()()(),o(20,"div",16)(21,"button",17)(22,"mat-icon"),C(23,"save"),r(),s(24),p(25,3),u(),r(),o(26,"button",18),R("click",function(){return E(a),f(n.cancel());}),o(27,"mat-icon"),C(28,"cancel"),r(),s(29),p(30,4),u(),r()()();}if(i&2){let a=de(18);l(10),I("ngModel",n.entry.amount),l(5),m("matDatepicker",a),I("ngModel",n.bizDatetime),l(),m("for",a),l(5),m("disabled",n.saving),l(5),m("disabled",n.saving);}},dependencies:[_t,Ee,dt,fe,ge,Ft,ve,Se,xe,qt,Kt,Ie,Te,Ae,we,J,gt,Zt,Jt,en],styles:[".mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}"]});}return t;})();var Or=[{path:"dashboard",component:ki},{path:"accounts",component:Sn},{path:"members",component:An},{path:"search",component:Gi},{path:"accounts",component:Sn},{path:"accounts/:accountId",component:Bi},{path:"entry/add/:accountId",outlet:"secondary",component:hn},{path:"entry/:bookId/:entryId",outlet:"secondary",component:hn},{path:"balance/:entryId",outlet:"secondary",component:Hi},{path:"members",component:An}],Yi=(()=>{class t{static ɵfac=function(i){return new(i||t)();};static ɵmod=it({type:t});static ɵinj=nt({imports:[sn.forChild(Or),sn]});}return t;})();var zi=(()=>{class t{notification;constructor(e){this.notification=e;}intercept(e,i){let n=Date.now(),a;return i.handle(e).pipe(zn({next:d=>{d instanceof li&&d.body?.error&&this.notification.openError(d.body.error);}}));}static ɵfac=function(i){return new(i||t)(se(U));};static ɵprov=me({token:t,factory:t.ɵfac});}return t;})();var Gl=(()=>{class t{static ɵfac=function(i){return new(i||t)();};static ɵmod=it({type:t});static ɵinj=nt({providers:[{provide:ii,useValue:"CNY"},{provide:_i,useClass:zi,multi:!0},Mt,zt,q,Ne,Ve,on,di(mi())],imports:[Ri,ci,Mi,Oi,Ai,bi,Ti,Ii,gi,fi,Yi]});}return t;})();export{Gl as WacaiModule};/**i18n:4e954d11e025817f1aceae10dbbd8d111274144b3c3dbbdb81deac1f9b9c7958*/