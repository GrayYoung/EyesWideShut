"use strict";(self.webpackChunkbank=self.webpackChunkbank||[]).push([[177],{1177:(Qi,_e,g)=>{g.r(_e),g.d(_e,{WacaiModule:()=>Gi});var c=g(1180),t=g(2223),y=g(4755),Jt=g(3144),Xt=g(5308),Q=g(1217);const nn=["*"],sn=new t.OlP("MAT_CARD_CONFIG");let le=(()=>{class n{constructor(e){this.appearance=e?.appearance||"raised"}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(sn,8))},n.\u0275cmp=t.Xpm({type:n,selectors:[["mat-card"]],hostAttrs:[1,"mat-mdc-card","mdc-card"],hostVars:4,hostBindings:function(e,a){2&e&&t.ekj("mat-mdc-card-outlined","outlined"===a.appearance)("mdc-card--outlined","outlined"===a.appearance)},inputs:{appearance:"appearance"},exportAs:["matCard"],ngContentSelectors:nn,decls:1,vars:0,template:function(e,a){1&e&&(t.F$t(),t.Hsn(0))},styles:['.mdc-card{display:flex;flex-direction:column;box-sizing:border-box}.mdc-card::after{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none;pointer-events:none}@media screen and (forced-colors: active){.mdc-card::after{border-color:CanvasText}}.mdc-card--outlined::after{border:none}.mdc-card__content{border-radius:inherit;height:100%}.mdc-card__media{position:relative;box-sizing:border-box;background-repeat:no-repeat;background-position:center;background-size:cover}.mdc-card__media::before{display:block;content:""}.mdc-card__media:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__media:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mdc-card__media--square::before{margin-top:100%}.mdc-card__media--16-9::before{margin-top:56.25%}.mdc-card__media-content{position:absolute;top:0;right:0;bottom:0;left:0;box-sizing:border-box}.mdc-card__primary-action{display:flex;flex-direction:column;box-sizing:border-box;position:relative;outline:none;color:inherit;text-decoration:none;cursor:pointer;overflow:hidden}.mdc-card__primary-action:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__primary-action:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mdc-card__actions{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;min-height:52px;padding:8px}.mdc-card__actions--full-bleed{padding:0}.mdc-card__action-buttons,.mdc-card__action-icons{display:flex;flex-direction:row;align-items:center;box-sizing:border-box}.mdc-card__action-icons{color:rgba(0, 0, 0, 0.6);flex-grow:1;justify-content:flex-end}.mdc-card__action-buttons+.mdc-card__action-icons{margin-left:16px;margin-right:0}[dir=rtl] .mdc-card__action-buttons+.mdc-card__action-icons,.mdc-card__action-buttons+.mdc-card__action-icons[dir=rtl]{margin-left:0;margin-right:16px}.mdc-card__action{display:inline-flex;flex-direction:row;align-items:center;box-sizing:border-box;justify-content:center;cursor:pointer;user-select:none}.mdc-card__action:focus{outline:none}.mdc-card__action--button{margin-left:0;margin-right:8px;padding:0 8px}[dir=rtl] .mdc-card__action--button,.mdc-card__action--button[dir=rtl]{margin-left:8px;margin-right:0}.mdc-card__action--button:last-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-card__action--button:last-child,.mdc-card__action--button:last-child[dir=rtl]{margin-left:0;margin-right:0}.mdc-card__actions--full-bleed .mdc-card__action--button{justify-content:space-between;width:100%;height:auto;max-height:none;margin:0;padding:8px 16px;text-align:left}[dir=rtl] .mdc-card__actions--full-bleed .mdc-card__action--button,.mdc-card__actions--full-bleed .mdc-card__action--button[dir=rtl]{text-align:right}.mdc-card__action--icon{margin:-6px 0;padding:12px}.mdc-card__action--icon:not(:disabled){color:rgba(0, 0, 0, 0.6)}.mat-mdc-card{border-radius:var(--mdc-elevated-card-container-shape);background-color:var(--mdc-elevated-card-container-color);border-width:0;border-style:solid;border-color:var(--mdc-elevated-card-container-color);box-shadow:var(--mdc-elevated-card-container-elevation);--mdc-elevated-card-container-shape:4px;--mdc-outlined-card-container-shape:4px;--mdc-outlined-card-outline-width:1px}.mat-mdc-card .mdc-card::after{border-radius:var(--mdc-elevated-card-container-shape)}.mat-mdc-card-outlined{border-width:var(--mdc-outlined-card-outline-width);border-style:solid;border-color:var(--mdc-outlined-card-outline-color);border-radius:var(--mdc-outlined-card-container-shape);background-color:var(--mdc-outlined-card-container-color);box-shadow:var(--mdc-outlined-card-container-elevation)}.mat-mdc-card-outlined .mdc-card::after{border-radius:var(--mdc-outlined-card-container-shape)}.mat-mdc-card-title{font-family:var(--mat-card-title-text-font);line-height:var(--mat-card-title-text-line-height);font-size:var(--mat-card-title-text-size);letter-spacing:var(--mat-card-title-text-tracking);font-weight:var(--mat-card-title-text-weight)}.mat-mdc-card-subtitle{color:var(--mat-card-subtitle-text-color);font-family:var(--mat-card-subtitle-text-font);line-height:var(--mat-card-subtitle-text-line-height);font-size:var(--mat-card-subtitle-text-size);letter-spacing:var(--mat-card-subtitle-text-tracking);font-weight:var(--mat-card-subtitle-text-weight)}.mat-mdc-card{position:relative}.mat-mdc-card-title,.mat-mdc-card-subtitle{display:block;margin:0}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle{padding:16px 16px 0}.mat-mdc-card-header{display:flex;padding:16px 16px 0}.mat-mdc-card-content{display:block;padding:0 16px}.mat-mdc-card-content:first-child{padding-top:16px}.mat-mdc-card-content:last-child{padding-bottom:16px}.mat-mdc-card-title-group{display:flex;justify-content:space-between;width:100%}.mat-mdc-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;margin-bottom:16px;object-fit:cover}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title{line-height:normal}.mat-mdc-card-sm-image{width:80px;height:80px}.mat-mdc-card-md-image{width:112px;height:112px}.mat-mdc-card-lg-image{width:152px;height:152px}.mat-mdc-card-xl-image{width:240px;height:240px}.mat-mdc-card-subtitle~.mat-mdc-card-title,.mat-mdc-card-title~.mat-mdc-card-subtitle,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-title-group .mat-mdc-card-title,.mat-mdc-card-title-group .mat-mdc-card-subtitle{padding-top:0}.mat-mdc-card-content>:last-child:not(.mat-mdc-card-footer){margin-bottom:0}.mat-mdc-card-actions-align-end{justify-content:flex-end}'],encapsulation:2,changeDetection:0}),n})(),de=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=t.lG2({type:n,selectors:[["mat-card-content"]],hostAttrs:[1,"mat-mdc-card-content"]}),n})(),dn=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[Q.BQ,y.ez,Q.BQ]}),n})();var un=g(2611),ht=g(3276),R=g(3627),Mt=g(3617),mn=g(2947),gn=g(9982),pn=g(2497),W=g(3116),T=g(9401),ft=g(727),P=g(9646),rt=g(4128),ct=g(8372),hn=g(8675),Wt=g(3900),Y=g(8746),z=g(262),H=g(4004),J=(()=>((J=J||{})[J.REVENUE=2]="REVENUE",J[J.PAY=3]="PAY",J))(),I=(()=>((I=I||{})[I.PAY=1]="PAY",I[I.REVENUE=2]="REVENUE",I[I.TRANSFER=3]="TRANSFER",I[I.BORROW=4]="BORROW",I[I.RETURN=5]="RETURN",I))(),D=(()=>((D=D||{})[D.BORROW=1]="BORROW",D[D.LEND=2]="LEND",D[D.RECEIVE=3]="RECEIVE",D[D.REPAYMENT=4]="REPAYMENT",D))(),st=g(155),At=g(1357),Ut=g(2140),xt=g(4242);let _t=(()=>{class n{constructor(e){(0,c.Z)(this,"requestService",void 0),(0,c.Z)(this,"books",void 0),this.requestService=e}getBooks(){return this.books?(0,P.of)({code:null,error:null,data:{books:this.books}}):this.requestService.get("activity/bkk-frontier/api/v2/book/web/query").pipe((0,H.U)(e=>(e&&e.data&&e.data.books&&(this.books=e.data.books),e)))}getAccountTypeList(){return this.requestService.get("setting/account_allAccountTypes.action",{timesamp:Date.now()})}getAccountList(e=!0,a=!1,i=!0){return this.requestService.get("setting/account_list.action",{timesamp:Date.now(),hidden:e,reqBalance:a,loanFlag:i})}getVisibleAccountList(){return this.requestService.post("activity/bkk-frontier/api/account/index",{localTime:Date.now(),timeZoneId:this.requestService.TIME_ZONE_ID,useCompleteSort:!0})}getHiddenAccountList(){return this.requestService.post("activity/bkk-frontier/api/account/hiddenList",{localTime:Date.now(),timeZoneId:this.requestService.TIME_ZONE_ID,useCompleteSort:!0})}getShortAccounts(e=1){return this.requestService.get("activity/bkk-frontier/api/account/web/query",{accountOption:e})}getEntryCategories(e,a){return this.requestService.get("activity/bkk-frontier/api/v2/category/web/query",{bkId:e,categoryType:a})}getTransactionObjects(e){return this.requestService.get("activity/bkk-frontier/api/v2/trade/target/web/query",{bkId:e})}getBookProjects(e){return this.requestService.get("activity/bkk-frontier/api/v2/project/web/query",{bkId:e})}getMembers(e){return this.requestService.get("activity/bkk-frontier/api/v2/book/member/web/query",{bkId:e})}queryEntries(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/list/web",e)}getEntries(e,a,i){const r={accountId:e,startDate:a.valueOf(),endDate:i.valueOf(),timeZoneId:this.requestService.TIME_ZONE_ID,localTime:Date.now()};return this.requestService.post("activity/bkk-frontier/api/account/detail/flow",r)}getEntry(e,a){return this.requestService.get("activity/bkk-frontier/api/v2/flow/query/web/"+e+"/"+a)}saveEntry(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/save",{flows:e})}deleteEntries(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/batch/delete",{flowIds:e})}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.LFG(xt.s))}),(0,c.Z)(n,"\u0275prov",t.Yz7({token:n,factory:n.\u0275fac})),n})(),ue=(()=>{class n{constructor(e){(0,c.Z)(this,"requestService",void 0),this.requestService=e}getCategoryStatistics(e,a,i,r=1){return this.requestService.post("activity/bkk-frontier/api/v2/report/chartStat",{bkId:e,startTime:a.valueOf(),endTime:i.valueOf(),statNo:r})}getRevenueNExpenditureStatistics(e,a,i,r=11){return this.requestService.post("activity/bkk-frontier/api/v2/report/monthStat",{bkId:e,startTime:a.valueOf(),endTime:i.valueOf(),statNo:r})}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.LFG(xt.s))}),(0,c.Z)(n,"\u0275prov",t.Yz7({token:n,factory:n.\u0275fac})),n})();var w=g(1692),b=g(2516),fn=g(8186),En=g(2855),Cn=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(function An(n){for(var o=n.length/6|0,e=new Array(o),a=0;a<o;)e[a]="#"+n.slice(6*a,6*++a);return e});const Sn=(0,En.hD)((n=Cn)[n.length-1]);var n,me,bn=g(961),Nn=g(3489),Ot=g(3179),zt=g(8415),Et=g(714),Mn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Zt(n){if(!(o=Mn.exec(n)))throw new Error("invalid format: "+n);var o;return new Ht({fill:o[1],align:o[2],sign:o[3],symbol:o[4],zero:o[5],width:o[6],comma:o[7],precision:o[8]&&o[8].slice(1),trim:o[9],type:o[10]})}function Ht(n){this.fill=void 0===n.fill?" ":n.fill+"",this.align=void 0===n.align?">":n.align+"",this.sign=void 0===n.sign?"-":n.sign+"",this.symbol=void 0===n.symbol?"":n.symbol+"",this.zero=!!n.zero,this.width=void 0===n.width?void 0:+n.width,this.comma=!!n.comma,this.precision=void 0===n.precision?void 0:+n.precision,this.trim=!!n.trim,this.type=void 0===n.type?"":n.type+""}function Pt(n,o){if((e=(n=o?n.toExponential(o-1):n.toExponential()).indexOf("e"))<0)return null;var e,a=n.slice(0,e);return[a.length>1?a[0]+a.slice(2):a,+n.slice(e+1)]}function Tt(n){return(n=Pt(Math.abs(n)))?n[1]:NaN}function ge(n,o){var e=Pt(n,o);if(!e)return n+"";var a=e[0],i=e[1];return i<0?"0."+new Array(-i).join("0")+a:a.length>i+1?a.slice(0,i+1)+"."+a.slice(i+1):a+new Array(i-a.length+2).join("0")}Zt.prototype=Ht.prototype,Ht.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const pe={"%":(n,o)=>(100*n).toFixed(o),b:n=>Math.round(n).toString(2),c:n=>n+"",d:function Rn(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)},e:(n,o)=>n.toExponential(o),f:(n,o)=>n.toFixed(o),g:(n,o)=>n.toPrecision(o),o:n=>Math.round(n).toString(8),p:(n,o)=>ge(100*n,o),r:ge,s:function xn(n,o){var e=Pt(n,o);if(!e)return n+"";var a=e[0],i=e[1],r=i-(me=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=a.length;return r===s?a:r>s?a+new Array(r-s+1).join("0"):r>0?a.slice(0,r)+"."+a.slice(r):"0."+new Array(1-r).join("0")+Pt(n,Math.max(0,o+r-1))[0]},X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function he(n){return n}var wt,Ee,Te,fe=Array.prototype.map,Ae=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function Ce(n){var o=n.domain;return n.ticks=function(e){var a=o();return(0,Et.ZP)(a[0],a[a.length-1],e??10)},n.tickFormat=function(e,a){var i=o();return function $n(n,o,e,a){var r,i=(0,Et.ly)(n,o,e);switch((a=Zt(a??",f")).type){case"s":var s=Math.max(Math.abs(n),Math.abs(o));return null==a.precision&&!isNaN(r=function In(n,o){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Tt(o)/3)))-Tt(Math.abs(n)))}(i,s))&&(a.precision=r),Te(a,s);case"":case"e":case"g":case"p":case"r":null==a.precision&&!isNaN(r=function Pn(n,o){return n=Math.abs(n),o=Math.abs(o)-n,Math.max(0,Tt(o)-Tt(n))+1}(i,Math.max(Math.abs(n),Math.abs(o))))&&(a.precision=r-("e"===a.type));break;case"f":case"%":null==a.precision&&!isNaN(r=function wn(n){return Math.max(0,-Tt(Math.abs(n)))}(i))&&(a.precision=r-2*("%"===a.type))}return Ee(a)}(i[0],i[i.length-1],e??10,a)},n.nice=function(e){null==e&&(e=10);var d,u,a=o(),i=0,r=a.length-1,s=a[i],_=a[r],f=10;for(_<s&&(u=s,s=_,_=u,u=i,i=r,r=u);f-- >0;){if((u=(0,Et.G9)(s,_,e))===d)return a[i]=s,a[r]=_,o(a);if(u>0)s=Math.floor(s/u)*u,_=Math.ceil(_/u)*u;else{if(!(u<0))break;s=Math.ceil(s*u)/u,_=Math.floor(_*u)/u}d=u}return n},n}function qt(){var n=(0,Ot.ZP)();return n.copy=function(){return(0,Ot.JG)(n,qt())},zt.o.apply(n,arguments),Ce(n)}!function Zn(n){wt=function On(n){var o=void 0===n.grouping||void 0===n.thousands?he:function yn(n,o){return function(e,a){for(var i=e.length,r=[],s=0,_=n[0],d=0;i>0&&_>0&&(d+_+1>a&&(_=Math.max(1,a-d)),r.push(e.substring(i-=_,i+_)),!((d+=_+1)>a));)_=n[s=(s+1)%n.length];return r.reverse().join(o)}}(fe.call(n.grouping,Number),n.thousands+""),e=void 0===n.currency?"":n.currency[0]+"",a=void 0===n.currency?"":n.currency[1]+"",i=void 0===n.decimal?".":n.decimal+"",r=void 0===n.numerals?he:function Dn(n){return function(o){return o.replace(/[0-9]/g,function(e){return n[+e]})}}(fe.call(n.numerals,String)),s=void 0===n.percent?"%":n.percent+"",_=void 0===n.minus?"\u2212":n.minus+"",d=void 0===n.nan?"NaN":n.nan+"";function u(l){var p=(l=Zt(l)).fill,A=l.align,E=l.sign,h=l.symbol,m=l.zero,S=l.width,X=l.comma,k=l.precision,nt=l.trim,x=l.type;"n"===x?(X=!0,x="g"):pe[x]||(void 0===k&&(k=12),nt=!0,x="g"),(m||"0"===p&&"="===A)&&(m=!0,p="0",A="=");var dt="$"===h?e:"#"===h&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",ut="$"===h?a:/[%p]/.test(x)?s:"",at=pe[x],mt=/[defgprs%]/.test(x);function ot(N){var B,it,M,L=dt,O=ut;if("c"===x)O=at(N)+O,N="";else{var gt=(N=+N)<0||1/N<0;if(N=isNaN(N)?d:at(Math.abs(N),k),nt&&(N=function vn(n){t:for(var i,o=n.length,e=1,a=-1;e<o;++e)switch(n[e]){case".":a=i=e;break;case"0":0===a&&(a=e),i=e;break;default:if(!+n[e])break t;a>0&&(a=0)}return a>0?n.slice(0,a)+n.slice(i+1):n}(N)),gt&&0==+N&&"+"!==E&&(gt=!1),L=(gt?"("===E?E:_:"-"===E||"("===E?"":E)+L,O=("s"===x?Ae[8+me/3]:"")+O+(gt&&"("===E?")":""),mt)for(B=-1,it=N.length;++B<it;)if(48>(M=N.charCodeAt(B))||M>57){O=(46===M?i+N.slice(B+1):N.slice(B))+O,N=N.slice(0,B);break}}X&&!m&&(N=o(N,1/0));var pt=L.length+N.length+O.length,G=pt<S?new Array(S-pt+1).join(p):"";switch(X&&m&&(N=o(G+N,G.length?S-O.length:1/0),G=""),A){case"<":N=L+N+O+G;break;case"=":N=L+G+N+O;break;case"^":N=G.slice(0,pt=G.length>>1)+L+N+O+G.slice(pt);break;default:N=G+L+N+O}return r(N)}return k=void 0===k?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,k)):Math.max(0,Math.min(20,k)),ot.toString=function(){return l+""},ot}return{format:u,formatPrefix:function f(l,p){var A=u(((l=Zt(l)).type="f",l)),E=3*Math.max(-8,Math.min(8,Math.floor(Tt(p)/3))),h=Math.pow(10,-E),m=Ae[8+E/3];return function(S){return A(h*S)+m}}}}(n),Ee=wt.format,Te=wt.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});var Ft=g(8448);const Ct=(Symbol(),{"font-family":"Google Sans","font-size":14}),St=new t.OlP("Default chart options"),Ln={padding:{top:10,right:0,bottom:30,left:80},layout:"grouped",delay:20,maxBandWidth:100,valueFun:n=>n,colors:["#a6aaad","#11a3dc","#5e92a8","#10536d","#012345"],palette:function Se(){var n=Ce(function $t(){var e,a,i,r,d,n=0,o=1,s=Ot.yR,_=!1;function u(l){return null==l||isNaN(l=+l)?d:s(0===i?.5:(l=(r(l)-e)*i,_?Math.max(0,Math.min(1,l)):l))}function f(l){return function(p){var A,E;return arguments.length?([A,E]=p,s=l(A,E),u):[s(0),s(1)]}}return u.domain=function(l){return arguments.length?([n,o]=l,e=r(n=+n),a=r(o=+o),i=e===a?0:1/(a-e),u):[n,o]},u.clamp=function(l){return arguments.length?(_=!!l,u):_},u.interpolator=function(l){return arguments.length?(s=l,u):s},u.range=f(bn.Z),u.rangeRound=f(Nn.Z),u.unknown=function(l){return arguments.length?(d=l,u):d},function(l){return r=l,e=l(n),a=l(o),i=e===a?0:1/(a-e),u}}()(Ot.yR));return n.copy=function(){return function Yt(n,o){return o.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}(n,Se())},zt.O.apply(n,arguments)}(Sn),xAxis:{type:"string",clipped:!0,font:Ct,minZoom:1,maxZoom:10,padding:10,position:"bottom"},yAxis:{clipped:!1,font:Ct,minZoom:1,maxZoom:1,padding:10,position:"left"}},Bn=(qt([],[]).interpolate(fn.q),(0,Ft.Z)(),{padding:{top:10,right:10,bottom:10,left:10},delay:20,font:{"pointer-events":"none","text-anchor":"middle","font-size":10,"fill-opacity":.9},title:{font:{dy:"0.35em"}},palette:(0,Ft.Z)([],[])});var Me=g(2555),Gn=g(8930),Qn=g(4709),Jn=g(2966),Xn=g(8023),jt=g(3649),Wn=g(9751),Un=g(7579),kt=g(9300),Re=g(7489),Ie=g(3511),Hn=g(3698),ye=g(8169),Lt=g(29),qn=g(9338),Fn=g(1351);function Vt(){var r,s,n=(0,Ft.Z)().unknown(void 0),o=n.domain,e=n.range,a=0,i=1,_=!1,d=0,u=0,f=.5;function l(){var p=o().length,A=i<a,E=A?i:a,h=A?a:i;r=(h-E)/Math.max(1,p-d+2*u),_&&(r=Math.floor(r)),E+=(h-E-r*(p-d))*f,s=r*(1-d),_&&(E=Math.round(E),s=Math.round(s));var m=(0,Ie.Z)(p).map(function(S){return E+r*S});return e(A?m.reverse():m)}return delete n.unknown,n.domain=function(p){return arguments.length?(o(p),l()):o()},n.range=function(p){return arguments.length?([a,i]=p,a=+a,i=+i,l()):[a,i]},n.rangeRound=function(p){return[a,i]=p,a=+a,i=+i,_=!0,l()},n.bandwidth=function(){return s},n.step=function(){return r},n.round=function(p){return arguments.length?(_=!!p,l()):_},n.padding=function(p){return arguments.length?(d=Math.min(1,u=+p),l()):d},n.paddingInner=function(p){return arguments.length?(d=Math.min(1,p),l()):d},n.paddingOuter=function(p){return arguments.length?(u=+p,l()):u},n.align=function(p){return arguments.length?(f=Math.max(0,Math.min(1,p)),l()):f},n.copy=function(){return Vt(o(),[a,i]).round(_).paddingInner(d).paddingOuter(u).align(f)},zt.o.apply(l(),arguments)}var jn=g(4659),ve=g(711),Rt=g(8791),Vn=g(1426),q=g(7524),F=g(3409),K=g(9388),tt=g(3573),xe=g(4558),bt=g(682),Kt=g(2526),Kn=g(821);const j=1e3,V=60*j,et=60*V,U=24*et,It=30*U,te=365*U,yt=[[q.E,1,j],[q.E,2,2*j],[q.E,3,3*j],[q.E,4,4*j],[q.E,5,5*j],[q.E,10,10*j],[q.E,15,15*j],[q.E,30,30*j],[F.Z_,1,V],[F.Z_,2,2*V],[F.Z_,3,3*V],[F.Z_,4,4*V],[F.Z_,5,5*V],[F.Z_,10,10*V],[F.Z_,15,15*V],[F.Z_,30,30*V],[K.WQ,1,et],[K.WQ,2,2*et],[K.WQ,3,3*et],[K.WQ,4,4*et],[K.WQ,6,6*et],[K.WQ,8,8*et],[K.WQ,12,12*et],[tt.rr,1,U],[tt.rr,2,2*U],[tt.rr,3,3*U],[tt.rr,4,4*U],[tt.rr,5,5*U],[tt.rr,6,6*U],[tt.rr,10,10*U],[xe.Zy,1,6048e5],[bt.F0,1,It],[bt.F0,2,2*It],[bt.F0,3,3*It],[bt.F0,4,4*It],[bt.F0,6,6*It],[Kt.jB,1,te]],Oe=n=>{let o;switch(n){case"second":o=q.E;break;case"minute":o=F.Z_;break;case"hour":o=K.WQ;break;case"day":o=tt.rr;break;case"week":o=xe.Zy;break;case"month":o=bt.F0;break;case"year":o=Kt.jB;break;default:o=Kn.A}return o},Ze=(n,o,e)=>{const a=Oe(e);return Math.max(1,a.count(n,o))};var ee=g(5441);let na=0;const Dt=(n,o,e)=>{const a=n.invertX(o[0][0])-e[0][0],i=n.invertX(o[1][0])-e[1][0],r=n.invertY(o[0][1])-e[0][1],s=n.invertY(o[1][1])-e[1][1];return n.translate(i>a?a:Math.min(0,a)||Math.max(0,i),s>r?r:Math.min(0,r)||Math.max(0,s))};let Pe=(()=>{class n{set options(e){this.chartOptions=(0,Re.merge)({},this.injector.get(St),e)}get options(){return this.chartOptions}set xTransform(e){const a=this.xZoom;e&&(e=new Rt.ax(Math.min(a.scaleExtent()[1],Math.max(a.scaleExtent()[0],e.k)),e.x,e.y),e=Dt(e,a.extent()(),a.translateExtent())),this._xTransform=e}get xTransform(){return this._xTransform}set yTransform(e){const a=this.yZoom;e&&(e=new Rt.ax(Math.min(a.scaleExtent()[1],Math.max(a.scaleExtent()[0],e.k)),e.x,e.y),e=Dt(e,a.extent()(),a.translateExtent())),this._yTransform=e}get yTransform(){return this._yTransform}constructor(e,a,i,r,s){(0,c.Z)(this,"renderer",void 0),(0,c.Z)(this,"changeDetectorRef",void 0),(0,c.Z)(this,"overlay",void 0),(0,c.Z)(this,"injector",void 0),(0,c.Z)(this,"data",void 0),(0,c.Z)(this,"selection",void 0),(0,c.Z)(this,"tooltip",void 0),(0,c.Z)(this,"chartOptions",void 0),(0,c.Z)(this,"dimension",new DOMRect(0,0,0,0)),(0,c.Z)(this,"palette",void 0),(0,c.Z)(this,"xAxisScale",void 0),(0,c.Z)(this,"xAxis",void 0),(0,c.Z)(this,"yAxisScale",void 0),(0,c.Z)(this,"yAxis",void 0),(0,c.Z)(this,"content",void 0),(0,c.Z)(this,"zoom",void 0),(0,c.Z)(this,"xZoom",void 0),(0,c.Z)(this,"yZoom",void 0),(0,c.Z)(this,"resizeObservable",void 0),(0,c.Z)(this,"subscription",new ft.w0),(0,c.Z)(this,"tooltipPositionStrategy",void 0),(0,c.Z)(this,"_container",void 0),(0,c.Z)(this,"_isDev",!1),(0,c.Z)(this,"CONTENT_CLASS_NAME","drawing"),(0,c.Z)(this,"X_AXIS_CLASS_NAME","x-axis"),(0,c.Z)(this,"Y_AXIS_CLASS_NAME","y-axis"),(0,c.Z)(this,"renderingObs",void 0),(0,c.Z)(this,"_xTransform",void 0),(0,c.Z)(this,"_yTransform",void 0),(0,c.Z)(this,"id_count",void 0),this.renderer=a,this.changeDetectorRef=i,this.overlay=r,this.injector=s;const _=this.createSVGElement("svg"),d=this.createSVGElement("g"),u=this.createSVGElement("g"),f=this.createSVGElement("g"),l=this.createSVGElement("rect");a.addClass(d,this.X_AXIS_CLASS_NAME),a.addClass(u,this.Y_AXIS_CLASS_NAME),a.addClass(f,this.CONTENT_CLASS_NAME),a.addClass(l,"canvas-area"),a.appendChild(_,this.createSVGElement("defs")),a.appendChild(f,l),a.appendChild(_,d),a.appendChild(_,u),a.appendChild(_,f),a.appendChild(e,_),this.id_count=++na,this.chartOptions=(0,Re.merge)({},s.get(St)),this._container=e,this.content=(0,ve.Z)(_),this.resizeObservable=new Wn.y(p=>{const A=new ResizeObserver(E=>{const h=E[0].contentRect;p.next(new DOMRect(Math.floor(h.left),Math.floor(h.top),Math.floor(h.width),Math.floor(h.height)))});return A.observe(e),function(){A.disconnect()}}),this.renderingObs=new Un.x,this.zoom=(0,Rt.sP)().constrain(Dt),this.xZoom=(0,Rt.sP)().constrain(Dt),this.yZoom=(0,Rt.sP)().constrain(Dt),this.tooltipPositionStrategy=this.overlay.position().flexibleConnectedTo(_).withPositions([{originX:"start",originY:"top",overlayX:"center",overlayY:"bottom"}])}ngOnChanges(e){if(e.options){const a=e.options?.previousValue,i=e.options?.currentValue,r=this.options;this.zoom.scaleExtent([this.getScaleBoundary(r.minZoom),this.getScaleBoundary(r.maxZoom)]),this.xZoom.scaleExtent([this.getScaleBoundary(typeof r.xAxis?.minZoom<"u"?r.xAxis.minZoom:r.minZoom),this.getScaleBoundary(typeof r.xAxis?.maxZoom<"u"?r.xAxis.maxZoom:r.maxZoom)]),this.yZoom.scaleExtent([this.getScaleBoundary(typeof r.yAxis?.minZoom<"u"?r.yAxis.minZoom:r.minZoom),this.getScaleBoundary(typeof r.yAxis?.maxZoom<"u"?r.yAxis.maxZoom:r.maxZoom)]),i?.xAxis?.position!==a?.xAxis?.position||i?.xAxis?.type!==a?.xAxis?.type?this.createAxisScale("x",r.xAxis):typeof i?.xAxis?.format<"u"&&this.xAxis.tickFormat(i.xAxis.format),i?.yAxis?.position!==a?.yAxis?.position?this.createAxisScale("y",r.yAxis):typeof i?.yAxis?.format<"u"&&this.yAxis.tickFormat(i.yAxis.format),this.tooltip.disabled=(0,w.Ig)(r.tooltip?.disabled)}(e.data||e.options)&&this.tooltip&&this.tooltip.hide()}ngOnInit(){this.subscription.add(this.resizeObservable.pipe((0,kt.h)(e=>{const a=this.dimension;return e.width!==a.width||e.height!==a.height}),(0,H.U)(e=>(this.dimension=e,e)),(0,ct.b)(100)).subscribe(()=>{this.resize(),this.identifyZoom(),this.prepareToRender()})),this.renderingObs.pipe((0,ct.b)(5)).subscribe(()=>{this.render()}),this.content.on("contextmenu",e=>{e.preventDefault()})}ngAfterViewInit(){}ngOnDestroy(){this.renderingObs.complete(),this.subscription.unsubscribe(),this.tooltip&&this.tooltip.hide()}zoomIn(){this.content.call(this.zoom.scaleBy,2)}zoomOut(){this.content.call(this.zoom.scaleBy,.5)}getValue(...e){const a=this.invertViewData.call(this,...e);return this.options.valueFun(a,...e)}getXValue(e){const a=this.options.xAxis?.valueFun;return(0,w.su)("function"==typeof a?a(e):e)}getYValue(e){const a=this.options.yAxis?.valueFun;return(0,w.su)("function"==typeof a?a(e):e)}getPalette(){return this.palette}getCanvasArea(){const e=this.dimension,a=this.options.padding;return{...a,width:Math.max(0,e.width-a.left-a.right),height:Math.max(0,e.height-a.top-a.bottom)}}getContainer(){return this._container}resize(){const e=this.dimension,a=e.width,i=e.height;this.content.attr("viewBox",[0,0,a,i]).attr("width",a).attr("height",i),this.setViewportExtent()}setPalette(){const e=this.options,a=this.injector.get(St);let i=e.palette;if(i&&i.unknown(a.palette.unknown()),i=this.palette=i||a.palette.copy(),"static"!==e.domain||!e.palette){const s=(this.data||[]).length;let _=e.colors;(!_||!_.length)&&(_=(0,qn.Z)(jn.Z,s+2),_.shift(),_.pop()),i.domain((0,Ie.Z)(0,s+1)).range(_)}}setViewportExtent(){const e=this.options,a=this.getCanvasArea(),i=this.content,r=[{className:this.X_AXIS_CLASS_NAME,viewBox:this.getAxisViewBox(e.xAxis,a)},{className:this.Y_AXIS_CLASS_NAME,viewBox:this.getAxisViewBox(e.yAxis,a)},{className:this.CONTENT_CLASS_NAME,viewBox:[a.left,a.top,a.width,a.height]}];[{axis:this.xAxis,scale:this.xAxisScale,zoom:this.xZoom,options:e.xAxis},{axis:this.yAxis,scale:this.yAxisScale,zoom:this.yZoom,options:e.yAxis}].forEach(s=>{const{axis:_,scale:d,zoom:u,options:f}=s;if("string"==typeof f?.minZoom||"string"==typeof f?.maxZoom){const l=u.scaleExtent(),p=this.calcAppropriateNumberOfTicks(_,d,f,a);if("string"==typeof f?.minZoom){const A=Ze(d.domain()[0],d.domain().slice(-1)[0],f.minZoom);l[0]=A/p}if("string"==typeof f?.maxZoom){const A=Ze(d.domain()[0],d.domain().slice(-1)[0],f.maxZoom);l[1]=A/p}u.scaleExtent(l)}}),i.selectAll("defs").data([null]).join(s=>s.append(()=>this.createSVGElement("defs"))).selectAll("clipPath").data(r).join(s=>s.append(()=>this.createSVGElement("clipPath"))).attr("clipPathUnits","userSpaceOnUse").attr("id",(s,_,d)=>{const u=(0,ve.Z)(d[_]);let f;switch(s.className){case this.X_AXIS_CLASS_NAME:f=this.xZoom.translateExtent([[s.viewBox[0],s.viewBox[1]],[s.viewBox[0]+s.viewBox[2],s.viewBox[1]]]);break;case this.Y_AXIS_CLASS_NAME:f=this.yZoom.translateExtent([[s.viewBox[0],s.viewBox[1]],[s.viewBox[0],s.viewBox[1]+s.viewBox[3]]]);break;default:f=this.zoom.translateExtent([[s.viewBox[0],s.viewBox[1]],[s.viewBox[0]+s.viewBox[2],s.viewBox[1]+s.viewBox[3]]])}return f.extent([[s.viewBox[0],s.viewBox[1]],[s.viewBox[0]+s.viewBox[2],s.viewBox[1]+s.viewBox[3]]]),u.selectAll("rect").data([null]).join(l=>l.append(()=>this.createSVGElement("rect"))).attr("x",s.viewBox[0]).attr("y",s.viewBox[1]).attr("width",s.viewBox[2]).attr("height",s.viewBox[3]),this.getClipID(s.className)}),i.select(`.${this.CONTENT_CLASS_NAME}`).attr("clip-path",`url(#${this.getClipID(this.CONTENT_CLASS_NAME)})`).select("rect.canvas-area").attr("fill","transparent").attr("x",a.left).attr("y",a.top).attr("width",a.width).attr("height",a.height)}prepareToRender(){this.renderingObs.next()}createAxisScale(e,a){let i,r;switch(a?.type){case"date":i=(0,Fn.Z)();break;case"string":i=Vt();break;default:i=qt()}switch(a?.position){case"top":if("y"===e)throw new Error("yAxis cannot be placed on horizontal.");r=(0,Lt.F5)(i);break;case"left":if("x"===e)throw new Error("xAxis cannot be placed on vertical.");r=(0,Lt.y4)(i);break;case"right":if("x"===e)throw new Error("xAxis cannot be placed on vertical.");r=(0,Lt.Kh)(i);break;default:if("y"===e)throw new Error("yAxis cannot be placed on horizontal.");r=(0,Lt.LL)(i)}return r.tickSize(5).tickPadding(10),typeof a?.format<"u"&&r.tickFormat(a.format),"x"===e?(this.xAxisScale=i,this.xAxis=r):(this.yAxisScale=i,this.yAxis=r),i}createAxis(e,a,i,r){const s=e.scale(),_=this.getCanvasArea(),d=this.getAxisViewBox(a,_),u=this.content,f=this.calcAppropriateNumberOfTicks(e,s,a,_);let l;if("function"==typeof s.invert)e.ticks("date"===a.type?((n,o,e,a)=>{const i=Math.abs(o-n)/e,r=(0,Vn.Z)(([,,d])=>d).right(yt,i);if(r===yt.length)return Kt.jB.every((0,Et.ly)(n/te,o/te,e));if(0===r)return Oe(a).every(Math.max((0,Et.ly)(n,o,e),1));const[s,_]=yt[i/yt[r-1][2]<yt[r][2]/i?r-1:r];return s.every(_)})(s.invert(0).valueOf(),s.invert(_.width).valueOf(),f-2,"string"==typeof a.minZoom?a.minZoom:void 0):f);else{const A=Math.max(1,(0,w.su)(this.data?.length));e.tickValues(function zn(n,o){if("function"!=typeof o)throw new TypeError("test is not a function");const e=[];let a=-1;for(const i of n)o(i,++a,n)&&e.push(i);return e}(s.domain(),(E,h)=>h%Math.max(1,Math.floor(A/f/(0,w.su)(r.k)))==0))}switch(a?.position){case"left":l=[_.left,0];break;case"right":l=[_.left+_.width,0];break;case"top":l=[0,_.top];break;default:l=[0,_.top+_.height]}const p=u.select(`.${i}`).attr("clip-path",(0,w.Ig)(a?.clipped)?`url(#${this.getClipID(i)})`:"").on("wheel",A=>{A.preventDefault()});p.selectAll("rect").data(A=>[A]).join(A=>A.append(()=>this.createSVGElement("rect"))).attr("x",d[0]).attr("y",d[1]).attr("width",d[2]).attr("height",d[3]).attr("fill","transparent"),p.selectAll("g").data(A=>[A]).join(A=>A.append(()=>this.createSVGElement("g"))).attr("transform",`translate(${l})`).style("user-select","none").call(e).call(A=>{this.setStyle(A,a.font),this.setStyle(A.selectAll(".domain"),a.baseline?.style),this.setStyle(A.selectAll(".tick line"),a.ticks?.style)})}getAxisViewBox(e,a){let i;switch(e?.position){case"top":i=[a.left,0,a.width,a.top];break;case"left":i=[0,a.top,a.left,a.height];break;case"right":i=[a.left+a.width,a.top,a.right,a.height];break;default:i=[a.left,a.top+a.height,a.width,a.bottom]}return i}calcAppropriateNumberOfTicks(e,a,i,r){const s=(0,w.su)(i?.font["font-size"])||14,_=(0,w.su)(i?.padding);let u,f,l,p,d=e.tickFormat();switch(d=null===d?a.tickFormat?a.tickFormat.apply(a,e.tickArguments()):A=>A:d,i?.position){case"left":case"right":u=r.top+r.height,f=r.height,l=s;break;default:const E=this.renderer.createElement("canvas").getContext("2d"),h=m=>"function"==typeof m?.toString?E.measureText(m.toString()).width:0;E.font=`${s}px "${i.font["font-family"]}"`,u=r.left,f=r.width,l=(0,Hn.Z)((a.invert?(0,ye.Z)((0,Et.ZP)(u,u+f,f),m=>h(d(a.invert(m),-1))):(0,ye.Z)(a.domain(),m=>h(d(m,-1)))).concat([_]))}return l=Math.ceil(l)+_,p=Math.max(1,Math.floor(f/l)),p}getTransformXAxisScale(){const e=this.xAxisScale,a=this.xTransform;try{return a.rescaleX(e)}catch{return("function"==typeof e.rangeRound?e.copy().rangeRound:e.copy().range)(e.range().map(r=>a.applyX(r)))}}getTransformYAxisScale(){const e=this.yAxisScale,a=this.yTransform;try{return a.rescaleY(e)}catch{return("function"==typeof e.rangeRound?e.copy().rangeRound:e.copy().range)(e.range().map(r=>a.applyY(r)))}}getScaleBoundary(e,a){let i;switch(typeof e){case"boolean":i=e?1/0:1;break;case"number":i=e;break;default:i=1}return i}createSVGElement(e){return this.renderer.createElement(e,"svg")}setStyle(e,a){const i="function"==typeof a?a(e.data()):a||{};for(const r in i)e.attr(r,i[r])}createTooltip(){const e=this.injector,a=new jt.gM(this.overlay,new t.SBq(this.getContainer()),e.get(Qn.mF),e.get(t.s_b),e.get(t.R0b),e.get(Jn.t4),e.get(Me.$s),e.get(Me.tE),e.get(jt.cV),e.get(Gn.Is),e.get(jt.Jm),e.get(y.K0)),i=this.options?.tooltip?.component;return i&&(a._portal=new Xn.C5(i,e.get(t.s_b))),a.message="_",a.show(),a.hide(),a._overlayRef.updatePositionStrategy(this.tooltipPositionStrategy),a}updateTooltip(e,a){const i=this.tooltip,r=this.injector.get(t.R0b),s=e.offsetX,_=e.offsetY;r.run(()=>{this.tooltipPositionStrategy.withPositions([{offsetX:s,offsetY:_,originX:"start",originY:"top",overlayX:"center",overlayY:"bottom"}]),i.message=`${a}`,i.show()})}enableMultipleSelection(e){return navigator.platform?.toLowerCase().indexOf("mac")>-1?e.metaKey:e.ctrlKey}getClipID(e){return`boundsClip-${this.injector.get(t.AFp)}-${this.id_count}-${e}`}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(HTMLElement),t.Y36(t.Qsj),t.Y36(t.sBO),t.Y36(ee.aV),t.Y36(t.zs3))}),(0,c.Z)(n,"\u0275dir",t.lG2({type:n,inputs:{data:"data",selection:"selection",options:"options"},features:[t.TTD]})),n})(),aa=(()=>{class n extends Pe{constructor(e,a,i,r,s){super((0,w.fI)(e),a,i,r,s),(0,c.Z)(this,"renderer",void 0),(0,c.Z)(this,"changeDetectorRef",void 0),(0,c.Z)(this,"overlay",void 0),(0,c.Z)(this,"injector",void 0),(0,c.Z)(this,"data",void 0),this.renderer=a,this.changeDetectorRef=i,this.overlay=r,this.injector=s,this.createAxisScale("x",this.options.xAxis),this.createAxisScale("y",this.options.yAxis),this.tooltip=this.createTooltip()}ngOnChanges(e){if(super.ngOnChanges(e),["data","options"].some(i=>e[i]&&(e[i].firstChange||e[i].currentValue!==e[i].previousValue))){const i=this.options,r="stacked"===i.layout,s=this.data||[];[{scale:this.xAxisScale,options:i.xAxis,domain:b.UID(s,d=>d[0])},{scale:this.yAxisScale,options:i.yAxis,domain:b.TSy(b.UID(s,d=>b.UID(d.slice(1),r?(u,f)=>b.e3P(d.slice(1,f+2)):u=>Math.abs((0,w.su)(u))))).concat([0])}].forEach(d=>{if("string"===d.options.type)d.scale.domain(d.domain);else{const u=typeof d.options?.min<"u",f=typeof d.options?.max<"u",l=b.Wem(d.domain);u&&(l[0]=b.VV$([l[0],d.options.min])),f&&(l[1]=b.Fp7([l[1],d.options.max])),d.scale.domain(l),"function"==typeof d.scale.nice&&d.scale.nice()}}),this.setPalette()}this.xTransform&&this.yTransform&&this.prepareToRender()}ngOnInit(){super.ngOnInit(),this.xZoom.on("zoom",e=>{const a=this.xTransform;this.xTransform=e.transform,(a.k!==e.transform.k||a.x!==e.transform.x)&&this.prepareToRender()}),this.yZoom.on("zoom",e=>{const a=this.yTransform;this.yTransform=e.transform,(a.k!==e.transform.k||a.y!==e.transform.y)&&this.prepareToRender()})}render(){this.renderAxes(),this.renderContent()}renderContent(){const e=this.data||[],a=this.getNumOfSeries(e),i=this.options,r="stacked"===i.layout,_=this.getPalette(),d=this.getTransformXAxisScale(),u=this.getTransformYAxisScale(),f=this.content.select(`.${this.CONTENT_CLASS_NAME}`);let l=30;"function"==typeof d.clamp&&d.clamp(!1),"function"==typeof u.clamp&&u.clamp(!1),l="function"==typeof d.bandwidth?d.bandwidth():Math.abs(Math.floor(d(e[0][0])-d(e[1][0]))),f.selectAll("g.bars").data([null]).join(h=>h.append(()=>this.createSVGElement("g"))).attr("class","bars").selectAll("g.bar").data(e).join(h=>h.append(()=>this.createSVGElement("g"))).attr("class","bar").call(h=>{h.selectAll("rect").data(m=>b.UID(m.slice(1),()=>m)).join(m=>m.append(()=>this.createSVGElement("rect"))).attr("fill",(m,S)=>_(S)).attr("x",(m,S)=>d(m[0])+(r?0:l/a*S)).attr("width",r?l:l/a).attr("y",(m,S)=>u(r?S<1?m[S+1]:m[S]:Math.abs(m[S+1]))).attr("height",(m,S)=>u(0)-u(Math.abs(m[S+1])))}).on("mousemove",h=>{this.tooltip&&this.showTooltip(h)}).on("mouseenter",h=>{this.tooltip&&this.showTooltip(h),h.stopPropagation()}).on("mouseleave",h=>{this.tooltip&&this.tooltip.hide(),h.stopPropagation()});const p=new Array(Math.min(1,a)),A=b.q$2(b.OOA,a+2);A.unshift(),A.pop();const E=b.PKp(b.w6H(0,a,1),A);p.length&&(p[0]=a-1),f.selectAll("g.lines").data(p).join(h=>h.append(()=>this.createSVGElement("g"))).attr("class","lines").call(h=>{h.selectAll("path").data(m=>[b.UID(e,S=>[S[0],r?b.e3P(S.slice(1)):S[m]])]).join(m=>m.append(()=>this.createSVGElement("path"))).attr("fill","none").attr("stroke",(m,S)=>E(S)).attr("stroke-width",1).attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("d",b.jvg().curve(b.FdL).x(m=>d(m[0])+l/2).y(m=>u(m[1]))).call(m=>{this.setStyle(m,i.lineStyle)})})}renderAxes(){const e=this.options,a=this.content,i=this.X_AXIS_CLASS_NAME,r=this.Y_AXIS_CLASS_NAME,s=this.getCanvasArea(),_=this.xAxisScale;if("function"==typeof _.bandwidth){const d=_.domain().length,u=(0,w.su)(e.maxBandWidth),f=this.xTransform;_.paddingOuter(Math.max(.01,1-d/(s.width/u))),_.paddingInner(Math.max(.38,_.paddingOuter())),this.xZoom.scaleExtent([1,Math.max(1,u/_.step())]),this.xTransform=new b.axH(f.k,f.x,f.y)}this.createAxis(this.xAxis.scale(this.getTransformXAxisScale()),e.xAxis,i,this.xTransform),this.createAxis(this.yAxis.scale(this.getTransformYAxisScale()),e.yAxis,r,this.yTransform),a.select(`.${i}`).call(this.xZoom).call(this.xZoom.transform,this.xTransform),a.select(`.${r}`).call(d=>{d.selectAll(".tick line").clone().attr("x2",s.width).attr("stroke","#000000").style("stroke-dasharray",u=>0===u?null:"3 3").attr("stroke-opacity",u=>0===u?.5:.2)}).call(this.yZoom)}viewData(e){return this.getTransformXAxisScale()(this.getXValue(e))}invertViewData(e,a=this.data){return a[e]}setViewportExtent(){super.setViewportExtent();const e=this.options,a=this.getCanvasArea();[{scale:this.xAxisScale,options:e.xAxis},{scale:this.yAxisScale,options:e.yAxis}].forEach(r=>{switch(r.options?.position){case"left":case"right":("function"==typeof r.scale.rangeRound?r.scale.rangeRound:r.scale.range)([a.top+a.height,a.top]);break;default:("function"==typeof r.scale.rangeRound?r.scale.rangeRound:r.scale.range)([a.left,a.left+a.width])}})}identifyZoom(){this.xTransform=this.yTransform=b.CRH}showTooltip(e){const a=b.Ys(e.target),i=a.size()?a.data()[0]:null,r=this.options.tooltip?.content,s=i?"function"==typeof r?r(i):b.u4g(i,(_,d)=>_+`${d} \n`,""):"";this.updateTooltip(e,s)}getNumOfSeries(e){return e&&e[0]?e[0].length-1:0}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(t.Qsj),t.Y36(t.sBO),t.Y36(ee.aV),t.Y36(t.zs3))}),(0,c.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-bar-chart"]],hostAttrs:[1,"d-block","chart","chart-bar"],inputs:{data:"data"},features:[t._Bn([{provide:St,useValue:Ln}]),t.qOj,t.TTD],decls:0,vars:0,template:function(e,a){},styles:["[_nghost-%COMP%]{display:block;overflow:hidden}","svg[_ngcontent-%COMP%]{display:block}"]})),n})(),oa=(()=>{class n extends Pe{constructor(e,a,i,r,s,_){super((0,w.fI)(e),a,i,r,s),(0,c.Z)(this,"renderer",void 0),(0,c.Z)(this,"changeDetectorRef",void 0),(0,c.Z)(this,"overlay",void 0),(0,c.Z)(this,"injector",void 0),(0,c.Z)(this,"percentPipe",void 0),(0,c.Z)(this,"root",void 0),(0,c.Z)(this,"arc",void 0),(0,c.Z)(this,"totalDepth",void 0),this.renderer=a,this.changeDetectorRef=i,this.overlay=r,this.injector=s,this.percentPipe=_,this.arc=b.Nb1().startAngle(d=>d.x0).endAngle(d=>d.x1).padAngle(d=>Math.min((d.x1-d.x0)/2,.005)).innerRadius(d=>d.y0).outerRadius(d=>d.y1-1),this.totalDepth=0,this.tooltip=this.createTooltip()}ngOnChanges(e){super.ngOnChanges(e),["data","options"].some(i=>e[i]&&(e[i].firstChange||e[i].currentValue!==e[i].previousValue))&&this.setPalette(),this.prepareToRender()}ngOnInit(){super.ngOnInit()}render(){this.renderContent()}renderContent(){const e=(this.data?this.data[0]:null)||{id:"",name:"",children:[]},a=this.options,i=(0,w.su)(a?.font["font-size"])||14,s=this.getPalette(),_=this.getCanvasArea(),d=Math.min(_.width,_.height)/2,u=this.content.select(`.${this.CONTENT_CLASS_NAME}`),f=this.arc.padRadius(d/2),l=this.root=b.uKc().size([2*Math.PI,d])(b.bT9(e).sum(h=>h.children&&h.children.length?0:h.value).sort((h,m)=>m.value-h.value)),p=this.totalDepth=b.Fp7(l.descendants(),h=>h.depth),A=1/this.totalDepth,E=b.sXR(Math.min(Math.max(A,.4),.9),Math.max(Math.min(1-A,.9),.9));s.domain(b.UID(e.children,h=>h.id)),u.selectAll("text.main").data([e]).join(h=>h.append(()=>this.createSVGElement("text"))).attr("class","main").attr("transform",`translate(${[_.left+_.width/2,_.top+_.height/2]})`).attr("text-anchor","middle").call(h=>{this.setTitle(h,h.data()[0]),this.setStyle(h,a.title?.font)}),u.selectAll("g.part").data(l.descendants().filter(h=>h.depth&&h.x1-h.x0>.001)).join(h=>h.append(()=>this.createSVGElement("g"))).attr("class","part").attr("transform",`translate(${[_.left+_.width/2,_.top+_.height/2]})`).call(h=>{h.selectAll("path").data(m=>m).join(m=>m.append(()=>this.createSVGElement("path"))).attr("fill",(m,S)=>this.getColorByData(m,S).toString()).attr("fill-opacity",m=>E((m.depth+1)/p)).attr("d",f),h.selectAll("text").data(m=>m).join(m=>m.append(()=>this.createSVGElement("text"))).attr("transform",m=>{const S=(m.x0+m.x1)/2*180/Math.PI;return`rotate(${S-90}) translate(${(m.y0+m.y1)/2}, 0) rotate(${S<180?0:180})`}).text(m=>m.depth&&(m.y0+m.y1)/2*(m.x1-m.x0)>i?m.data.name:"").call(m=>{m.attr("dy","0.35em"),this.setStyle(m,a.font)})}).on("mousemove",h=>{this.tooltip&&this.showTooltip(h)}).on("mouseenter",h=>{const m=b.Ys(h.target),S=m.data()[0];m.select("path").attr("fill-opacity",1),this.setTitle(u.select("text.main"),S.data),this.tooltip&&this.showTooltip(h),h.stopPropagation()}).on("mouseleave",h=>{const m=b.Ys(h.target),S=m.data()[0];m.select("path").attr("fill-opacity",E((S.depth+1)/p)),this.setTitle(u.select("text.main"),this.data?this.data[0]:null),this.tooltip&&this.tooltip.hide(),h.stopPropagation()})}renderAxes(){throw new Error("Method not implemented.")}viewData(e){throw new Error("Method not implemented.")}invertViewData(e){return e}setPalette(){const e=this.options,a=this.injector.get(St),r=((this.data?this.data[0]:null)||{id:"",name:"",children:[]}).children.length;let s=e.palette,_=e.colors;s&&s.unknown(a.palette.unknown()),s=this.palette=s||a.palette.copy(),(!_||!_.length)&&(_=b.q$2(b.ICD,r+1).reverse(),_.pop()),s.range(_)}identifyZoom(){this.xTransform=this.yTransform=b.CRH}showTooltip(e){const a=this.options.tooltip?.content,i=b.Ys(e.target),r=i.size()?i.data()[0]:null,s=r?"function"==typeof a?a(r.data):`${r.ancestors().map(_=>_.data.name).reverse().join("/")}\n${this.percentPipe.transform(r.value/this.root.value,"0.0-2")}`:"";this.updateTooltip(e,s)}setTitle(e,a){let i="",r=0;a&&(a.name?i=a.name:a.data&&(i=a.data.name),"number"==typeof a.value&&(r=a.value)),e.selectAll(".percentage").data([i,this.getValue(r).toString()]).join(s=>s.append(()=>this.createSVGElement("tspan"))).attr("class","percentage").attr("x",0).attr("y",0).attr("dy",(s,_)=>1.2*_-.1+"em").text(s=>s)}getColorByData(e,a){const i=e.depth;let r=1,s=a%r;for(e.parent&&(r=e.parent.data.children.length,s=a%r,e.parent.data.children.some((l,p)=>e.data.name===l.name&&(s=p,!0)));e.depth>1;)e=e.parent;const _=b.Ym7(this.getPalette()(e.data.id)),d=b.Ym7(_).h,u=1/this.totalDepth;let f=_;if(i>1){const l=b.Ym7(d,Math.max(1-u,.3),Math.max(1-u,.8)),p=b.Ym7(d,1,Math.min(u,.2));f=b.Ym7(b.USs(l,p)(s/r))}return f}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(t.Qsj),t.Y36(t.sBO),t.Y36(ee.aV),t.Y36(t.zs3),t.Y36(y.Zx))}),(0,c.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-sunburst-chart"]],hostAttrs:[1,"d-block","chart","chart-sunburst"],features:[t._Bn([{provide:St,useValue:Bn}]),t.qOj,t.TTD],decls:0,vars:0,template:function(e,a){},styles:["[_nghost-%COMP%]{display:block;overflow:hidden}","svg[_ngcontent-%COMP%]{display:block}"]})),n})();var lt=g(1728),v=g(8280),$=g(9114),Nt=g(430),Bt=g(787),Gt=g(1299),ia=g(8811),ne=g(2201);function ra(n,o){1&n&&(t.TgZ(0,"mat-label"),t.ynx(1),t.SDv(2,19),t.BQk(),t.qZA())}function ca(n,o){if(1&n&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}let sa=(()=>{class n{constructor(e,a,i,r,s,_,d,u,f){(0,c.Z)(this,"elementRef",void 0),(0,c.Z)(this,"currencyPipe",void 0),(0,c.Z)(this,"datePipe",void 0),(0,c.Z)(this,"dateAdapter",void 0),(0,c.Z)(this,"notification",void 0),(0,c.Z)(this,"communication",void 0),(0,c.Z)(this,"datetimeService",void 0),(0,c.Z)(this,"database",void 0),(0,c.Z)(this,"statistics",void 0),(0,c.Z)(this,"currencyValueFormat",l=>this.currencyPipe.transform(l/100,"CNY","symbol-narrow","0.0-2")),(0,c.Z)(this,"dateRange",new T.cw({start:new T.NI(null),end:new T.NI(null)})),(0,c.Z)(this,"books",[]),(0,c.Z)(this,"selectedBook",void 0),(0,c.Z)(this,"payCategoriesData",void 0),(0,c.Z)(this,"revenueCategoriesData",void 0),(0,c.Z)(this,"revNExpndData",void 0),(0,c.Z)(this,"totalBalance",""),(0,c.Z)(this,"sunburstChartOptions",{valueFun:this.currencyValueFormat}),(0,c.Z)(this,"barChartOptions",{layout:"stacked",lineStyle:{stroke:"#5e92a8","stroke-width":2},valueFun:this.currencyValueFormat,tooltip:{content:l=>`${this.datePipe.transform(l[0],"MMMM, y")}\n        \t ${l.slice(1).reduce((p,A,E)=>p+`${E>0?"\n":""} ${A<0?"":"+"}${this.currencyValueFormat(A)}`,"")}\n        \t =${this.currencyValueFormat(l.slice(1).reduce((p,A)=>p+A,0))}\n      `},xAxis:{baseline:{style:{stroke:"#808080"}},font:{color:"#808080"},format:l=>this.datePipe.transform(l,"MMM, y")},yAxis:{baseline:{style:{stroke:"transparent"}},font:{color:"#808080"},format:this.currencyValueFormat}}),(0,c.Z)(this,"subscription",new ft.w0),this.elementRef=e,this.currencyPipe=a,this.datePipe=i,this.dateAdapter=r,this.notification=s,this.communication=_,this.datetimeService=d,this.database=u,this.statistics=f}ngOnInit(){this.dateRange.valueChanges.subscribe(()=>{this.communication.giveRefreshCommand()}),this.datetimeService.initTimeRange(this.dateRange)}ngAfterViewInit(){setTimeout(()=>{this.database.getBooks().subscribe(e=>{this.books=e.data.books,this.selectedBook=this.books[0].id,this.initRefreshIndicator()})})}ngOnDestroy(){this.subscription.unsubscribe(),this.datetimeService.destoryTimeRange()}onBookSelectionChange(e){this.communication.giveRefreshCommand()}prevYear(){const a=this.dateAdapter.getYear(this.dateRange.value.start)-1;this.dateRange.setValue({start:this.dateAdapter.createDate(a,0,1),end:this.dateAdapter.createDate(a,11,31)})}nextYear(){const a=this.dateAdapter.getYear(this.dateRange.value.end)+1;this.dateRange.setValue({start:this.dateAdapter.createDate(a,0,1),end:this.dateAdapter.createDate(a,11,31)})}prevMonth(){const e=this.dateAdapter;let a=e.clone(this.dateRange.value.start),i=e.today();const r=e.getYear(a),s=e.getMonth(a)-1;s<0?(a=e.createDate(r-1,11,1),i=e.createDate(r,0,1)):(a=e.createDate(r,s,1),i=e.createDate(r,s+1,1)),i=e.addCalendarDays(i,-1),this.dateRange.setValue({start:a,end:i})}nextMonth(){const e=this.dateAdapter;let a=e.clone(this.dateRange.value.start),i=e.today();const r=e.getYear(a),s=e.getMonth(a)+1;s>11?(a=e.createDate(r+1,0,1),i=e.createDate(r+1,1,1)):(a=e.createDate(r,s,1),i=s+1>11?e.createDate(r+1,0,1):e.createDate(r,s+1,1)),i=e.addCalendarDays(i,-1),this.dateRange.setValue({start:a,end:i})}showAllHistory(){this.dateRange.setValue({start:this.datetimeService.getMinDate(),end:this.datetimeService.getMaxDate()})}initRefreshIndicator(){this.subscription.add(this.communication.acceptRefreshCommand().pipe((0,ct.b)(500),(0,hn.O)({}),(0,Wt.w)(()=>{let e=this.dateRange.controls.start.value,a=this.dateRange.controls.end.value;return this.dateRange.invalid?(0,P.of)(null):(this.notification.showLoading(this.elementRef.nativeElement),e&&a?(e=this.dateAdapter.deserialize(this.datetimeService.getStartDatetime(e)),a=this.dateAdapter.deserialize(this.datetimeService.getEndDatetime(a)),(0,rt.D)([this.assemblePayCategoriesStatistics(e,a),this.assembleRevenueCategoriesStatistics(e,a),this.assembleRevenueNExpenditureStatistics(e,a)])):(0,P.of)(null))}),(0,Y.x)(()=>{this.notification.hideLoading()})).subscribe(()=>{this.notification.hideLoading()}))}assemblePayCategoriesStatistics(e,a){return(0,rt.D)([this.database.getEntryCategories(this.selectedBook,J.PAY),this.statistics.getCategoryStatistics(this.selectedBook,e,a,1),this.statistics.getCategoryStatistics(this.selectedBook,e,a,2)]).pipe((0,z.K)(()=>(0,P.of)([])),(0,H.U)(i=>{let r=!1;if(i.forEach(u=>{u.error&&(r=!0),r=!u.data||r}),r)return void(this.payCategoriesData=[]);const s=i[0].data.bookCategories,_=i[1].data,d=i[2].data.groups;return this.payCategoriesData=[{id:"_",name:_.title,value:_.totalAmount,children:_.groups.map(u=>{const f=u.id,l=s.find(A=>A.categoryId===f)?.outgoSubTypes,p=d.filter(A=>l.some(E=>E.categoryId===A.id)).map(A=>({id:A.id,name:A.name,value:A.amount}));return{id:u.id,name:u.name,value:u.amount,children:p}})}],null}))}assembleRevenueCategoriesStatistics(e,a){return this.statistics.getCategoryStatistics(this.selectedBook,e,a,6).pipe((0,z.K)(()=>(0,P.of)({})),(0,H.U)(i=>{const r=i.data;if(r&&r.groups)return this.revenueCategoriesData=[{id:"_",name:r.title,value:r.totalAmount,children:r.groups.map(s=>({id:s.id,name:s.name,value:s.amount}))}],null;this.revenueCategoriesData=[]}))}assembleRevenueNExpenditureStatistics(e,a){return this.statistics.getRevenueNExpenditureStatistics(this.selectedBook,e,a,11).pipe((0,z.K)(()=>(0,P.of)({})),(0,H.U)(i=>{const r=this.dateAdapter,s=i.data;if(s){if(this.totalBalance=s.currency+" "+s.totalBalance/100,!s.groups)return void(this.revNExpndData=[]);this.revNExpndData=s.groups.map(_=>[r.deserialize(_.startTime),_.balanceMoney+_.outgoMoney,-_.outgoMoney])}else this.totalBalance="",this.revNExpndData=[];return null}))}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(y.H9),t.Y36(y.uU),t.Y36(Q._A),t.Y36(st.g),t.Y36(At.O),t.Y36(Ut.d),t.Y36(_t),t.Y36(ue))}),(0,c.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-dashboard"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:50,vars:21,consts:function(){let o;return o="Account book",[["role","group",1,"btn-group"],["mat-button","",3,"for"],["matDatepickerToggleIcon",""],["type","button","mat-button","",3,"click"],["appearance","fill",1,"mat-form-field-mini"],[4,"ngIf"],["name","book",3,"value","valueChange","selectionChange"],["bookSelect",""],[3,"value",4,"ngFor","ngForOf"],[1,"align-middle","ms-2"],[1,"visually-hidden",3,"formGroup","rangePicker"],["matStartDate","","formControlName","start"],["matEndDate","","formControlName","end"],["dateRangePicker",""],[1,"flex-fill","px-2",2,"overflow-x","hidden","overflow-y","auto"],[1,"row"],[1,"col-12","col-lg-6","py-2","sunburst-chart"],[3,"data","options"],[1,"col-12","py-2","bar-chart"],o,[3,"value"]]},template:function(e,a){if(1&e&&(t.TgZ(0,"app-operation-toolbar")(1,"div",0)(2,"mat-datepicker-toggle",1)(3,"mat-icon",2),t._uU(4,"date_range"),t.qZA()(),t.TgZ(5,"button",3),t.NdJ("click",function(){return a.showAllHistory()}),t.TgZ(6,"mat-icon"),t._uU(7,"history_toggle_off"),t.qZA()(),t.TgZ(8,"button",3),t.NdJ("click",function(){return a.prevYear()}),t.TgZ(9,"mat-icon"),t._uU(10,"first_page"),t.qZA()(),t.TgZ(11,"button",3),t.NdJ("click",function(){return a.prevMonth()}),t.TgZ(12,"mat-icon"),t._uU(13,"chevron_left"),t.qZA()(),t.TgZ(14,"button",3),t.NdJ("click",function(){return a.nextMonth()}),t.TgZ(15,"mat-icon"),t._uU(16,"chevron_right"),t.qZA()(),t.TgZ(17,"button",3),t.NdJ("click",function(){return a.nextYear()}),t.TgZ(18,"mat-icon"),t._uU(19,"last_page"),t.qZA()()(),t.TgZ(20,"mat-form-field",4),t.YNc(21,ra,3,0,"mat-label",5),t.TgZ(22,"mat-select",6,7),t.NdJ("valueChange",function(r){return a.selectedBook=r})("selectionChange",function(r){return a.onBookSelectionChange(r)}),t.YNc(24,ca,2,2,"mat-option",8),t.qZA()()(),t.TgZ(25,"app-breadcrumb")(26,"span",9),t._uU(27),t.ALo(28,"date"),t.ALo(29,"date"),t.qZA()(),t.TgZ(30,"mat-date-range-input",10),t._UZ(31,"input",11)(32,"input",12),t.qZA(),t._UZ(33,"mat-date-range-picker",null,13),t.TgZ(35,"div",14)(36,"div",15)(37,"div",16)(38,"mat-card")(39,"mat-card-content"),t._UZ(40,"app-sunburst-chart",17),t.qZA()()(),t.TgZ(41,"div",16)(42,"mat-card")(43,"mat-card-content"),t._UZ(44,"app-sunburst-chart",17),t.qZA()()()(),t.TgZ(45,"div",15)(46,"div",18)(47,"mat-card")(48,"mat-card-content"),t._UZ(49,"app-bar-chart",17),t.qZA()()()()()),2&e){const i=t.MAs(23),r=t.MAs(34);t.xp6(2),t.Q6J("for",r),t.xp6(19),t.Q6J("ngIf",!i.triggerValue),t.xp6(1),t.Q6J("value",a.selectedBook),t.xp6(2),t.Q6J("ngForOf",a.books),t.xp6(3),t.lnq(" (",t.xi3(28,15,a.dateRange.value.start,"longDate")," - ",t.xi3(29,18,a.dateRange.value.end,"longDate")," => ",a.totalBalance,") "),t.xp6(3),t.Q6J("formGroup",a.dateRange)("rangePicker",r),t.xp6(10),t.Q6J("data",a.payCategoriesData)("options",a.sunburstChartOptions),t.xp6(4),t.Q6J("data",a.revenueCategoriesData)("options",a.sunburstChartOptions),t.xp6(5),t.Q6J("data",a.revNExpndData)("options",a.barChartOptions)}},dependencies:[aa,oa,y.sg,y.O5,le,de,T.Fj,T.JJ,T.JL,lt.lW,v.nW,v.Q0,v.wx,v.zY,v.By,v._g,$.KE,$.hX,Nt.Hw,Bt.gD,Q.ey,T.sg,T.u,Gt.L,ia.U,ne.e],styles:[".sunburst-chart[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{height:calc(60vh - 140px);min-height:300px}.bar-chart[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{height:calc(40vh - 100px);min-height:300px}.chart[_ngcontent-%COMP%]{width:100%;height:100%}"]})),n})(),we=(()=>{class n{constructor(e){(0,c.Z)(this,"requestService",void 0),this.requestService=e}getBankList(){return this.requestService.get("setting/account_bankList.action",{type:""})}getCardTypeList(){return this.requestService.get("setting/account_cardList.action",{type:""})}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.LFG(xt.s))}),(0,c.Z)(n,"\u0275prov",t.Yz7({token:n,factory:n.\u0275fac})),n})();var ae=g(4159),oe=g(636),ie=g(7633);function _a(n,o){1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,17),t.BQk(),t.qZA())}function la(n,o){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.TgZ(2,"span",19),t._uU(3),t.qZA()()),2&n){const e=o.$implicit;t.xp6(1),t.hij("",e.name," "),t.xp6(2),t.Oqu(e.tailNo)}}function da(n,o){1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,20),t.BQk(),t.qZA())}function ua(n,o){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.Oqu(e.groupName)}}function ma(n,o){1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,21),t.BQk(),t.qZA())}function ga(n,o){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.AsE("",e.moneyType.flag," ",t.xi3(2,2,e.balanceMoney,"0.2-2"),"")}}function pa(n,o){1&n&&t._UZ(0,"th",22)}function ha(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"td",18)(1,"button",23),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.goToEntryList(r))}),t.TgZ(2,"mat-icon"),t._uU(3,"receipt"),t.qZA()()()}}function fa(n,o){1&n&&t._UZ(0,"tr",24)}function Aa(n,o){1&n&&t._UZ(0,"tr",25)}function Ea(n,o){1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,26),t.BQk(),t.qZA())}function Ta(n,o){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.Oqu(e.name)}}function Ca(n,o){1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,27),t.BQk(),t.qZA())}function Sa(n,o){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.groupName," ")}}function ba(n,o){if(1&n&&(t.ynx(0),t.TgZ(1,"mat-icon",33),t._uU(2),t.ALo(3,"lowercase"),t.qZA(),t.BQk()),2&n){const e=t.oxw(2).$implicit;t.xp6(2),t.Oqu(t.lcZ(3,1,null==e.bank?null:e.bank.ename))}}function Na(n,o){if(1&n&&(t.ynx(0),t._UZ(1,"img",34),t.BQk()),2&n){const e=t.oxw(2).$implicit;t.xp6(1),t.Q6J("alt",null==e.bank?null:e.bank.ename)("src",e.iconUrl,t.LSH)}}function Ma(n,o){if(1&n&&(t.ynx(0,31),t.YNc(1,ba,4,3,"ng-container",29),t.YNc(2,Na,2,2,"ng-container",32),t._uU(3),t.BQk()),2&n){const e=t.oxw().$implicit;t.Q6J("ngSwitch",2===e.type&&!e.iconUrl),t.xp6(1),t.Q6J("ngSwitchCase",!0),t.xp6(2),t.hij(" ",e.tailNo," ")}}function Ra(n,o){1&n&&(t.TgZ(0,"td",28),t.YNc(1,Sa,2,1,"ng-container",29),t.YNc(2,Ma,4,3,"ng-container",30),t.qZA()),2&n&&(t.Q6J("ngSwitch",!o.$implicit.name),t.xp6(1),t.Q6J("ngSwitchCase",!0))}function Ia(n,o){if(1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,35),t.BQk(),t._uU(3),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.hij(" ",e.totalBalance," ")}}function ya(n,o){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.AsE("",e.moneyType.flag," ",t.xi3(2,2,e.balanceMoney,"0.2-2"),"")}}function Da(n,o){1&n&&t._UZ(0,"th",22)}function va(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",37),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,r=t.oxw();return t.KtG(r.goToEntryList(i))}),t.TgZ(1,"mat-icon"),t._uU(2,"receipt"),t.qZA()()}}function xa(n,o){if(1&n&&(t.TgZ(0,"td",18),t.YNc(1,va,3,0,"button",36),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.Q6J("ngIf",!!e.uuid)}}function Oa(n,o){1&n&&t._UZ(0,"tr",24)}function Za(n,o){1&n&&t._UZ(0,"tr",25),2&n&&t.ekj("table-primary",!o.$implicit.name)}let Pa=(()=>{class n{constructor(e,a,i,r,s,_,d){(0,c.Z)(this,"route",void 0),(0,c.Z)(this,"router",void 0),(0,c.Z)(this,"elementRef",void 0),(0,c.Z)(this,"communication",void 0),(0,c.Z)(this,"notification",void 0),(0,c.Z)(this,"databaseService",void 0),(0,c.Z)(this,"additionalData",void 0),(0,c.Z)(this,"dataSource",void 0),(0,c.Z)(this,"secondaryDataSource",void 0),(0,c.Z)(this,"displayedColumns",["name","groupName","balanceMoney","tailNo"]),(0,c.Z)(this,"totalBalance",""),(0,c.Z)(this,"subscription",new ft.w0),this.route=e,this.router=a,this.elementRef=i,this.communication=r,this.notification=s,this.databaseService=_,this.additionalData=d,this.dataSource=new R.by,this.secondaryDataSource=new R.by}ngOnInit(){this.subscription.add(this.communication.acceptRefreshCommand().pipe((0,ct.b)(300)).subscribe(()=>{this.updateAccounts()})),this.communication.giveRefreshCommand()}ngOnDestroy(){this.subscription.unsubscribe()}goToEntryList(e){this.router.navigate(["accounts",e.uuid],{queryParams:{title:e.name},relativeTo:this.route.parent})}updateAccounts(){this.notification.showLoading(this.elementRef.nativeElement),(0,rt.D)([this.databaseService.getVisibleAccountList(),this.databaseService.getHiddenAccountList(),this.additionalData.getBankList()]).pipe((0,Y.x)(()=>{this.notification.hideLoading()})).subscribe(e=>{const a=e[0],i=e[1],r=e[2].banks,s=a.data.accountSummary[0];let d,_=[];a.data.accountList.forEach(u=>{u.accountData.forEach(f=>{d=r.find(l=>f.bankId===l.id.toString()),f.groupName=u.groupName,f.balanceMoney=f.balanceMoney/100,f.bank=d}),_.push({name:"",groupName:u.groupName,balanceMoney:u.groupMoney.summaryAssets/100,moneyType:u.groupMoney.allMoneyCategory[0].moneyType}),_=_.concat(u.accountData)}),this.dataSource.data=_,this.totalBalance=s.moneyType.flag+" "+s.assets/100,this.secondaryDataSource.data=i.data})}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(W.gz),t.Y36(W.F0),t.Y36(t.SBq),t.Y36(At.O),t.Y36(st.g),t.Y36(_t),t.Y36(we))}),(0,c.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-accounts"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:36,vars:8,consts:function(){let o,e,a,i,r,s;return o="Alias",e="Type",a="Balance",i="Alias",r="Type",s="Balance",[["appStartContent","",1,"d-flex","flex-column","h-100"],[1,"w-100","h-100","overflow-auto"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","groupName"],["matColumnDef","balanceMoney"],["matColumnDef","tailNo","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-cell","",3,"ngSwitch",4,"matCellDef"],["matColumnDef","tailNo"],["mat-row","",3,"table-primary",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],o,["mat-cell",""],[1,"text-muted"],e,a,["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""],i,r,["mat-cell","",3,"ngSwitch"],[4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchDefault"],[3,"ngSwitch"],[4,"ngSwitchDefault"],["fontSet","Marching"],["width","32","height","32",3,"alt","src"],s,["type","button","mat-icon-button","","color","primary","class","mat-button-mini","y","",3,"click",4,"ngIf"],["type","button","mat-icon-button","","color","primary","y","",1,"mat-button-mini",3,"click"]]},template:function(e,a){1&e&&(t._UZ(0,"app-default-operation-toolbar")(1,"app-breadcrumb"),t.TgZ(2,"app-two-cols-layout")(3,"div",0)(4,"div",1)(5,"table",2),t.ynx(6,3),t.YNc(7,_a,3,0,"th",4),t.YNc(8,la,4,2,"td",5),t.BQk(),t.ynx(9,6),t.YNc(10,da,3,0,"th",4),t.YNc(11,ua,2,1,"td",5),t.BQk(),t.ynx(12,7),t.YNc(13,ma,3,0,"th",4),t.YNc(14,ga,3,5,"td",5),t.BQk(),t.ynx(15,8),t.YNc(16,pa,1,0,"th",9),t.YNc(17,ha,4,0,"td",5),t.BQk(),t.YNc(18,fa,1,0,"tr",10),t.YNc(19,Aa,1,0,"tr",11),t.qZA()()(),t.TgZ(20,"div",12)(21,"table",2),t.ynx(22,3),t.YNc(23,Ea,3,0,"th",4),t.YNc(24,Ta,2,1,"td",5),t.BQk(),t.ynx(25,6),t.YNc(26,Ca,3,0,"th",4),t.YNc(27,Ra,3,2,"td",13),t.BQk(),t.ynx(28,7),t.YNc(29,Ia,4,1,"th",4),t.YNc(30,ya,3,5,"td",5),t.BQk(),t.ynx(31,14),t.YNc(32,Da,1,0,"th",9),t.YNc(33,xa,2,1,"td",5),t.BQk(),t.YNc(34,Oa,1,0,"tr",10),t.YNc(35,Za,1,2,"tr",15),t.qZA()()()),2&e&&(t.xp6(5),t.Q6J("dataSource",a.secondaryDataSource),t.xp6(13),t.Q6J("matHeaderRowDef",a.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(2),t.Q6J("dataSource",a.dataSource),t.xp6(13),t.Q6J("matHeaderRowDef",a.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns))},dependencies:[y.O5,y.RF,y.n9,y.ED,lt.RK,Nt.Hw,R.BZ,R.fO,R.as,R.w1,R.Dz,R.nj,R.ge,R.ev,R.XQ,R.Gk,Gt.L,ae.Y,oe.o,ie.h,y.i8,y.JJ],styles:[".table[_ngcontent-%COMP%]{font-size:.75rem}img[_ngcontent-%COMP%]{width:32px;height:32px;vertical-align:middle}"]})),n})();var $e=g(418),wa=g(6054),$a=g(6451),Ye=g(8505);class ke extends R._4{constructor(o,e,a=!0,i=!0){super(),(0,c.Z)(this,"remoteSourceFn",void 0),(0,c.Z)(this,"dataConverter",void 0),(0,c.Z)(this,"remotePagetion",void 0),(0,c.Z)(this,"readied",void 0),(0,c.Z)(this,"loading",!1),(0,c.Z)(this,"pageSizeOptions",[20,50,100]),(0,c.Z)(this,"x",void 0),(0,c.Z)(this,"responseError",new t.vpe),(0,c.Z)(this,"pageSize",void 0),(0,c.Z)(this,"countId",0),(0,c.Z)(this,"dataSubscription",void 0),(0,c.Z)(this,"pageTokenMap",new Map),this.remoteSourceFn=o,this.dataConverter=e,this.remotePagetion=a,this.readied=i}reset(){const o=this.paginator;this.pageTokenMap.clear(),o&&(o.pageIndex=0),this.reload()}reload(){this.load().subscribe()}_updateChangeSubscription(){super._updateChangeSubscription();const o=this.paginator;let e;o&&(o.pageSizeOptions=this.pageSizeOptions,this.pageSize=o.pageSize),e=this.remotePagetion&&o?(0,$a.T)(o.page.pipe((0,kt.h)(i=>this.pageSize===i.pageSize||(this.pageSize=i.pageSize,this.reset(),!1))),o.initialized):(0,P.of)(null);const a=e.pipe((0,kt.h)(()=>this.readied&&!!this.pageTokenMap),(0,Wt.w)(()=>this.load()));this.dataSubscription?.unsubscribe(),this.dataSubscription=a.subscribe()}_pageData(o){return this.remotePagetion?o:super._pageData(o)}_updatePaginator(o){!this.remotePagetion&&super._updatePaginator(o)}load(){const o=this.paginator,e=(0,P.of)(null);return o?e.pipe((0,Ye.b)(()=>{this.loading=!0,this.countId++,o.disabled=!0}),(0,Wt.w)(()=>{const a=this.countId,i=new ht.kl;return i.pageSize=o.pageSize,i.pageIndex=o.pageIndex,this.remoteSourceFn(i,this.pageTokenMap.get(o.pageIndex)||"").pipe((0,z.K)(r=>(this.responseError.emit(r),(0,P.of)({}))),(0,Y.x)(()=>{this.loading=a!==this.countId&&this.loading}))}),(0,H.U)(a=>{const i=this.dataConverter(a);return this.data=i,o.disabled=!1,i})):e}}var Le=g(598);let vt=(()=>{class n{constructor(e){(0,c.Z)(this,"router",void 0),this.router=e}addNewOne(e,a){this.router.navigate([{outlets:{secondary:["entry","add",e]}}],{queryParamsHandling:"preserve",relativeTo:a})}edit(e,a){let i;i=null===e.recType?["balance",e.id]:["entry",e.bkId,e.id],this.router.navigate([{outlets:{secondary:i}}],{queryParamsHandling:"preserve",relativeTo:a,state:e})}closeSecondaryOutlet(e){this.router.navigate([{outlets:{secondary:null}}],{queryParamsHandling:"preserve",relativeTo:e})}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.LFG(W.F0))}),(0,c.Z)(n,"\u0275prov",t.Yz7({token:n,factory:n.\u0275fac})),n})();var Be=g(1292),re=g(8097);function Ya(n,o){if(1&n&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function ka(n,o){1&n&&(t.ynx(0),t.SDv(1,72),t.BQk())}function La(n,o){1&n&&(t.ynx(0),t.SDv(1,73),t.BQk())}function Ba(n,o){1&n&&(t.ynx(0),t.SDv(1,74),t.BQk())}function Ga(n,o){1&n&&(t.ynx(0),t.SDv(1,75),t.BQk())}function Qa(n,o){1&n&&(t.ynx(0),t.SDv(1,76),t.BQk())}function Ja(n,o){if(1&n&&(t.TgZ(0,"mat-option",16),t.ynx(1,70),t.YNc(2,ka,2,0,"ng-container",71),t.YNc(3,La,2,0,"ng-container",71),t.YNc(4,Ba,2,0,"ng-container",71),t.YNc(5,Ga,2,0,"ng-container",71),t.YNc(6,Qa,2,0,"ng-container",71),t.BQk(),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.Q6J("ngSwitch",e),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4),t.xp6(1),t.Q6J("ngSwitchCase",5)}}function Xa(n,o){if(1&n&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function Wa(n,o){if(1&n&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function Ua(n,o){if(1&n&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function za(n,o){if(1&n&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function Ha(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"th",77)(1,"mat-checkbox",78),t.NdJ("change",function(i){t.CHM(e);const r=t.oxw();return t.KtG(i?r.masterToggle():null)}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("checked",e.selection.hasValue()&&e.isAllSelected())("indeterminate",e.selection.hasValue()&&!e.isAllSelected())("matBadge",e.selection.selected.length)}}function qa(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"td",79)(1,"mat-checkbox",80),t.NdJ("click",function(i){return i.stopPropagation()})("change",function(i){const s=t.CHM(e).$implicit,_=t.oxw();return t.KtG(i?_.selection.toggle(s):null)}),t.qZA()()}if(2&n){const e=o.$implicit,a=t.oxw();t.xp6(1),t.Q6J("checked",a.selection.isSelected(e))}}function Fa(n,o){1&n&&(t.TgZ(0,"th",81),t.ynx(1),t.SDv(2,82),t.BQk(),t.qZA())}function ja(n,o){if(1&n&&(t.TgZ(0,"td",79)(1,"span",83),t._uU(2),t.ALo(3,"date"),t.qZA()()),2&n){const e=o.$implicit;t.xp6(2),t.Oqu(t.xi3(3,1,e.bizTime,"yyyy-MM-dd HH:mm:ss"))}}function Va(n,o){1&n&&(t.TgZ(0,"th",81),t.ynx(1),t.SDv(2,84),t.BQk(),t.qZA())}function Ka(n,o){1&n&&(t.TgZ(0,"mat-icon",91),t._uU(1,"remove"),t.qZA())}function to(n,o){1&n&&(t.TgZ(0,"mat-icon",92),t._uU(1,"add"),t.qZA())}function eo(n,o){if(1&n&&(t.TgZ(0,"mat-icon",93),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit,a=t.oxw();t.xp6(1),t.Oqu(e.targetId===a.accountId?"add":"remove")}}function no(n,o){if(1&n&&(t.TgZ(0,"mat-icon"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.ekj("text-info",0===e.recSubtype)("text-warning",0!==e.recSubtype),t.xp6(1),t.hij(" ",0===e.recSubtype?"add":"remove"," ")}}function ao(n,o){if(1&n&&(t.TgZ(0,"mat-icon"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.ekj("text-info",0===e.recSubtype)("text-warning",0!==e.recSubtype),t.xp6(1),t.hij(" ",0===e.recSubtype?"add":"remove"," ")}}function oo(n,o){1&n&&(t.TgZ(0,"mat-icon",93),t._uU(1,"help_outline"),t.qZA())}function io(n,o){if(1&n&&(t.TgZ(0,"td",85),t.YNc(1,Ka,2,0,"mat-icon",86),t.YNc(2,to,2,0,"mat-icon",87),t.YNc(3,eo,2,1,"mat-icon",88),t.YNc(4,no,2,5,"mat-icon",89),t.YNc(5,ao,2,5,"mat-icon",89),t.YNc(6,oo,2,0,"mat-icon",90),t._uU(7),t.ALo(8,"number"),t.qZA()),2&n){const e=o.$implicit;t.Q6J("ngSwitch",e.recType),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4),t.xp6(1),t.Q6J("ngSwitchCase",5),t.xp6(2),t.AsE(" ",e.currencyFlag," ",t.xi3(8,8,e.amount/100,"0.2-2")," ")}}function ro(n,o){1&n&&(t.TgZ(0,"th",81),t.ynx(1),t.SDv(2,94),t.BQk(),t.qZA())}function co(n,o){if(1&n&&(t.TgZ(0,"td",95),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.hij(" ",e.categoryName," ")}}function so(n,o){1&n&&(t.TgZ(0,"th",81),t.ynx(1),t.SDv(2,96),t.BQk(),t.qZA())}function _o(n,o){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=o.$implicit,a=o.last;t.xp6(1),t.AsE(" ",e.name,"",a?"":"/"," ")}}function lo(n,o){if(1&n&&(t.TgZ(0,"td",95),t.YNc(1,_o,2,2,"ng-container",97),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.Q6J("ngForOf",e.members)}}function uo(n,o){1&n&&(t.TgZ(0,"th",81),t.ynx(1),t.SDv(2,98),t.BQk(),t.qZA())}function mo(n,o){if(1&n&&(t.TgZ(0,"td",95),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.Oqu(e.tradetgtName)}}function go(n,o){1&n&&(t.TgZ(0,"th",81),t.ynx(1),t.SDv(2,99),t.BQk(),t._uU(3,"/ "),t.ynx(4),t.SDv(5,100),t.BQk(),t.qZA())}function po(n,o){if(1&n&&(t.ynx(0)(1),t._uU(2),t.BQk()()),2&n){const e=o.$implicit,a=o.last;t.xp6(2),t.AsE("",e.name,"",a?"":", ","")}}function ho(n,o){if(1&n&&(t.TgZ(0,"td",101)(1,"small",83),t.YNc(2,po,3,2,"ng-container",97),t.qZA(),t._UZ(3,"br"),t.TgZ(4,"small",83),t._uU(5),t.qZA()()),2&n){const e=o.$implicit;t.xp6(2),t.Q6J("ngForOf",e.tags),t.xp6(3),t.Oqu(e.accountName)}}function fo(n,o){1&n&&(t.TgZ(0,"th",81),t.ynx(1),t.SDv(2,102),t.BQk(),t.qZA())}function Ao(n,o){if(1&n&&(t.TgZ(0,"td",103)(1,"span",104),t._uU(2),t.qZA()()),2&n){const e=o.$implicit;t.xp6(2),t.Oqu(e.comment)}}function Eo(n,o){1&n&&t._UZ(0,"th",105)}function To(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"td",79)(1,"button",106),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.edit(r))}),t.TgZ(2,"mat-icon"),t._uU(3,"edit"),t.qZA()()()}}function Co(n,o){if(1&n&&(t.TgZ(0,"td",79),t._uU(1),t.ALo(2,"date"),t.qZA()),2&n){const e=o.$implicit,a=t.oxw();t.uIk("colspan",a.displayedColumns.length),t.xp6(1),t.AsE(" ",t.xi3(2,3,e.bizTime,"yyyy-MM-dd EEEE")," \xa0\xa0\xa0\xa0\xa0 ",e.comment," ")}}function So(n,o){1&n&&t._UZ(0,"tr",107)}function bo(n,o){1&n&&t._UZ(0,"tr",108)}function No(n,o){1&n&&t._UZ(0,"tr",109)}const Mo=function(){return["daySummary"]};let Ro=(()=>{class n extends((0,wa.tS)(class{})){constructor(e,a,i,r,s,_,d,u,f){super(),(0,c.Z)(this,"route",void 0),(0,c.Z)(this,"elementRef",void 0),(0,c.Z)(this,"dateAdapter",void 0),(0,c.Z)(this,"algorithm",void 0),(0,c.Z)(this,"communication",void 0),(0,c.Z)(this,"notification",void 0),(0,c.Z)(this,"datetimeService",void 0),(0,c.Z)(this,"databaseService",void 0),(0,c.Z)(this,"operation",void 0),(0,c.Z)(this,"books",[]),(0,c.Z)(this,"recordTypes",[I.PAY,I.REVENUE,I.TRANSFER,I.BORROW,I.RETURN]),(0,c.Z)(this,"accounts",[]),(0,c.Z)(this,"projects",[]),(0,c.Z)(this,"members",[]),(0,c.Z)(this,"payCategories",[]),(0,c.Z)(this,"txnObjects",[]),(0,c.Z)(this,"searchKeys",{bkId:null,startTime:0,endTime:0,amountStart:null,amountEnd:null,comment:null,recTypeList:null,mainTypeIdList:null,subTypeIdList:null,accountIdList:null,projectIdList:null,tradetgtIdList:null,memberIdList:null,reimburseList:null,categoryIdList:null,queryFlowCount:!0}),(0,c.Z)(this,"displayedColumns",[]),(0,c.Z)(this,"dataSource",void 0),(0,c.Z)(this,"selection",new $e.Ov(!0,[])),(0,c.Z)(this,"totalEntry",void 0),(0,c.Z)(this,"range",new T.cw({start:new T.NI(null),end:new T.NI(null)})),(0,c.Z)(this,"paginator",void 0),(0,c.Z)(this,"deleting",!1),(0,c.Z)(this,"columnsToDisplay",["select","bizTime","amount","categoryName","members","tradetgtName","tags","comment","operation"]),(0,c.Z)(this,"isSummary",(l,p)=>!p.id),(0,c.Z)(this,"isNotSummary",(l,p)=>!!p.id),this.route=e,this.elementRef=a,this.dateAdapter=i,this.algorithm=r,this.communication=s,this.notification=_,this.datetimeService=d,this.databaseService=u,this.operation=f,this.dataSource=new ke(l=>{const p=this.range.controls.start.value,A=this.range.controls.end.value,E={...this.searchKeys,startTime:p?this.datetimeService.getStartDatetime(p).valueOf():null,endTime:A?this.datetimeService.getEndDatetime(A).valueOf():null,pageSize:l.pageSize,pageIndex:l.pageIndex+1};let h;for(const m in E)h=E[m],Array.isArray(h)&&!h.length&&(E[m]=null);return this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.queryEntries(E).pipe((0,z.K)(()=>(0,P.of)({code:500,data:{dailyItems:[],flowCount:0},error:""})))},l=>{const p=this.dateAdapter,A=this.accounts;let E=[];return this.selection.clear(),this.notification.hideLoading(),l.data.dailyItems?.forEach(h=>{E.push({bizTime:p.toIso8601(p.deserialize(h.date)),comment:" + "+h.income+"   |   - "+h.outgo}),h.flowList.forEach(m=>{m.accountName=A.find(S=>S.uuid===m.accountId)?.name}),E=E.concat(h.flowList)}),this.totalEntry=`${l.data.totalIncomeString} | -${l.data.totalOutgoString}`,this.paginator.length=(0,w.su)(l?.data?.flowCount),E},!0,!1)}ngOnInit(){this.dataSource.paginator=this.paginator,this.datetimeService.initTimeRange(this.range),this.displayedColumns=this.columnsToDisplay,(0,rt.D)([this.databaseService.getBooks(),this.databaseService.getShortAccounts()]).pipe((0,Y.x)(()=>{this.notification.hideLoading()})).subscribe(e=>{this.books=e[0].data.books;const a=this.books[0];a&&(this.searchKeys.bkId=a.id,this.dataSource.readied=!0,this.onBookSelectionChange({value:a.id})),this.accounts=e[1].data.accounts,this.initRefreshIndicator()})}ngOnDestroy(){this.datetimeService.destoryTimeRange()}onBookSelectionChange(e){const a=e.value;this.notification.showLoading(this.elementRef.nativeElement),(0,rt.D)([this.databaseService.getTransactionObjects(a),this.databaseService.getBookProjects(a),this.databaseService.getMembers(a),this.databaseService.getEntryCategories(a,J.PAY)]).pipe((0,Y.x)(()=>{this.notification.hideLoading(),this.communication.giveRefreshCommand()})).subscribe(i=>{this.txnObjects=i[0].data.bookTradeTargets,this.projects=i[1].data.bookProjects,this.members=i[2].data.bookMembers,this.payCategories=i[3].data.bookCategories})}isAllSelected(){const a=this.dataSource.data.length;return a>0&&this.selection.selected.length===a}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(e=>this.selection.select(e))}search(){this.dataSource.reset()}reset(){const e=this.dateAdapter,a=this.searchKeys,i=e.today(),r=e.createDate(e.getYear(i),e.getMonth(i),1);this.range.setValue({start:r,end:i}),a.bkId=this.books[0].id,a.amountStart=null,a.amountEnd=null,a.comment=null,a.recTypeList=null,a.mainTypeIdList=null,a.subTypeIdList=null,a.accountIdList=null,a.projectIdList=null,a.tradetgtIdList=null,a.memberIdList=null,a.reimburseList=null,this.dataSource.reset()}addNewOne(){this.operation.addNewOne("new",this.route.parent)}edit(e){this.operation.edit(e,this.route.parent)}delete(){const e=this.selection.selected.map(a=>a.id);!e.length||this.deleting||(this.deleting=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.deleteEntries(e).pipe((0,Y.x)(()=>{this.deleting=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand()})).subscribe())}initRefreshIndicator(){this.subscription.add(this.communication.acceptRefreshCommand().pipe((0,ct.b)(300)).subscribe(()=>{this.dataSource.reload()}))}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(W.gz),t.Y36(t.SBq),t.Y36(Q._A),t.Y36(Le.e),t.Y36(At.O),t.Y36(st.g),t.Y36(Ut.d),t.Y36(_t),t.Y36(vt))}),(0,c.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-search-entries"]],viewQuery:function(e,a){if(1&e&&t.Gf(ht.NW,7),2&e){let i;t.iGM(i=t.CRH())&&(a.paginator=i.first)}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],features:[t.qOj],decls:122,vars:34,consts:function(){let o,e,a,i,r,s,_,d,u,f,l,p,A,E,h,m,S,X,k,nt,x,dt,ut,at,mt,ot,N,L,O,B,it;return o="Account book",e="Date range",a="Start date",i="End date",r="Type",s="Balance modification",_="Amount",d="Comment",u="Account",f="Member",l="Trader",p="Tags",A="Reimburse",E="To be reimbursed",h="Reimbursed",m="Non-reimbursable",S="Search",X="Reset",k="Pay",nt="Revenue",x="Transfer",dt="Loan(incoming)",ut="Loan(outing)",at="Time",mt="Amount",ot="Category",N="Member",L="Trader",O="Tags",B="Account",it="Comment",[[3,"new","delete"],[1,"align-middle","ms-2"],["appStartContent","",1,"d-flex","flex-column","h-100",3,"ngSubmit"],[1,"flex-fill","overflow-auto","p-3"],["appearance","outline",1,"w-100"],o,["name","book",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],e,[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder",a],["matEndDate","","formControlName","end","placeholder",i],["matSuffix","",3,"for"],["picker",""],r,["name","recordTypes","multiple","",3,"value","valueChange"],[3,"value"],s,_,[1,"d-flex","flex-row","flex-nowrap"],["name","amountStart","type","number","matInput","",3,"ngModel","ngModelChange"],[1,"mx-2","flex-grow-0","flex-shrink-0"],["name","amountEnd","type","number","matInput","",3,"ngModel","ngModelChange","click"],d,["name","comment","type","text","matInput","",3,"ngModel","ngModelChange"],u,["name","accounts","multiple","",3,"value","valueChange"],f,["name","members","multiple","",3,"value","valueChange"],l,["name","txnObjects","multiple","",3,"value","valueChange"],p,["name","tags","multiple","",3,"ngModel","ngModelChange"],A,["name","reimburse","multiple","",3,"ngModel","ngModelChange"],E,h,m,[1,"container-fluid","py-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2"],["fontset","Marching"],S,["type","button","mat-stroked-button","","color","primary",3,"click"],X,[1,"d-flex","flex-column","flex-nowrap","h-100"],[1,"flex-fill","overflow-hidden"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","select","sticky","true"],["mat-header-cell","","style","width: 50px;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","bizTime"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","amount"],["mat-cell","","class","text-nowrap",3,"ngSwitch",4,"matCellDef"],["matColumnDef","categoryName"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","members"],["matColumnDef","tradetgtName"],["matColumnDef","tags"],["mat-cell","","style","line-height: 1.1;",4,"matCellDef"],["matColumnDef","comment"],["mat-cell","","width","1000",4,"matCellDef"],["matColumnDef","operation","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["matColumnDef","daySummary"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["class","table-primary text-start","mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["showFirstLastButtons","",3,"pageSizeOptions","pageSize"],[3,"ngSwitch"],[4,"ngSwitchCase"],k,nt,x,dt,ut,["mat-header-cell","",2,"width","50px"],["matBadgeColor","warn",1,"mat-checkbox-mini",3,"checked","indeterminate","matBadge","change"],["mat-cell",""],[1,"mat-checkbox-mini",3,"checked","click","change"],["mat-header-cell",""],at,[1,"text-nowrap"],mt,["mat-cell","",1,"text-nowrap",3,"ngSwitch"],["class","text-danger",4,"ngSwitchCase"],["class","text-success",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchCase"],[3,"text-info","text-warning",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchDefault"],[1,"text-danger"],[1,"text-success"],[1,"text-muted"],ot,["mat-cell","",1,"text-nowrap"],N,[4,"ngFor","ngForOf"],L,O,B,["mat-cell","",2,"line-height","1.1"],it,["mat-cell","","width","1000"],[1,"ellipsis-description-line-2"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""],["mat-row","",1,"table-primary","text-start"]]},template:function(e,a){if(1&e&&(t.TgZ(0,"app-default-operation-toolbar",0),t.NdJ("new",function(){return a.addNewOne()})("delete",function(){return a.delete()}),t.qZA(),t.TgZ(1,"app-breadcrumb")(2,"span",1),t._uU(3),t.qZA()(),t.TgZ(4,"app-two-cols-layout")(5,"form",2),t.NdJ("ngSubmit",function(){return a.search()}),t.TgZ(6,"div",3)(7,"mat-form-field",4)(8,"mat-label"),t.ynx(9),t.SDv(10,5),t.BQk(),t.qZA(),t.TgZ(11,"mat-select",6),t.NdJ("valueChange",function(r){return a.searchKeys.bkId=r})("selectionChange",function(r){return a.onBookSelectionChange(r)}),t.YNc(12,Ya,2,2,"mat-option",7),t.qZA()(),t.TgZ(13,"mat-form-field",4)(14,"mat-label"),t.SDv(15,8),t.qZA(),t.TgZ(16,"mat-date-range-input",9),t._UZ(17,"input",10)(18,"input",11),t.qZA(),t._UZ(19,"mat-datepicker-toggle",12)(20,"mat-date-range-picker",null,13),t.qZA(),t.TgZ(22,"mat-form-field",4)(23,"mat-label"),t.SDv(24,14),t.qZA(),t.TgZ(25,"mat-select",15),t.NdJ("valueChange",function(r){return a.searchKeys.recTypeList=r}),t.YNc(26,Ja,7,7,"mat-option",7),t.TgZ(27,"mat-option",16),t.SDv(28,17),t.qZA()()(),t.TgZ(29,"mat-form-field",4)(30,"mat-label"),t.SDv(31,18),t.qZA(),t.TgZ(32,"div",19)(33,"input",20),t.NdJ("ngModelChange",function(r){return a.searchKeys.amountStart=r}),t.qZA(),t.TgZ(34,"mat-icon",21),t._uU(35,"settings_ethernet"),t.qZA(),t.TgZ(36,"input",22),t.NdJ("ngModelChange",function(r){return a.searchKeys.amountEnd=r})("click",function(r){return r.stopPropagation()}),t.qZA()()(),t.TgZ(37,"mat-form-field",4)(38,"mat-label"),t.SDv(39,23),t.qZA(),t.TgZ(40,"input",24),t.NdJ("ngModelChange",function(r){return a.searchKeys.comment=r}),t.qZA()(),t.TgZ(41,"mat-form-field",4)(42,"mat-label"),t.SDv(43,25),t.qZA(),t.TgZ(44,"mat-select",26),t.NdJ("valueChange",function(r){return a.searchKeys.accountIdList=r}),t.YNc(45,Xa,2,2,"mat-option",7),t.qZA()(),t.TgZ(46,"mat-form-field",4)(47,"mat-label"),t.SDv(48,27),t.qZA(),t.TgZ(49,"mat-select",28),t.NdJ("valueChange",function(r){return a.searchKeys.memberIdList=r}),t.YNc(50,Wa,2,2,"mat-option",7),t.qZA()(),t.TgZ(51,"mat-form-field",4)(52,"mat-label"),t.SDv(53,29),t.qZA(),t.TgZ(54,"mat-select",30),t.NdJ("valueChange",function(r){return a.searchKeys.tradetgtIdList=r}),t.YNc(55,Ua,2,2,"mat-option",7),t.qZA()(),t.TgZ(56,"mat-form-field",4)(57,"mat-label"),t.SDv(58,31),t.qZA(),t.TgZ(59,"mat-select",32),t.NdJ("ngModelChange",function(r){return a.searchKeys.projectIdList=r}),t.YNc(60,za,2,2,"mat-option",7),t.qZA()(),t.TgZ(61,"mat-form-field",4)(62,"mat-label"),t.SDv(63,33),t.qZA(),t.TgZ(64,"mat-select",34),t.NdJ("ngModelChange",function(r){return a.searchKeys.reimburseList=r}),t.TgZ(65,"mat-option",16),t.ynx(66),t.SDv(67,35),t.BQk(),t.qZA(),t.TgZ(68,"mat-option",16),t.ynx(69),t.SDv(70,36),t.BQk(),t.qZA(),t.TgZ(71,"mat-option",16),t.ynx(72),t.SDv(73,37),t.BQk(),t.qZA()()()(),t.TgZ(74,"div",38)(75,"button",39)(76,"mat-icon",40),t._uU(77,"search"),t.qZA(),t.ynx(78),t.SDv(79,41),t.BQk(),t.qZA(),t.TgZ(80,"button",42),t.NdJ("click",function(){return a.reset()}),t.TgZ(81,"mat-icon"),t._uU(82,"search_off"),t.qZA(),t.ynx(83),t.SDv(84,43),t.BQk(),t.qZA()()(),t.TgZ(85,"div",44)(86,"div",45)(87,"div",46)(88,"table",47),t.ynx(89,48),t.YNc(90,Ha,2,3,"th",49),t.YNc(91,qa,2,1,"td",50),t.BQk(),t.ynx(92,51),t.YNc(93,Fa,3,0,"th",52),t.YNc(94,ja,4,4,"td",50),t.BQk(),t.ynx(95,53),t.YNc(96,Va,3,0,"th",52),t.YNc(97,io,9,11,"td",54),t.BQk(),t.ynx(98,55),t.YNc(99,ro,3,0,"th",52),t.YNc(100,co,2,1,"td",56),t.BQk(),t.ynx(101,57),t.YNc(102,so,3,0,"th",52),t.YNc(103,lo,2,1,"td",56),t.BQk(),t.ynx(104,58),t.YNc(105,uo,3,0,"th",52),t.YNc(106,mo,2,1,"td",56),t.BQk(),t.ynx(107,59),t.YNc(108,go,6,0,"th",52),t.YNc(109,ho,6,2,"td",60),t.BQk(),t.ynx(110,61),t.YNc(111,fo,3,0,"th",52),t.YNc(112,Ao,3,1,"td",62),t.BQk(),t.ynx(113,63),t.YNc(114,Eo,1,0,"th",64),t.YNc(115,To,4,0,"td",50),t.BQk(),t.ynx(116,65),t.YNc(117,Co,3,6,"td",50),t.BQk(),t.YNc(118,So,1,0,"tr",66),t.YNc(119,bo,1,0,"tr",67),t.YNc(120,No,1,0,"tr",68),t.qZA()()(),t._UZ(121,"mat-paginator",69),t.qZA()()),2&e){const i=t.MAs(21);t.xp6(3),t.Oqu(a.totalEntry),t.xp6(8),t.Q6J("value",a.searchKeys.bkId),t.xp6(1),t.Q6J("ngForOf",a.books),t.xp6(4),t.Q6J("formGroup",a.range)("rangePicker",i),t.xp6(3),t.Q6J("for",i),t.xp6(6),t.Q6J("value",a.searchKeys.recTypeList),t.xp6(1),t.Q6J("ngForOf",a.recordTypes),t.xp6(1),t.Q6J("value",null),t.xp6(6),t.Q6J("ngModel",a.searchKeys.amountStart),t.xp6(3),t.Q6J("ngModel",a.searchKeys.amountEnd),t.xp6(4),t.Q6J("ngModel",a.searchKeys.comment),t.xp6(4),t.Q6J("value",a.searchKeys.accountIdList),t.xp6(1),t.Q6J("ngForOf",a.accounts),t.xp6(4),t.Q6J("value",a.searchKeys.memberIdList),t.xp6(1),t.Q6J("ngForOf",a.members),t.xp6(4),t.Q6J("value",a.searchKeys.tradetgtIdList),t.xp6(1),t.Q6J("ngForOf",a.txnObjects),t.xp6(4),t.Q6J("ngModel",a.searchKeys.projectIdList),t.xp6(1),t.Q6J("ngForOf",a.projects),t.xp6(4),t.Q6J("ngModel",a.searchKeys.reimburseList),t.xp6(1),t.Q6J("value",1),t.xp6(3),t.Q6J("value",2),t.xp6(3),t.Q6J("value",0),t.xp6(17),t.Q6J("dataSource",a.dataSource),t.xp6(30),t.Q6J("matHeaderRowDef",a.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns)("matRowDefWhen",a.isNotSummary),t.xp6(1),t.Q6J("matRowDefColumns",t.DdM(33,Mo))("matRowDefWhen",a.isSummary),t.xp6(1),t.Q6J("pageSizeOptions",a.dataSource.pageSizeOptions)("pageSize",a.dataSource.pageSizeOptions[0])}},dependencies:[y.sg,y.RF,y.n9,y.ED,Xt.k,T._Y,T.Fj,T.wV,T.JJ,T.JL,T.On,T.F,lt.lW,lt.RK,Be.oG,v.nW,v.wx,v.zY,v.By,v._g,$.KE,$.hX,$.R9,Nt.Hw,re.Nt,Bt.gD,Q.ey,T.sg,T.u,ht.NW,R.BZ,R.fO,R.as,R.w1,R.Dz,R.nj,R.ge,R.ev,R.XQ,R.Gk,Gt.L,ae.Y,oe.o,ie.h,y.JJ,ne.e],encapsulation:2})),n})();var Ge=g(2843),Io=g(877);function yo(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"th",35)(1,"mat-checkbox",36),t.NdJ("change",function(i){t.CHM(e);const r=t.oxw();return t.KtG(i?r.masterToggle():null)}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("checked",e.selection.hasValue()&&e.isAllSelected())("indeterminate",e.selection.hasValue()&&!e.isAllSelected())("matBadge",e.selection.selected.length)}}function Do(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"td",37)(1,"mat-checkbox",38),t.NdJ("click",function(i){return i.stopPropagation()})("change",function(i){const s=t.CHM(e).$implicit,_=t.oxw();return t.KtG(i?_.selection.toggle(s):null)}),t.qZA()()}if(2&n){const e=o.$implicit,a=t.oxw();t.xp6(1),t.Q6J("checked",a.selection.isSelected(e))}}function vo(n,o){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,40),t.BQk(),t.qZA())}function xo(n,o){if(1&n&&(t.TgZ(0,"td",37)(1,"span",41),t._uU(2),t.ALo(3,"date"),t.qZA()()),2&n){const e=o.$implicit;t.xp6(2),t.Oqu(t.xi3(3,1,e.bizTime,"yyyy-MM-dd HH:mm:ss"))}}function Oo(n,o){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,42),t.BQk(),t.qZA())}function Zo(n,o){1&n&&(t.TgZ(0,"mat-icon",49),t._uU(1,"remove"),t.qZA())}function Po(n,o){1&n&&(t.TgZ(0,"mat-icon",50),t._uU(1,"add"),t.qZA())}function wo(n,o){if(1&n&&(t.TgZ(0,"mat-icon",51),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit,a=t.oxw();t.xp6(1),t.Oqu(e.targetId===a.accountId?"add":"remove")}}function $o(n,o){if(1&n&&(t.TgZ(0,"mat-icon"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.ekj("text-info",0===e.recSubtype)("text-warning",0!==e.recSubtype),t.xp6(1),t.hij(" ",0===e.recSubtype?"add":"remove"," ")}}function Yo(n,o){if(1&n&&(t.TgZ(0,"mat-icon"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.ekj("text-info",0===e.recSubtype)("text-warning",0!==e.recSubtype),t.xp6(1),t.hij(" ",0===e.recSubtype?"add":"remove"," ")}}function ko(n,o){1&n&&(t.TgZ(0,"mat-icon",51),t._uU(1,"help_outline"),t.qZA())}function Lo(n,o){if(1&n&&(t.TgZ(0,"td",43),t.YNc(1,Zo,2,0,"mat-icon",44),t.YNc(2,Po,2,0,"mat-icon",45),t.YNc(3,wo,2,1,"mat-icon",46),t.YNc(4,$o,2,5,"mat-icon",47),t.YNc(5,Yo,2,5,"mat-icon",47),t.YNc(6,ko,2,0,"mat-icon",48),t._uU(7),t.ALo(8,"number"),t.qZA()),2&n){const e=o.$implicit;t.Q6J("ngSwitch",e.recType),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4),t.xp6(1),t.Q6J("ngSwitchCase",5),t.xp6(2),t.AsE(" ",e.moneyType.flag," ",t.xi3(8,8,e.amount/100,"0.2-2")," ")}}function Bo(n,o){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,52),t.BQk(),t.qZA())}function Go(n,o){if(1&n&&(t.TgZ(0,"td",53),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.AsE(" ",e.moneyType.flag," ",t.xi3(2,2,e.accountBalance,"0.2-2")," ")}}function Qo(n,o){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,54),t.BQk(),t.qZA())}function Jo(n,o){if(1&n&&(t.TgZ(0,"td",53),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.hij(" ",e.categoryName," ")}}function Xo(n,o){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,55),t.BQk(),t.qZA())}function Wo(n,o){if(1&n&&(t.ynx(0)(1),t._uU(2),t.BQk()()),2&n){const e=o.$implicit,a=o.last;t.xp6(2),t.AsE("",e.name,"",a?"":", ","")}}function Uo(n,o){if(1&n&&(t.TgZ(0,"td",37)(1,"small",41),t.YNc(2,Wo,3,2,"ng-container",56),t.qZA()()),2&n){const e=o.$implicit;t.xp6(2),t.Q6J("ngForOf",e.tags)}}function zo(n,o){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,57),t.BQk(),t.qZA())}function Ho(n,o){if(1&n&&(t.TgZ(0,"td",58)(1,"span",59),t._uU(2),t.qZA()()),2&n){const e=o.$implicit;t.xp6(2),t.Oqu(e.comment)}}function qo(n,o){1&n&&t._UZ(0,"th",60)}function Fo(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"td",37)(1,"button",61),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.edit(r))}),t.TgZ(2,"mat-icon"),t._uU(3,"edit"),t.qZA()()()}}function jo(n,o){1&n&&t._UZ(0,"tr",62)}function Vo(n,o){1&n&&t._UZ(0,"tr",63)}let Ko=(()=>{class n{constructor(e,a,i,r,s,_,d,u,f){(0,c.Z)(this,"elementRef",void 0),(0,c.Z)(this,"route",void 0),(0,c.Z)(this,"dateAdapter",void 0),(0,c.Z)(this,"algorithm",void 0),(0,c.Z)(this,"notification",void 0),(0,c.Z)(this,"communication",void 0),(0,c.Z)(this,"datetimeService",void 0),(0,c.Z)(this,"databaseService",void 0),(0,c.Z)(this,"operation",void 0),(0,c.Z)(this,"displayedColumns",[]),(0,c.Z)(this,"selection",new $e.Ov(!0,[])),(0,c.Z)(this,"dataSource",void 0),(0,c.Z)(this,"showBalance",!1),(0,c.Z)(this,"range",new T.cw({start:new T.NI(null),end:new T.NI(null)})),(0,c.Z)(this,"paginator",void 0),(0,c.Z)(this,"accountId",void 0),(0,c.Z)(this,"deleting",!1),(0,c.Z)(this,"columnsToDisplay",["select","bizTime","amount","accountBalance","categoryName","comment","operation"]),(0,c.Z)(this,"subscription",new ft.w0),this.elementRef=e,this.route=a,this.dateAdapter=i,this.algorithm=r,this.notification=s,this.communication=_,this.datetimeService=d,this.databaseService=u,this.operation=f,this.dataSource=new ke(l=>{const p=this.range.controls.start.value,A=this.range.controls.end.value;return this.notification.showLoading(this.elementRef.nativeElement),(p&&A?this.databaseService.getEntries(this.accountId,this.datetimeService.getStartDatetime(p),this.datetimeService.getEndDatetime(A)):(0,Ge._)(()=>new Error("No datetime conditions"))).pipe((0,z.K)(()=>(0,P.of)({code:500,data:{flows:[]},error:""})))},l=>{this.selection.clear(),this.notification.hideLoading();const p=this.accountId,A=l.data.flows;let E=0;return this.showBalance&&this.algorithm.reverseDeviceOfDuff(A,m=>{switch(m.recType){case I.PAY:E-=m.amount;break;case I.REVENUE:E+=m.amount;break;case I.TRANSFER:m.targetId===p?E+=m.amount:E-=m.amount;break;case I.BORROW:case I.RETURN:0===m.recSubtype?E+=m.amount:E-=m.amount;break;default:E=m.amount}m.accountBalance=E/100}),A},!1,!0)}ngOnInit(){this.displayedColumns=this.columnsToDisplay.filter(e=>"accountBalance"!==e||this.showBalance),this.dataSource.paginator=this.paginator,this.subscription.add(this.route.paramMap.subscribe(e=>{this.accountId=e.get("accountId")})),this.subscription.add(this.communication.acceptRefreshCommand().pipe((0,ct.b)(300)).subscribe(()=>{this.dataSource.reload()})),this.subscription.add(this.range.valueChanges.pipe((0,ct.b)(300)).subscribe(()=>{this.dataSource.reset()})),this.datetimeService.initTimeRange(this.range)}ngOnDestroy(){this.datetimeService.destoryTimeRange(),this.subscription.unsubscribe()}isAllSelected(){const a=this.dataSource.data.length;return a>0&&this.selection.selected.length===a}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(e=>this.selection.select(e))}onShowBalanceChange(e){e.checked?(this.range.setValue({start:this.datetimeService.getMinDate(),end:this.datetimeService.getMaxDate()}),this.range.disable()):this.range.enable(),this.displayedColumns=this.columnsToDisplay.filter(a=>"accountBalance"!==a||this.showBalance)}addNewOne(){this.operation.addNewOne(this.accountId,this.route.parent)}edit(e){this.operation.edit(e,this.route.parent)}delete(){const e=this.selection.selected.map(a=>a.id);!e.length||this.deleting||(this.deleting=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.deleteEntries(e).pipe((0,Y.x)(()=>{this.deleting=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand()})).subscribe())}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(W.gz),t.Y36(Q._A),t.Y36(Le.e),t.Y36(st.g),t.Y36(At.O),t.Y36(Ut.d),t.Y36(_t),t.Y36(vt))}),(0,c.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-account-entries"]],viewQuery:function(e,a){if(1&e&&t.Gf(ht.NW,7),2&e){let i;t.iGM(i=t.CRH())&&(a.paginator=i.first)}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:53,vars:11,consts:function(){let o,e,a,i,r,s,_,d,u,f,l;return o="Date range",e="Start date",a="End date",i="Show balance",r="Review all entries of this account.",s="Time",_="Amount",d="Balance",u="Category",f="Tags",l="Comment",[[3,"new","delete"],["appStartContent","",1,"d-flex","flex-column","h-100"],[1,"p-3"],["appearance","outline",1,"w-100"],o,[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder",e],["matEndDate","","formControlName","end","placeholder",a],["matSuffix","",3,"for","disabled"],["picker",""],["color","primary",3,"ngModel","ngModelChange","change"],i,r,[1,"d-flex","flex-column","flex-nowrap","h-100"],[1,"flex-fill","overflow-hidden"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","select","sticky","true"],["mat-header-cell","","style","min-width: 50px;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","bizTime"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","amount"],["mat-cell","","class","text-nowrap",3,"ngSwitch",4,"matCellDef"],["matColumnDef","accountBalance"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","categoryName"],["matColumnDef","tags"],["matColumnDef","comment"],["mat-cell","","width","1000",4,"matCellDef"],["matColumnDef","operation","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions","pageSize"],["mat-header-cell","",2,"min-width","50px"],["matBadgeColor","warn",1,"mat-checkbox-mini",3,"checked","indeterminate","matBadge","change"],["mat-cell",""],[1,"mat-checkbox-mini",3,"checked","click","change"],["mat-header-cell",""],s,[1,"text-nowrap"],_,["mat-cell","",1,"text-nowrap",3,"ngSwitch"],["class","text-danger",4,"ngSwitchCase"],["class","text-success",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchCase"],[3,"text-info","text-warning",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchDefault"],[1,"text-danger"],[1,"text-success"],[1,"text-muted"],d,["mat-cell","",1,"text-nowrap"],u,f,[4,"ngFor","ngForOf"],l,["mat-cell","","width","1000"],[1,"ellipsis-description-line-2"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",1,"mat-button-mini",3,"click"],["mat-header-row",""],["mat-row",""]]},template:function(e,a){if(1&e&&(t.TgZ(0,"app-default-operation-toolbar",0),t.NdJ("new",function(){return a.addNewOne()})("delete",function(){return a.delete()}),t.qZA(),t._UZ(1,"app-breadcrumb"),t.TgZ(2,"app-two-cols-layout")(3,"div",1)(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),t.SDv(7,4),t.qZA(),t.TgZ(8,"mat-date-range-input",5),t._UZ(9,"input",6)(10,"input",7),t.qZA(),t._UZ(11,"mat-datepicker-toggle",8)(12,"mat-date-range-picker",null,9),t.qZA(),t.TgZ(14,"div")(15,"mat-slide-toggle",10),t.NdJ("ngModelChange",function(r){return a.showBalance=r})("change",function(r){return a.onShowBalanceChange(r)}),t.ynx(16),t.SDv(17,11),t.BQk(),t.qZA()(),t.TgZ(18,"p")(19,"small"),t.ynx(20),t.SDv(21,12),t.BQk(),t.qZA()()()(),t.TgZ(22,"div",13)(23,"div",14)(24,"div",15)(25,"table",16),t.ynx(26,17),t.YNc(27,yo,2,3,"th",18),t.YNc(28,Do,2,1,"td",19),t.BQk(),t.ynx(29,20),t.YNc(30,vo,3,0,"th",21),t.YNc(31,xo,4,4,"td",19),t.BQk(),t.ynx(32,22),t.YNc(33,Oo,3,0,"th",21),t.YNc(34,Lo,9,11,"td",23),t.BQk(),t.ynx(35,24),t.YNc(36,Bo,3,0,"th",21),t.YNc(37,Go,3,5,"td",25),t.BQk(),t.ynx(38,26),t.YNc(39,Qo,3,0,"th",21),t.YNc(40,Jo,2,1,"td",25),t.BQk(),t.ynx(41,27),t.YNc(42,Xo,3,0,"th",21),t.YNc(43,Uo,3,1,"td",19),t.BQk(),t.ynx(44,28),t.YNc(45,zo,3,0,"th",21),t.YNc(46,Ho,3,1,"td",29),t.BQk(),t.ynx(47,30),t.YNc(48,qo,1,0,"th",31),t.YNc(49,Fo,4,0,"td",19),t.BQk(),t.YNc(50,jo,1,0,"tr",32),t.YNc(51,Vo,1,0,"tr",33),t.qZA()()(),t._UZ(52,"mat-paginator",34),t.qZA()()),2&e){const i=t.MAs(13);t.xp6(8),t.Q6J("formGroup",a.range)("rangePicker",i),t.xp6(3),t.Q6J("for",i)("disabled",a.showBalance),t.xp6(4),t.Q6J("ngModel",a.showBalance),t.xp6(10),t.Q6J("dataSource",a.dataSource),t.xp6(25),t.Q6J("matHeaderRowDef",a.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(1),t.Q6J("pageSizeOptions",a.dataSource.pageSizeOptions)("pageSize",a.dataSource.pageSizeOptions[0])}},dependencies:[y.sg,y.RF,y.n9,y.ED,Xt.k,T.Fj,T.JJ,T.JL,T.On,lt.RK,Be.oG,v.nW,v.wx,v.zY,v.By,v._g,$.KE,$.hX,$.R9,Nt.Hw,Io.Rr,T.sg,T.u,ht.NW,R.BZ,R.fO,R.as,R.w1,R.Dz,R.nj,R.ge,R.ev,R.XQ,R.Gk,Gt.L,ae.Y,oe.o,ie.h,y.JJ,ne.e],encapsulation:2})),n})();var ti=g(1005);const Qe={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let Qt;const ei=new Uint8Array(16);function ni(){if(!Qt&&(Qt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Qt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qt(ei)}const Z=[];for(let n=0;n<256;++n)Z.push((n+256).toString(16).slice(1));const oi=function ai(n,o,e){if(Qe.randomUUID&&!o&&!n)return Qe.randomUUID();const a=(n=n||{}).random||(n.rng||ni)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,o){e=e||0;for(let i=0;i<16;++i)o[e+i]=a[i];return o}return function Je(n,o=0){return(Z[n[o+0]]+Z[n[o+1]]+Z[n[o+2]]+Z[n[o+3]]+"-"+Z[n[o+4]]+Z[n[o+5]]+"-"+Z[n[o+6]]+Z[n[o+7]]+"-"+Z[n[o+8]]+Z[n[o+9]]+"-"+Z[n[o+10]]+Z[n[o+11]]+Z[n[o+12]]+Z[n[o+13]]+Z[n[o+14]]+Z[n[o+15]]).toLowerCase()}(a)};class ce{constructor(){(0,c.Z)(this,"amount",void 0),(0,c.Z)(this,"accountId",void 0),(0,c.Z)(this,"accountName",void 0),(0,c.Z)(this,"bizId",void 0),(0,c.Z)(this,"bizTime",void 0),(0,c.Z)(this,"bkId",void 0),(0,c.Z)(this,"bookId",void 0),(0,c.Z)(this,"categoryId",void 0),(0,c.Z)(this,"comment",void 0),(0,c.Z)(this,"address",void 0),(0,c.Z)(this,"attachments",void 0),(0,c.Z)(this,"members",void 0),(0,c.Z)(this,"recType",void 0),(0,c.Z)(this,"recSubtype",void 0),(0,c.Z)(this,"lendType",void 0),(0,c.Z)(this,"flag",void 0),(0,c.Z)(this,"profit",void 0),(0,c.Z)(this,"reimburse",void 0),(0,c.Z)(this,"sourceSystem",void 0),(0,c.Z)(this,"tags",void 0),(0,c.Z)(this,"tradetgtId",void 0),(0,c.Z)(this,"tradetgtName",void 0),(0,c.Z)(this,"id",void 0),(0,c.Z)(this,"edited",void 0),(0,c.Z)(this,"deleted",void 0),(0,c.Z)(this,"accountBalance",void 0),(0,c.Z)(this,"account",void 0),(0,c.Z)(this,"category",void 0),(0,c.Z)(this,"member",void 0),(0,c.Z)(this,"project",void 0),(0,c.Z)(this,"targetId",void 0),(0,c.Z)(this,"targetName",void 0),(0,c.Z)(this,"targetAmount",void 0),(0,c.Z)(this,"tradetgt",void 0),this.id=0,this.amount=0,this.comment="",this.address="",this.attachments="",this.reimburse=0,this.edited=0,this.deleted=0,this.sourceSystem=201}}var Xe=g(5001);function ii(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function ri(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.categoryId),t.xp6(1),t.hij(" ",e.name," ")}}function ci(n,o){if(1&n&&(t.TgZ(0,"mat-optgroup",53),t.YNc(1,ri,2,2,"mat-option",14),t.qZA()),2&n){const e=o.$implicit;t.Q6J("label",e.name),t.xp6(1),t.Q6J("ngForOf",e.outgoSubTypes)}}function si(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function _i(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function li(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function di(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",9)(2,"div",10)(3,"mat-form-field",11)(4,"mat-label"),t.SDv(5,35),t.qZA(),t.TgZ(6,"mat-select",36),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.accountId=i)}),t.YNc(7,ii,2,2,"mat-option",14),t.qZA()()(),t.TgZ(8,"div",10)(9,"mat-form-field",11)(10,"mat-label"),t.SDv(11,37),t.qZA(),t.TgZ(12,"mat-select",38),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.categoryId=i)}),t.YNc(13,ci,2,2,"mat-optgroup",39),t.qZA()()()(),t.TgZ(14,"div",9)(15,"div",10)(16,"mat-form-field",11)(17,"mat-label"),t.SDv(18,40),t.qZA(),t.TgZ(19,"mat-select",41),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.tags=i)}),t.YNc(20,si,2,2,"mat-option",14),t.qZA()()(),t.TgZ(21,"div",10)(22,"mat-form-field",11)(23,"mat-label"),t.SDv(24,42),t.qZA(),t.TgZ(25,"mat-select",43),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.tradetgtId=i)}),t.TgZ(26,"mat-option",44),t._uU(27,"-"),t.qZA(),t.YNc(28,_i,2,2,"mat-option",14),t.qZA()()()(),t.TgZ(29,"div",9)(30,"div",10)(31,"mat-form-field",11)(32,"mat-label"),t.SDv(33,45),t.qZA(),t.TgZ(34,"mat-select",46),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.selectedMembers=i)}),t.YNc(35,li,2,2,"mat-option",14),t.qZA()()(),t.TgZ(36,"div",10)(37,"mat-form-field",11)(38,"mat-label"),t.SDv(39,47),t.qZA(),t.TgZ(40,"mat-select",48),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.reimburse=i)}),t.TgZ(41,"mat-option",49),t.ynx(42),t.SDv(43,50),t.BQk(),t.qZA(),t.TgZ(44,"mat-option",49),t.ynx(45),t.SDv(46,51),t.BQk(),t.qZA(),t.TgZ(47,"mat-option",49),t.ynx(48),t.SDv(49,52),t.BQk(),t.qZA()()()()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.entry.accountId),t.xp6(1),t.Q6J("ngForOf",e.accounts),t.xp6(5),t.Q6J("ngModel",e.entry.categoryId),t.xp6(1),t.Q6J("ngForOf",e.payCategories),t.xp6(6),t.Q6J("compareWith",e.compareTagWith)("ngModel",e.entry.tags),t.xp6(1),t.Q6J("ngForOf",e.tags),t.xp6(5),t.Q6J("ngModel",e.entry.tradetgtId),t.xp6(3),t.Q6J("ngForOf",e.txnObjects),t.xp6(6),t.Q6J("ngModel",e.selectedMembers),t.xp6(1),t.Q6J("ngForOf",e.members),t.xp6(5),t.Q6J("ngModel",e.entry.reimburse),t.xp6(1),t.Q6J("value",1),t.xp6(3),t.Q6J("value",2),t.xp6(3),t.Q6J("value",0)}}function ui(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function mi(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.categoryId),t.xp6(1),t.hij(" ",e.name," ")}}function gi(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function pi(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function hi(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function fi(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",9)(2,"div",10)(3,"mat-form-field",11)(4,"mat-label"),t.SDv(5,54),t.qZA(),t.TgZ(6,"mat-select",36),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.accountId=i)}),t.YNc(7,ui,2,2,"mat-option",14),t.qZA()()(),t.TgZ(8,"div",10)(9,"mat-form-field",11)(10,"mat-label"),t.SDv(11,55),t.qZA(),t.TgZ(12,"mat-select",56),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.categoryId=i)}),t.YNc(13,mi,2,2,"mat-option",14),t.qZA()()()(),t.TgZ(14,"div",9)(15,"div",10)(16,"mat-form-field",11)(17,"mat-label"),t.SDv(18,57),t.qZA(),t.TgZ(19,"mat-select",41),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.tags=i)}),t.TgZ(20,"mat-option",44),t._uU(21,"-"),t.qZA(),t.YNc(22,gi,2,2,"mat-option",14),t.qZA()()(),t.TgZ(23,"div",10)(24,"mat-form-field",11)(25,"mat-label"),t.SDv(26,58),t.qZA(),t.TgZ(27,"mat-select",43),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.tradetgtId=i)}),t.TgZ(28,"mat-option",44),t._uU(29,"-"),t.qZA(),t.YNc(30,pi,2,2,"mat-option",14),t.qZA()()()(),t.TgZ(31,"div",9)(32,"div",10)(33,"mat-form-field",11)(34,"mat-label"),t.SDv(35,59),t.qZA(),t.TgZ(36,"mat-select",46),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.selectedMembers=i)}),t.YNc(37,hi,2,2,"mat-option",14),t.qZA()()(),t.TgZ(38,"div",10)(39,"mat-form-field",11)(40,"mat-label"),t.SDv(41,60),t.qZA(),t.TgZ(42,"mat-select",48),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.reimburse=i)}),t.TgZ(43,"mat-option",49),t.ynx(44),t.SDv(45,61),t.BQk(),t.qZA(),t.TgZ(46,"mat-option",49),t.ynx(47),t.SDv(48,62),t.BQk(),t.qZA(),t.TgZ(49,"mat-option",49),t.ynx(50),t.SDv(51,63),t.BQk(),t.qZA()()()()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.entry.accountId),t.xp6(1),t.Q6J("ngForOf",e.accounts),t.xp6(5),t.Q6J("ngModel",e.entry.categoryId),t.xp6(1),t.Q6J("ngForOf",e.revenueCategories),t.xp6(6),t.Q6J("compareWith",e.compareTagWith)("ngModel",e.entry.tags),t.xp6(3),t.Q6J("ngForOf",e.tags),t.xp6(5),t.Q6J("ngModel",e.entry.tradetgtId),t.xp6(3),t.Q6J("ngForOf",e.txnObjects),t.xp6(6),t.Q6J("ngModel",e.selectedMembers),t.xp6(1),t.Q6J("ngForOf",e.members),t.xp6(5),t.Q6J("ngModel",e.entry.reimburse),t.xp6(1),t.Q6J("value",1),t.xp6(3),t.Q6J("value",2),t.xp6(3),t.Q6J("value",0)}}function Ai(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function Ei(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function Ti(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",9)(2,"div",10)(3,"mat-form-field",11)(4,"mat-label"),t.SDv(5,64),t.qZA(),t.TgZ(6,"mat-select",65),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.accountId=i)}),t.YNc(7,Ai,2,2,"mat-option",14),t.qZA()()(),t.TgZ(8,"div",10)(9,"mat-form-field",11)(10,"mat-label"),t.SDv(11,66),t.qZA(),t.TgZ(12,"mat-select",67),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.targetId=i)}),t.YNc(13,Ei,2,2,"mat-option",14),t.qZA()()()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.entry.accountId)("forbiddenSame",e.entry.targetId),t.xp6(1),t.Q6J("ngForOf",e.accounts),t.xp6(5),t.Q6J("ngModel",e.entry.targetId)("forbiddenSame",e.entry.accountId),t.xp6(1),t.Q6J("ngForOf",e.accounts)}}function Ci(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,75),t.BQk()())}function Si(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,76),t.BQk()())}function bi(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,77),t.BQk()())}function Ni(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,78),t.BQk()())}function Mi(n,o){if(1&n&&(t.TgZ(0,"mat-option",74),t.YNc(1,Ci,3,0,"ng-container",72),t.YNc(2,Si,3,0,"ng-container",72),t.YNc(3,bi,3,0,"ng-container",72),t.YNc(4,Ni,3,0,"ng-container",72),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e)("ngSwitch",e),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4)}}function Ri(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,79),t.BQk()())}function Ii(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,80),t.BQk()())}function yi(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,81),t.BQk()())}function Di(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,82),t.BQk()())}function vi(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function xi(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,83),t.BQk()())}function Oi(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,84),t.BQk()())}function Zi(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,85),t.BQk()())}function Pi(n,o){1&n&&(t.ynx(0)(1),t.SDv(2,86),t.BQk()())}function wi(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function $i(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",9)(2,"div",10)(3,"mat-form-field",11)(4,"mat-label"),t.SDv(5,68),t.qZA(),t.TgZ(6,"mat-select",69),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.lendType=i)}),t.YNc(7,Mi,5,6,"mat-option",70),t.qZA()()()(),t.TgZ(8,"div",9)(9,"div",10)(10,"mat-form-field",11)(11,"mat-label",71),t.YNc(12,Ri,3,0,"ng-container",72),t.YNc(13,Ii,3,0,"ng-container",72),t.YNc(14,yi,3,0,"ng-container",72),t.YNc(15,Di,3,0,"ng-container",72),t.qZA(),t.TgZ(16,"mat-select",73),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.accountId=i)}),t.YNc(17,vi,2,2,"mat-option",14),t.qZA()()(),t.TgZ(18,"div",10)(19,"mat-form-field",11)(20,"mat-label",71),t.YNc(21,xi,3,0,"ng-container",72),t.YNc(22,Oi,3,0,"ng-container",72),t.YNc(23,Zi,3,0,"ng-container",72),t.YNc(24,Pi,3,0,"ng-container",72),t.qZA(),t.TgZ(25,"mat-select",36),t.NdJ("ngModelChange",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.entry.targetId=i)}),t.YNc(26,wi,2,2,"mat-option",14),t.qZA()()()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.entry.lendType),t.xp6(1),t.Q6J("ngForOf",e.loanTypes),t.xp6(4),t.Q6J("ngSwitch",e.entry.lendType),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4),t.xp6(1),t.Q6J("ngModel",e.entry.accountId),t.xp6(1),t.Q6J("ngForOf",e.creditors),t.xp6(3),t.Q6J("ngSwitch",e.entry.lendType),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4),t.xp6(1),t.Q6J("ngModel",e.entry.targetId),t.xp6(1),t.Q6J("ngForOf",e.accounts)}}function Yi(n,o){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function se(){return oi()}let We=(()=>{class n{constructor(e,a,i,r,s,_,d){(0,c.Z)(this,"elementRef",void 0),(0,c.Z)(this,"route",void 0),(0,c.Z)(this,"dateAdapter",void 0),(0,c.Z)(this,"communication",void 0),(0,c.Z)(this,"notification",void 0),(0,c.Z)(this,"databaseService",void 0),(0,c.Z)(this,"operation",void 0),(0,c.Z)(this,"books",[]),(0,c.Z)(this,"accounts",[]),(0,c.Z)(this,"tags",[]),(0,c.Z)(this,"members",[]),(0,c.Z)(this,"payCategories",[]),(0,c.Z)(this,"revenueCategories",[]),(0,c.Z)(this,"txnObjects",[]),(0,c.Z)(this,"creditors",[]),(0,c.Z)(this,"loanTypes",[D.BORROW,D.LEND,D.RECEIVE,D.REPAYMENT]),(0,c.Z)(this,"compareTagWith",(u,f)=>u?.tagId===f?.tagId),(0,c.Z)(this,"entry",void 0),(0,c.Z)(this,"selectedMembers",void 0),(0,c.Z)(this,"bizDatetime",void 0),(0,c.Z)(this,"isNew",!1),(0,c.Z)(this,"selectedTabIndex",0),(0,c.Z)(this,"saving",!1),(0,c.Z)(this,"accountId",void 0),(0,c.Z)(this,"entryForm",void 0),(0,c.Z)(this,"selects",void 0),(0,c.Z)(this,"getEntrySsp",void 0),(0,c.Z)(this,"subscription",new ft.w0),this.elementRef=e,this.route=a,this.dateAdapter=i,this.communication=r,this.notification=s,this.databaseService=_,this.operation=d,this.entry=new ce,this.entry.bizId=se(),this.entry.recType=I.PAY}ngOnInit(){this.isNew=!this.route.snapshot.paramMap.get("accountId"),this.subscription.add(this.route.paramMap.subscribe(e=>{const a=e.get("entryId"),i=e.get("accountId");i?(this.accountId="new"===i?void 0:i,this.entry.accountId=this.accountId,this.isNew=!0,this.bizDatetime=this.dateAdapter.today()):a&&(this.isNew=!1)}))}ngAfterViewInit(){this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.getBooks().pipe((0,ti.g)(100),(0,z.K)(e=>(this.notification.hideLoading(),(0,Ge._)(()=>e)))).subscribe(e=>{if(e&&e.data&&e.data.books[0]){const a=e.data.books[0];let i=a.id;this.books=e.data.books,this.isNew?(this.entry.bkId=a.id,this.entry.bookId=a.uuid):i=(0,w.su)(this.route.snapshot.paramMap.get("bookId")),(0,rt.D)([this.databaseService.getShortAccounts(),this.databaseService.getShortAccounts(-1),this.getAdditionalDatas(i)]).pipe((0,Y.x)(()=>{this.notification.hideLoading()})).subscribe(r=>{if(this.accounts=r[0].data.accounts,this.creditors=r[1].data.accounts,this.isNew)!this.entry.accountId&&this.accounts[0]&&(this.entry.accountId=this.accounts[0].uuid);else{const s=this.route.snapshot.paramMap.get("entryId");this.getCurrentEntry(i,s)}setTimeout(()=>{this.onSelectedTabChange({index:this.selectedTabIndex})})})}})}ngOnDestroy(){this.subscription.unsubscribe()}onSelectedTabChange(e){const a=this.entry,i=e.index+1;let r;switch(a.recType=i,this.checkValuesWhetherExisted(),i){case I.PAY:r=this.payCategories[0];case I.REVENUE:if(r||(r=this.revenueCategories[0]),!a.accountId&&this.accountId){a.accountId=this.accountId;break}!a.categoryId&&r&&(a.categoryId=r.outgoSubTypes&&r.outgoSubTypes[0]?r.outgoSubTypes[0].categoryId:r.categoryId),!a.tags?.length&&this.tags&&this.tags.length&&(this.entry.tags=[this.tags[0]]),(!this.selectedMembers||!this.selectedMembers.length)&&this.members&&(this.selectedMembers=this.members.slice(0,1).map(s=>s.uuid));break;case I.TRANSFER:!a.accountId&&this.accountId&&(a.accountId=this.accountId),!a.targetId&&this.accounts[0]&&(a.targetId=this.accounts[0].uuid);break;default:typeof a.lendType>"u"&&(a.lendType=1),a.targetId||(a.targetId=this.accountId||(this.accounts[0]?this.accounts[0].uuid:void 0)),a.accountId||(a.accountId=this.creditors&&this.creditors[0]?this.creditors[0].uuid:void 0)}}onBookSelectionChange(e){const a=e.value;this.books&&this.books.some(i=>i.id===a&&(this.entry.bookId=i.uuid,!0)),this.notification.showLoading(this.elementRef.nativeElement),this.getAdditionalDatas(a).pipe((0,Y.x)(()=>{setTimeout(()=>{this.onSelectedTabChange({index:this.selectedTabIndex})})})).subscribe()}save(){this.update().subscribe(e=>{e&&this.cancel()})}saveAs(){const e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(const a in e)e[a].markAsTouched();this.entry.id=0,this.entry.bizId=se(),this.save()}saveAndNew(){const e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(const a in e)e[a].markAsTouched();this.update().subscribe(a=>{a&&(this.entry.id=0,this.entry.bizId=se())})}cancel(){this.operation.closeSecondaryOutlet(this.route.parent)}update(){if(this.checkValuesWhetherExisted(),this.entryForm&&this.entryForm.valid){const e=this.entry;switch(e.recType){case I.PAY:case I.REVENUE:e.targetId=void 0,e.profit=void 0,e.lendType=void 0,e.recSubtype=void 0,e.members=this.selectedMembers.map(a=>({memberId:a,amount:e.amount}));break;case I.TRANSFER:if(e.accountId===e.targetId)return;e.categoryId=void 0,e.tags=void 0,e.tradetgtId=void 0,e.profit=void 0,e.lendType=void 0,e.recSubtype=void 0,e.reimburse=0,e.targetAmount=e.amount,e.members=this.members.slice(0,1).map(a=>({memberId:a.uuid,amount:e.amount}));break;default:switch(e.categoryId=void 0,e.tags=void 0,e.tradetgtId=void 0,e.profit=0,e.reimburse=0,e.targetAmount=e.amount,e.lendType){case D.LEND:case D.REPAYMENT:e.recSubtype=1;break;default:e.recSubtype=0}(e.lendType===D.RECEIVE||e.lendType===D.REPAYMENT)&&(e.recType=I.RETURN),e.members=[{amount:e.amount}]}return e.bizTime=this.dateAdapter.toIso8601(this.bizDatetime),typeof e.comment>"u"&&(e.comment=""),this.saving=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.saveEntry([e]).pipe((0,z.K)(()=>(0,P.of)(!1)),(0,H.U)(a=>!("boolean"!=typeof a&&a.error)),(0,Y.x)(()=>{this.saving=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand()}))}return(0,P.of)(!1)}checkValuesWhetherExisted(){this.selects.forEach(e=>{if(e.options.length)if(e.multiple){if(e.value){const a=e.value.filter(i=>e.options.some(r=>r.value===i));e.ngControl.control.setValue(a)}}else e.options.some(a=>a.value===e.value)||e.ngControl.control.setValue(null)})}getCurrentEntry(e,a){this.getEntrySsp&&this.getEntrySsp.unsubscribe(),this.notification.showLoading(this.elementRef.nativeElement),this.getEntrySsp=this.databaseService.getEntry(e,a).pipe((0,kt.h)(i=>!i.error),(0,Y.x)(()=>{this.getEntrySsp=void 0,this.notification.hideLoading()})).subscribe(i=>{const r=i.data;r.amount=r.amount/100,this.accountId=r.accountId,this.bizDatetime=this.dateAdapter.deserialize(r.bizTime),this.selectedMembers=Array.isArray(r.members)?this.members.filter(s=>r.members.some(_=>_.memberId===s.uuid)).map(s=>s.uuid):this.members.slice(0,1).map(s=>s.uuid),r.recType===I.RETURN?r.lendType=0===r.recSubtype?D.RECEIVE:D.REPAYMENT:r.recType===I.BORROW&&(r.lendType=0===r.recSubtype?D.BORROW:D.LEND),this.entry=r,r.accountId&&!this.creditors.find(s=>s.uuid===r.accountId)&&this.creditors.push({uuid:r.accountId,name:r.accountName}),r.targetId&&!this.accounts.find(s=>s.uuid===r.targetId)&&this.accounts.push({uuid:r.targetId,name:r.targetName}),this.selectedTabIndex=(r.recType>5?4:r.recType)-1})}getAdditionalDatas(e){return(0,rt.D)([this.databaseService.getTransactionObjects(e),this.databaseService.getBookProjects(e),this.databaseService.getMembers(e),this.databaseService.getEntryCategories(e,J.PAY),this.databaseService.getEntryCategories(e,J.REVENUE)]).pipe((0,Y.x)(()=>{this.notification.hideLoading()}),(0,H.U)(a=>{this.txnObjects=a[0].data.bookTradeTargets,this.tags=a[1].data.bookProjects.map(i=>({tagId:i.uuid,name:i.name})),this.members=a[2].data.bookMembers,this.payCategories=a[3].data.bookCategories,this.revenueCategories=a[4].data.bookCategories}))}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(W.gz),t.Y36(Q._A),t.Y36(At.O),t.Y36(st.g),t.Y36(_t),t.Y36(vt))}),(0,c.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-add-or-edit-entry"]],viewQuery:function(e,a){if(1&e&&(t.Gf(T.F,5),t.Gf(Bt.gD,5)),2&e){let i;t.iGM(i=t.CRH())&&(a.entryForm=i.first),t.iGM(i=t.CRH())&&(a.selects=i)}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:62,vars:16,consts:function(){let o,e,a,i,r,s,_,d,u,f,l,p,A,E,h,m,S,X,k,nt,x,dt,ut,at,mt,ot,N,L,O,B,it,M,gt,pt,G,Ue,ze,He,qe,Fe,je,Ve,Ke,tn,en;return o="Pay",e="Revenue",a="Transfer",i="Loan",r="Account book",s="Amount",_="Time",d="Comment",u="Save",f="Save as",l="Save and new",p="Cancel",A="Account",E="Category",h="Tags",m="Trader",S="Member",X="Reimburse",k="To be reimbursed",nt="Reimbursed",x="Non-reimbursable",dt="Account",ut="Category",at="Tags",mt="Payer",ot="Member",N="Reimburse",L="To be reimbursed",O="Reimbursed",B="Non-reimbursable",it="From account",M="To account",gt="Category",pt="Borrow",G="Lend",Ue="Receive",ze="Repayment",He="Creditor",qe="Debtor",Fe="Debtor",je="Creditor",Ve="Borrow account",Ke="Lend account",tn="Receive account",en="Repayment account",[["name","entryForm",1,"d-flex","flex-column","flex-nowrap","flex-fill","overflow-hidden",3,"ngSubmit"],["color","primary",3,"selectedIndex","selectedIndexChange","selectedTabChange"],["label",o],["label",e],["label",a],["label",i],[1,"flex-fill","overflow-auto"],["class","container-fluid pt-3",4,"ngIf"],[1,"container-fluid","pb-3"],[1,"row"],[1,"col","col-lg-6"],["appearance","outline"],r,["name","book","required","",3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],s,["name","amount","type","number","step","1","min","0.01","required","","matInput","",3,"ngModel","ngModelChange"],_,["name","bizDatetime","matInput","","required","",3,"matDatepicker","ngModel","ngModelChange"],["matSuffix","",3,"for"],["color","primary"],["picker",""],[1,"col"],d,["name","comment","matInput","",3,"ngModel","ngModelChange"],[1,"container-fluid","pt-3","pb-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2",3,"disabled"],u,["type","button","mat-flat-button","","color","primary",1,"me-2",3,"disabled","click"],f,["type","button","mat-flat-button","","color","accent",1,"me-2",3,"disabled","click"],l,["type","button","mat-stroked-button","","color","accent",1,"me-2",3,"disabled","click"],p,[1,"container-fluid","pt-3"],A,["name","account","required","",3,"ngModel","ngModelChange"],E,["name","payCategory","required","",3,"ngModel","ngModelChange"],[3,"label",4,"ngFor","ngForOf"],h,["name","tags","multiple","",3,"compareWith","ngModel","ngModelChange"],m,["name","txnObject",3,"ngModel","ngModelChange"],["value",""],S,["name","member","multiple","","required","",3,"ngModel","ngModelChange"],X,["name","reimburse",3,"ngModel","ngModelChange"],[3,"value"],k,nt,x,[3,"label"],dt,ut,["name","revenueCategory","required","",3,"ngModel","ngModelChange"],at,mt,ot,N,L,O,B,it,["name","account","required","",3,"ngModel","forbiddenSame","ngModelChange"],M,["name","transferObject","required","",3,"ngModel","forbiddenSame","ngModelChange"],gt,["name","lendType","required","",3,"ngModel","ngModelChange"],[3,"value","ngSwitch",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],["name","creditor","required","",3,"ngModel","ngModelChange"],[3,"value","ngSwitch"],pt,G,Ue,ze,He,qe,Fe,je,Ve,Ke,tn,en]},template:function(e,a){if(1&e&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return a.save()}),t.TgZ(1,"mat-tab-group",1),t.NdJ("selectedIndexChange",function(r){return a.selectedTabIndex=r})("selectedTabChange",function(r){return a.onSelectedTabChange(r)}),t._UZ(2,"mat-tab",2)(3,"mat-tab",3)(4,"mat-tab",4)(5,"mat-tab",5),t.qZA(),t.TgZ(6,"div",6),t.YNc(7,di,50,15,"div",7),t.YNc(8,fi,52,15,"div",7),t.YNc(9,Ti,14,6,"div",7),t.YNc(10,$i,27,16,"div",7),t.TgZ(11,"div",8)(12,"div",9)(13,"div",10)(14,"mat-form-field",11)(15,"mat-label"),t.SDv(16,12),t.qZA(),t.TgZ(17,"mat-select",13),t.NdJ("ngModelChange",function(r){return a.entry.bkId=r})("selectionChange",function(r){return a.onBookSelectionChange(r)}),t.YNc(18,Yi,2,2,"mat-option",14),t.qZA()()()(),t.TgZ(19,"div",9)(20,"div",10)(21,"mat-form-field",11)(22,"mat-label"),t.SDv(23,15),t.qZA(),t.TgZ(24,"input",16),t.NdJ("ngModelChange",function(r){return a.entry.amount=r}),t.qZA()()(),t.TgZ(25,"div",10)(26,"mat-form-field",11)(27,"mat-label"),t.SDv(28,17),t.qZA(),t.TgZ(29,"input",18),t.NdJ("ngModelChange",function(r){return a.bizDatetime=r}),t.qZA(),t._UZ(30,"mat-datepicker-toggle",19),t.TgZ(31,"mat-datepicker",20,21)(33,"mat-datepicker-actions"),t._UZ(34,"mat-timepicker"),t.qZA()()()()(),t.TgZ(35,"div",9)(36,"div",22)(37,"mat-form-field",11)(38,"mat-label"),t.SDv(39,23),t.qZA(),t.TgZ(40,"textarea",24),t.NdJ("ngModelChange",function(r){return a.entry.comment=r}),t.qZA()()()()()(),t.TgZ(41,"div",25)(42,"button",26)(43,"mat-icon"),t._uU(44,"save"),t.qZA(),t.ynx(45),t.SDv(46,27),t.BQk(),t.qZA(),t.TgZ(47,"button",28),t.NdJ("click",function(){return a.saveAs()}),t.TgZ(48,"mat-icon"),t._uU(49,"file_copy"),t.qZA(),t.ynx(50),t.SDv(51,29),t.BQk(),t.qZA(),t.TgZ(52,"button",30),t.NdJ("click",function(){return a.saveAndNew()}),t.TgZ(53,"mat-icon"),t._uU(54,"post_add"),t.qZA(),t.ynx(55),t.SDv(56,31),t.BQk(),t.qZA(),t.TgZ(57,"button",32),t.NdJ("click",function(){return a.cancel()}),t.TgZ(58,"mat-icon"),t._uU(59,"cancel"),t.qZA(),t.ynx(60),t.SDv(61,33),t.BQk(),t.qZA()()()),2&e){const i=t.MAs(32);t.xp6(1),t.Q6J("selectedIndex",a.selectedTabIndex),t.xp6(6),t.Q6J("ngIf",0===a.selectedTabIndex),t.xp6(1),t.Q6J("ngIf",1===a.selectedTabIndex),t.xp6(1),t.Q6J("ngIf",2===a.selectedTabIndex),t.xp6(1),t.Q6J("ngIf",3===a.selectedTabIndex),t.xp6(7),t.Q6J("ngModel",a.entry.bkId),t.xp6(1),t.Q6J("ngForOf",a.books),t.xp6(6),t.Q6J("ngModel",a.entry.amount),t.xp6(5),t.Q6J("matDatepicker",i)("ngModel",a.bizDatetime),t.xp6(1),t.Q6J("for",i),t.xp6(10),t.Q6J("ngModel",a.entry.comment),t.xp6(2),t.Q6J("disabled",a.saving),t.xp6(5),t.Q6J("disabled",a.saving||a.isNew),t.xp6(5),t.Q6J("disabled",a.saving),t.xp6(5),t.Q6J("disabled",a.saving)}},dependencies:[y.sg,y.O5,y.RF,y.n9,T._Y,T.Fj,T.wV,T.JJ,T.JL,T.Q7,T.qQ,T.On,T.F,lt.lW,v.Mq,v.hl,v.nW,v.M5,$.KE,$.hX,$.R9,Nt.Hw,re.Nt,Bt.gD,Q.ey,Q.Nv,Xe.a,Mt.uX,Mt.SP],styles:[".mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}"]})),n})();const ki=[{path:"dashboard",component:sa},{path:"accounts",component:Pa},{path:"search",component:Ro},{path:"accounts/:accountId",component:Ko},{path:"entry/add/:accountId",outlet:"secondary",component:We},{path:"entry/:bookId/:entryId",outlet:"secondary",component:We},{path:"balance/:entryId",outlet:"secondary",component:(()=>{class n{constructor(e,a,i,r,s,_,d,u){(0,c.Z)(this,"elementRef",void 0),(0,c.Z)(this,"router",void 0),(0,c.Z)(this,"route",void 0),(0,c.Z)(this,"dateAdapter",void 0),(0,c.Z)(this,"communication",void 0),(0,c.Z)(this,"notification",void 0),(0,c.Z)(this,"databaseService",void 0),(0,c.Z)(this,"operation",void 0),(0,c.Z)(this,"entry",void 0),(0,c.Z)(this,"bizDatetime",void 0),(0,c.Z)(this,"selectedTabIndex",0),(0,c.Z)(this,"saving",!1),(0,c.Z)(this,"entryForm",void 0),(0,c.Z)(this,"subscription",new ft.w0),this.elementRef=e,this.router=a,this.route=i,this.dateAdapter=r,this.communication=s,this.notification=_,this.databaseService=d,this.operation=u,this.router.getCurrentNavigation()?(this.entry=this.router.getCurrentNavigation().extras.state,this.entry?(this.entry.amount=this.entry.accountBalance,this.bizDatetime=this.dateAdapter.deserialize(this.entry.bizTime)):this.entry=new ce):this.entry=new ce}ngOnInit(){}ngOnDestroy(){this.subscription.unsubscribe()}save(){this.update().subscribe(e=>{e&&this.cancel()})}saveAndNew(){const e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(const a in e)e[a].markAsTouched();this.update().subscribe(a=>{a&&(this.entry.id=0)})}cancel(){this.operation.closeSecondaryOutlet(this.route.parent)}update(){if(this.entryForm&&this.entryForm.valid){const e=this.entry;return e.bizTime=this.bizDatetime.toISOString(),typeof e.comment>"u"&&(e.comment=""),this.saving=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.saveEntry([e]).pipe((0,z.K)(()=>(0,P.of)(!1)),(0,H.U)(a=>!("boolean"!=typeof a&&a.error)),(0,Y.x)(()=>{this.saving=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand()}))}return(0,P.of)(!1)}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(W.F0),t.Y36(W.gz),t.Y36(Q._A),t.Y36(At.O),t.Y36(st.g),t.Y36(_t),t.Y36(vt))}),(0,c.Z)(n,"\u0275cmp",t.Xpm({type:n,selectors:[["app-balance-modifier"]],viewQuery:function(e,a){if(1&e&&t.Gf(T.F,5),2&e){let i;t.iGM(i=t.CRH())&&(a.entryForm=i.first)}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:31,vars:6,consts:function(){let o,e,a,i,r;return o="Balance modification",e="Amount",a="Time",i="Save",r="Cancel",[["name","entryForm",1,"d-flex","flex-column","flex-nowrap","flex-fill","overflow-hidden",3,"ngSubmit"],["color","primary"],["label",o],[1,"flex-fill","overflow-auto"],[1,"container-fluid","py-3"],[1,"row"],[1,"col","col-lg-6"],["appearance","fill"],e,["name","amount","type","number","step","1","required","","matInput","",3,"ngModel","ngModelChange"],a,["name","bizDatetime","matInput","","required","",3,"matDatepicker","ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],[1,"container-fluid","pt-3","pb-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2",3,"disabled"],i,["type","button","mat-flat-button","","color","warn",1,"me-2",3,"disabled","click"],r]},template:function(e,a){if(1&e&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return a.save()}),t.TgZ(1,"mat-tab-group",1),t._UZ(2,"mat-tab",2),t.qZA(),t.TgZ(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"mat-form-field",7)(8,"mat-label"),t.SDv(9,8),t.qZA(),t.TgZ(10,"input",9),t.NdJ("ngModelChange",function(r){return a.entry.amount=r}),t.qZA()()(),t.TgZ(11,"div",6)(12,"mat-form-field",7)(13,"mat-label"),t.SDv(14,10),t.qZA(),t.TgZ(15,"input",11),t.NdJ("ngModelChange",function(r){return a.bizDatetime=r}),t.qZA(),t._UZ(16,"mat-datepicker-toggle",12),t.TgZ(17,"mat-datepicker",1,13),t._UZ(19,"mat-timepicker"),t.qZA()()()()()(),t.TgZ(20,"div",14)(21,"button",15)(22,"mat-icon"),t._uU(23,"save"),t.qZA(),t.ynx(24),t.SDv(25,16),t.BQk(),t.qZA(),t.TgZ(26,"button",17),t.NdJ("click",function(){return a.cancel()}),t.TgZ(27,"mat-icon"),t._uU(28,"cancel"),t.qZA(),t.ynx(29),t.SDv(30,18),t.BQk(),t.qZA()()()),2&e){const i=t.MAs(18);t.xp6(10),t.Q6J("ngModel",a.entry.amount),t.xp6(5),t.Q6J("matDatepicker",i)("ngModel",a.bizDatetime),t.xp6(1),t.Q6J("for",i),t.xp6(5),t.Q6J("disabled",a.saving),t.xp6(5),t.Q6J("disabled",a.saving)}},dependencies:[T._Y,T.Fj,T.wV,T.JJ,T.JL,T.Q7,T.On,T.F,lt.lW,v.Mq,v.hl,v.nW,$.KE,$.hX,$.R9,Nt.Hw,re.Nt,Xe.a,Mt.uX,Mt.SP],styles:[".mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}"]})),n})()}];let Li=(()=>{class n{}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)}),(0,c.Z)(n,"\u0275mod",t.oAB({type:n})),(0,c.Z)(n,"\u0275inj",t.cJS({imports:[W.Bz.forChild(ki),W.Bz]})),n})(),Bi=(()=>{class n{constructor(e){(0,c.Z)(this,"notification",void 0),this.notification=e}intercept(e,a){return Date.now(),a.handle(e).pipe((0,Ye.b)({next:s=>{s instanceof Jt.Zn&&s.body?.error&&this.notification.openError(s.body.error)}}))}}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)(t.LFG(st.g))}),(0,c.Z)(n,"\u0275prov",t.Yz7({token:n,factory:n.\u0275fac})),n})(),Gi=(()=>{class n{}return(0,c.Z)(n,"\u0275fac",function(e){return new(e||n)}),(0,c.Z)(n,"\u0275mod",t.oAB({type:n})),(0,c.Z)(n,"\u0275inj",t.cJS({providers:[{provide:t.EJc,useValue:"CNY"},{provide:Jt.TP,useClass:Bi,multi:!0},we,y.H9,_t,vt,xt.s,ue],imports:[pn.S,y.ez,Jt.JF,Xt.g,dn,mn.t,ht.TU,un.JX,R.p0,Mt.Nh,gn.m,Li]})),n})()}}]);