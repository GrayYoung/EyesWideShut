"use strict";(self.webpackChunkbank=self.webpackChunkbank||[]).push([[430],{7430:(Po,ce,m)=>{m.r(ce),m.d(ce,{WacaiModule:()=>vo});var t=m(4650),M=m(6895),Ht=m(529),Yt=m(2673),k=m(3238);const Ve=["*",[["mat-card-footer"]]],tn=["*","mat-card-footer"];let en=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=t.lG2({type:n,selectors:[["mat-card-content"],["","mat-card-content",""],["","matCardContent",""]],hostAttrs:[1,"mat-card-content"]}),n})(),nn=(()=>{class n{constructor(e){this._animationMode=e}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.QbO,8))},n.\u0275cmp=t.Xpm({type:n,selectors:[["mat-card"]],hostAttrs:[1,"mat-card","mat-focus-indicator"],hostVars:2,hostBindings:function(e,_){2&e&&t.ekj("_mat-animation-noopable","NoopAnimations"===_._animationMode)},exportAs:["matCard"],ngContentSelectors:tn,decls:2,vars:0,template:function(e,_){1&e&&(t.F$t(Ve),t.Hsn(0),t.Hsn(1,1))},styles:[".mat-card{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:block;position:relative;padding:16px;border-radius:4px}.mat-card._mat-animation-noopable{transition:none !important;animation:none !important}.mat-card>.mat-divider-horizontal{position:absolute;left:0;width:100%}[dir=rtl] .mat-card>.mat-divider-horizontal{left:auto;right:0}.mat-card>.mat-divider-horizontal.mat-divider-inset{position:static;margin:0}[dir=rtl] .mat-card>.mat-divider-horizontal.mat-divider-inset{margin-right:0}.cdk-high-contrast-active .mat-card{outline:solid 1px}.mat-card-actions,.mat-card-subtitle,.mat-card-content{display:block;margin-bottom:16px}.mat-card-title{display:block;margin-bottom:8px}.mat-card-actions{margin-left:-8px;margin-right:-8px;padding:8px 0}.mat-card-actions-align-end{display:flex;justify-content:flex-end}.mat-card-image{width:calc(100% + 32px);margin:0 -16px 16px -16px;display:block;overflow:hidden}.mat-card-image img{width:100%}.mat-card-footer{display:block;margin:0 -16px -16px -16px}.mat-card-actions .mat-button,.mat-card-actions .mat-raised-button,.mat-card-actions .mat-stroked-button{margin:0 8px}.mat-card-header{display:flex;flex-direction:row}.mat-card-header .mat-card-title{margin-bottom:12px}.mat-card-header-text{margin:0 16px}.mat-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;object-fit:cover}.mat-card-title-group{display:flex;justify-content:space-between}.mat-card-sm-image{width:80px;height:80px}.mat-card-md-image{width:112px;height:112px}.mat-card-lg-image{width:152px;height:152px}.mat-card-xl-image{width:240px;height:240px;margin:-8px}.mat-card-title-group>.mat-card-xl-image{margin:-8px 0 8px}@media(max-width: 599px){.mat-card-title-group{margin:0}.mat-card-xl-image{margin-left:0;margin-right:0}}.mat-card>:first-child,.mat-card-content>:first-child{margin-top:0}.mat-card>:last-child:not(.mat-card-footer),.mat-card-content>:last-child:not(.mat-card-footer){margin-bottom:0}.mat-card-image:first-child{margin-top:-16px;border-top-left-radius:inherit;border-top-right-radius:inherit}.mat-card>.mat-card-actions:last-child{margin-bottom:-8px;padding-bottom:0}.mat-card-actions:not(.mat-card-actions-align-end) .mat-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-raised-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-stroked-button:first-child{margin-left:0;margin-right:0}.mat-card-actions-align-end .mat-button:last-child,.mat-card-actions-align-end .mat-raised-button:last-child,.mat-card-actions-align-end .mat-stroked-button:last-child{margin-left:0;margin-right:0}.mat-card-title:not(:first-child),.mat-card-subtitle:not(:first-child){margin-top:-4px}.mat-card-header .mat-card-subtitle:not(:first-child){margin-top:-8px}.mat-card>.mat-card-xl-image:first-child{margin-top:-8px}.mat-card>.mat-card-xl-image:last-child{margin-bottom:-8px}"],encapsulation:2,changeDetection:0}),n})(),_n=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[k.BQ,k.BQ]}),n})();var an=m(6308),Et=m(8739),b=m(7155),Nt=m(3848),on=m(6331),rn=m(9982),cn=m(2497),Y=m(4793),f=m(4006),at=m(727),v=m(9646),ot=m(4128),it=m(8372),sn=m(8675),Lt=m(3900),Z=m(8746),Q=m(262),G=m(4004),rt=(()=>{return(n=rt||(rt={}))[n.REVENUE=2]="REVENUE",n[n.PAY=3]="PAY",rt;var n})(),D=(()=>{return(n=D||(D={}))[n.PAY=1]="PAY",n[n.REVENUE=2]="REVENUE",n[n.TRANSFER=3]="TRANSFER",n[n.BORROW=4]="BORROW",n[n.RETURN=5]="RETURN",D;var n})(),P=(()=>{return(n=P||(P={}))[n.BORROW=1]="BORROW",n[n.LEND=2]="LEND",n[n.RECEIVE=3]="RECEIVE",n[n.REPAYMENT=4]="REPAYMENT",P;var n})(),ct=m(155),gt=m(1357),Qt=m(2140),Ot=m(4242);let st=(()=>{class n{constructor(e){this.requestService=e}getBooks(){return this.books?(0,v.of)({code:null,error:null,data:{books:this.books}}):this.requestService.get("activity/bkk-frontier/api/v2/book/web/query").pipe((0,G.U)(e=>(e&&e.data&&e.data.books&&(this.books=e.data.books),e)))}getAccountTypeList(){return this.requestService.get("setting/account_allAccountTypes.action",{timesamp:Date.now()})}getAccountList(e=!0,_=!1,o=!0){return this.requestService.get("setting/account_list.action",{timesamp:Date.now(),hidden:e,reqBalance:_,loanFlag:o})}getVisibleAccountList(){return this.requestService.post("activity/bkk-frontier/api/account/index",{localTime:Date.now(),timeZoneId:this.requestService.TIME_ZONE_ID,useCompleteSort:!0})}getHiddenAccountList(){return this.requestService.post("activity/bkk-frontier/api/account/hiddenList",{localTime:Date.now(),timeZoneId:this.requestService.TIME_ZONE_ID,useCompleteSort:!0})}getShortAccounts(e=1){return this.requestService.get("activity/bkk-frontier/api/account/web/query",{accountOption:e})}getEntryCategories(e,_){return this.requestService.get("activity/bkk-frontier/api/v2/category/web/query",{bkId:e,categoryType:_})}getTransactionObjects(e){return this.requestService.get("activity/bkk-frontier/api/v2/trade/target/web/query",{bkId:e})}getBookProjects(e){return this.requestService.get("activity/bkk-frontier/api/v2/project/web/query",{bkId:e})}getMembers(e){return this.requestService.get("activity/bkk-frontier/api/v2/book/member/web/query",{bkId:e})}queryEntries(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/list/web",e)}getEntries(e,_,o){const i={accountId:e,startDate:_.valueOf(),endDate:o.valueOf(),timeZoneId:this.requestService.TIME_ZONE_ID,localTime:Date.now()};return this.requestService.post("activity/bkk-frontier/api/account/detail/flow",i)}getEntry(e,_){return this.requestService.get("activity/bkk-frontier/api/v2/flow/query/web/"+e+"/"+_)}saveEntry(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/save",{flows:e})}deleteEntries(e){return this.requestService.post("activity/bkk-frontier/api/v2/flow/batch/delete",{flowIds:e})}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(Ot.s))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})(),se=(()=>{class n{constructor(e){this.requestService=e}getCategoryStatistics(e,_,o,i=1){return this.requestService.post("activity/bkk-frontier/api/v2/report/chartStat",{bkId:e,startTime:_.valueOf(),endTime:o.valueOf(),statNo:i})}getRevenueNExpenditureStatistics(e,_,o,i=11){return this.requestService.post("activity/bkk-frontier/api/v2/report/monthStat",{bkId:e,startTime:_.valueOf(),endTime:o.valueOf(),statNo:i})}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(Ot.s))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();var w=m(1281),T=m(13),ln=m(8186),un=m(2855),An=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(function dn(n){for(var a=n.length/6|0,e=new Array(a),_=0;_<a;)e[_]="#"+n.slice(6*_,6*++_);return e});const En=(0,un.hD)((n=An)[n.length-1]);var n,le,gn=m(961),Sn=m(3489),xt=m(3179),Gt=m(8415),St=m(714),pn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function vt(n){if(!(a=pn.exec(n)))throw new Error("invalid format: "+n);var a;return new Jt({fill:a[1],align:a[2],sign:a[3],symbol:a[4],zero:a[5],width:a[6],comma:a[7],precision:a[8]&&a[8].slice(1),trim:a[9],type:a[10]})}function Jt(n){this.fill=void 0===n.fill?" ":n.fill+"",this.align=void 0===n.align?">":n.align+"",this.sign=void 0===n.sign?"-":n.sign+"",this.symbol=void 0===n.symbol?"":n.symbol+"",this.zero=!!n.zero,this.width=void 0===n.width?void 0:+n.width,this.comma=!!n.comma,this.precision=void 0===n.precision?void 0:+n.precision,this.trim=!!n.trim,this.type=void 0===n.type?"":n.type+""}function Pt(n,a){if((e=(n=a?n.toExponential(a-1):n.toExponential()).indexOf("e"))<0)return null;var e,_=n.slice(0,e);return[_.length>1?_[0]+_.slice(2):_,+n.slice(e+1)]}function pt(n){return(n=Pt(Math.abs(n)))?n[1]:NaN}function de(n,a){var e=Pt(n,a);if(!e)return n+"";var _=e[0],o=e[1];return o<0?"0."+new Array(-o).join("0")+_:_.length>o+1?_.slice(0,o+1)+"."+_.slice(o+1):_+new Array(o-_.length+2).join("0")}vt.prototype=Jt.prototype,Jt.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const ue={"%":(n,a)=>(100*n).toFixed(a),b:n=>Math.round(n).toString(2),c:n=>n+"",d:function fn(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)},e:(n,a)=>n.toExponential(a),f:(n,a)=>n.toFixed(a),g:(n,a)=>n.toPrecision(a),o:n=>Math.round(n).toString(8),p:(n,a)=>de(100*n,a),r:de,s:function Nn(n,a){var e=Pt(n,a);if(!e)return n+"";var _=e[0],o=e[1],i=o-(le=3*Math.max(-8,Math.min(8,Math.floor(o/3))))+1,r=_.length;return i===r?_:i>r?_+new Array(i-r+1).join("0"):i>0?_.slice(0,i)+"."+_.slice(i):"0."+new Array(1-i).join("0")+Pt(n,Math.max(0,a+i-1))[0]},X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function me(n){return n}var wt,ge,Se,Ae=Array.prototype.map,Ee=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function pe(n){var a=n.domain;return n.ticks=function(e){var _=a();return(0,St.ZP)(_[0],_[_.length-1],e??10)},n.tickFormat=function(e,_){var o=a();return function yn(n,a,e,_){var i,o=(0,St.ly)(n,a,e);switch((_=vt(_??",f")).type){case"s":var r=Math.max(Math.abs(n),Math.abs(a));return null==_.precision&&!isNaN(i=function Cn(n,a){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(pt(a)/3)))-pt(Math.abs(n)))}(o,r))&&(_.precision=i),Se(_,r);case"":case"e":case"g":case"p":case"r":null==_.precision&&!isNaN(i=function Dn(n,a){return n=Math.abs(n),a=Math.abs(a)-n,Math.max(0,pt(a)-pt(n))+1}(o,Math.max(Math.abs(n),Math.abs(a))))&&(_.precision=i-("e"===_.type));break;case"f":case"%":null==_.precision&&!isNaN(i=function In(n){return Math.max(0,-pt(Math.abs(n)))}(o))&&(_.precision=i-2*("%"===_.type))}return ge(_)}(o[0],o[o.length-1],e??10,_)},n.nice=function(e){null==e&&(e=10);var l,d,_=a(),o=0,i=_.length-1,r=_[o],c=_[i],g=10;for(c<r&&(d=r,r=c,c=d,d=o,o=i,i=d);g-- >0;){if((d=(0,St.G9)(r,c,e))===l)return _[o]=r,_[i]=c,a(_);if(d>0)r=Math.floor(r/d)*d,c=Math.ceil(c/d)*d;else{if(!(d<0))break;r=Math.ceil(r*d)/d,c=Math.floor(c*d)/d}l=d}return n},n}function Xt(){var n=(0,xt.ZP)();return n.copy=function(){return(0,xt.JG)(n,Xt())},Gt.o.apply(n,arguments),pe(n)}function $t(){var e,_,o,i,l,n=0,a=1,r=xt.yR,c=!1;function d(s){return null==s||isNaN(s=+s)?l:r(0===o?.5:(s=(i(s)-e)*o,c?Math.max(0,Math.min(1,s)):s))}function g(s){return function(A){var S,p;return arguments.length?([S,p]=A,r=s(S,p),d):[r(0),r(1)]}}return d.domain=function(s){return arguments.length?([n,a]=s,e=i(n=+n),_=i(a=+a),o=e===_?0:1/(_-e),d):[n,a]},d.clamp=function(s){return arguments.length?(c=!!s,d):c},d.interpolator=function(s){return arguments.length?(r=s,d):r},d.range=g(gn.Z),d.rangeRound=g(Sn.Z),d.unknown=function(s){return arguments.length?(l=s,d):l},function(s){return i=s,e=s(n),_=s(a),o=e===_?0:1/(_-e),d}}function Zt(n,a){return a.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}!function Mn(n){wt=function bn(n){var a=void 0===n.grouping||void 0===n.thousands?me:function hn(n,a){return function(e,_){for(var o=e.length,i=[],r=0,c=n[0],l=0;o>0&&c>0&&(l+c+1>_&&(c=Math.max(1,_-l)),i.push(e.substring(o-=c,o+c)),!((l+=c+1)>_));)c=n[r=(r+1)%n.length];return i.reverse().join(a)}}(Ae.call(n.grouping,Number),n.thousands+""),e=void 0===n.currency?"":n.currency[0]+"",_=void 0===n.currency?"":n.currency[1]+"",o=void 0===n.decimal?".":n.decimal+"",i=void 0===n.numerals?me:function Tn(n){return function(a){return a.replace(/[0-9]/g,function(e){return n[+e]})}}(Ae.call(n.numerals,String)),r=void 0===n.percent?"%":n.percent+"",c=void 0===n.minus?"\u2212":n.minus+"",l=void 0===n.nan?"NaN":n.nan+"";function d(s){var A=(s=vt(s)).fill,S=s.align,p=s.sign,E=s.symbol,u=s.zero,h=s.width,H=s.comma,B=s.precision,tt=s.trim,y=s.type;"n"===y?(H=!0,y="g"):ue[y]||(void 0===B&&(B=12),tt=!0,y="g"),(u||"0"===A&&"="===S)&&(u=!0,A="0",S="=");var lt="$"===E?e:"#"===E&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",dt="$"===E?_:/[%p]/.test(y)?r:"",et=ue[y],ut=/[defgprs%]/.test(y);function nt(R){var W,_t,N,K=lt,O=dt;if("c"===y)O=et(R)+O,R="";else{var mt=(R=+R)<0||1/R<0;if(R=isNaN(R)?l:et(Math.abs(R),B),tt&&(R=function Rn(n){t:for(var o,a=n.length,e=1,_=-1;e<a;++e)switch(n[e]){case".":_=o=e;break;case"0":0===_&&(_=e),o=e;break;default:if(!+n[e])break t;_>0&&(_=0)}return _>0?n.slice(0,_)+n.slice(o+1):n}(R)),mt&&0==+R&&"+"!==p&&(mt=!1),K=(mt?"("===p?p:c:"-"===p||"("===p?"":p)+K,O=("s"===y?Ee[8+le/3]:"")+O+(mt&&"("===p?")":""),ut)for(W=-1,_t=R.length;++W<_t;)if(48>(N=R.charCodeAt(W))||N>57){O=(46===N?o+R.slice(W+1):R.slice(W))+O,R=R.slice(0,W);break}}H&&!u&&(R=a(R,1/0));var At=K.length+R.length+O.length,U=At<h?new Array(h-At+1).join(A):"";switch(H&&u&&(R=a(U+R,U.length?h-O.length:1/0),U=""),S){case"<":R=K+R+O+U;break;case"=":R=K+U+R+O;break;case"^":R=U.slice(0,At=U.length>>1)+K+R+O+U.slice(At);break;default:R=U+K+R+O}return i(R)}return B=void 0===B?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,B)):Math.max(0,Math.min(20,B)),nt.toString=function(){return s+""},nt}return{format:d,formatPrefix:function g(s,A){var S=d(((s=vt(s)).type="f",s)),p=3*Math.max(-8,Math.min(8,Math.floor(pt(A)/3))),E=Math.pow(10,-p),u=Ee[8+p/3];return function(h){return S(E*h)+u}}}}(n),ge=wt.format,Se=wt.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});var zt=m(8448);const ft=(Symbol(),{"font-family":"Google Sans","font-size":14}),Ct=new t.OlP("Default chart options"),vn={padding:{top:10,right:0,bottom:30,left:80},layout:"grouped",delay:20,maxBandWidth:100,valueFun:n=>n,colors:["#a6aaad","#11a3dc","#5e92a8","#10536d","#012345"],palette:function fe(){var n=pe($t()(xt.yR));return n.copy=function(){return Zt(n,fe())},Gt.O.apply(n,arguments)}(En),xAxis:{type:"string",clipped:!0,font:ft,minZoom:1,maxZoom:10,padding:10,position:"bottom"},yAxis:{clipped:!1,font:ft,minZoom:1,maxZoom:1,padding:10,position:"left"}},Pn=(Xt([],[]).interpolate(ln.q),(0,zt.Z)(),{padding:{top:10,right:10,bottom:10,left:10},delay:20,font:{"pointer-events":"none","text-anchor":"middle","font-size":10,"fill-opacity":.9},title:{font:{dy:"0.35em"}},palette:(0,zt.Z)([],[])});var Te=m(2687),wn=m(445),$n=m(5589),Zn=m(3353),Bn=m(4080),qt=m(266),Kn=m(9751),Wn=m(7579),Bt=m(9300),Re=m(7489),Ne=m(3511),kn=m(3698),be=m(8169),Kt=m(29),Hn=m(9338),Yn=m(1780);function Ft(){var i,r,n=(0,zt.Z)().unknown(void 0),a=n.domain,e=n.range,_=0,o=1,c=!1,l=0,d=0,g=.5;function s(){var A=a().length,S=o<_,p=S?o:_,E=S?_:o;i=(E-p)/Math.max(1,A-l+2*d),c&&(i=Math.floor(i)),p+=(E-p-i*(A-l))*g,r=i*(1-l),c&&(p=Math.round(p),r=Math.round(r));var u=(0,Ne.Z)(A).map(function(h){return p+i*h});return e(S?u.reverse():u)}return delete n.unknown,n.domain=function(A){return arguments.length?(a(A),s()):a()},n.range=function(A){return arguments.length?([_,o]=A,_=+_,o=+o,s()):[_,o]},n.rangeRound=function(A){return[_,o]=A,_=+_,o=+o,c=!0,s()},n.bandwidth=function(){return r},n.step=function(){return i},n.round=function(A){return arguments.length?(c=!!A,s()):c},n.padding=function(A){return arguments.length?(l=Math.min(1,d=+A),s()):l},n.paddingInner=function(A){return arguments.length?(l=Math.min(1,A),s()):l},n.paddingOuter=function(A){return arguments.length?(d=+A,s()):d},n.align=function(A){return arguments.length?(g=Math.max(0,Math.min(1,A)),s()):g},n.copy=function(){return Ft(a(),[_,o]).round(c).paddingInner(l).paddingOuter(d).align(g)},Gt.o.apply(s(),arguments)}var Ln=m(4659),De=m(711),bt=m(8791),Qn=m(1426),J=m(7524),X=m(3409),F=m(9388),j=m(3573),Ie=m(4558),ht=m(682),jt=m(2526),Gn=m(821);const z=1e3,q=60*z,V=60*q,L=24*V,Mt=30*L,Vt=365*L,Dt=[[J.Z,1,z],[J.Z,2,2*z],[J.Z,3,3*z],[J.Z,4,4*z],[J.Z,5,5*z],[J.Z,10,10*z],[J.Z,15,15*z],[J.Z,30,30*z],[X.Z,1,q],[X.Z,2,2*q],[X.Z,3,3*q],[X.Z,4,4*q],[X.Z,5,5*q],[X.Z,10,10*q],[X.Z,15,15*q],[X.Z,30,30*q],[F.Z,1,V],[F.Z,2,2*V],[F.Z,3,3*V],[F.Z,4,4*V],[F.Z,6,6*V],[F.Z,8,8*V],[F.Z,12,12*V],[j.Z,1,L],[j.Z,2,2*L],[j.Z,3,3*L],[j.Z,4,4*L],[j.Z,5,5*L],[j.Z,6,6*L],[j.Z,10,10*L],[Ie.OM,1,6048e5],[ht.Z,1,Mt],[ht.Z,2,2*Mt],[ht.Z,3,3*Mt],[ht.Z,4,4*Mt],[ht.Z,6,6*Mt],[jt.Z,1,Vt]],ye=n=>{let a;switch(n){case"second":a=J.Z;break;case"minute":a=X.Z;break;case"hour":a=F.Z;break;case"day":a=j.Z;break;case"week":a=Ie.OM;break;case"month":a=ht.Z;break;case"year":a=jt.Z;break;default:a=Gn.Z}return a},Oe=(n,a,e)=>{const _=ye(e);return Math.max(1,_.count(n,a))};var te=m(8184);let zn=0;const It=(n,a,e)=>{const _=n.invertX(a[0][0])-e[0][0],o=n.invertX(a[1][0])-e[1][0],i=n.invertY(a[0][1])-e[0][1],r=n.invertY(a[1][1])-e[1][1];return n.translate(o>_?_:Math.min(0,_)||Math.max(0,o),r>i?i:Math.min(0,i)||Math.max(0,r))};let xe=(()=>{class n{constructor(e,_,o,i,r){this.renderer=_,this.changeDetectorRef=o,this.overlay=i,this.injector=r,this.dimension=new DOMRect(0,0,0,0),this.subscription=new at.w0,this._isDev=!1,this.CONTENT_CLASS_NAME="drawing",this.X_AXIS_CLASS_NAME="x-axis",this.Y_AXIS_CLASS_NAME="y-axis";const c=this.createSVGElement("svg"),l=this.createSVGElement("g"),d=this.createSVGElement("g"),g=this.createSVGElement("g"),s=this.createSVGElement("rect");_.addClass(l,this.X_AXIS_CLASS_NAME),_.addClass(d,this.Y_AXIS_CLASS_NAME),_.addClass(g,this.CONTENT_CLASS_NAME),_.addClass(s,"canvas-area"),_.appendChild(c,this.createSVGElement("defs")),_.appendChild(g,s),_.appendChild(c,l),_.appendChild(c,d),_.appendChild(c,g),_.appendChild(e,c),this.id_count=++zn,this.chartOptions=(0,Re.merge)({},r.get(Ct)),this._container=e,this.content=(0,De.Z)(c),this.resizeObservable=new Kn.y(A=>{const S=new ResizeObserver(p=>{const E=p[0].contentRect;A.next(new DOMRect(Math.floor(E.left),Math.floor(E.top),Math.floor(E.width),Math.floor(E.height)))});return S.observe(e),function(){S.disconnect()}}),this.renderingObs=new Wn.x,this.zoom=(0,bt.sP)().constrain(It),this.xZoom=(0,bt.sP)().constrain(It),this.yZoom=(0,bt.sP)().constrain(It),this.tooltipPositionStrategy=this.overlay.position().flexibleConnectedTo(c).withPositions([{originX:"start",originY:"top",overlayX:"center",overlayY:"bottom"}])}set options(e){this.chartOptions=(0,Re.merge)({},this.injector.get(Ct),e)}get options(){return this.chartOptions}set xTransform(e){const _=this.xZoom;e&&(e=new bt.ax(Math.min(_.scaleExtent()[1],Math.max(_.scaleExtent()[0],e.k)),e.x,e.y),e=It(e,_.extent()(),_.translateExtent())),this._xTransform=e}get xTransform(){return this._xTransform}set yTransform(e){const _=this.yZoom;e&&(e=new bt.ax(Math.min(_.scaleExtent()[1],Math.max(_.scaleExtent()[0],e.k)),e.x,e.y),e=It(e,_.extent()(),_.translateExtent())),this._yTransform=e}get yTransform(){return this._yTransform}ngOnChanges(e){if(e.options){const _=e.options?.previousValue,o=e.options?.currentValue,i=this.options;this.zoom.scaleExtent([this.getScaleBoundary(i.minZoom),this.getScaleBoundary(i.maxZoom)]),this.xZoom.scaleExtent([this.getScaleBoundary(typeof i.xAxis?.minZoom<"u"?i.xAxis.minZoom:i.minZoom),this.getScaleBoundary(typeof i.xAxis?.maxZoom<"u"?i.xAxis.maxZoom:i.maxZoom)]),this.yZoom.scaleExtent([this.getScaleBoundary(typeof i.yAxis?.minZoom<"u"?i.yAxis.minZoom:i.minZoom),this.getScaleBoundary(typeof i.yAxis?.maxZoom<"u"?i.yAxis.maxZoom:i.maxZoom)]),o?.xAxis?.position!==_?.xAxis?.position||o?.xAxis?.type!==_?.xAxis?.type?this.createAxisScale("x",i.xAxis):typeof o?.xAxis?.format<"u"&&this.xAxis.tickFormat(o.xAxis.format),o?.yAxis?.position!==_?.yAxis?.position?this.createAxisScale("y",i.yAxis):typeof o?.yAxis?.format<"u"&&this.yAxis.tickFormat(o.yAxis.format),this.tooltip.disabled=(0,w.Ig)(i.tooltip?.disabled)}(e.data||e.options)&&this.tooltip&&this.tooltip.hide()}ngOnInit(){this.subscription.add(this.resizeObservable.pipe((0,Bt.h)(e=>{const _=this.dimension;return e.width!==_.width||e.height!==_.height}),(0,G.U)(e=>(this.dimension=e,e)),(0,it.b)(100)).subscribe(()=>{this.resize(),this.identifyZoom(),this.prepareToRender()})),this.renderingObs.pipe((0,it.b)(5)).subscribe(()=>{this.render()}),this.content.on("contextmenu",e=>{e.preventDefault()})}ngAfterViewInit(){}ngOnDestroy(){this.renderingObs.complete(),this.subscription.unsubscribe(),this.tooltip&&this.tooltip.hide()}zoomIn(){this.content.call(this.zoom.scaleBy,2)}zoomOut(){this.content.call(this.zoom.scaleBy,.5)}getValue(...e){const _=this.invertViewData.call(this,...e);return this.options.valueFun(_,...e)}getXValue(e){const _=this.options.xAxis?.valueFun;return(0,w.su)("function"==typeof _?_(e):e)}getYValue(e){const _=this.options.yAxis?.valueFun;return(0,w.su)("function"==typeof _?_(e):e)}getPalette(){return this.palette}getCanvasArea(){const e=this.dimension,_=this.options.padding;return{..._,width:Math.max(0,e.width-_.left-_.right),height:Math.max(0,e.height-_.top-_.bottom)}}getContainer(){return this._container}resize(){const e=this.dimension,_=e.width,o=e.height;this.content.attr("viewBox",[0,0,_,o]).attr("width",_).attr("height",o),this.setViewportExtent()}setPalette(){const e=this.options,_=this.injector.get(Ct);let o=e.palette;if(o&&o.unknown(_.palette.unknown()),o=this.palette=o||_.palette.copy(),"static"!==e.domain||!e.palette){const r=(this.data||[]).length;let c=e.colors;(!c||!c.length)&&(c=(0,Hn.Z)(Ln.Z,r+2),c.shift(),c.pop()),o.domain((0,Ne.Z)(0,r+1)).range(c)}}setViewportExtent(){const e=this.options,_=this.getCanvasArea(),o=this.content,i=[{className:this.X_AXIS_CLASS_NAME,viewBox:this.getAxisViewBox(e.xAxis,_)},{className:this.Y_AXIS_CLASS_NAME,viewBox:this.getAxisViewBox(e.yAxis,_)},{className:this.CONTENT_CLASS_NAME,viewBox:[_.left,_.top,_.width,_.height]}];[{axis:this.xAxis,scale:this.xAxisScale,zoom:this.xZoom,options:e.xAxis},{axis:this.yAxis,scale:this.yAxisScale,zoom:this.yZoom,options:e.yAxis}].forEach(r=>{const{axis:c,scale:l,zoom:d,options:g}=r;if("string"==typeof g?.minZoom||"string"==typeof g?.maxZoom){const s=d.scaleExtent(),A=this.calcAppropriateNumberOfTicks(c,l,g,_);if("string"==typeof g?.minZoom){const S=Oe(l.domain()[0],l.domain().slice(-1)[0],g.minZoom);s[0]=S/A}if("string"==typeof g?.maxZoom){const S=Oe(l.domain()[0],l.domain().slice(-1)[0],g.maxZoom);s[1]=S/A}d.scaleExtent(s)}}),o.selectAll("defs").data([null]).join(r=>r.append(()=>this.createSVGElement("defs"))).selectAll("clipPath").data(i).join(r=>r.append(()=>this.createSVGElement("clipPath"))).attr("clipPathUnits","userSpaceOnUse").attr("id",(r,c,l)=>{const d=(0,De.Z)(l[c]);let g;switch(r.className){case this.X_AXIS_CLASS_NAME:g=this.xZoom.translateExtent([[r.viewBox[0],r.viewBox[1]],[r.viewBox[0]+r.viewBox[2],r.viewBox[1]]]);break;case this.Y_AXIS_CLASS_NAME:g=this.yZoom.translateExtent([[r.viewBox[0],r.viewBox[1]],[r.viewBox[0],r.viewBox[1]+r.viewBox[3]]]);break;default:g=this.zoom.translateExtent([[r.viewBox[0],r.viewBox[1]],[r.viewBox[0]+r.viewBox[2],r.viewBox[1]+r.viewBox[3]]])}return g.extent([[r.viewBox[0],r.viewBox[1]],[r.viewBox[0]+r.viewBox[2],r.viewBox[1]+r.viewBox[3]]]),d.selectAll("rect").data([null]).join(s=>s.append(()=>this.createSVGElement("rect"))).attr("x",r.viewBox[0]).attr("y",r.viewBox[1]).attr("width",r.viewBox[2]).attr("height",r.viewBox[3]),this.getClipID(r.className)}),o.select(`.${this.CONTENT_CLASS_NAME}`).attr("clip-path",`url(#${this.getClipID(this.CONTENT_CLASS_NAME)})`).select("rect.canvas-area").attr("fill","transparent").attr("x",_.left).attr("y",_.top).attr("width",_.width).attr("height",_.height)}prepareToRender(){this.renderingObs.next()}createAxisScale(e,_){let o,i;switch(_?.type){case"date":o=(0,Yn.Z)();break;case"string":o=Ft();break;default:o=Xt()}switch(_?.position){case"top":if("y"===e)throw new Error("yAxis cannot be placed on horizontal.");i=(0,Kt.F5)(o);break;case"left":if("x"===e)throw new Error("xAxis cannot be placed on vertical.");i=(0,Kt.y4)(o);break;case"right":if("x"===e)throw new Error("xAxis cannot be placed on vertical.");i=(0,Kt.Kh)(o);break;default:if("y"===e)throw new Error("yAxis cannot be placed on horizontal.");i=(0,Kt.LL)(o)}return i.tickSize(5).tickPadding(10),typeof _?.format<"u"&&i.tickFormat(_.format),"x"===e?(this.xAxisScale=o,this.xAxis=i):(this.yAxisScale=o,this.yAxis=i),o}createAxis(e,_,o,i){const r=e.scale(),c=this.getCanvasArea(),l=this.getAxisViewBox(_,c),d=this.content,g=this.calcAppropriateNumberOfTicks(e,r,_,c);let s;if("function"==typeof r.invert)e.ticks("date"===_.type?((n,a,e,_)=>{const o=Math.abs(a-n)/e,i=(0,Qn.Z)(([,,l])=>l).right(Dt,o);if(i===Dt.length)return jt.Z.every((0,St.ly)(n/Vt,a/Vt,e));if(0===i)return ye(_).every(Math.max((0,St.ly)(n,a,e),1));const[r,c]=Dt[o/Dt[i-1][2]<Dt[i][2]/o?i-1:i];return r.every(c)})(r.invert(0).valueOf(),r.invert(c.width).valueOf(),g-2,"string"==typeof _.minZoom?_.minZoom:void 0):g);else{const S=Math.max(1,(0,w.su)(this.data?.length));e.tickValues(function Un(n,a){if("function"!=typeof a)throw new TypeError("test is not a function");const e=[];let _=-1;for(const o of n)a(o,++_,n)&&e.push(o);return e}(r.domain(),(p,E)=>E%Math.max(1,Math.floor(S/g/(0,w.su)(i.k)))==0))}switch(_?.position){case"left":s=[c.left,0];break;case"right":s=[c.left+c.width,0];break;case"top":s=[0,c.top];break;default:s=[0,c.top+c.height]}const A=d.select(`.${o}`).attr("clip-path",(0,w.Ig)(_?.clipped)?`url(#${this.getClipID(o)})`:"").on("wheel",S=>{S.preventDefault()});A.selectAll("rect").data(S=>[S]).join(S=>S.append(()=>this.createSVGElement("rect"))).attr("x",l[0]).attr("y",l[1]).attr("width",l[2]).attr("height",l[3]).attr("fill","transparent"),A.selectAll("g").data(S=>[S]).join(S=>S.append(()=>this.createSVGElement("g"))).attr("transform",`translate(${s})`).style("user-select","none").call(e).call(S=>{this.setStyle(S,_.font),this.setStyle(S.selectAll(".domain"),_.baseline?.style),this.setStyle(S.selectAll(".tick line"),_.ticks?.style)})}getAxisViewBox(e,_){let o;switch(e?.position){case"top":o=[_.left,0,_.width,_.top];break;case"left":o=[0,_.top,_.left,_.height];break;case"right":o=[_.left+_.width,_.top,_.right,_.height];break;default:o=[_.left,_.top+_.height,_.width,_.bottom]}return o}calcAppropriateNumberOfTicks(e,_,o,i){const r=(0,w.su)(o?.font["font-size"])||14,c=(0,w.su)(o?.padding);let d,g,s,A,l=e.tickFormat();switch(l=null===l?_.tickFormat?_.tickFormat.apply(_,e.tickArguments()):S=>S:l,o?.position){case"left":case"right":d=i.top+i.height,g=i.height,s=r;break;default:const p=this.renderer.createElement("canvas").getContext("2d"),E=u=>"function"==typeof u?.toString?p.measureText(u.toString()).width:0;p.font=`${r}px "${o.font["font-family"]}"`,d=i.left,g=i.width,s=(0,kn.Z)((_.invert?(0,be.Z)((0,St.ZP)(d,d+g,g),u=>E(l(_.invert(u),-1))):(0,be.Z)(_.domain(),u=>E(l(u,-1)))).concat([c]))}return s=Math.ceil(s)+c,A=Math.max(1,Math.floor(g/s)),A}getTransformXAxisScale(){const e=this.xAxisScale,_=this.xTransform;try{return _.rescaleX(e)}catch{return("function"==typeof e.rangeRound?e.copy().rangeRound:e.copy().range)(e.range().map(i=>_.applyX(i)))}}getTransformYAxisScale(){const e=this.yAxisScale,_=this.yTransform;try{return _.rescaleY(e)}catch{return("function"==typeof e.rangeRound?e.copy().rangeRound:e.copy().range)(e.range().map(i=>_.applyY(i)))}}getScaleBoundary(e,_){let o;switch(typeof e){case"boolean":o=e?1/0:1;break;case"number":o=e;break;default:o=1}return o}createSVGElement(e){return this.renderer.createElement(e,"svg")}setStyle(e,_){let o;o="function"==typeof _?_(e.data()):_||{};for(const i in o)e.attr(i,o[i])}createTooltip(){const e=this.injector,_=new qt.gM(this.overlay,new t.SBq(this.getContainer()),e.get($n.mF),e.get(t.s_b),e.get(t.R0b),e.get(Zn.t4),e.get(Te.$s),e.get(Te.tE),e.get(qt.cV),e.get(wn.Is),e.get(qt.Jm),e.get(M.K0)),o=this.options?.tooltip?.component;return o&&(_._portal=new Bn.C5(o,e.get(t.s_b))),_.message="_",_.show(),_.hide(),_._overlayRef.updatePositionStrategy(this.tooltipPositionStrategy),_}updateTooltip(e,_){const o=this.tooltip,i=this.injector.get(t.R0b),r=e.offsetX,c=e.offsetY;i.run(()=>{this.tooltipPositionStrategy.withPositions([{offsetX:r,offsetY:c,originX:"start",originY:"top",overlayX:"center",overlayY:"bottom"}]),o.message=`${_}`,o.show()})}enableMultipleSelection(e){return navigator.platform?.toLowerCase().indexOf("mac")>-1?e.metaKey:e.ctrlKey}getClipID(e){return`boundsClip-${this.injector.get(t.AFp)}-${this.id_count}-${e}`}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(HTMLElement),t.Y36(t.Qsj),t.Y36(t.sBO),t.Y36(te.aV),t.Y36(t.zs3))},n.\u0275dir=t.lG2({type:n,inputs:{data:"data",selection:"selection",options:"options"},features:[t.TTD]}),n})(),qn=(()=>{class n extends xe{constructor(e,_,o,i,r){super((0,w.fI)(e),_,o,i,r),this.renderer=_,this.changeDetectorRef=o,this.overlay=i,this.injector=r,this.createAxisScale("x",this.options.xAxis),this.createAxisScale("y",this.options.yAxis),this.tooltip=this.createTooltip()}ngOnChanges(e){if(super.ngOnChanges(e),["data","options"].some(o=>e[o]&&(e[o].firstChange||e[o].currentValue!==e[o].previousValue))){const o=this.options,i="stacked"===o.layout,r=this.data||[];[{scale:this.xAxisScale,options:o.xAxis,domain:T.UID(r,l=>l[0])},{scale:this.yAxisScale,options:o.yAxis,domain:T.TSy(T.UID(r,l=>T.UID(l.slice(1),i?(d,g)=>T.e3P(l.slice(1,g+2)):d=>Math.abs((0,w.su)(d))))).concat([0])}].forEach(l=>{if("string"===l.options.type)l.scale.domain(l.domain);else{const d=typeof l.options?.min<"u",g=typeof l.options?.max<"u";let s=T.Wem(l.domain);d&&(s[0]=T.VV$([s[0],l.options.min])),g&&(s[1]=T.Fp7([s[1],l.options.max])),l.scale.domain(s),"function"==typeof l.scale.nice&&l.scale.nice()}}),this.setPalette()}this.xTransform&&this.yTransform&&this.prepareToRender()}ngOnInit(){super.ngOnInit(),this.xZoom.on("zoom",e=>{const _=this.xTransform;this.xTransform=e.transform,(_.k!==e.transform.k||_.x!==e.transform.x)&&this.prepareToRender()}),this.yZoom.on("zoom",e=>{const _=this.yTransform;this.yTransform=e.transform,(_.k!==e.transform.k||_.y!==e.transform.y)&&this.prepareToRender()})}render(){this.renderAxes(),this.renderContent()}renderContent(){const e=this.data||[],_=this.getNumOfSeries(e),o=this.options,i="stacked"===o.layout,c=this.getPalette(),l=this.getTransformXAxisScale(),d=this.getTransformYAxisScale(),g=this.content.select(`.${this.CONTENT_CLASS_NAME}`);let s=30;"function"==typeof l.clamp&&l.clamp(!1),"function"==typeof d.clamp&&d.clamp(!1),s="function"==typeof l.bandwidth?l.bandwidth():Math.abs(Math.floor(l(e[0][0])-l(e[1][0]))),g.selectAll("g.bars").data([null]).join(E=>E.append(()=>this.createSVGElement("g"))).attr("class","bars").selectAll("g.bar").data(e).join(E=>E.append(()=>this.createSVGElement("g"))).attr("class","bar").call(E=>{E.selectAll("rect").data(u=>T.UID(u.slice(1),()=>u)).join(u=>u.append(()=>this.createSVGElement("rect"))).attr("fill",(u,h)=>c(h)).attr("x",(u,h)=>l(u[0])+(i?0:s/_*h)).attr("width",i?s:s/_).attr("y",(u,h)=>d(i?h<1?u[h+1]:u[h]:Math.abs(u[h+1]))).attr("height",(u,h)=>d(0)-d(Math.abs(u[h+1])))}).on("mousemove",E=>{this.tooltip&&this.showTooltip(E)}).on("mouseenter",E=>{this.tooltip&&this.showTooltip(E),E.stopPropagation()}).on("mouseleave",E=>{this.tooltip&&this.tooltip.hide(),E.stopPropagation()});const A=new Array(Math.min(1,_)),S=T.q$2(T.OOA,_+2);S.unshift(),S.pop();const p=T.PKp(T.w6H(0,_,1),S);A.length&&(A[0]=_-1),g.selectAll("g.lines").data(A).join(E=>E.append(()=>this.createSVGElement("g"))).attr("class","lines").call(E=>{E.selectAll("path").data(u=>[T.UID(e,h=>[h[0],i?T.e3P(h.slice(1)):h[u]])]).join(u=>u.append(()=>this.createSVGElement("path"))).attr("fill","none").attr("stroke",(u,h)=>p(h)).attr("stroke-width",1).attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("d",T.jvg().curve(T.FdL).x(u=>l(u[0])+s/2).y(u=>d(u[1]))).call(u=>{this.setStyle(u,o.lineStyle)})})}renderAxes(){const e=this.options,_=this.content,o=this.X_AXIS_CLASS_NAME,i=this.Y_AXIS_CLASS_NAME,r=this.getCanvasArea(),c=this.xAxisScale;if("function"==typeof c.bandwidth){const l=c.domain().length,d=(0,w.su)(e.maxBandWidth),g=this.xTransform;c.paddingOuter(Math.max(.01,1-l/(r.width/d))),c.paddingInner(Math.max(.38,c.paddingOuter())),this.xZoom.scaleExtent([1,Math.max(1,d/c.step())]),this.xTransform=new T.axH(g.k,g.x,g.y)}this.createAxis(this.xAxis.scale(this.getTransformXAxisScale()),e.xAxis,o,this.xTransform),this.createAxis(this.yAxis.scale(this.getTransformYAxisScale()),e.yAxis,i,this.yTransform),_.select(`.${o}`).call(this.xZoom).call(this.xZoom.transform,this.xTransform),_.select(`.${i}`).call(l=>{l.selectAll(".tick line").clone().attr("x2",r.width).attr("stroke","#000000").style("stroke-dasharray",d=>0===d?null:"3 3").attr("stroke-opacity",d=>0===d?.5:.2)}).call(this.yZoom)}viewData(e){return this.getTransformXAxisScale()(this.getXValue(e))}invertViewData(e,_=this.data){return _[e]}setViewportExtent(){super.setViewportExtent();const e=this.options,_=this.getCanvasArea();[{scale:this.xAxisScale,options:e.xAxis},{scale:this.yAxisScale,options:e.yAxis}].forEach(i=>{switch(i.options?.position){case"left":case"right":("function"==typeof i.scale.rangeRound?i.scale.rangeRound:i.scale.range)([_.top+_.height,_.top]);break;default:("function"==typeof i.scale.rangeRound?i.scale.rangeRound:i.scale.range)([_.left,_.left+_.width])}})}identifyZoom(){this.xTransform=this.yTransform=T.CRH}showTooltip(e){const _=T.Ys(e.target),o=_.size()?_.data()[0]:null,i=this.options.tooltip?.content,r=o?"function"==typeof i?i(o):T.u4g(o,(c,l)=>c+`${l} \n`,""):"";this.updateTooltip(e,r)}getNumOfSeries(e){return e&&e[0]?e[0].length-1:0}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(t.Qsj),t.Y36(t.sBO),t.Y36(te.aV),t.Y36(t.zs3))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-bar-chart"]],hostAttrs:[1,"chart","chart-bar"],inputs:{data:"data"},features:[t._Bn([{provide:Ct,useValue:vn}]),t.qOj,t.TTD],decls:0,vars:0,template:function(e,_){},styles:["[_nghost-%COMP%]{display:block;overflow:hidden}","svg[_ngcontent-%COMP%]{display:block}"]}),n})(),Fn=(()=>{class n extends xe{constructor(e,_,o,i,r,c){super((0,w.fI)(e),_,o,i,r),this.renderer=_,this.changeDetectorRef=o,this.overlay=i,this.injector=r,this.percentPipe=c,this.arc=T.Nb1().startAngle(l=>l.x0).endAngle(l=>l.x1).padAngle(l=>Math.min((l.x1-l.x0)/2,.005)).innerRadius(l=>l.y0).outerRadius(l=>l.y1-1),this.totalDepth=0,this.tooltip=this.createTooltip()}ngOnChanges(e){super.ngOnChanges(e),["data","options"].some(o=>e[o]&&(e[o].firstChange||e[o].currentValue!==e[o].previousValue))&&this.setPalette(),this.prepareToRender()}ngOnInit(){super.ngOnInit()}render(){this.renderContent()}renderContent(){const e=(this.data?this.data[0]:null)||{id:"",name:"",children:[]},_=this.options,o=(0,w.su)(_?.font["font-size"])||14,r=this.getPalette(),c=this.getCanvasArea(),l=Math.min(c.width,c.height)/2,d=this.content.select(`.${this.CONTENT_CLASS_NAME}`),g=this.arc.padRadius(l/2),s=this.root=T.uKc().size([2*Math.PI,l])(T.bT9(e).sum(E=>E.children&&E.children.length?0:E.value).sort((E,u)=>u.value-E.value)),A=this.totalDepth=T.Fp7(s.descendants(),E=>E.depth),S=1/this.totalDepth,p=T.sXR(Math.min(Math.max(S,.4),.9),Math.max(Math.min(1-S,.9),.9));r.domain(T.UID(e.children,E=>E.id)),d.selectAll("text.main").data([e]).join(E=>E.append(()=>this.createSVGElement("text"))).attr("class","main").attr("transform",`translate(${[c.left+c.width/2,c.top+c.height/2]})`).attr("text-anchor","middle").call(E=>{this.setTitle(E,E.data()[0]),this.setStyle(E,_.title?.font)}),d.selectAll("g.part").data(s.descendants().filter(E=>E.depth&&E.x1-E.x0>.001)).join(E=>E.append(()=>this.createSVGElement("g"))).attr("class","part").attr("transform",`translate(${[c.left+c.width/2,c.top+c.height/2]})`).call(E=>{E.selectAll("path").data(u=>u).join(u=>u.append(()=>this.createSVGElement("path"))).attr("fill",(u,h)=>this.getColorByData(u,h).toString()).attr("fill-opacity",u=>p((u.depth+1)/A)).attr("d",g),E.selectAll("text").data(u=>u).join(u=>u.append(()=>this.createSVGElement("text"))).attr("transform",u=>{const h=(u.x0+u.x1)/2*180/Math.PI;return`rotate(${h-90}) translate(${(u.y0+u.y1)/2}, 0) rotate(${h<180?0:180})`}).text(u=>u.depth&&(u.y0+u.y1)/2*(u.x1-u.x0)>o?u.data.name:"").call(u=>{u.attr("dy","0.35em"),this.setStyle(u,_.font)})}).on("mousemove",E=>{this.tooltip&&this.showTooltip(E)}).on("mouseenter",E=>{const u=T.Ys(E.target),h=u.data()[0];u.select("path").attr("fill-opacity",1),this.setTitle(d.select("text.main"),h.data),this.tooltip&&this.showTooltip(E),E.stopPropagation()}).on("mouseleave",E=>{const u=T.Ys(E.target),h=u.data()[0];u.select("path").attr("fill-opacity",p((h.depth+1)/A)),this.setTitle(d.select("text.main"),this.data?this.data[0]:null),this.tooltip&&this.tooltip.hide(),E.stopPropagation()})}renderAxes(){throw new Error("Method not implemented.")}viewData(e){throw new Error("Method not implemented.")}invertViewData(e){return e}setPalette(){const e=this.options,_=this.injector.get(Ct),i=((this.data?this.data[0]:null)||{id:"",name:"",children:[]}).children.length;let r=e.palette,c=e.colors;r&&r.unknown(_.palette.unknown()),r=this.palette=r||_.palette.copy(),(!c||!c.length)&&(c=T.q$2(T.ICD,i+1).reverse(),c.pop()),r.range(c)}identifyZoom(){this.xTransform=this.yTransform=T.CRH}showTooltip(e){const _=this.options.tooltip?.content,o=T.Ys(e.target),i=o.size()?o.data()[0]:null,r=i?"function"==typeof _?_(i.data):`${i.ancestors().map(c=>c.data.name).reverse().join("/")}\n${this.percentPipe.transform(i.value/this.root.value,"0.0-2")}`:"";this.updateTooltip(e,r)}setTitle(e,_){let o="",i=0;_&&(_.name?o=_.name:_.data&&(o=_.data.name),"number"==typeof _.value&&(i=_.value)),e.selectAll(".percentage").data([o,this.getValue(i).toString()]).join(r=>r.append(()=>this.createSVGElement("tspan"))).attr("class","percentage").attr("x",0).attr("y",0).attr("dy",(r,c)=>1.2*c-.1+"em").text(r=>r)}getColorByData(e,_){const o=e.depth;let i=1,r=_%i;for(e.parent&&(i=e.parent.data.children.length,r=_%i,e.parent.data.children.some((s,A)=>e.data.name===s.name&&(r=A,!0)));e.depth>1;)e=e.parent;const c=T.Ym7(this.getPalette()(e.data.id)),l=T.Ym7(c).h,d=1/this.totalDepth;let g=c;if(o>1){const s=T.Ym7(l,Math.max(1-d,.3),Math.max(1-d,.8)),A=T.Ym7(l,1,Math.min(d,.2));g=T.Ym7(T.USs(s,A)(r/i))}return g}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(t.Qsj),t.Y36(t.sBO),t.Y36(te.aV),t.Y36(t.zs3),t.Y36(M.Zx))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-sunburst-chart"]],hostAttrs:[1,"chart","chart-sunburst"],features:[t._Bn([{provide:Ct,useValue:Pn}]),t.qOj,t.TTD],decls:0,vars:0,template:function(e,_){},styles:["[_nghost-%COMP%]{display:block;overflow:hidden}","svg[_ngcontent-%COMP%]{display:block}"]}),n})();var Tt=m(4859),I=m(9602),$=m(9549),Rt=m(7392),Wt=m(4385),Ut=m(1299),jn=m(8811),ee=m(2201);function Vn(n,a){if(1&n&&(t.TgZ(0,"mat-option",18),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}let t_=(()=>{class n{constructor(e,_,o,i,r,c,l,d,g){this.elementRef=e,this.currencyPipe=_,this.datePipe=o,this.dateAdapter=i,this.notification=r,this.communication=c,this.datetimeService=l,this.database=d,this.statistics=g,this.currencyValueFormat=s=>this.currencyPipe.transform(s/100,"CNY","symbol-narrow","0.0-2"),this.dateRange=new f.cw({start:new f.NI(null),end:new f.NI(null)}),this.books=[],this.totalBalance="",this.sunburstChartOptions={valueFun:this.currencyValueFormat},this.barChartOptions={layout:"stacked",lineStyle:{stroke:"#5e92a8","stroke-width":2},valueFun:this.currencyValueFormat,tooltip:{content:s=>`${this.datePipe.transform(s[0],"MMMM, y")}\n        \t ${s.slice(1).reduce((A,S,p)=>A+`${p>0?"\n":""} ${S<0?"":"+"}${this.currencyValueFormat(S)}`,"")}\n        \t =${this.currencyValueFormat(s.slice(1).reduce((A,S)=>A+S,0))}\n      `},xAxis:{baseline:{style:{stroke:"#808080"}},font:{color:"#808080"},format:s=>this.datePipe.transform(s,"MMM, y")},yAxis:{baseline:{style:{stroke:"transparent"}},font:{color:"#808080"},format:this.currencyValueFormat}},this.subscription=new at.w0}ngOnInit(){this.dateRange.valueChanges.subscribe(()=>{this.communication.giveRefreshCommand()}),this.datetimeService.initTimeRange(this.dateRange)}ngAfterViewInit(){setTimeout(()=>{this.database.getBooks().subscribe(e=>{this.books=e.data.books,this.selectedBook=this.books[0].id,this.initRefreshIndicator()})})}ngOnDestroy(){this.subscription.unsubscribe(),this.datetimeService.destoryTimeRange()}onBookSelectionChange(e){this.communication.giveRefreshCommand()}prevYear(){const _=this.dateAdapter.getYear(this.dateRange.value.start)-1;this.dateRange.setValue({start:this.dateAdapter.createDate(_,0,1),end:this.dateAdapter.createDate(_,11,31)})}nextYear(){const _=this.dateAdapter.getYear(this.dateRange.value.end)+1;this.dateRange.setValue({start:this.dateAdapter.createDate(_,0,1),end:this.dateAdapter.createDate(_,11,31)})}prevMonth(){const e=this.dateAdapter;let _=e.clone(this.dateRange.value.start),o=e.today();_=e.createDate(e.getYear(_),e.getMonth(_)-1,1),o=e.createDate(e.getYear(_),e.getMonth(_)+1,1),o=e.addCalendarDays(o,-1),this.dateRange.setValue({start:_,end:o})}nextMonth(){const e=this.dateAdapter;let o,_=this.dateAdapter.clone(this.dateRange.value.end);_=e.createDate(e.getYear(_),e.getMonth(_)+2,1),_=e.addCalendarDays(_,-1),o=e.createDate(e.getYear(_),e.getMonth(_),1),this.dateRange.setValue({start:o,end:_})}showAllHistory(){this.dateRange.setValue({start:this.datetimeService.getMinDate(),end:this.datetimeService.getMaxDate()})}initRefreshIndicator(){this.subscription.add(this.communication.acceptRefreshCommand().pipe((0,it.b)(500),(0,sn.O)({}),(0,Lt.w)(()=>{let e=this.dateRange.controls.start.value,_=this.dateRange.controls.end.value;return this.dateRange.invalid?(0,v.of)(null):(this.notification.showLoading(this.elementRef.nativeElement),e&&_?(e=this.dateAdapter.deserialize(this.datetimeService.getStartDatetime(e)),_=this.dateAdapter.deserialize(this.datetimeService.getEndDatetime(_)),(0,ot.D)([this.assemblePayCategoriesStatistics(e,_),this.assembleRevenueCategoriesStatistics(e,_),this.assembleRevenueNExpenditureStatistics(e,_)])):(0,v.of)(null))}),(0,Z.x)(()=>{this.notification.hideLoading()})).subscribe(()=>{this.notification.hideLoading()}))}assemblePayCategoriesStatistics(e,_){return(0,ot.D)([this.database.getEntryCategories(this.selectedBook,rt.PAY),this.statistics.getCategoryStatistics(this.selectedBook,e,_,1),this.statistics.getCategoryStatistics(this.selectedBook,e,_,2)]).pipe((0,Q.K)(()=>(0,v.of)([])),(0,G.U)(o=>{let i=!1;if(o.forEach(d=>{d.error&&(i=!0),i=!d.data||i}),i)return void(this.payCategoriesData=[]);const r=o[0].data.bookCategories,c=o[1].data,l=o[2].data.groups;return this.payCategoriesData=[{id:"_",name:c.title,value:c.totalAmount,children:c.groups.map(d=>{const g=d.id,s=r.find(S=>S.categoryId===g)?.outgoSubTypes,A=l.filter(S=>s.some(p=>p.categoryId===S.id)).map(S=>({id:S.id,name:S.name,value:S.amount}));return{id:d.id,name:d.name,value:d.amount,children:A}})}],null}))}assembleRevenueCategoriesStatistics(e,_){return this.statistics.getCategoryStatistics(this.selectedBook,e,_,6).pipe((0,Q.K)(()=>(0,v.of)({})),(0,G.U)(o=>{const i=o.data;if(i&&i.groups)return this.revenueCategoriesData=[{id:"_",name:i.title,value:i.totalAmount,children:i.groups.map(r=>({id:r.id,name:r.name,value:r.amount}))}],null;this.revenueCategoriesData=[]}))}assembleRevenueNExpenditureStatistics(e,_){return this.statistics.getRevenueNExpenditureStatistics(this.selectedBook,e,_,11).pipe((0,Q.K)(()=>(0,v.of)({})),(0,G.U)(o=>{const i=this.dateAdapter,r=o.data;if(r){if(this.totalBalance=r.currency+" "+r.totalBalance/100,!r.groups)return void(this.revNExpndData=[]);this.revNExpndData=r.groups.map(c=>[i.deserialize(c.startTime),c.balanceMoney+c.outgoMoney,-c.outgoMoney])}else this.totalBalance="",this.revNExpndData=[];return null}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(M.H9),t.Y36(M.uU),t.Y36(k._A),t.Y36(ct.g),t.Y36(gt.O),t.Y36(Qt.d),t.Y36(st),t.Y36(se))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-dashboard"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:51,vars:20,consts:function(){let a;return a="Account book",[["role","group",1,"btn-group"],["mat-button","",3,"for"],["matDatepickerToggleIcon",""],["type","button","mat-button","",3,"click"],["appearance","legacy","floatLabel","never",1,"mat-mini","mat-form-field-outline"],a,["name","book",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"align-middle","ms-2"],[1,"visually-hidden",3,"formGroup","rangePicker"],["matStartDate","","formControlName","start"],["matEndDate","","formControlName","end"],["dateRangePicker",""],[1,"flex-fill","px-2",2,"overflow-x","hidden","overflow-y","auto"],[1,"row"],[1,"col-12","col-lg-6","py-2","sunburst-chart"],[3,"data","options"],[1,"col-12","py-2","bar-chart"],[3,"value"]]},template:function(e,_){if(1&e&&(t.TgZ(0,"app-operation-toolbar")(1,"div",0)(2,"mat-datepicker-toggle",1)(3,"mat-icon",2),t._uU(4,"date_range"),t.qZA()(),t.TgZ(5,"button",3),t.NdJ("click",function(){return _.showAllHistory()}),t.TgZ(6,"mat-icon"),t._uU(7,"history_toggle_off"),t.qZA()(),t.TgZ(8,"button",3),t.NdJ("click",function(){return _.prevYear()}),t.TgZ(9,"mat-icon"),t._uU(10,"first_page"),t.qZA()(),t.TgZ(11,"button",3),t.NdJ("click",function(){return _.prevMonth()}),t.TgZ(12,"mat-icon"),t._uU(13,"chevron_left"),t.qZA()(),t.TgZ(14,"button",3),t.NdJ("click",function(){return _.nextMonth()}),t.TgZ(15,"mat-icon"),t._uU(16,"chevron_right"),t.qZA()(),t.TgZ(17,"button",3),t.NdJ("click",function(){return _.nextYear()}),t.TgZ(18,"mat-icon"),t._uU(19,"last_page"),t.qZA()()(),t.TgZ(20,"mat-form-field",4)(21,"mat-label"),t.ynx(22),t.SDv(23,5),t.BQk(),t.qZA(),t.TgZ(24,"mat-select",6),t.NdJ("valueChange",function(i){return _.selectedBook=i})("selectionChange",function(i){return _.onBookSelectionChange(i)}),t.YNc(25,Vn,2,2,"mat-option",7),t.qZA()()(),t.TgZ(26,"app-breadcrumb")(27,"span",8),t._uU(28),t.ALo(29,"date"),t.ALo(30,"date"),t.qZA()(),t.TgZ(31,"mat-date-range-input",9),t._UZ(32,"input",10)(33,"input",11),t.qZA(),t._UZ(34,"mat-date-range-picker",null,12),t.TgZ(36,"div",13)(37,"div",14)(38,"div",15)(39,"mat-card")(40,"mat-card-content"),t._UZ(41,"app-sunburst-chart",16),t.qZA()()(),t.TgZ(42,"div",15)(43,"mat-card")(44,"mat-card-content"),t._UZ(45,"app-sunburst-chart",16),t.qZA()()()(),t.TgZ(46,"div",14)(47,"div",17)(48,"mat-card")(49,"mat-card-content"),t._UZ(50,"app-bar-chart",16),t.qZA()()()()()),2&e){const o=t.MAs(35);t.xp6(2),t.Q6J("for",o),t.xp6(22),t.Q6J("value",_.selectedBook),t.xp6(1),t.Q6J("ngForOf",_.books),t.xp6(3),t.lnq(" (",t.xi3(29,14,_.dateRange.value.start,"longDate")," - ",t.xi3(30,17,_.dateRange.value.end,"longDate")," => ",_.totalBalance,") "),t.xp6(3),t.Q6J("formGroup",_.dateRange)("rangePicker",o),t.xp6(10),t.Q6J("data",_.payCategoriesData)("options",_.sunburstChartOptions),t.xp6(4),t.Q6J("data",_.revenueCategoriesData)("options",_.sunburstChartOptions),t.xp6(5),t.Q6J("data",_.revNExpndData)("options",_.barChartOptions)}},dependencies:[qn,Fn,M.sg,nn,en,f.Fj,f.JJ,f.JL,Tt.lW,I.nW,I.Q0,I.wx,I.zY,I.By,I._g,$.KE,$.hX,Rt.Hw,Wt.gD,k.ey,f.sg,f.u,Ut.L,jn.U,ee.e],styles:[".mat-button-base[_ngcontent-%COMP%]{border-radius:0}.sunburst-chart[_ngcontent-%COMP%]   .mat-card-content[_ngcontent-%COMP%]{height:calc(60vh - 140px);min-height:300px}.bar-chart[_ngcontent-%COMP%]   .mat-card-content[_ngcontent-%COMP%]{height:calc(40vh - 100px);min-height:300px}.chart[_ngcontent-%COMP%]{width:100%;height:100%}"]}),n})(),ve=(()=>{class n{constructor(e){this.requestService=e}getBankList(){return this.requestService.get("setting/account_bankList.action",{type:""})}getCardTypeList(){return this.requestService.get("setting/account_cardList.action",{type:""})}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(Ot.s))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();var ne=m(4159),_e=m(636),ae=m(7633);function e_(n,a){1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,17),t.BQk(),t.qZA())}function n_(n,a){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.TgZ(2,"span",19),t._uU(3),t.qZA()()),2&n){const e=a.$implicit;t.xp6(1),t.hij("",e.name," "),t.xp6(2),t.Oqu(e.tailNo)}}function __(n,a){1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,20),t.BQk(),t.qZA())}function a_(n,a){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Oqu(e.groupName)}}function o_(n,a){1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,21),t.BQk(),t.qZA())}function i_(n,a){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.AsE("",e.moneyType.flag," ",t.xi3(2,2,e.balanceMoney,"0.2-2"),"")}}function r_(n,a){1&n&&t._UZ(0,"th",22)}function c_(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"td",18)(1,"button",23),t.NdJ("click",function(){const i=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.goToEntryList(i))}),t.TgZ(2,"mat-icon"),t._uU(3,"receipt"),t.qZA()()()}}function s_(n,a){1&n&&t._UZ(0,"tr",24)}function l_(n,a){1&n&&t._UZ(0,"tr",25)}function d_(n,a){1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,26),t.BQk(),t.qZA())}function u_(n,a){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Oqu(e.name)}}function m_(n,a){1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,27),t.BQk(),t.qZA())}function A_(n,a){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.groupName," ")}}function E_(n,a){if(1&n&&(t.ynx(0),t.TgZ(1,"mat-icon",33),t._uU(2),t.ALo(3,"lowercase"),t.qZA(),t.BQk()),2&n){const e=t.oxw(2).$implicit;t.xp6(2),t.Oqu(t.lcZ(3,1,null==e.bank?null:e.bank.ename))}}function g_(n,a){if(1&n&&(t.ynx(0),t._UZ(1,"img",34),t.BQk()),2&n){const e=t.oxw(2).$implicit;t.xp6(1),t.Q6J("alt",null==e.bank?null:e.bank.ename)("src",e.iconUrl,t.LSH)}}function S_(n,a){if(1&n&&(t.ynx(0,31),t.YNc(1,E_,4,3,"ng-container",29),t.YNc(2,g_,2,2,"ng-container",32),t._uU(3),t.BQk()),2&n){const e=t.oxw().$implicit;t.Q6J("ngSwitch",2===e.type&&!e.iconUrl),t.xp6(1),t.Q6J("ngSwitchCase",!0),t.xp6(2),t.hij(" ",e.tailNo," ")}}function p_(n,a){1&n&&(t.TgZ(0,"td",28),t.YNc(1,A_,2,1,"ng-container",29),t.YNc(2,S_,4,3,"ng-container",30),t.qZA()),2&n&&(t.Q6J("ngSwitch",!a.$implicit.name),t.xp6(1),t.Q6J("ngSwitchCase",!0))}function f_(n,a){if(1&n&&(t.TgZ(0,"th",16),t.ynx(1),t.SDv(2,35),t.BQk(),t._uU(3),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.hij(" ",e.totalBalance," ")}}function C_(n,a){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.AsE("",e.moneyType.flag," ",t.xi3(2,2,e.balanceMoney,"0.2-2"),"")}}function h_(n,a){1&n&&t._UZ(0,"th",22)}function T_(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",37),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,i=t.oxw();return t.KtG(i.goToEntryList(o))}),t.TgZ(1,"mat-icon"),t._uU(2,"receipt"),t.qZA()()}}function R_(n,a){if(1&n&&(t.TgZ(0,"td",18),t.YNc(1,T_,3,0,"button",36),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Q6J("ngIf",!!e.uuid)}}function N_(n,a){1&n&&t._UZ(0,"tr",24)}function b_(n,a){1&n&&t._UZ(0,"tr",25),2&n&&t.ekj("table-primary",!a.$implicit.name)}let M_=(()=>{class n{constructor(e,_,o,i,r,c,l){this.route=e,this.router=_,this.elementRef=o,this.communication=i,this.notification=r,this.databaseService=c,this.additionalData=l,this.displayedColumns=["name","groupName","balanceMoney","tailNo"],this.totalBalance="",this.subscription=new at.w0,this.dataSource=new b.by,this.secondaryDataSource=new b.by}ngOnInit(){this.subscription.add(this.communication.acceptRefreshCommand().pipe((0,it.b)(300)).subscribe(()=>{this.updateAccounts()})),this.communication.giveRefreshCommand()}ngOnDestroy(){this.subscription.unsubscribe()}goToEntryList(e){this.router.navigate(["accounts",e.uuid],{queryParams:{title:e.name},relativeTo:this.route.parent})}updateAccounts(){this.notification.showLoading(this.elementRef.nativeElement),(0,ot.D)([this.databaseService.getVisibleAccountList(),this.databaseService.getHiddenAccountList(),this.additionalData.getBankList()]).pipe((0,Z.x)(()=>{this.notification.hideLoading()})).subscribe(e=>{const _=e[0],o=e[1],i=e[2].banks,r=_.data.accountSummary[0];let l,c=[];_.data.accountList.forEach(d=>{d.accountData.forEach(g=>{l=i.find(s=>g.bankId===s.id.toString()),g.groupName=d.groupName,g.balanceMoney=g.balanceMoney/100,g.bank=l}),c.push({name:"",groupName:d.groupName,balanceMoney:d.groupMoney.summaryAssets/100,moneyType:d.groupMoney.allMoneyCategory[0].moneyType}),c=c.concat(d.accountData)}),this.dataSource.data=c,this.totalBalance=r.moneyType.flag+" "+r.assets/100,this.secondaryDataSource.data=o.data})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Y.gz),t.Y36(Y.F0),t.Y36(t.SBq),t.Y36(gt.O),t.Y36(ct.g),t.Y36(st),t.Y36(ve))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-accounts"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:36,vars:8,consts:function(){let a,e,_,o,i,r;return a="Alias",e="Type",_="Balance",o="Alias",i="Type",r="Balance",[["appStartContent","",1,"d-flex","flex-column","h-100"],[1,"w-100","h-100","overflow-auto"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","groupName"],["matColumnDef","balanceMoney"],["matColumnDef","tailNo","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-cell","",3,"ngSwitch",4,"matCellDef"],["matColumnDef","tailNo"],["mat-row","",3,"table-primary",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],a,["mat-cell",""],[1,"text-muted"],e,_,["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",3,"click"],["mat-header-row",""],["mat-row",""],o,i,["mat-cell","",3,"ngSwitch"],[4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchDefault"],[3,"ngSwitch"],[4,"ngSwitchDefault"],["fontSet","Marching"],["width","32","height","32",3,"alt","src"],r,["type","button","mat-icon-button","","color","primary","y","",3,"click",4,"ngIf"],["type","button","mat-icon-button","","color","primary","y","",3,"click"]]},template:function(e,_){1&e&&(t._UZ(0,"app-default-operation-toolbar")(1,"app-breadcrumb"),t.TgZ(2,"app-two-cols-layout")(3,"div",0)(4,"div",1)(5,"table",2),t.ynx(6,3),t.YNc(7,e_,3,0,"th",4),t.YNc(8,n_,4,2,"td",5),t.BQk(),t.ynx(9,6),t.YNc(10,__,3,0,"th",4),t.YNc(11,a_,2,1,"td",5),t.BQk(),t.ynx(12,7),t.YNc(13,o_,3,0,"th",4),t.YNc(14,i_,3,5,"td",5),t.BQk(),t.ynx(15,8),t.YNc(16,r_,1,0,"th",9),t.YNc(17,c_,4,0,"td",5),t.BQk(),t.YNc(18,s_,1,0,"tr",10),t.YNc(19,l_,1,0,"tr",11),t.qZA()()(),t.TgZ(20,"div",12)(21,"table",2),t.ynx(22,3),t.YNc(23,d_,3,0,"th",4),t.YNc(24,u_,2,1,"td",5),t.BQk(),t.ynx(25,6),t.YNc(26,m_,3,0,"th",4),t.YNc(27,p_,3,2,"td",13),t.BQk(),t.ynx(28,7),t.YNc(29,f_,4,1,"th",4),t.YNc(30,C_,3,5,"td",5),t.BQk(),t.ynx(31,14),t.YNc(32,h_,1,0,"th",9),t.YNc(33,R_,2,1,"td",5),t.BQk(),t.YNc(34,N_,1,0,"tr",10),t.YNc(35,b_,1,2,"tr",15),t.qZA()()()),2&e&&(t.xp6(5),t.Q6J("dataSource",_.secondaryDataSource),t.xp6(13),t.Q6J("matHeaderRowDef",_.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",_.displayedColumns),t.xp6(2),t.Q6J("dataSource",_.dataSource),t.xp6(13),t.Q6J("matHeaderRowDef",_.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",_.displayedColumns))},dependencies:[M.O5,M.RF,M.n9,M.ED,Tt.lW,Rt.Hw,b.BZ,b.fO,b.as,b.w1,b.Dz,b.nj,b.ge,b.ev,b.XQ,b.Gk,Ut.L,ne.Y,_e.o,ae.h,M.i8,M.JJ],styles:[".table[_ngcontent-%COMP%]{font-size:.75rem}img[_ngcontent-%COMP%]{width:32px;height:32px;vertical-align:middle}"]}),n})();var Pe=m(5017),D_=m(6451),we=m(8505);class $e extends b._4{constructor(a,e,_=!0,o=!0){super(),this.remoteSourceFn=a,this.dataConverter=e,this.remotePagetion=_,this.readied=o,this.loading=!1,this.pageSizeOptions=[20,50,100],this.responseError=new t.vpe,this.countId=0,this.pageTokenMap=new Map}reset(){const a=this.paginator;this.pageTokenMap.clear(),a&&(a.pageIndex=0),this.reload()}reload(){this.load().subscribe()}_updateChangeSubscription(){super._updateChangeSubscription();const a=this.paginator;let e;a&&(a.pageSizeOptions=this.pageSizeOptions,this.pageSize=a.pageSize),e=this.remotePagetion&&a?(0,D_.T)(a.page.pipe((0,Bt.h)(o=>this.pageSize===o.pageSize||(this.pageSize=o.pageSize,this.reset(),!1))),a.initialized):(0,v.of)(null);const _=e.pipe((0,Bt.h)(()=>this.readied&&!!this.pageTokenMap),(0,Lt.w)(()=>this.load()));this.dataSubscription?.unsubscribe(),this.dataSubscription=_.subscribe()}_pageData(a){return this.remotePagetion?a:super._pageData(a)}_updatePaginator(a){!this.remotePagetion&&super._updatePaginator(a)}load(){const a=this.paginator,e=(0,v.of)(null);return a?e.pipe((0,we.b)(()=>{this.loading=!0,this.countId++,a.disabled=!0}),(0,Lt.w)(()=>{const _=this.countId,o=new Et.kl;return o.pageSize=a.pageSize,o.pageIndex=a.pageIndex,this.remoteSourceFn(o,this.pageTokenMap.get(a.pageIndex)||"").pipe((0,Q.K)(i=>(this.responseError.emit(i),(0,v.of)({}))),(0,Z.x)(()=>{this.loading=_!==this.countId&&this.loading}))}),(0,G.U)(_=>{const o=this.dataConverter(_);return this.data=o,a.disabled=!1,o})):e}}var Ze=m(598);let yt=(()=>{class n{constructor(e){this.router=e}addNewOne(e,_){this.router.navigate([{outlets:{secondary:["entry","add",e]}}],{queryParamsHandling:"preserve",relativeTo:_})}edit(e,_){let o;o=null===e.recType?["balance",e.id]:["entry",e.bkId,e.id],this.router.navigate([{outlets:{secondary:o}}],{queryParamsHandling:"preserve",relativeTo:_,state:e})}closeSecondaryOutlet(e){this.router.navigate([{outlets:{secondary:null}}],{queryParamsHandling:"preserve",relativeTo:e})}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(Y.F0))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();var Be=m(6709),oe=m(4144);function I_(n,a){if(1&n&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function y_(n,a){1&n&&(t.ynx(0),t.SDv(1,70),t.BQk())}function O_(n,a){1&n&&(t.ynx(0),t.SDv(1,71),t.BQk())}function x_(n,a){1&n&&(t.ynx(0),t.SDv(1,72),t.BQk())}function v_(n,a){1&n&&(t.ynx(0),t.SDv(1,73),t.BQk())}function P_(n,a){1&n&&(t.ynx(0),t.SDv(1,74),t.BQk())}function w_(n,a){if(1&n&&(t.TgZ(0,"mat-option",15),t.ynx(1,68),t.YNc(2,y_,2,0,"ng-container",69),t.YNc(3,O_,2,0,"ng-container",69),t.YNc(4,x_,2,0,"ng-container",69),t.YNc(5,v_,2,0,"ng-container",69),t.YNc(6,P_,2,0,"ng-container",69),t.BQk(),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.Q6J("ngSwitch",e),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4),t.xp6(1),t.Q6J("ngSwitchCase",5)}}function $_(n,a){if(1&n&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function Z_(n,a){if(1&n&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function B_(n,a){if(1&n&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function K_(n,a){if(1&n&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function W_(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"th",75)(1,"mat-checkbox",76),t.NdJ("change",function(o){t.CHM(e);const i=t.oxw();return t.KtG(o?i.masterToggle():null)}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("checked",e.selection.hasValue()&&e.isAllSelected())("indeterminate",e.selection.hasValue()&&!e.isAllSelected())("matBadge",e.selection.selected.length)}}function U_(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"td",77)(1,"mat-checkbox",78),t.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){const r=t.CHM(e).$implicit,c=t.oxw();return t.KtG(o?c.selection.toggle(r):null)}),t.qZA()()}if(2&n){const e=a.$implicit,_=t.oxw();t.xp6(1),t.Q6J("checked",_.selection.isSelected(e))}}function k_(n,a){1&n&&(t.TgZ(0,"th",79),t.ynx(1),t.SDv(2,80),t.BQk(),t.qZA())}function H_(n,a){if(1&n&&(t.TgZ(0,"td",77)(1,"span",81),t._uU(2),t.ALo(3,"date"),t.qZA()()),2&n){const e=a.$implicit;t.xp6(2),t.Oqu(t.xi3(3,1,e.bizTime,"yyyy-MM-dd HH:mm:ss"))}}function Y_(n,a){1&n&&(t.TgZ(0,"th",79),t.ynx(1),t.SDv(2,82),t.BQk(),t.qZA())}function L_(n,a){1&n&&(t.TgZ(0,"mat-icon",89),t._uU(1,"remove"),t.qZA())}function Q_(n,a){1&n&&(t.TgZ(0,"mat-icon",90),t._uU(1,"add"),t.qZA())}function G_(n,a){if(1&n&&(t.TgZ(0,"mat-icon",91),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit,_=t.oxw();t.xp6(1),t.Oqu(e.targetId===_.accountId?"add":"remove")}}function J_(n,a){if(1&n&&(t.TgZ(0,"mat-icon"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.ekj("text-info",0===e.recSubtype)("text-warning",0!==e.recSubtype),t.xp6(1),t.hij(" ",0===e.recSubtype?"add":"remove"," ")}}function X_(n,a){if(1&n&&(t.TgZ(0,"mat-icon"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.ekj("text-info",0===e.recSubtype)("text-warning",0!==e.recSubtype),t.xp6(1),t.hij(" ",0===e.recSubtype?"add":"remove"," ")}}function z_(n,a){1&n&&(t.TgZ(0,"mat-icon",91),t._uU(1,"help_outline"),t.qZA())}function q_(n,a){if(1&n&&(t.TgZ(0,"td",83),t.YNc(1,L_,2,0,"mat-icon",84),t.YNc(2,Q_,2,0,"mat-icon",85),t.YNc(3,G_,2,1,"mat-icon",86),t.YNc(4,J_,2,5,"mat-icon",87),t.YNc(5,X_,2,5,"mat-icon",87),t.YNc(6,z_,2,0,"mat-icon",88),t._uU(7),t.ALo(8,"number"),t.qZA()),2&n){const e=a.$implicit;t.Q6J("ngSwitch",e.recType),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4),t.xp6(1),t.Q6J("ngSwitchCase",5),t.xp6(2),t.AsE(" ",e.currencyFlag," ",t.xi3(8,8,e.amount/100,"0.2-2")," ")}}function F_(n,a){1&n&&(t.TgZ(0,"th",79),t.ynx(1),t.SDv(2,92),t.BQk(),t.qZA())}function j_(n,a){if(1&n&&(t.TgZ(0,"td",93),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.hij(" ",e.categoryName," ")}}function V_(n,a){1&n&&(t.TgZ(0,"th",79),t.ynx(1),t.SDv(2,94),t.BQk(),t.qZA())}function ta(n,a){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=a.$implicit,_=a.last;t.xp6(1),t.AsE(" ",e.name,"",_?"":"/"," ")}}function ea(n,a){if(1&n&&(t.TgZ(0,"td",93),t.YNc(1,ta,2,2,"ng-container",95),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Q6J("ngForOf",e.members)}}function na(n,a){1&n&&(t.TgZ(0,"th",79),t.ynx(1),t.SDv(2,96),t.BQk(),t.qZA())}function _a(n,a){if(1&n&&(t.TgZ(0,"td",93),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.Oqu(e.tradetgtName)}}function aa(n,a){1&n&&(t.TgZ(0,"th",79),t.ynx(1),t.SDv(2,97),t.BQk(),t._uU(3,"/ "),t.ynx(4),t.SDv(5,98),t.BQk(),t.qZA())}function oa(n,a){if(1&n&&(t.ynx(0)(1),t._uU(2),t.BQk()()),2&n){const e=a.$implicit,_=a.last;t.xp6(2),t.AsE("",e.name,"",_?"":", ","")}}function ia(n,a){if(1&n&&(t.TgZ(0,"td",99)(1,"small",81),t.YNc(2,oa,3,2,"ng-container",95),t.qZA(),t._UZ(3,"br"),t.TgZ(4,"small",81),t._uU(5),t.qZA()()),2&n){const e=a.$implicit;t.xp6(2),t.Q6J("ngForOf",e.tags),t.xp6(3),t.Oqu(e.accountName)}}function ra(n,a){1&n&&(t.TgZ(0,"th",79),t.ynx(1),t.SDv(2,100),t.BQk(),t.qZA())}function ca(n,a){if(1&n&&(t.TgZ(0,"td",101)(1,"span",102),t._uU(2),t.qZA()()),2&n){const e=a.$implicit;t.xp6(2),t.Oqu(e.comment)}}function sa(n,a){1&n&&t._UZ(0,"th",103)}function la(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"td",77)(1,"button",104),t.NdJ("click",function(){const i=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.edit(i))}),t.TgZ(2,"mat-icon"),t._uU(3,"edit"),t.qZA()()()}}function da(n,a){if(1&n&&(t.TgZ(0,"td",77),t._uU(1),t.ALo(2,"date"),t.qZA()),2&n){const e=a.$implicit,_=t.oxw();t.uIk("colspan",_.displayedColumns.length),t.xp6(1),t.AsE(" ",t.xi3(2,3,e.bizTime,"yyyy-MM-dd EEEE")," \xa0\xa0\xa0\xa0\xa0 ",e.comment," ")}}function ua(n,a){1&n&&t._UZ(0,"tr",105)}function ma(n,a){1&n&&t._UZ(0,"tr",106)}function Aa(n,a){1&n&&t._UZ(0,"tr",107)}const Ea=function(){return["daySummary"]};let ga=(()=>{class n{constructor(e,_,o,i,r,c,l,d,g){this.route=e,this.elementRef=_,this.dateAdapter=o,this.algorithm=i,this.communication=r,this.notification=c,this.datetimeService=l,this.databaseService=d,this.operation=g,this.books=[],this.recordTypes=[D.PAY,D.REVENUE,D.TRANSFER,D.BORROW,D.RETURN],this.accounts=[],this.projects=[],this.members=[],this.payCategories=[],this.txnObjects=[],this.searchKeys={bkId:null,startTime:0,endTime:0,amountStart:null,amountEnd:null,comment:null,recTypeList:null,mainTypeIdList:null,subTypeIdList:null,accountIdList:null,projectIdList:null,tradetgtIdList:null,memberIdList:null,reimburseList:null,categoryIdList:null,queryFlowCount:!0},this.displayedColumns=[],this.selection=new Pe.Ov(!0,[]),this.range=new f.cw({start:new f.NI(null),end:new f.NI(null)}),this.deleting=!1,this.columnsToDisplay=["select","bizTime","amount","categoryName","members","tradetgtName","tags","comment","operation"],this.subscription=new at.w0,this.isSummary=(s,A)=>!A.id,this.isNotSummary=(s,A)=>!!A.id,this.dataSource=new $e(s=>{const A=this.range.controls.start.value,S=this.range.controls.end.value,p={...this.searchKeys,startTime:A?this.datetimeService.getStartDatetime(A).valueOf():null,endTime:S?this.datetimeService.getEndDatetime(S).valueOf():null,pageSize:s.pageSize,pageIndex:s.pageIndex+1};let E;for(const u in p)E=p[u],Array.isArray(E)&&!E.length&&(p[u]=null);return this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.queryEntries(p).pipe((0,Q.K)(()=>(0,v.of)({code:500,data:{dailyItems:[],flowCount:0},error:""})))},s=>{const A=this.dateAdapter,S=this.accounts;let p=[];return this.selection.clear(),this.notification.hideLoading(),s?.data?.dailyItems?.forEach(E=>{p.push({bizTime:A.toIso8601(A.deserialize(E.date)),comment:" + "+E.income+"   |   - "+E.outgo}),E.flowList.forEach(u=>{u.accountName=S.find(h=>h.uuid===u.accountId)?.name}),p=p.concat(E.flowList)}),this.paginator.length=(0,w.su)(s?.data?.flowCount),p},!0,!1)}ngOnInit(){this.dataSource.paginator=this.paginator,this.datetimeService.initTimeRange(this.range),this.displayedColumns=this.columnsToDisplay,(0,ot.D)([this.databaseService.getBooks(),this.databaseService.getShortAccounts()]).pipe((0,Z.x)(()=>{this.notification.hideLoading()})).subscribe(e=>{this.books=e[0].data.books;const _=this.books[0];_&&(this.searchKeys.bkId=_.id,this.dataSource.readied=!0,this.onBookSelectionChange({value:_.id})),this.accounts=e[1].data.accounts,this.initRefreshIndicator()})}ngOnDestroy(){this.datetimeService.destoryTimeRange(),this.operation.closeSecondaryOutlet(this.route.parent),this.subscription.unsubscribe()}onBookSelectionChange(e){const _=e.value;this.notification.showLoading(this.elementRef.nativeElement),(0,ot.D)([this.databaseService.getTransactionObjects(_),this.databaseService.getBookProjects(_),this.databaseService.getMembers(_),this.databaseService.getEntryCategories(_,rt.PAY)]).pipe((0,Z.x)(()=>{this.notification.hideLoading(),this.communication.giveRefreshCommand()})).subscribe(o=>{this.txnObjects=o[0].data.bookTradeTargets,this.projects=o[1].data.bookProjects,this.members=o[2].data.bookMembers,this.payCategories=o[3].data.bookCategories})}isAllSelected(){const _=this.dataSource.data.length;return _>0&&this.selection.selected.length===_}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(e=>this.selection.select(e))}search(){this.dataSource.reset()}reset(){const e=this.dateAdapter,_=this.searchKeys,o=e.today(),i=e.createDate(e.getYear(o),e.getMonth(o),1);this.range.setValue({start:i,end:o}),_.bkId=this.books[0].id,_.amountStart=null,_.amountEnd=null,_.comment=null,_.recTypeList=null,_.mainTypeIdList=null,_.subTypeIdList=null,_.accountIdList=null,_.projectIdList=null,_.tradetgtIdList=null,_.memberIdList=null,_.reimburseList=null,this.dataSource.reset()}addNewOne(){this.operation.addNewOne("new",this.route.parent)}edit(e){this.operation.edit(e,this.route.parent)}delete(){const e=this.selection.selected.map(_=>_.id);!e.length||this.deleting||(this.deleting=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.deleteEntries(e).pipe((0,Z.x)(()=>{this.deleting=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand()})).subscribe())}initRefreshIndicator(){this.subscription.add(this.communication.acceptRefreshCommand().pipe((0,it.b)(300)).subscribe(()=>{this.dataSource.reload()}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Y.gz),t.Y36(t.SBq),t.Y36(k._A),t.Y36(Ze.e),t.Y36(gt.O),t.Y36(ct.g),t.Y36(Qt.d),t.Y36(st),t.Y36(yt))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-search-entries"]],viewQuery:function(e,_){if(1&e&&t.Gf(Et.NW,7),2&e){let o;t.iGM(o=t.CRH())&&(_.paginator=o.first)}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:120,vars:33,consts:function(){let a,e,_,o,i,r,c,l,d,g,s,A,S,p,E,u,h,H,B,tt,y,lt,dt,et,ut,nt,R,K,O,W,_t;return a="Account book",e="Date range",_="Start date",o="End date",i="Type",r="Balance modification",c="Amount",l="Comment",d="Account",g="Member",s="Trader",A="Tags",S="Reimburse",p="To be reimbursed",E="Reimbursed",u="Non-reimbursable",h="Search",H="Reset",B="Pay",tt="Revenue",y="Transfer",lt="Loan(incoming)",dt="Loan(outing)",et="Time",ut="Amount",nt="Category",R="Member",K="Trader",O="Tags",W="Account",_t="Comment",[[3,"new","delete"],["appStartContent","",1,"d-flex","flex-column","h-100",3,"ngSubmit"],[1,"flex-fill","overflow-auto","p-3"],["appearance","outline",1,"w-100"],a,["name","book",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],e,[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder",_],["matEndDate","","formControlName","end","placeholder",o],["matSuffix","",3,"for"],["picker",""],i,["name","recordTypes","multiple","",3,"value","valueChange"],[3,"value"],r,c,[1,"d-flex","flex-row","flex-nowrap"],["name","amountStart","type","number","matInput","",3,"ngModel","ngModelChange"],[1,"mx-2","flex-grow-0","flex-shrink-0"],["name","amountEnd","type","number","matInput","",3,"ngModel","ngModelChange","click"],l,["name","comment","type","text","matInput","",3,"ngModel","ngModelChange"],d,["name","accounts","multiple","",3,"value","valueChange"],g,["name","members","multiple","",3,"value","valueChange"],s,["name","txnObjects","multiple","",3,"value","valueChange"],A,["name","tags","multiple","",3,"ngModel","ngModelChange"],S,["name","reimburse","multiple","",3,"ngModel","ngModelChange"],p,E,u,[1,"container-fluid","py-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2"],h,["type","button","mat-stroked-button","","color","primary",3,"click"],H,[1,"d-flex","flex-column","flex-nowrap","h-100"],[1,"flex-fill","overflow-hidden"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","select","sticky","true"],["mat-header-cell","","style","width: 50px;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","bizTime"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","amount"],["mat-cell","","class","text-nowrap",3,"ngSwitch",4,"matCellDef"],["matColumnDef","categoryName"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","members"],["matColumnDef","tradetgtName"],["matColumnDef","tags"],["mat-cell","","style","line-height: 1.1;",4,"matCellDef"],["matColumnDef","comment"],["mat-cell","","width","1000",4,"matCellDef"],["matColumnDef","operation","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["matColumnDef","daySummary"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["class","table-primary text-start","mat-row","",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["showFirstLastButtons","",3,"pageSizeOptions","pageSize"],[3,"ngSwitch"],[4,"ngSwitchCase"],B,tt,y,lt,dt,["mat-header-cell","",2,"width","50px"],["matBadgeColor","warn",3,"checked","indeterminate","matBadge","change"],["mat-cell",""],[3,"checked","click","change"],["mat-header-cell",""],et,[1,"text-nowrap"],ut,["mat-cell","",1,"text-nowrap",3,"ngSwitch"],["class","text-danger",4,"ngSwitchCase"],["class","text-success",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchCase"],[3,"text-info","text-warning",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchDefault"],[1,"text-danger"],[1,"text-success"],[1,"text-muted"],nt,["mat-cell","",1,"text-nowrap"],R,[4,"ngFor","ngForOf"],K,O,W,["mat-cell","",2,"line-height","1.1"],_t,["mat-cell","","width","1000"],[1,"ellipsis-description-line-2"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",3,"click"],["mat-header-row",""],["mat-row",""],["mat-row","",1,"table-primary","text-start"]]},template:function(e,_){if(1&e&&(t.TgZ(0,"app-default-operation-toolbar",0),t.NdJ("new",function(){return _.addNewOne()})("delete",function(){return _.delete()}),t.qZA(),t._UZ(1,"app-breadcrumb"),t.TgZ(2,"app-two-cols-layout")(3,"form",1),t.NdJ("ngSubmit",function(){return _.search()}),t.TgZ(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),t.ynx(7),t.SDv(8,4),t.BQk(),t.qZA(),t.TgZ(9,"mat-select",5),t.NdJ("valueChange",function(i){return _.searchKeys.bkId=i})("selectionChange",function(i){return _.onBookSelectionChange(i)}),t.YNc(10,I_,2,2,"mat-option",6),t.qZA()(),t.TgZ(11,"mat-form-field",3)(12,"mat-label"),t.SDv(13,7),t.qZA(),t.TgZ(14,"mat-date-range-input",8),t._UZ(15,"input",9)(16,"input",10),t.qZA(),t._UZ(17,"mat-datepicker-toggle",11)(18,"mat-date-range-picker",null,12),t.qZA(),t.TgZ(20,"mat-form-field",3)(21,"mat-label"),t.SDv(22,13),t.qZA(),t.TgZ(23,"mat-select",14),t.NdJ("valueChange",function(i){return _.searchKeys.recTypeList=i}),t.YNc(24,w_,7,7,"mat-option",6),t.TgZ(25,"mat-option",15),t.SDv(26,16),t.qZA()()(),t.TgZ(27,"mat-form-field",3)(28,"mat-label"),t.SDv(29,17),t.qZA(),t.TgZ(30,"div",18)(31,"input",19),t.NdJ("ngModelChange",function(i){return _.searchKeys.amountStart=i}),t.qZA(),t.TgZ(32,"mat-icon",20),t._uU(33,"settings_ethernet"),t.qZA(),t.TgZ(34,"input",21),t.NdJ("ngModelChange",function(i){return _.searchKeys.amountEnd=i})("click",function(i){return i.stopPropagation()}),t.qZA()()(),t.TgZ(35,"mat-form-field",3)(36,"mat-label"),t.SDv(37,22),t.qZA(),t.TgZ(38,"input",23),t.NdJ("ngModelChange",function(i){return _.searchKeys.comment=i}),t.qZA()(),t.TgZ(39,"mat-form-field",3)(40,"mat-label"),t.SDv(41,24),t.qZA(),t.TgZ(42,"mat-select",25),t.NdJ("valueChange",function(i){return _.searchKeys.accountIdList=i}),t.YNc(43,$_,2,2,"mat-option",6),t.qZA()(),t.TgZ(44,"mat-form-field",3)(45,"mat-label"),t.SDv(46,26),t.qZA(),t.TgZ(47,"mat-select",27),t.NdJ("valueChange",function(i){return _.searchKeys.memberIdList=i}),t.YNc(48,Z_,2,2,"mat-option",6),t.qZA()(),t.TgZ(49,"mat-form-field",3)(50,"mat-label"),t.SDv(51,28),t.qZA(),t.TgZ(52,"mat-select",29),t.NdJ("valueChange",function(i){return _.searchKeys.tradetgtIdList=i}),t.YNc(53,B_,2,2,"mat-option",6),t.qZA()(),t.TgZ(54,"mat-form-field",3)(55,"mat-label"),t.SDv(56,30),t.qZA(),t.TgZ(57,"mat-select",31),t.NdJ("ngModelChange",function(i){return _.searchKeys.projectIdList=i}),t.YNc(58,K_,2,2,"mat-option",6),t.qZA()(),t.TgZ(59,"mat-form-field",3)(60,"mat-label"),t.SDv(61,32),t.qZA(),t.TgZ(62,"mat-select",33),t.NdJ("ngModelChange",function(i){return _.searchKeys.reimburseList=i}),t.TgZ(63,"mat-option",15),t.ynx(64),t.SDv(65,34),t.BQk(),t.qZA(),t.TgZ(66,"mat-option",15),t.ynx(67),t.SDv(68,35),t.BQk(),t.qZA(),t.TgZ(69,"mat-option",15),t.ynx(70),t.SDv(71,36),t.BQk(),t.qZA()()()(),t.TgZ(72,"div",37)(73,"button",38)(74,"mat-icon"),t._uU(75,"search"),t.qZA(),t.ynx(76),t.SDv(77,39),t.BQk(),t.qZA(),t.TgZ(78,"button",40),t.NdJ("click",function(){return _.reset()}),t.TgZ(79,"mat-icon"),t._uU(80,"search_off"),t.qZA(),t.ynx(81),t.SDv(82,41),t.BQk(),t.qZA()()(),t.TgZ(83,"div",42)(84,"div",43)(85,"div",44)(86,"table",45),t.ynx(87,46),t.YNc(88,W_,2,3,"th",47),t.YNc(89,U_,2,1,"td",48),t.BQk(),t.ynx(90,49),t.YNc(91,k_,3,0,"th",50),t.YNc(92,H_,4,4,"td",48),t.BQk(),t.ynx(93,51),t.YNc(94,Y_,3,0,"th",50),t.YNc(95,q_,9,11,"td",52),t.BQk(),t.ynx(96,53),t.YNc(97,F_,3,0,"th",50),t.YNc(98,j_,2,1,"td",54),t.BQk(),t.ynx(99,55),t.YNc(100,V_,3,0,"th",50),t.YNc(101,ea,2,1,"td",54),t.BQk(),t.ynx(102,56),t.YNc(103,na,3,0,"th",50),t.YNc(104,_a,2,1,"td",54),t.BQk(),t.ynx(105,57),t.YNc(106,aa,6,0,"th",50),t.YNc(107,ia,6,2,"td",58),t.BQk(),t.ynx(108,59),t.YNc(109,ra,3,0,"th",50),t.YNc(110,ca,3,1,"td",60),t.BQk(),t.ynx(111,61),t.YNc(112,sa,1,0,"th",62),t.YNc(113,la,4,0,"td",48),t.BQk(),t.ynx(114,63),t.YNc(115,da,3,6,"td",48),t.BQk(),t.YNc(116,ua,1,0,"tr",64),t.YNc(117,ma,1,0,"tr",65),t.YNc(118,Aa,1,0,"tr",66),t.qZA()()(),t._UZ(119,"mat-paginator",67),t.qZA()()),2&e){const o=t.MAs(19);t.xp6(9),t.Q6J("value",_.searchKeys.bkId),t.xp6(1),t.Q6J("ngForOf",_.books),t.xp6(4),t.Q6J("formGroup",_.range)("rangePicker",o),t.xp6(3),t.Q6J("for",o),t.xp6(6),t.Q6J("value",_.searchKeys.recTypeList),t.xp6(1),t.Q6J("ngForOf",_.recordTypes),t.xp6(1),t.Q6J("value",null),t.xp6(6),t.Q6J("ngModel",_.searchKeys.amountStart),t.xp6(3),t.Q6J("ngModel",_.searchKeys.amountEnd),t.xp6(4),t.Q6J("ngModel",_.searchKeys.comment),t.xp6(4),t.Q6J("value",_.searchKeys.accountIdList),t.xp6(1),t.Q6J("ngForOf",_.accounts),t.xp6(4),t.Q6J("value",_.searchKeys.memberIdList),t.xp6(1),t.Q6J("ngForOf",_.members),t.xp6(4),t.Q6J("value",_.searchKeys.tradetgtIdList),t.xp6(1),t.Q6J("ngForOf",_.txnObjects),t.xp6(4),t.Q6J("ngModel",_.searchKeys.projectIdList),t.xp6(1),t.Q6J("ngForOf",_.projects),t.xp6(4),t.Q6J("ngModel",_.searchKeys.reimburseList),t.xp6(1),t.Q6J("value",1),t.xp6(3),t.Q6J("value",2),t.xp6(3),t.Q6J("value",0),t.xp6(17),t.Q6J("dataSource",_.dataSource),t.xp6(30),t.Q6J("matHeaderRowDef",_.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",_.displayedColumns)("matRowDefWhen",_.isNotSummary),t.xp6(1),t.Q6J("matRowDefColumns",t.DdM(32,Ea))("matRowDefWhen",_.isSummary),t.xp6(1),t.Q6J("pageSizeOptions",_.dataSource.pageSizeOptions)("pageSize",_.dataSource.pageSizeOptions[0])}},dependencies:[M.sg,M.RF,M.n9,M.ED,Yt.k,f._Y,f.Fj,f.wV,f.JJ,f.JL,f.On,f.F,Tt.lW,Be.oG,I.nW,I.wx,I.zY,I.By,I._g,$.KE,$.hX,$.R9,Rt.Hw,oe.Nt,Wt.gD,k.ey,f.sg,f.u,Et.NW,b.BZ,b.fO,b.as,b.w1,b.Dz,b.nj,b.ge,b.ev,b.XQ,b.Gk,Ut.L,ne.Y,_e.o,ae.h,M.JJ,ee.e]}),n})();var Ke=m(2843),Sa=m(455);function pa(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"th",35)(1,"mat-checkbox",36),t.NdJ("change",function(o){t.CHM(e);const i=t.oxw();return t.KtG(o?i.masterToggle():null)}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("checked",e.selection.hasValue()&&e.isAllSelected())("indeterminate",e.selection.hasValue()&&!e.isAllSelected())("matBadge",e.selection.selected.length)}}function fa(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"td",37)(1,"mat-checkbox",38),t.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){const r=t.CHM(e).$implicit,c=t.oxw();return t.KtG(o?c.selection.toggle(r):null)}),t.qZA()()}if(2&n){const e=a.$implicit,_=t.oxw();t.xp6(1),t.Q6J("checked",_.selection.isSelected(e))}}function Ca(n,a){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,40),t.BQk(),t.qZA())}function ha(n,a){if(1&n&&(t.TgZ(0,"td",37)(1,"span",41),t._uU(2),t.ALo(3,"date"),t.qZA()()),2&n){const e=a.$implicit;t.xp6(2),t.Oqu(t.xi3(3,1,e.bizTime,"yyyy-MM-dd HH:mm:ss"))}}function Ta(n,a){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,42),t.BQk(),t.qZA())}function Ra(n,a){1&n&&(t.TgZ(0,"mat-icon",49),t._uU(1,"remove"),t.qZA())}function Na(n,a){1&n&&(t.TgZ(0,"mat-icon",50),t._uU(1,"add"),t.qZA())}function ba(n,a){if(1&n&&(t.TgZ(0,"mat-icon",51),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit,_=t.oxw();t.xp6(1),t.Oqu(e.targetId===_.accountId?"add":"remove")}}function Ma(n,a){if(1&n&&(t.TgZ(0,"mat-icon"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.ekj("text-info",0===e.recSubtype)("text-warning",0!==e.recSubtype),t.xp6(1),t.hij(" ",0===e.recSubtype?"add":"remove"," ")}}function Da(n,a){if(1&n&&(t.TgZ(0,"mat-icon"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.ekj("text-info",0===e.recSubtype)("text-warning",0!==e.recSubtype),t.xp6(1),t.hij(" ",0===e.recSubtype?"add":"remove"," ")}}function Ia(n,a){1&n&&(t.TgZ(0,"mat-icon",51),t._uU(1,"help_outline"),t.qZA())}function ya(n,a){if(1&n&&(t.TgZ(0,"td",43),t.YNc(1,Ra,2,0,"mat-icon",44),t.YNc(2,Na,2,0,"mat-icon",45),t.YNc(3,ba,2,1,"mat-icon",46),t.YNc(4,Ma,2,5,"mat-icon",47),t.YNc(5,Da,2,5,"mat-icon",47),t.YNc(6,Ia,2,0,"mat-icon",48),t._uU(7),t.ALo(8,"number"),t.qZA()),2&n){const e=a.$implicit;t.Q6J("ngSwitch",e.recType),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4),t.xp6(1),t.Q6J("ngSwitchCase",5),t.xp6(2),t.AsE(" ",e.moneyType.flag," ",t.xi3(8,8,e.amount/100,"0.2-2")," ")}}function Oa(n,a){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,52),t.BQk(),t.qZA())}function xa(n,a){if(1&n&&(t.TgZ(0,"td",53),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.AsE(" ",e.moneyType.flag," ",t.xi3(2,2,e.accountBalance,"0.2-2")," ")}}function va(n,a){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,54),t.BQk(),t.qZA())}function Pa(n,a){if(1&n&&(t.TgZ(0,"td",53),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.hij(" ",e.categoryName," ")}}function wa(n,a){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,55),t.BQk(),t.qZA())}function $a(n,a){if(1&n&&(t.ynx(0)(1),t._uU(2),t.BQk()()),2&n){const e=a.$implicit,_=a.last;t.xp6(2),t.AsE("",e.name,"",_?"":", ","")}}function Za(n,a){if(1&n&&(t.TgZ(0,"td",37)(1,"small",41),t.YNc(2,$a,3,2,"ng-container",56),t.qZA()()),2&n){const e=a.$implicit;t.xp6(2),t.Q6J("ngForOf",e.tags)}}function Ba(n,a){1&n&&(t.TgZ(0,"th",39),t.ynx(1),t.SDv(2,57),t.BQk(),t.qZA())}function Ka(n,a){if(1&n&&(t.TgZ(0,"td",58)(1,"span",59),t._uU(2),t.qZA()()),2&n){const e=a.$implicit;t.xp6(2),t.Oqu(e.comment)}}function Wa(n,a){1&n&&t._UZ(0,"th",60)}function Ua(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"td",37)(1,"button",61),t.NdJ("click",function(){const i=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.edit(i))}),t.TgZ(2,"mat-icon"),t._uU(3,"edit"),t.qZA()()()}}function ka(n,a){1&n&&t._UZ(0,"tr",62)}function Ha(n,a){1&n&&t._UZ(0,"tr",63)}let Ya=(()=>{class n{constructor(e,_,o,i,r,c,l,d,g){this.elementRef=e,this.route=_,this.dateAdapter=o,this.algorithm=i,this.notification=r,this.communication=c,this.datetimeService=l,this.databaseService=d,this.operation=g,this.displayedColumns=[],this.selection=new Pe.Ov(!0,[]),this.showBalance=!1,this.range=new f.cw({start:new f.NI(null),end:new f.NI(null)}),this.deleting=!1,this.columnsToDisplay=["select","bizTime","amount","accountBalance","categoryName","comment","operation"],this.subscription=new at.w0,this.dataSource=new $e(s=>{const A=this.range.controls.start.value,S=this.range.controls.end.value;return this.notification.showLoading(this.elementRef.nativeElement),(A&&S?this.databaseService.getEntries(this.accountId,this.datetimeService.getStartDatetime(A),this.datetimeService.getEndDatetime(S)):(0,Ke._)(()=>new Error("No datetime conditions"))).pipe((0,Q.K)(()=>(0,v.of)({code:500,data:{flows:[]},error:""})))},s=>{this.selection.clear(),this.notification.hideLoading();const A=this.accountId,S=s.data.flows;let p=0;return this.showBalance&&this.algorithm.reverseDeviceOfDuff(S,u=>{switch(u.recType){case D.PAY:p-=u.amount;break;case D.REVENUE:p+=u.amount;break;case D.TRANSFER:u.targetId===A?p+=u.amount:p-=u.amount;break;case D.BORROW:case D.RETURN:0===u.recSubtype?p+=u.amount:p-=u.amount;break;default:p=u.amount}u.accountBalance=p/100}),S},!1,!0)}ngOnInit(){this.displayedColumns=this.columnsToDisplay.filter(e=>"accountBalance"!==e||this.showBalance),this.dataSource.paginator=this.paginator,this.subscription.add(this.route.paramMap.subscribe(e=>{this.accountId=e.get("accountId")})),this.subscription.add(this.communication.acceptRefreshCommand().pipe((0,it.b)(300)).subscribe(()=>{this.dataSource.reload()})),this.subscription.add(this.range.valueChanges.pipe((0,it.b)(300)).subscribe(()=>{this.dataSource.reset()})),this.datetimeService.initTimeRange(this.range)}ngOnDestroy(){this.datetimeService.destoryTimeRange(),this.operation.closeSecondaryOutlet(this.route.parent),this.subscription.unsubscribe()}isAllSelected(){const _=this.dataSource.data.length;return _>0&&this.selection.selected.length===_}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(e=>this.selection.select(e))}onShowBalanceChange(e){e.checked?(this.range.setValue({start:this.datetimeService.getMinDate(),end:this.datetimeService.getMaxDate()}),this.range.disable()):this.range.enable(),this.displayedColumns=this.columnsToDisplay.filter(_=>"accountBalance"!==_||this.showBalance)}addNewOne(){this.operation.addNewOne(this.accountId,this.route.parent)}edit(e){this.operation.edit(e,this.route.parent)}delete(){const e=this.selection.selected.map(_=>_.id);!e.length||this.deleting||(this.deleting=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.deleteEntries(e).pipe((0,Z.x)(()=>{this.deleting=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand()})).subscribe())}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(Y.gz),t.Y36(k._A),t.Y36(Ze.e),t.Y36(ct.g),t.Y36(gt.O),t.Y36(Qt.d),t.Y36(st),t.Y36(yt))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-account-entries"]],viewQuery:function(e,_){if(1&e&&t.Gf(Et.NW,7),2&e){let o;t.iGM(o=t.CRH())&&(_.paginator=o.first)}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:53,vars:11,consts:function(){let a,e,_,o,i,r,c,l,d,g,s;return a="Date range",e="Start date",_="End date",o="Show balance",i="Review all entries of this account.",r="Time",c="Amount",l="Balance",d="Category",g="Tags",s="Comment",[[3,"new","delete"],["appStartContent","",1,"d-flex","flex-column","h-100"],[1,"p-3"],["appearance","outline",1,"w-100"],a,[3,"formGroup","rangePicker"],["matStartDate","","formControlName","start","placeholder",e],["matEndDate","","formControlName","end","placeholder",_],["matSuffix","",3,"for","disabled"],["picker",""],["color","primary",3,"ngModel","ngModelChange","change"],o,i,[1,"d-flex","flex-column","flex-nowrap","h-100"],[1,"flex-fill","overflow-hidden"],[1,"w-100","mh-100","overflow-auto","main-content"],["mat-table","",1,"table","table-sm","table-bordered","table-striped","table-hover","table-narrow","w-100",3,"dataSource"],["matColumnDef","select","sticky","true"],["mat-header-cell","","style","min-width: 50px;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","bizTime"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","amount"],["mat-cell","","class","text-nowrap",3,"ngSwitch",4,"matCellDef"],["matColumnDef","accountBalance"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","categoryName"],["matColumnDef","tags"],["matColumnDef","comment"],["mat-cell","","width","1000",4,"matCellDef"],["matColumnDef","operation","stickyEnd","true"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions","pageSize"],["mat-header-cell","",2,"min-width","50px"],["matBadgeColor","warn",3,"checked","indeterminate","matBadge","change"],["mat-cell",""],[3,"checked","click","change"],["mat-header-cell",""],r,[1,"text-nowrap"],c,["mat-cell","",1,"text-nowrap",3,"ngSwitch"],["class","text-danger",4,"ngSwitchCase"],["class","text-success",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchCase"],[3,"text-info","text-warning",4,"ngSwitchCase"],["class","text-muted",4,"ngSwitchDefault"],[1,"text-danger"],[1,"text-success"],[1,"text-muted"],l,["mat-cell","",1,"text-nowrap"],d,g,[4,"ngFor","ngForOf"],s,["mat-cell","","width","1000"],[1,"ellipsis-description-line-2"],["mat-header-cell","","width","1"],["type","button","mat-icon-button","","color","primary",3,"click"],["mat-header-row",""],["mat-row",""]]},template:function(e,_){if(1&e&&(t.TgZ(0,"app-default-operation-toolbar",0),t.NdJ("new",function(){return _.addNewOne()})("delete",function(){return _.delete()}),t.qZA(),t._UZ(1,"app-breadcrumb"),t.TgZ(2,"app-two-cols-layout")(3,"div",1)(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),t.SDv(7,4),t.qZA(),t.TgZ(8,"mat-date-range-input",5),t._UZ(9,"input",6)(10,"input",7),t.qZA(),t._UZ(11,"mat-datepicker-toggle",8)(12,"mat-date-range-picker",null,9),t.qZA(),t.TgZ(14,"div")(15,"mat-slide-toggle",10),t.NdJ("ngModelChange",function(i){return _.showBalance=i})("change",function(i){return _.onShowBalanceChange(i)}),t.ynx(16),t.SDv(17,11),t.BQk(),t.qZA()(),t.TgZ(18,"p")(19,"small"),t.ynx(20),t.SDv(21,12),t.BQk(),t.qZA()()()(),t.TgZ(22,"div",13)(23,"div",14)(24,"div",15)(25,"table",16),t.ynx(26,17),t.YNc(27,pa,2,3,"th",18),t.YNc(28,fa,2,1,"td",19),t.BQk(),t.ynx(29,20),t.YNc(30,Ca,3,0,"th",21),t.YNc(31,ha,4,4,"td",19),t.BQk(),t.ynx(32,22),t.YNc(33,Ta,3,0,"th",21),t.YNc(34,ya,9,11,"td",23),t.BQk(),t.ynx(35,24),t.YNc(36,Oa,3,0,"th",21),t.YNc(37,xa,3,5,"td",25),t.BQk(),t.ynx(38,26),t.YNc(39,va,3,0,"th",21),t.YNc(40,Pa,2,1,"td",25),t.BQk(),t.ynx(41,27),t.YNc(42,wa,3,0,"th",21),t.YNc(43,Za,3,1,"td",19),t.BQk(),t.ynx(44,28),t.YNc(45,Ba,3,0,"th",21),t.YNc(46,Ka,3,1,"td",29),t.BQk(),t.ynx(47,30),t.YNc(48,Wa,1,0,"th",31),t.YNc(49,Ua,4,0,"td",19),t.BQk(),t.YNc(50,ka,1,0,"tr",32),t.YNc(51,Ha,1,0,"tr",33),t.qZA()()(),t._UZ(52,"mat-paginator",34),t.qZA()()),2&e){const o=t.MAs(13);t.xp6(8),t.Q6J("formGroup",_.range)("rangePicker",o),t.xp6(3),t.Q6J("for",o)("disabled",_.showBalance),t.xp6(4),t.Q6J("ngModel",_.showBalance),t.xp6(10),t.Q6J("dataSource",_.dataSource),t.xp6(25),t.Q6J("matHeaderRowDef",_.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",_.displayedColumns),t.xp6(1),t.Q6J("pageSizeOptions",_.dataSource.pageSizeOptions)("pageSize",_.dataSource.pageSizeOptions[0])}},dependencies:[M.sg,M.RF,M.n9,M.ED,Yt.k,f.Fj,f.JJ,f.JL,f.On,Tt.lW,Be.oG,I.nW,I.wx,I.zY,I.By,I._g,$.KE,$.hX,$.R9,Rt.Hw,Sa.Rr,f.sg,f.u,Et.NW,b.BZ,b.fO,b.as,b.w1,b.Dz,b.nj,b.ge,b.ev,b.XQ,b.Gk,Ut.L,ne.Y,_e.o,ae.h,M.JJ,ee.e]}),n})();var La=m(1005);const We={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let kt;const Qa=new Uint8Array(16);function Ga(){if(!kt&&(kt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!kt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return kt(Qa)}const x=[];for(let n=0;n<256;++n)x.push((n+256).toString(16).slice(1));const Xa=function Ja(n,a,e){if(We.randomUUID&&!a&&!n)return We.randomUUID();const _=(n=n||{}).random||(n.rng||Ga)();if(_[6]=15&_[6]|64,_[8]=63&_[8]|128,a){e=e||0;for(let o=0;o<16;++o)a[e+o]=_[o];return a}return function Ue(n,a=0){return(x[n[a+0]]+x[n[a+1]]+x[n[a+2]]+x[n[a+3]]+"-"+x[n[a+4]]+x[n[a+5]]+"-"+x[n[a+6]]+x[n[a+7]]+"-"+x[n[a+8]]+x[n[a+9]]+"-"+x[n[a+10]]+x[n[a+11]]+x[n[a+12]]+x[n[a+13]]+x[n[a+14]]+x[n[a+15]]).toLowerCase()}(_)};class ie{constructor(){this.id=0,this.amount=0,this.comment="",this.address="",this.attachments="",this.reimburse=0,this.edited=0,this.deleted=0,this.sourceSystem=201}}var ke=m(5001);function za(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function qa(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.categoryId),t.xp6(1),t.hij(" ",e.name," ")}}function Fa(n,a){if(1&n&&(t.TgZ(0,"mat-optgroup",53),t.YNc(1,qa,2,2,"mat-option",14),t.qZA()),2&n){const e=a.$implicit;t.Q6J("label",e.name),t.xp6(1),t.Q6J("ngForOf",e.outgoSubTypes)}}function ja(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function Va(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function to(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function eo(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",9)(2,"div",10)(3,"mat-form-field",11)(4,"mat-label"),t.SDv(5,35),t.qZA(),t.TgZ(6,"mat-select",36),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.accountId=o)}),t.YNc(7,za,2,2,"mat-option",14),t.qZA()()(),t.TgZ(8,"div",10)(9,"mat-form-field",11)(10,"mat-label"),t.SDv(11,37),t.qZA(),t.TgZ(12,"mat-select",38),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.categoryId=o)}),t.YNc(13,Fa,2,2,"mat-optgroup",39),t.qZA()()()(),t.TgZ(14,"div",9)(15,"div",10)(16,"mat-form-field",11)(17,"mat-label"),t.SDv(18,40),t.qZA(),t.TgZ(19,"mat-select",41),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.tags=o)}),t.YNc(20,ja,2,2,"mat-option",14),t.qZA()()(),t.TgZ(21,"div",10)(22,"mat-form-field",11)(23,"mat-label"),t.SDv(24,42),t.qZA(),t.TgZ(25,"mat-select",43),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.tradetgtId=o)}),t.TgZ(26,"mat-option",44),t._uU(27,"-"),t.qZA(),t.YNc(28,Va,2,2,"mat-option",14),t.qZA()()()(),t.TgZ(29,"div",9)(30,"div",10)(31,"mat-form-field",11)(32,"mat-label"),t.SDv(33,45),t.qZA(),t.TgZ(34,"mat-select",46),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.selectedMembers=o)}),t.YNc(35,to,2,2,"mat-option",14),t.qZA()()(),t.TgZ(36,"div",10)(37,"mat-form-field",11)(38,"mat-label"),t.SDv(39,47),t.qZA(),t.TgZ(40,"mat-select",48),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.reimburse=o)}),t.TgZ(41,"mat-option",49),t.ynx(42),t.SDv(43,50),t.BQk(),t.qZA(),t.TgZ(44,"mat-option",49),t.ynx(45),t.SDv(46,51),t.BQk(),t.qZA(),t.TgZ(47,"mat-option",49),t.ynx(48),t.SDv(49,52),t.BQk(),t.qZA()()()()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.entry.accountId),t.xp6(1),t.Q6J("ngForOf",e.accounts),t.xp6(5),t.Q6J("ngModel",e.entry.categoryId),t.xp6(1),t.Q6J("ngForOf",e.payCategories),t.xp6(6),t.Q6J("compareWith",e.compareTagWith)("ngModel",e.entry.tags),t.xp6(1),t.Q6J("ngForOf",e.tags),t.xp6(5),t.Q6J("ngModel",e.entry.tradetgtId),t.xp6(3),t.Q6J("ngForOf",e.txnObjects),t.xp6(6),t.Q6J("ngModel",e.selectedMembers),t.xp6(1),t.Q6J("ngForOf",e.members),t.xp6(5),t.Q6J("ngModel",e.entry.reimburse),t.xp6(1),t.Q6J("value",1),t.xp6(3),t.Q6J("value",2),t.xp6(3),t.Q6J("value",0)}}function no(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function _o(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.categoryId),t.xp6(1),t.hij(" ",e.name," ")}}function ao(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function oo(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function io(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function ro(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",9)(2,"div",10)(3,"mat-form-field",11)(4,"mat-label"),t.SDv(5,54),t.qZA(),t.TgZ(6,"mat-select",36),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.accountId=o)}),t.YNc(7,no,2,2,"mat-option",14),t.qZA()()(),t.TgZ(8,"div",10)(9,"mat-form-field",11)(10,"mat-label"),t.SDv(11,55),t.qZA(),t.TgZ(12,"mat-select",56),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.categoryId=o)}),t.YNc(13,_o,2,2,"mat-option",14),t.qZA()()()(),t.TgZ(14,"div",9)(15,"div",10)(16,"mat-form-field",11)(17,"mat-label"),t.SDv(18,57),t.qZA(),t.TgZ(19,"mat-select",41),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.tags=o)}),t.TgZ(20,"mat-option",44),t._uU(21,"-"),t.qZA(),t.YNc(22,ao,2,2,"mat-option",14),t.qZA()()(),t.TgZ(23,"div",10)(24,"mat-form-field",11)(25,"mat-label"),t.SDv(26,58),t.qZA(),t.TgZ(27,"mat-select",43),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.tradetgtId=o)}),t.TgZ(28,"mat-option",44),t._uU(29,"-"),t.qZA(),t.YNc(30,oo,2,2,"mat-option",14),t.qZA()()()(),t.TgZ(31,"div",9)(32,"div",10)(33,"mat-form-field",11)(34,"mat-label"),t.SDv(35,59),t.qZA(),t.TgZ(36,"mat-select",46),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.selectedMembers=o)}),t.YNc(37,io,2,2,"mat-option",14),t.qZA()()(),t.TgZ(38,"div",10)(39,"mat-form-field",11)(40,"mat-label"),t.SDv(41,60),t.qZA(),t.TgZ(42,"mat-select",48),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.reimburse=o)}),t.TgZ(43,"mat-option",49),t.ynx(44),t.SDv(45,61),t.BQk(),t.qZA(),t.TgZ(46,"mat-option",49),t.ynx(47),t.SDv(48,62),t.BQk(),t.qZA(),t.TgZ(49,"mat-option",49),t.ynx(50),t.SDv(51,63),t.BQk(),t.qZA()()()()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.entry.accountId),t.xp6(1),t.Q6J("ngForOf",e.accounts),t.xp6(5),t.Q6J("ngModel",e.entry.categoryId),t.xp6(1),t.Q6J("ngForOf",e.revenueCategories),t.xp6(6),t.Q6J("compareWith",e.compareTagWith)("ngModel",e.entry.tags),t.xp6(3),t.Q6J("ngForOf",e.tags),t.xp6(5),t.Q6J("ngModel",e.entry.tradetgtId),t.xp6(3),t.Q6J("ngForOf",e.txnObjects),t.xp6(6),t.Q6J("ngModel",e.selectedMembers),t.xp6(1),t.Q6J("ngForOf",e.members),t.xp6(5),t.Q6J("ngModel",e.entry.reimburse),t.xp6(1),t.Q6J("value",1),t.xp6(3),t.Q6J("value",2),t.xp6(3),t.Q6J("value",0)}}function co(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function so(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function lo(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",9)(2,"div",10)(3,"mat-form-field",11)(4,"mat-label"),t.SDv(5,64),t.qZA(),t.TgZ(6,"mat-select",65),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.accountId=o)}),t.YNc(7,co,2,2,"mat-option",14),t.qZA()()(),t.TgZ(8,"div",10)(9,"mat-form-field",11)(10,"mat-label"),t.SDv(11,66),t.qZA(),t.TgZ(12,"mat-select",67),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.targetId=o)}),t.YNc(13,so,2,2,"mat-option",14),t.qZA()()()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.entry.accountId)("forbiddenSame",e.entry.targetId),t.xp6(1),t.Q6J("ngForOf",e.accounts),t.xp6(5),t.Q6J("ngModel",e.entry.targetId)("forbiddenSame",e.entry.accountId),t.xp6(1),t.Q6J("ngForOf",e.accounts)}}function uo(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,75),t.BQk()())}function mo(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,76),t.BQk()())}function Ao(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,77),t.BQk()())}function Eo(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,78),t.BQk()())}function go(n,a){if(1&n&&(t.TgZ(0,"mat-option",74),t.YNc(1,uo,3,0,"ng-container",72),t.YNc(2,mo,3,0,"ng-container",72),t.YNc(3,Ao,3,0,"ng-container",72),t.YNc(4,Eo,3,0,"ng-container",72),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e)("ngSwitch",e),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4)}}function So(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,79),t.BQk()())}function po(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,80),t.BQk()())}function fo(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,81),t.BQk()())}function Co(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,82),t.BQk()())}function ho(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function To(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,83),t.BQk()())}function Ro(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,84),t.BQk()())}function No(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,85),t.BQk()())}function bo(n,a){1&n&&(t.ynx(0)(1),t.SDv(2,86),t.BQk()())}function Mo(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.name," ")}}function Do(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"div",9)(2,"div",10)(3,"mat-form-field",11)(4,"mat-label"),t.SDv(5,68),t.qZA(),t.TgZ(6,"mat-select",69),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.lendType=o)}),t.YNc(7,go,5,6,"mat-option",70),t.qZA()()()(),t.TgZ(8,"div",9)(9,"div",10)(10,"mat-form-field",11)(11,"mat-label",71),t.YNc(12,So,3,0,"ng-container",72),t.YNc(13,po,3,0,"ng-container",72),t.YNc(14,fo,3,0,"ng-container",72),t.YNc(15,Co,3,0,"ng-container",72),t.qZA(),t.TgZ(16,"mat-select",73),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.accountId=o)}),t.YNc(17,ho,2,2,"mat-option",14),t.qZA()()(),t.TgZ(18,"div",10)(19,"mat-form-field",11)(20,"mat-label",71),t.YNc(21,To,3,0,"ng-container",72),t.YNc(22,Ro,3,0,"ng-container",72),t.YNc(23,No,3,0,"ng-container",72),t.YNc(24,bo,3,0,"ng-container",72),t.qZA(),t.TgZ(25,"mat-select",36),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.entry.targetId=o)}),t.YNc(26,Mo,2,2,"mat-option",14),t.qZA()()()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngModel",e.entry.lendType),t.xp6(1),t.Q6J("ngForOf",e.loanTypes),t.xp6(4),t.Q6J("ngSwitch",e.entry.lendType),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4),t.xp6(1),t.Q6J("ngModel",e.entry.accountId),t.xp6(1),t.Q6J("ngForOf",e.creditors),t.xp6(3),t.Q6J("ngSwitch",e.entry.lendType),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3),t.xp6(1),t.Q6J("ngSwitchCase",4),t.xp6(1),t.Q6J("ngModel",e.entry.targetId),t.xp6(1),t.Q6J("ngForOf",e.accounts)}}function Io(n,a){if(1&n&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function re(){return Xa()}let He=(()=>{class n{constructor(e,_,o,i,r,c,l){this.elementRef=e,this.route=_,this.dateAdapter=o,this.communication=i,this.notification=r,this.databaseService=c,this.operation=l,this.books=[],this.accounts=[],this.tags=[],this.members=[],this.payCategories=[],this.revenueCategories=[],this.txnObjects=[],this.creditors=[],this.loanTypes=[P.BORROW,P.LEND,P.RECEIVE,P.REPAYMENT],this.compareTagWith=(d,g)=>d?.tagId===g?.tagId,this.isNew=!1,this.selectedTabIndex=0,this.saving=!1,this.subscription=new at.w0,this.entry=new ie,this.entry.bizId=re(),this.entry.recType=D.PAY}ngOnInit(){this.isNew=!this.route.snapshot.paramMap.get("accountId"),this.subscription.add(this.route.paramMap.subscribe(e=>{const _=e.get("entryId"),o=e.get("accountId");o?(this.accountId="new"===o?void 0:o,this.entry.accountId=this.accountId,this.isNew=!0,this.bizDatetime=this.dateAdapter.today()):_&&(this.isNew=!1)}))}ngAfterViewInit(){this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.getBooks().pipe((0,La.g)(100),(0,Q.K)(e=>(this.notification.hideLoading(),(0,Ke._)(()=>e)))).subscribe(e=>{if(e&&e.data&&e.data.books[0]){const _=e.data.books[0];let o=_.id;this.books=e.data.books,this.isNew?(this.entry.bkId=_.id,this.entry.bookId=_.uuid):o=(0,w.su)(this.route.snapshot.paramMap.get("bookId")),(0,ot.D)([this.databaseService.getShortAccounts(),this.databaseService.getShortAccounts(-1),this.getAdditionalDatas(o)]).pipe((0,Z.x)(()=>{this.notification.hideLoading()})).subscribe(i=>{if(this.accounts=i[0].data.accounts,this.creditors=i[1].data.accounts,this.isNew)!this.entry.accountId&&this.accounts[0]&&(this.entry.accountId=this.accounts[0].uuid);else{const r=this.route.snapshot.paramMap.get("entryId");this.getCurrentEntry(o,r)}setTimeout(()=>{this.onSelectedTabChange({index:this.selectedTabIndex})})})}})}ngOnDestroy(){this.subscription.unsubscribe()}onSelectedTabChange(e){const _=this.entry,o=e.index+1;let i;switch(_.recType=o,this.checkValuesWhetherExisted(),o){case D.PAY:i=this.payCategories[0];case D.REVENUE:if(i||(i=this.revenueCategories[0]),!_.accountId&&this.accountId){_.accountId=this.accountId;break}!_.categoryId&&i&&(_.categoryId=i.outgoSubTypes&&i.outgoSubTypes[0]?i.outgoSubTypes[0].categoryId:i.categoryId),!_.tags?.length&&this.tags&&this.tags.length&&(this.entry.tags=[this.tags[0]]),(!this.selectedMembers||!this.selectedMembers.length)&&this.members&&(this.selectedMembers=this.members.slice(0,1).map(r=>r.uuid));break;case D.TRANSFER:!_.accountId&&this.accountId&&(_.accountId=this.accountId),!_.targetId&&this.accounts[0]&&(_.targetId=this.accounts[0].uuid);break;default:typeof _.lendType>"u"&&(_.lendType=1),_.targetId||(_.targetId=this.accountId||(this.accounts[0]?this.accounts[0].uuid:void 0)),_.accountId||(_.accountId=this.creditors&&this.creditors[0]?this.creditors[0].uuid:void 0)}}onBookSelectionChange(e){const _=e.value;this.books&&this.books.some(o=>o.id===_&&(this.entry.bookId=o.uuid,!0)),this.notification.showLoading(this.elementRef.nativeElement),this.getAdditionalDatas(_).pipe((0,Z.x)(()=>{setTimeout(()=>{this.onSelectedTabChange({index:this.selectedTabIndex})})})).subscribe()}save(){this.update().subscribe(e=>{e&&this.cancel()})}saveAs(){const e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(const _ in e)e[_].markAsTouched();this.entry.id=0,this.entry.bizId=re(),this.save()}saveAndNew(){const e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(const _ in e)e[_].markAsTouched();this.update().subscribe(_=>{_&&(this.entry.id=0,this.entry.bizId=re())})}cancel(){this.operation.closeSecondaryOutlet(this.route.parent)}update(){if(this.checkValuesWhetherExisted(),this.entryForm&&this.entryForm.valid){const e=this.entry;switch(e.recType){case D.PAY:case D.REVENUE:e.targetId=void 0,e.profit=void 0,e.lendType=void 0,e.recSubtype=void 0,e.members=this.selectedMembers.map(_=>({memberId:_,amount:e.amount}));break;case D.TRANSFER:if(e.accountId===e.targetId)return;e.categoryId=void 0,e.tags=void 0,e.tradetgtId=void 0,e.profit=void 0,e.lendType=void 0,e.recSubtype=void 0,e.reimburse=0,e.targetAmount=e.amount,e.members=this.members.slice(0,1).map(_=>({memberId:_.uuid,amount:e.amount}));break;default:switch(e.categoryId=void 0,e.tags=void 0,e.tradetgtId=void 0,e.profit=0,e.reimburse=0,e.targetAmount=e.amount,e.lendType){case P.LEND:case P.REPAYMENT:e.recSubtype=1;break;default:e.recSubtype=0}(e.lendType===P.RECEIVE||e.lendType===P.REPAYMENT)&&(e.recType=D.RETURN),e.members=[{amount:e.amount}]}return e.bizTime=this.dateAdapter.toIso8601(this.bizDatetime),typeof e.comment>"u"&&(e.comment=""),this.saving=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.saveEntry([e]).pipe((0,Q.K)(()=>(0,v.of)(!1)),(0,G.U)(_=>!("boolean"!=typeof _&&_.error)),(0,Z.x)(()=>{this.saving=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand()}))}return(0,v.of)(!1)}checkValuesWhetherExisted(){this.selects.forEach(e=>{if(e.options.length)if(e.multiple){if(e.value){const _=e.value.filter(o=>e.options.some(i=>i.value===o));e.ngControl.control.setValue(_)}}else e.options.some(_=>_.value===e.value)||e.ngControl.control.setValue(null)})}getCurrentEntry(e,_){this.getEntrySsp&&this.getEntrySsp.unsubscribe(),this.notification.showLoading(this.elementRef.nativeElement),this.getEntrySsp=this.databaseService.getEntry(e,_).pipe((0,Bt.h)(o=>!o.error),(0,Z.x)(()=>{this.getEntrySsp=void 0,this.notification.hideLoading()})).subscribe(o=>{const i=o.data;i.amount=i.amount/100,this.accountId=i.accountId,this.bizDatetime=this.dateAdapter.deserialize(i.bizTime),this.selectedMembers=Array.isArray(i.members)?this.members.filter(r=>i.members.some(c=>c.memberId===r.uuid)).map(r=>r.uuid):this.members.slice(0,1).map(r=>r.uuid),i.recType===D.RETURN?i.lendType=0===i.recSubtype?P.RECEIVE:P.REPAYMENT:i.recType===D.BORROW&&(i.lendType=0===i.recSubtype?P.BORROW:P.LEND),this.entry=i,i.accountId&&!this.creditors.find(r=>r.uuid===i.accountId)&&this.creditors.push({uuid:i.accountId,name:i.accountName}),i.targetId&&!this.accounts.find(r=>r.uuid===i.targetId)&&this.accounts.push({uuid:i.targetId,name:i.targetName}),this.selectedTabIndex=(i.recType>5?4:i.recType)-1})}getAdditionalDatas(e){return(0,ot.D)([this.databaseService.getTransactionObjects(e),this.databaseService.getBookProjects(e),this.databaseService.getMembers(e),this.databaseService.getEntryCategories(e,rt.PAY),this.databaseService.getEntryCategories(e,rt.REVENUE)]).pipe((0,Z.x)(()=>{this.notification.hideLoading()}),(0,G.U)(_=>{this.txnObjects=_[0].data.bookTradeTargets,this.tags=_[1].data.bookProjects.map(o=>({tagId:o.uuid,name:o.name})),this.members=_[2].data.bookMembers,this.payCategories=_[3].data.bookCategories,this.revenueCategories=_[4].data.bookCategories}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(Y.gz),t.Y36(k._A),t.Y36(gt.O),t.Y36(ct.g),t.Y36(st),t.Y36(yt))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-add-or-edit-entry"]],viewQuery:function(e,_){if(1&e&&(t.Gf(f.F,5),t.Gf(Wt.gD,5)),2&e){let o;t.iGM(o=t.CRH())&&(_.entryForm=o.first),t.iGM(o=t.CRH())&&(_.selects=o)}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:62,vars:16,consts:function(){let a,e,_,o,i,r,c,l,d,g,s,A,S,p,E,u,h,H,B,tt,y,lt,dt,et,ut,nt,R,K,O,W,_t,N,mt,At,U,Ye,Le,Qe,Ge,Je,Xe,ze,qe,Fe,je;return a="Pay",e="Revenue",_="Transfer",o="Loan",i="Account book",r="Amount",c="Time",l="Comment",d="Save",g="Save as",s="Save and new",A="Cancel",S="Account",p="Category",E="Tags",u="Trader",h="Member",H="Reimburse",B="To be reimbursed",tt="Reimbursed",y="Non-reimbursable",lt="Account",dt="Category",et="Tags",ut="Payer",nt="Member",R="Reimburse",K="To be reimbursed",O="Reimbursed",W="Non-reimbursable",_t="From account",N="To account",mt="Category",At="Borrow",U="Lend",Ye="Receive",Le="Repayment",Qe="Creditor",Ge="Debtor",Je="Debtor",Xe="Creditor",ze="Borrow account",qe="Lend account",Fe="Receive account",je="Repayment account",[["name","entryForm",1,"d-flex","flex-column","flex-nowrap","flex-fill","overflow-hidden",3,"ngSubmit"],["color","primary",3,"selectedIndex","selectedIndexChange","selectedTabChange"],["label",a],["label",e],["label",_],["label",o],[1,"flex-fill","overflow-auto"],["class","container-fluid pt-3",4,"ngIf"],[1,"container-fluid","pb-3"],[1,"row"],[1,"col","col-lg-6"],["appearance","outline"],i,["name","book","required","",3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],r,["name","amount","type","number","step","1","min","0.01","required","","matInput","",3,"ngModel","ngModelChange"],c,["name","bizDatetime","matInput","","required","",3,"matDatepicker","ngModel","ngModelChange"],["matSuffix","",3,"for"],["color","primary"],["picker",""],[1,"col"],l,["name","comment","matInput","",3,"ngModel","ngModelChange"],[1,"container-fluid","pt-3","pb-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2",3,"disabled"],d,["type","button","mat-flat-button","","color","primary",1,"me-2",3,"disabled","click"],g,["type","button","mat-flat-button","","color","accent",1,"me-2",3,"disabled","click"],s,["type","button","mat-stroked-button","","color","accent",1,"me-2",3,"disabled","click"],A,[1,"container-fluid","pt-3"],S,["name","account","required","",3,"ngModel","ngModelChange"],p,["name","payCategory","required","",3,"ngModel","ngModelChange"],[3,"label",4,"ngFor","ngForOf"],E,["name","tags","multiple","",3,"compareWith","ngModel","ngModelChange"],u,["name","txnObject",3,"ngModel","ngModelChange"],["value",""],h,["name","member","multiple","","required","",3,"ngModel","ngModelChange"],H,["name","reimburse",3,"ngModel","ngModelChange"],[3,"value"],B,tt,y,[3,"label"],lt,dt,["name","revenueCategory","required","",3,"ngModel","ngModelChange"],et,ut,nt,R,K,O,W,_t,["name","account","required","",3,"ngModel","forbiddenSame","ngModelChange"],N,["name","transferObject","required","",3,"ngModel","forbiddenSame","ngModelChange"],mt,["name","lendType","required","",3,"ngModel","ngModelChange"],[3,"value","ngSwitch",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],["name","creditor","required","",3,"ngModel","ngModelChange"],[3,"value","ngSwitch"],At,U,Ye,Le,Qe,Ge,Je,Xe,ze,qe,Fe,je]},template:function(e,_){if(1&e&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return _.save()}),t.TgZ(1,"mat-tab-group",1),t.NdJ("selectedIndexChange",function(i){return _.selectedTabIndex=i})("selectedTabChange",function(i){return _.onSelectedTabChange(i)}),t._UZ(2,"mat-tab",2)(3,"mat-tab",3)(4,"mat-tab",4)(5,"mat-tab",5),t.qZA(),t.TgZ(6,"div",6),t.YNc(7,eo,50,15,"div",7),t.YNc(8,ro,52,15,"div",7),t.YNc(9,lo,14,6,"div",7),t.YNc(10,Do,27,16,"div",7),t.TgZ(11,"div",8)(12,"div",9)(13,"div",10)(14,"mat-form-field",11)(15,"mat-label"),t.SDv(16,12),t.qZA(),t.TgZ(17,"mat-select",13),t.NdJ("ngModelChange",function(i){return _.entry.bkId=i})("selectionChange",function(i){return _.onBookSelectionChange(i)}),t.YNc(18,Io,2,2,"mat-option",14),t.qZA()()()(),t.TgZ(19,"div",9)(20,"div",10)(21,"mat-form-field",11)(22,"mat-label"),t.SDv(23,15),t.qZA(),t.TgZ(24,"input",16),t.NdJ("ngModelChange",function(i){return _.entry.amount=i}),t.qZA()()(),t.TgZ(25,"div",10)(26,"mat-form-field",11)(27,"mat-label"),t.SDv(28,17),t.qZA(),t.TgZ(29,"input",18),t.NdJ("ngModelChange",function(i){return _.bizDatetime=i}),t.qZA(),t._UZ(30,"mat-datepicker-toggle",19),t.TgZ(31,"mat-datepicker",20,21)(33,"mat-datepicker-actions"),t._UZ(34,"mat-timepicker"),t.qZA()()()()(),t.TgZ(35,"div",9)(36,"div",22)(37,"mat-form-field",11)(38,"mat-label"),t.SDv(39,23),t.qZA(),t.TgZ(40,"textarea",24),t.NdJ("ngModelChange",function(i){return _.entry.comment=i}),t.qZA()()()()()(),t.TgZ(41,"div",25)(42,"button",26)(43,"mat-icon"),t._uU(44,"save"),t.qZA(),t.ynx(45),t.SDv(46,27),t.BQk(),t.qZA(),t.TgZ(47,"button",28),t.NdJ("click",function(){return _.saveAs()}),t.TgZ(48,"mat-icon"),t._uU(49,"file_copy"),t.qZA(),t.ynx(50),t.SDv(51,29),t.BQk(),t.qZA(),t.TgZ(52,"button",30),t.NdJ("click",function(){return _.saveAndNew()}),t.TgZ(53,"mat-icon"),t._uU(54,"post_add"),t.qZA(),t.ynx(55),t.SDv(56,31),t.BQk(),t.qZA(),t.TgZ(57,"button",32),t.NdJ("click",function(){return _.cancel()}),t.TgZ(58,"mat-icon"),t._uU(59,"cancel"),t.qZA(),t.ynx(60),t.SDv(61,33),t.BQk(),t.qZA()()()),2&e){const o=t.MAs(32);t.xp6(1),t.Q6J("selectedIndex",_.selectedTabIndex),t.xp6(6),t.Q6J("ngIf",0===_.selectedTabIndex),t.xp6(1),t.Q6J("ngIf",1===_.selectedTabIndex),t.xp6(1),t.Q6J("ngIf",2===_.selectedTabIndex),t.xp6(1),t.Q6J("ngIf",3===_.selectedTabIndex),t.xp6(7),t.Q6J("ngModel",_.entry.bkId),t.xp6(1),t.Q6J("ngForOf",_.books),t.xp6(6),t.Q6J("ngModel",_.entry.amount),t.xp6(5),t.Q6J("matDatepicker",o)("ngModel",_.bizDatetime),t.xp6(1),t.Q6J("for",o),t.xp6(10),t.Q6J("ngModel",_.entry.comment),t.xp6(2),t.Q6J("disabled",_.saving),t.xp6(5),t.Q6J("disabled",_.saving||_.isNew),t.xp6(5),t.Q6J("disabled",_.saving),t.xp6(5),t.Q6J("disabled",_.saving)}},dependencies:[M.sg,M.O5,M.RF,M.n9,f._Y,f.Fj,f.wV,f.JJ,f.JL,f.Q7,f.qQ,f.On,f.F,Tt.lW,I.Mq,I.hl,I.nW,I.M5,$.KE,$.hX,$.R9,Rt.Hw,oe.Nt,Wt.gD,k.ey,k.Nv,ke.a,Nt.SP,Nt.uX],styles:[".mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),n})();const yo=[{path:"dashboard",component:t_},{path:"accounts",component:M_},{path:"search",component:ga},{path:"accounts/:accountId",component:Ya},{path:"entry/add/:accountId",outlet:"secondary",component:He},{path:"entry/:bookId/:entryId",outlet:"secondary",component:He},{path:"balance/:entryId",outlet:"secondary",component:(()=>{class n{constructor(e,_,o,i,r,c,l,d){this.elementRef=e,this.router=_,this.route=o,this.dateAdapter=i,this.communication=r,this.notification=c,this.databaseService=l,this.operation=d,this.selectedTabIndex=0,this.saving=!1,this.subscription=new at.w0,this.router.getCurrentNavigation()?(this.entry=this.router.getCurrentNavigation().extras.state,this.entry?(this.entry.amount=this.entry.accountBalance,this.bizDatetime=this.dateAdapter.deserialize(this.entry.bizTime)):this.entry=new ie):this.entry=new ie}ngOnInit(){}ngOnDestroy(){this.subscription.unsubscribe()}save(){this.update().subscribe(e=>{e&&this.cancel()})}saveAndNew(){const e=this.entryForm.controls;this.entryForm.form.updateValueAndValidity();for(const _ in e)e[_].markAsTouched();this.update().subscribe(_=>{_&&(this.entry.id=0)})}cancel(){this.operation.closeSecondaryOutlet(this.route.parent)}update(){if(this.entryForm&&this.entryForm.valid){const e=this.entry;return e.bizTime=this.bizDatetime.toISOString(),typeof e.comment>"u"&&(e.comment=""),this.saving=!0,this.notification.showLoading(this.elementRef.nativeElement),this.databaseService.saveEntry([e]).pipe((0,Q.K)(()=>(0,v.of)(!1)),(0,G.U)(_=>!("boolean"!=typeof _&&_.error)),(0,Z.x)(()=>{this.saving=!1,this.notification.hideLoading(),this.communication.giveRefreshCommand()}))}return(0,v.of)(!1)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(Y.F0),t.Y36(Y.gz),t.Y36(k._A),t.Y36(gt.O),t.Y36(ct.g),t.Y36(st),t.Y36(yt))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-balance-modifier"]],viewQuery:function(e,_){if(1&e&&t.Gf(f.F,5),2&e){let o;t.iGM(o=t.CRH())&&(_.entryForm=o.first)}},hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],decls:31,vars:6,consts:function(){let a,e,_,o,i;return a="Balance modification",e="Amount",_="Time",o="Save",i="Cancel",[["name","entryForm",1,"d-flex","flex-column","flex-nowrap","flex-fill","overflow-hidden",3,"ngSubmit"],["color","primary"],["label",a],[1,"flex-fill","overflow-auto"],[1,"container-fluid","py-3"],[1,"row"],[1,"col","col-lg-6"],["appearance","legacy"],e,["name","amount","type","number","step","1","required","","matInput","",3,"ngModel","ngModelChange"],_,["name","bizDatetime","matInput","","required","",3,"matDatepicker","ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],[1,"container-fluid","pt-3","pb-3","text-end"],["type","submit","mat-flat-button","","color","primary",1,"me-2",3,"disabled"],o,["type","button","mat-flat-button","","color","warn",1,"me-2",3,"disabled","click"],i]},template:function(e,_){if(1&e&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return _.save()}),t.TgZ(1,"mat-tab-group",1),t._UZ(2,"mat-tab",2),t.qZA(),t.TgZ(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"mat-form-field",7)(8,"mat-label"),t.SDv(9,8),t.qZA(),t.TgZ(10,"input",9),t.NdJ("ngModelChange",function(i){return _.entry.amount=i}),t.qZA()()(),t.TgZ(11,"div",6)(12,"mat-form-field",7)(13,"mat-label"),t.SDv(14,10),t.qZA(),t.TgZ(15,"input",11),t.NdJ("ngModelChange",function(i){return _.bizDatetime=i}),t.qZA(),t._UZ(16,"mat-datepicker-toggle",12),t.TgZ(17,"mat-datepicker",1,13),t._UZ(19,"mat-timepicker"),t.qZA()()()()()(),t.TgZ(20,"div",14)(21,"button",15)(22,"mat-icon"),t._uU(23,"save"),t.qZA(),t.ynx(24),t.SDv(25,16),t.BQk(),t.qZA(),t.TgZ(26,"button",17),t.NdJ("click",function(){return _.cancel()}),t.TgZ(27,"mat-icon"),t._uU(28,"cancel"),t.qZA(),t.ynx(29),t.SDv(30,18),t.BQk(),t.qZA()()()),2&e){const o=t.MAs(18);t.xp6(10),t.Q6J("ngModel",_.entry.amount),t.xp6(5),t.Q6J("matDatepicker",o)("ngModel",_.bizDatetime),t.xp6(1),t.Q6J("for",o),t.xp6(5),t.Q6J("disabled",_.saving),t.xp6(5),t.Q6J("disabled",_.saving)}},dependencies:[f._Y,f.Fj,f.wV,f.JJ,f.JL,f.Q7,f.On,f.F,Tt.lW,I.Mq,I.hl,I.nW,$.KE,$.hX,$.R9,Rt.Hw,oe.Nt,ke.a,Nt.SP,Nt.uX],styles:[".mat-form-field[_ngcontent-%COMP%]{width:100%}"]}),n})()}];let Oo=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[Y.Bz.forChild(yo),Y.Bz]}),n})(),xo=(()=>{class n{constructor(e){this.notification=e}intercept(e,_){return Date.now(),_.handle(e).pipe((0,we.b)({next:r=>{r instanceof Ht.Zn&&r.body?.error&&this.notification.openError(r.body.error)}}))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(ct.g))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})(),vo=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[{provide:t.EJc,useValue:"CNY"},{provide:Ht.TP,useClass:xo,multi:!0},ve,M.H9,st,yt,Ot.s,se],imports:[cn.S,M.ez,Ht.JF,Yt.g,_n,on.t,Et.TU,an.JX,b.p0,Nt.Nh,rn.m,Oo]}),n})()}}]);