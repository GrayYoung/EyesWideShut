"use strict";(self.webpackChunkbank=self.webpackChunkbank||[]).push([[735],{1735:(ot,O,v)=>{v.r(O),v.d(O,{DemoModule:()=>wt});var h=v(1180),D=v(6814),C=v(5187),w=v(2495),I=v(5619),q=v(7394),_=v(2181),R=v(6111),z=v(1687),A=v(7398),d=v(4460);function B([o,g,e]){const t=1<<e;return[o-Math.floor(o/t)*t,g-Math.floor(g/t)*t,e]}var u=v(5879);const T=Math.PI/180,tt=180/Math.PI,X=new u.OlP("MAP_PROJECTION");function nt(o,g){let e=0,t=0;for(;o.length>e;++e)t+=o[e]*g[e];return t}let G=(()=>{class o{get d3Projection(){return this._projection}get geoPath(){return this._path}constructor(e){(0,h.Z)(this,"_projection",void 0),(0,h.Z)(this,"_path",void 0),this._projection=e,this._path=d.l49().projection(e)}fromLatLngToPoint(e){return this._projection(e)}fromPointToLatLng(e,t=!1){return this._projection.invert(e)}fromLatLngToRotate(e){const t=e[0]*T,n=e[1]*T;return[Math.cos(n)*Math.cos(t),Math.cos(n)*Math.sin(t),Math.sin(n)]}getCenter(){return[-this.wrapLong(this._projection.rotate()[0]),-this.wrapLat(this._projection.rotate()[1])]}getZoom(){return Math.round(Math.max(Math.log2(this.getRadius()*(2*Math.PI)/this.getTileSize()),0))}getRadius(){return this._projection.scale()}setRadius(e){this._projection.scale(e/(2*Math.PI))}getTileSize(){return 256}setDimension(e,t){this._projection.translate([e/2,t/2])}wrapLat(e,t=-90,n=90){const r=n-t,s=Math.pow(-1,Math.floor(e/r));return(e=Math.abs(e%r)*s)>=t&&e<=n||(e=(r-e*s)*s),e}wrapLong(e,t=-180,n=180){return e>=t&&e<n||(e=((e-t)%(n-=t)+n)%n+t),e}eulerAngles(e,t,n){const r=.5*n[0]*T,s=.5*n[1]*T,m=.5*n[2]*T,c=Math.sin(r),i=Math.cos(r),p=Math.sin(s),l=Math.cos(s),P=Math.sin(m),x=Math.cos(m),M=[i*l*x+c*p*P,c*l*x-i*p*P,i*p*x+c*l*P,i*l*P-c*p*x],a=this.fromLatLngToRotate(e),y=this.fromLatLngToRotate(t),f=function lt(o,g){return[o[1]*g[2]-o[2]*g[1],o[2]*g[0]-o[0]*g[2],o[0]*g[1]-o[1]*g[0]]}(a,y),E=Math.sqrt(nt(f,f));if(0===E)return n;const S=.5*Math.acos(Math.max(-1,Math.min(1,nt(a,y)))),F=f[2]*Math.sin(S)/E,L=-f[1]*Math.sin(S)/E,Y=f[0]*Math.sin(S)/E,b=Math.cos(S),j=S&&[b,F,L,Y],$=M[0],H=M[1],W=M[2],J=M[3],K=j[0],N=j[1],V=j[2],Q=j[3],Z=[$*K-H*N-W*V-J*Q,H*K+$*N+W*Q-J*V,$*V-H*Q+W*K+J*N,$*Q+H*V-W*N+J*K];return[Math.atan2(2*(Z[0]*Z[1]+Z[2]*Z[3]),1-2*(Z[1]*Z[1]+Z[2]*Z[2]))*tt,Math.asin(Math.max(-1,Math.min(1,2*(Z[0]*Z[2]-Z[3]*Z[1]))))*tt,Math.atan2(2*(Z[0]*Z[3]+Z[1]*Z[2]),1-2*(Z[2]*Z[2]+Z[3]*Z[3]))*tt]}}return(0,h.Z)(o,"\u0275fac",function(e){return new(e||o)(u.LFG(X))}),(0,h.Z)(o,"\u0275prov",u.Yz7({token:o,factory:o.\u0275fac})),o})();const ut={provide:X,deps:[[new u.FiY,new u.tp0,X]],useFactory:function ht(o,g){return o}};var et=v(6593);let st=(()=>{class o{constructor(e){(0,h.Z)(this,"titleService",void 0),(0,h.Z)(this,"oldTitle",void 0),this.titleService=e,this.oldTitle=e.getTitle()}ngOnDestroy(){this.titleService.setTitle(this.oldTitle)}setTitle(e){this.titleService.setTitle(e)}}return(0,h.Z)(o,"\u0275fac",function(e){return new(e||o)(u.Y36(et.Dx,8))}),(0,h.Z)(o,"\u0275dir",u.lG2({type:o})),o})();const U=new u.OlP("MAP_SOURCE");let pt=(()=>{class o{constructor(e){(0,h.Z)(this,"locale",void 0),this.locale=e}url(e,t,n){return`https://khms1.googleapis.com/kh?v=917&hl=${this.locale}&x=${e}&y=${t}&z=${n}`}}return(0,h.Z)(o,"\u0275fac",function(e){return new(e||o)(u.LFG(u.soG))}),(0,h.Z)(o,"\u0275prov",u.Yz7({token:o,factory:o.\u0275fac})),o})();const rt={provide:U,deps:[[new u.FiY,new u.tp0,U],u.soG],useFactory:function mt(o,g){return o||new pt(g)}};var ft=v(9829);let at=(()=>{class o{constructor(){}mapMatrixToSphere(e,t,n,r,s,m){const c=t[0]*T,i=n[0]*T,p=t[1]*T,l=n[1]*T,P=new Uint8ClampedArray(m*m*4);let x,M,a;r=[r[0]*T,r[1]*T,r[2]*T];for(let y=0;y<m;y++)for(let f=0;f<m;f++)x=this.mapPoint([y,f],c,i,p,l,r,s,m),M=4*(y+f*m),a=4*(x[0]+s+(x[1]+s)*m),P[a]=e[M],P[a+1]=e[M+1],P[a+2]=e[M+2],P[a+3]=e[M+3];return P}mapPoint(e,t,n,r,s,m,c,i){const p=this.mapCoordinate(0,i-1,n,t,e[0]),l=this.mapCoordinate(0,i-1,r,s,e[1]);let a,P=c*Math.sin(l)*Math.cos(p),x=c*Math.sin(l)*Math.sin(p),M=c*Math.cos(l);return a=this.rotate(m[0],x,M),x=a.r1,M=a.r2,a=this.rotate(m[1],P,M),P=a.r1,M=a.r2,[P,x,M]}mapCoordinate(e,t,n,r,s){return(s-e)/(t-e)*(r-n)+n}rotate(e,t,n){return{r1:t*Math.cos(e)-n*Math.sin(e),r2:t*Math.sin(e)+n*Math.cos(e)}}}return(0,h.Z)(o,"\u0275fac",function(e){return new(e||o)}),(0,h.Z)(o,"\u0275prov",u.Yz7({token:o,factory:o.\u0275fac})),o})(),dt=(()=>{class o extends st{constructor(e,t,n,r,s,m,c,i){super(e),(0,h.Z)(this,"elementRef",void 0),(0,h.Z)(this,"renderer",void 0),(0,h.Z)(this,"document",void 0),(0,h.Z)(this,"viewportRuler",void 0),(0,h.Z)(this,"mapSource",void 0),(0,h.Z)(this,"mapProjection",void 0),(0,h.Z)(this,"sphereSurface",void 0),(0,h.Z)(this,"hostClassList","d-flex flex-column flex-nowrap w-100 h-100"),(0,h.Z)(this,"mapZoomEvent",new I.X(null)),(0,h.Z)(this,"zoom",void 0),(0,h.Z)(this,"drag",void 0),(0,h.Z)(this,"content",void 0),(0,h.Z)(this,"surfaceContext",void 0),(0,h.Z)(this,"subscription",new q.w0),this.elementRef=t,this.renderer=n,this.document=r,this.viewportRuler=s,this.mapSource=m,this.mapProjection=c,this.sphereSurface=i,this.setTitle("Demo d3 Earth")}ngOnInit(){this.zoom=d.sPX().on("zoom",t=>{this.mapZoomEvent.next(t)}),this.drag=d.ohM().on("drag",t=>{const n=this.mapProjection.d3Projection.rotate();if(0!==t.dx&&0!==t.dy){const r=this.mapProjection.fromPointToLatLng([t.x,t.y]),s=this.mapProjection.fromPointToLatLng([t.x-t.dx,t.y-t.dy]);this.mapProjection.d3Projection.rotate(this.mapProjection.eulerAngles(s,r,n)),this.mapZoomEvent.next({sourceEvent:t.sourceEvent,target:null,type:t.type,transform:this.mapZoomEvent.value?.transform})}}),this.mapZoomEvent.next({sourceEvent:{},target:null,type:"",transform:d.CRH});const e=this.renderer.createElement("canvas");this.renderer.setStyle(e,"position","absolute"),this.renderer.setStyle(e,"top","0"),this.renderer.setStyle(e,"left","0"),this.renderer.setStyle(e,"width","100%"),this.renderer.setStyle(e,"height","100%"),this.renderer.appendChild((0,w.fI)(this.elementRef),e),this.surfaceContext=e.getContext("2d")}ngAfterViewInit(){const e=(0,w.fI)(this.elementRef),t=d.Ue8("svg"),n=t.append("g").attr("class","map-content"),s=(n.append("path").attr("class","view-edge").attr("fill-opacity",.3).attr("fill","green").attr("stroke-width",0),n.append("g").attr("class","map-sphere").attr("fill","transparent").attr("stroke-width",1).attr("stroke","#888888"));s.append("path").attr("class","map-graticule"),this.content=t,t.append("clipPath").attr("id","rect-clip").append("rect").attr("x",0).attr("y",0),e.appendChild(t.node()),this.setViewDimension(),t.call(this.zoom).call(this.zoom.transform,this.mapZoomEvent.value.transform),s.call(this.drag),s.on("click",c=>{console.log(this.mapProjection.fromPointToLatLng([c.offsetX,c.offsetY]))}),this.mapZoomEvent.pipe((0,_.h)(c=>null!==c),(0,R.D)(c=>{const i=c.sourceEvent?.type;return(0,z.F)("mousemove"===i||"touchmove"===i?0:100)}),(0,A.U)(c=>{const i=this.mapProjection,p=this.getDimension(),l=this.zoom.scaleExtent(),P=Math.min(l[1],Math.max(l[0],Math.ceil(c.transform.k))),x=p.width>>1,M=p.height>>1;return i.d3Projection.translate([x,M]),i.setRadius(P),{...c,transform:new d.axH(P,x,M)}})).subscribe(c=>{console.log(c),this.render(c.transform)}),this.subscription.add(this.viewportRuler.change(100).subscribe(()=>{console.log("viewportRuler => change"),this.setViewDimension()}))}ngOnDestroy(){super.ngOnDestroy(),this.mapZoomEvent.complete(),this.subscription.unsubscribe()}setViewDimension(){const e=this.getDimension(),t=e.width,n=e.height,r=this.mapProjection.getTileSize(),s=Math.floor(Math.min(t,n)*Math.PI*.618),m=r<<18;let c=this.mapZoomEvent.value.transform;this.content.attr("viewBox",[0,0,t,n]),this.content.select("clipPath > rect").attr("width",t).attr("height",n),this.zoom.extent([[0,0],[t,n]]).scaleExtent([s,m]),c=c.translate(t>>1,n>>1),c.k<s&&(c=c.scale(s)),this.mapZoomEvent.next({...this.mapZoomEvent.value,transform:c})}render(e){const t=this.mapProjection;console.log(`transform: ${e}`),console.log(t.getRadius());const n=t.getZoom(),r=1<<n,s=360/r,m=180/r,c=t.getCenter(),i=this.getDimension(),p=i.width,l=i.height,P=this.content.select(".map-graticule");let f,x=0,M=p,a=0,y=l;x=0,M=p,a=0,y=l,f=[t.fromPointToLatLng([0,0]),t.fromPointToLatLng([M,0]),t.fromPointToLatLng([M,y]),t.fromPointToLatLng([0,y]),t.fromPointToLatLng([0,0])],f[0]=f[4]=[t.wrapLong(Math.floor(f[0][0]/s)*s),t.wrapLat(Math.ceil(f[0][1]/m)*m)],f[1]=[t.wrapLong(Math.ceil(f[1][0]/s)*s),t.wrapLat(Math.ceil(f[1][1]/m)*m)],f[2]=[t.wrapLong(Math.ceil(f[2][0]/s)*s),t.wrapLat(Math.floor(f[2][1]/m)*m)],f[3]=[t.wrapLong(Math.floor(f[3][0]/s)*s),t.wrapLat(Math.floor(f[3][1]/m)*m)];const S=d.SaU().step([s,m]).precision(m)();console.log(`stepDegX: ${s} | stepDegY: ${m}`),P.attr("d",t.geoPath(S)),console.log(f),console.log(`center: ${c}`),console.log(`${n} <=> ${r}`),this.content.select(".view-edge").attr("d",t.geoPath({type:"Polygon",coordinates:[f]})),this.showGuideline(f,s,m),this.brushTiles(f,s,m,n,r)}brushTiles(e,t,n,r,s){const m=this.mapSource,c=this.mapProjection,i=this.sphereSurface,p=this.mapProjection.getTileSize(),l=this.document.createElement("canvas"),P=l.getContext("2d"),x=this.surfaceContext,M=[];l.width=l.height=p;for(let a=e[0][0];a<=e[2][0];a=c.wrapLong(a+t)){for(let y=e[2][1];y<=e[0][1]&&(M.push([a,y]),d.BHj(m.url.apply(m,B([a/t,y/n,r])),{crossOrigin:"anonymous"}).then(f=>{P.drawImage(f,0,0,p,p),x.putImageData(new ImageData(i.mapMatrixToSphere(P.getImageData(0,0,p,p).data,[a,y],[c.wrapLong(a+t),c.wrapLat(y+n)],c.d3Projection.rotate(),c.getRadius(),p),p,p),0,0)}),!(M.length>=s));y=c.wrapLat(y+n));if(M.length>=s)break}}showGuideline(e,t,n){const r=this.mapProjection,s=d.ut0().domain([-180,-91,-90,-1,1,89,90,180]).range(["blue","blue","green","green","black","red","red","yellow"]),m=[],c=this.content.select(".map-sphere");c.selectAll(".bounds-point").data(e).join("path").attr("class","bounds-point").attr("stroke","black").attr("stroke-width",2).attr("d",i=>r.geoPath({type:"Point",coordinates:i})).on("click",function(i){console.log(d.Ys(i.target).data()[0]),i.stopPropagation()});for(let i=-180;i<=180;i+=t)m.push([i,0]);for(let i=-90;i<=90;i+=n)m.push([0,i]);c.selectAll(".grid-point").data(m).join("path").attr("class","grid-point").attr("fill",function(i){return s(i[0]||i[1])}).attr("stroke-width",0).attr("d",i=>r.geoPath({type:"Point",coordinates:i})).on("click",function(i){console.log(d.Ys(i.target).data()[0]),i.stopPropagation()})}getDimension(){return(0,w.fI)(this.elementRef).getBoundingClientRect()}}return(0,h.Z)(o,"\u0275fac",function(e){return new(e||o)(u.Y36(et.Dx),u.Y36(u.SBq),u.Y36(u.Qsj),u.Y36(D.K0),u.Y36(ft.rL),u.Y36(U),u.Y36(G),u.Y36(at))}),(0,h.Z)(o,"\u0275cmp",u.Xpm({type:o,selectors:[["app-earth"]],hostVars:2,hostBindings:function(e,t){2&e&&u.Tol(t.hostClassList)},features:[u._Bn([rt,{provide:X,useValue:d.WvA()},G]),u.qOj],decls:0,vars:0,template:function(e,t){},encapsulation:2})),o})();function gt(o){return o.k}function Mt(o){return[o.x,o.y]}function it(o){return function(){return o}}var Pt=v(3680);const k=864e5,xt=d.i$Z("%d"),vt=d.i$Z("%B"),Zt=d.i$Z("%Y"),Et=[{path:"earth",component:dt},{path:"map",component:(()=>{class o extends st{constructor(e,t,n,r,s){super(e),(0,h.Z)(this,"elementRef",void 0),(0,h.Z)(this,"dateAdapter",void 0),(0,h.Z)(this,"mapSource",void 0),(0,h.Z)(this,"mapProjection",void 0),(0,h.Z)(this,"mapZoomEvent",new u.vpe),(0,h.Z)(this,"axisZoomEvent",new u.vpe),(0,h.Z)(this,"useScaleType","year"),this.elementRef=t,this.dateAdapter=n,this.mapSource=r,this.mapProjection=s,this.setTitle("Demo d3 Map")}ngAfterViewInit(){const e=(0,w.fI)(this.elementRef),t=e.getBoundingClientRect(),n=t.width,r=t.height,s=d.Ue8("svg").attr("viewBox",[0,0,n,r]);s.append("clipPath").attr("id","rect-clip").append("rect").attr("x",0).attr("y",0).attr("width",n).attr("height",r),this.createMapTiles(s,n,r),this.createXAxis(s,n,r),e.appendChild(s.node())}ngOnDestroy(){super.ngOnDestroy(),this.mapZoomEvent.complete(),this.axisZoomEvent.complete()}createMapTiles(e,t,n){const r=this.mapSource,s=this.mapProjection,m=s.getTileSize(),i=[Math.min(t,n),m<<18],p=function yt(){let o=0,g=0,e=960,t=500,n=!0,r=!0,s=256,m=gt,c=Mt,i=0;function p(){const l=+m.apply(this,arguments),P=c.apply(this,arguments),x=Math.log2(l/s),M=Math.round(Math.max(x+i,0)),a=Math.pow(2,x-M)*s,y=+P[0]-l/2,f=+P[1]-l/2,E=Math.max(n?0:-1/0,Math.floor((o-y)/a)),S=Math.min(n?1<<M:1/0,Math.ceil((e-y)/a)),F=Math.max(r?0:-1/0,Math.floor((g-f)/a)),L=Math.min(r?1<<M:1/0,Math.ceil((t-f)/a)),Y=[];for(let b=F;b<L;++b)for(let j=E;j<S;++j)Y.push([j,b,M]);return Y.translate=[y/a,f/a],Y.scale=a,Y}return p.size=function(l){return arguments.length?(o=g=0,e=+l[0],t=+l[1],p):[e-o,t-g]},p.extent=function(l){return arguments.length?(o=+l[0][0],g=+l[0][1],e=+l[1][0],t=+l[1][1],p):[[o,g],[e,t]]},p.scale=function(l){return arguments.length?(m="function"==typeof l?l:it(+l),p):m},p.translate=function(l){return arguments.length?(c="function"==typeof l?l:it([+l[0],+l[1]]),p):c},p.zoomDelta=function(l){return arguments.length?(i=+l,p):i},p.tileSize=function(l){return arguments.length?(s=+l,p):s},p.clamp=function(l){return arguments.length?(n=r=!!l,p):n&&r},p.clampX=function(l){return arguments.length?(n=!!l,p):n},p.clampY=function(l){return arguments.length?(r=!!l,p):r},p}().extent([[0,0],[t,n]]).tileSize(m).clampX(!1).clampY(!1),l=d.CRH.translate(t>>1,n>>1).scale(4096),P=d.sPX().scaleExtent(i).extent([[0,0],[t,n]]).on("zoom",a=>{let S,y=a.transform.k,f=a.transform.x,E=a.transform.y;y<=i[0]&&(y=i[0],E=n/2),y=Math.round(y),f=Math.round(f),E=Math.round(E),S=new d.axH(y,f,E),s.d3Projection.translate([f,E]),s.setRadius(y),this.mapZoomEvent.next({...a,transform:S})}),x=e.append("g").attr("class","map-content"),M=x.selectAll("g").data([-100,-2,-1,0]).join("g").attr("class","map-layer");this.mapZoomEvent.pipe((0,R.D)(a=>{const y=a.sourceEvent?.type;return(0,z.F)("mousemove"===y||"touchmove"===y?0:100)})).subscribe(a=>{let f,y=s.getTileSize();M.each((E,S,F)=>{f=p.zoomDelta(E)(a.transform),y=f.scale,d.Ys(F[S]).selectAll("image").data(f).join("image").attr("xlink:href",L=>r.url.apply(r,B(L))).attr("x",L=>(L[0]+f.translate[0])*y).attr("y",L=>(L[1]+f.translate[1])*y).attr("width",y).attr("height",y).attr("class","map-tile").on("error",function(){d.Ys(this).style("opacity",0)})})}),x.call(P).call(P.transform,l).on("click",a=>{console.log(s.fromPointToLatLng([a.offsetX,a.offsetY]))})}createXAxis(e,t,n){const r=this.dateAdapter.today(),s=this.dateAdapter.addCalendarYears(r,-20),m=Math.ceil((r.valueOf()-s.valueOf())/k),c=e.append("g").attr("clip-path","url(#rect-clip)"),i=d.Xf().domain([s,r]).rangeRound([0,t]).nice(d.jBk),l=[[0,0],[t,30]],P=d.sPX().scaleExtent([1,Math.max(t/40,Math.min(365,m))]).translateExtent(l).extent(l).on("zoom",a=>{this.axisZoomEvent.next(a)}),x=d.LLu(i).tickSize(8).tickPadding(5).ticks(t/80).tickFormat(a=>(d.F0B(a)<a?xt:d.jBk(a)<a?vt:Zt)(a));let M=d.CRH.scale(t/(i(r)-i(s))).translate(-i(s),0);this.axisZoomEvent.subscribe(a=>{M=a.transform,this.useScaleType=M.k<=12?"year":M.k<=30?"month":"day",c.select(".x-axis").call(x.scale(M.rescaleX(i)))}),c.append("rect").attr("fill","white").attr("x",0).attr("y",n-30).attr("width",t).attr("height",30),c.append("g").attr("class","x-axis").attr("transform",`translate(0,${n-30})`).style("user-select","none").call(x),c.call(P).transition().duration(1500).call(P.transform,M),c.on("click",a=>{console.log(d.rr1(M.rescaleX(i).invert(a.offsetX)))})}createTimeInterval(e){return d.JZ7(t=>{switch(this.useScaleType){case"year":t.setMonth(0,1);break;case"month":t.setDate(1)}t.setHours(0,0,0,0)},(t,n)=>{switch(this.useScaleType){case"year":t.setFullYear(t.getFullYear()+n);break;case"month":t.setMonth(t.getMonth()+n);break;default:t.setDate(t.getDate()+n)}},(t,n)=>{const r=(n.valueOf()-t.valueOf()-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/k;return console.log(r),r<=60?e/60:e/80},t=>{switch(this.useScaleType){case"year":return t.getFullYear();case"month":return t.getMonth();default:return t.getDate()-1}})}}return(0,h.Z)(o,"\u0275fac",function(e){return new(e||o)(u.Y36(et.Dx),u.Y36(u.SBq),u.Y36(Pt._A),u.Y36(U),u.Y36(G))}),(0,h.Z)(o,"\u0275cmp",u.Xpm({type:o,selectors:[["app-map"]],hostAttrs:[1,"d-flex","flex-column","flex-nowrap","w-100","h-100"],features:[u._Bn([rt,ut,G]),u.qOj],decls:0,vars:0,template:function(e,t){},encapsulation:2})),o})()},{path:"",redirectTo:"map",pathMatch:"full"},{path:"**",redirectTo:"map"}];let St=(()=>{class o{}return(0,h.Z)(o,"\u0275fac",function(e){return new(e||o)}),(0,h.Z)(o,"\u0275mod",u.oAB({type:o})),(0,h.Z)(o,"\u0275inj",u.cJS({imports:[C.Bz.forChild(Et),C.Bz]})),o})(),Tt=(()=>{class o{}return(0,h.Z)(o,"\u0275fac",function(e){return new(e||o)}),(0,h.Z)(o,"\u0275mod",u.oAB({type:o})),(0,h.Z)(o,"\u0275inj",u.cJS({providers:[at],imports:[D.ez]})),o})(),wt=(()=>{class o{}return(0,h.Z)(o,"\u0275fac",function(e){return new(e||o)}),(0,h.Z)(o,"\u0275mod",u.oAB({type:o})),(0,h.Z)(o,"\u0275inj",u.cJS({imports:[D.ez,St,Tt]})),o})()},1687:(ot,O,v)=>{v.d(O,{F:()=>C});var h=v(6321),D=v(4825);function C(w=0,I=h.z){return w<0&&(w=0),(0,D.H)(w,w,I)}},6111:(ot,O,v)=>{v.d(O,{D:()=>I});var h=v(9360),D=v(2420),C=v(8251),w=v(4829);function I(q){return(0,h.e)((_,R)=>{let z=!1,A=null,d=null;const B=()=>{if(d?.unsubscribe(),d=null,z){z=!1;const u=A;A=null,R.next(u)}};_.subscribe((0,C.x)(R,u=>{d?.unsubscribe(),z=!0,A=u,d=(0,C.x)(R,B,D.Z),(0,w.Xf)(q(u)).subscribe(d)},()=>{B(),R.complete()},void 0,()=>{A=d=null}))})}}}]);